
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'engine-dev/cocos2d/core/asset-manager/urlTransformer.js';
                    var __require = nodeEnv ? function (request) {
                        return require(request);
                    } : function (request) {
                        return __quick_compile_engine__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_engine__.registerModule(__filename, module);}"use strict";

/****************************************************************************
 Copyright (c) 2019 Xiamen Yaji Software Co., Ltd.

 https://www.cocos.com/

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated engine source code (the "Software"), a limited,
  worldwide, royalty-free, non-assignable, revocable and non-exclusive license
 to use Cocos Creator solely to develop games on your target platforms. You shall
  not use Cocos Creator software for developing other software or tools that's
  used for developing games. You are not granted to publish, distribute,
  sublicense, and/or sell copies of Cocos Creator.

 The software or tools in this License Agreement are licensed, not sold.
 Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 THE SOFTWARE.
 ****************************************************************************/
var _require = require('./helper'),
    decodeUuid = _require.decodeUuid;

var RequestItem = require('./request-item');

var _require2 = require('./shared'),
    RequestType = _require2.RequestType,
    bundles = _require2.bundles;

function parse(task) {
  var input = task.input,
      options = task.options;
  input = Array.isArray(input) ? input : [input];
  task.output = [];

  for (var i = 0; i < input.length; i++) {
    var item = input[i];
    var out = RequestItem.create();

    if (typeof item === 'string') {
      item = Object.create(null);
      item[options.__requestType__ || RequestType.UUID] = input[i];
    }

    if (typeof item === 'object') {
      // local options will overlap glabal options
      cc.js.addon(item, options);

      if (item.preset) {
        cc.js.addon(item, cc.assetManager.presets[item.preset]);
      }

      for (var key in item) {
        switch (key) {
          case RequestType.UUID:
            var uuid = out.uuid = decodeUuid(item.uuid);

            if (bundles.has(item.bundle)) {
              var config = bundles.get(item.bundle)._config;

              var info = config.getAssetInfo(uuid);

              if (info && info.redirect) {
                if (!bundles.has(info.redirect)) throw new Error("Please load bundle " + info.redirect + " first");
                config = bundles.get(info.redirect)._config;
                info = config.getAssetInfo(uuid);
              }

              out.config = config;
              out.info = info;
            }

            out.ext = item.ext || '.json';
            break;

          case '__requestType__':
          case 'ext':
          case 'bundle':
          case 'preset':
          case 'type':
            break;

          case RequestType.DIR:
            if (bundles.has(item.bundle)) {
              var infos = [];

              bundles.get(item.bundle)._config.getDirWithPath(item.dir, item.type, infos);

              for (var _i = 0, l = infos.length; _i < l; _i++) {
                var info = infos[_i];
                input.push({
                  uuid: info.uuid,
                  __isNative__: false,
                  ext: '.json',
                  bundle: item.bundle
                });
              }
            }

            out.recycle();
            out = null;
            break;

          case RequestType.PATH:
            if (bundles.has(item.bundle)) {
              var config = bundles.get(item.bundle)._config;

              var info = config.getInfoWithPath(item.path, item.type);

              if (info && info.redirect) {
                if (!bundles.has(info.redirect)) throw new Error("you need to load bundle " + info.redirect + " first");
                config = bundles.get(info.redirect)._config;
                info = config.getAssetInfo(info.uuid);
              }

              if (!info) {
                out.recycle();
                throw new Error("Bundle " + item.bundle + " doesn't contain " + item.path);
              }

              out.config = config;
              out.uuid = info.uuid;
              out.info = info;
            }

            out.ext = item.ext || '.json';
            break;

          case RequestType.SCENE:
            if (bundles.has(item.bundle)) {
              var config = bundles.get(item.bundle)._config;

              var info = config.getSceneInfo(item.scene);

              if (info && info.redirect) {
                if (!bundles.has(info.redirect)) throw new Error("you need to load bundle " + info.redirect + " first");
                config = bundles.get(info.redirect)._config;
                info = config.getAssetInfo(info.uuid);
              }

              if (!info) {
                out.recycle();
                throw new Error("Bundle " + config.name + " doesn't contain scene " + item.scene);
              }

              out.config = config;
              out.uuid = info.uuid;
              out.info = info;
            }

            break;

          case '__isNative__':
            out.isNative = item.__isNative__;
            break;

          case RequestType.URL:
            out.url = item.url;
            out.uuid = item.uuid || item.url;
            out.ext = item.ext || cc.path.extname(item.url);
            out.isNative = item.__isNative__ !== undefined ? item.__isNative__ : true;
            break;

          default:
            out.options[key] = item[key];
        }

        if (!out) break;
      }
    }

    if (!out) continue;
    task.output.push(out);
    if (!out.uuid && !out.url) throw new Error('unknown input:' + item.toString());
  }

  return null;
}

function combine(task) {
  var input = task.output = task.input;

  for (var i = 0; i < input.length; i++) {
    var item = input[i];
    if (item.url) continue;
    var url = '',
        base = '';
    var config = item.config;

    if (item.isNative) {
      base = config && config.nativeBase ? config.base + config.nativeBase : cc.assetManager.generalNativeBase;
    } else {
      base = config && config.importBase ? config.base + config.importBase : cc.assetManager.generalImportBase;
    }

    var uuid = item.uuid;
    var ver = '';

    if (item.info) {
      if (item.isNative) {
        ver = item.info.nativeVer ? '.' + item.info.nativeVer : '';
      } else {
        ver = item.info.ver ? '.' + item.info.ver : '';
      }
    } // ugly hack, WeChat does not support loading font likes 'myfont.dw213.ttf'. So append hash to directory


    if (item.ext === '.ttf') {
      url = base + "/" + uuid.slice(0, 2) + "/" + uuid + ver + "/" + item.options.__nativeName__;
    } else {
      url = base + "/" + uuid.slice(0, 2) + "/" + uuid + ver + item.ext;
    }

    item.url = url;
  }

  return null;
}

module.exports = {
  parse: parse,
  combine: combine
};
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_engine__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImVuZ2luZS1kZXYvY29jb3MyZC9jb3JlL2Fzc2V0LW1hbmFnZXIvdXJsVHJhbnNmb3JtZXIuanMiXSwibmFtZXMiOlsicmVxdWlyZSIsImRlY29kZVV1aWQiLCJSZXF1ZXN0SXRlbSIsIlJlcXVlc3RUeXBlIiwiYnVuZGxlcyIsInBhcnNlIiwidGFzayIsImlucHV0Iiwib3B0aW9ucyIsIkFycmF5IiwiaXNBcnJheSIsIm91dHB1dCIsImkiLCJsZW5ndGgiLCJpdGVtIiwib3V0IiwiY3JlYXRlIiwiT2JqZWN0IiwiX19yZXF1ZXN0VHlwZV9fIiwiVVVJRCIsImNjIiwianMiLCJhZGRvbiIsInByZXNldCIsImFzc2V0TWFuYWdlciIsInByZXNldHMiLCJrZXkiLCJ1dWlkIiwiaGFzIiwiYnVuZGxlIiwiY29uZmlnIiwiZ2V0IiwiX2NvbmZpZyIsImluZm8iLCJnZXRBc3NldEluZm8iLCJyZWRpcmVjdCIsIkVycm9yIiwiZXh0IiwiRElSIiwiaW5mb3MiLCJnZXREaXJXaXRoUGF0aCIsImRpciIsInR5cGUiLCJsIiwicHVzaCIsIl9faXNOYXRpdmVfXyIsInJlY3ljbGUiLCJQQVRIIiwiZ2V0SW5mb1dpdGhQYXRoIiwicGF0aCIsIlNDRU5FIiwiZ2V0U2NlbmVJbmZvIiwic2NlbmUiLCJuYW1lIiwiaXNOYXRpdmUiLCJVUkwiLCJ1cmwiLCJleHRuYW1lIiwidW5kZWZpbmVkIiwidG9TdHJpbmciLCJjb21iaW5lIiwiYmFzZSIsIm5hdGl2ZUJhc2UiLCJnZW5lcmFsTmF0aXZlQmFzZSIsImltcG9ydEJhc2UiLCJnZW5lcmFsSW1wb3J0QmFzZSIsInZlciIsIm5hdGl2ZVZlciIsInNsaWNlIiwiX19uYXRpdmVOYW1lX18iLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7O0FBQUE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztlQXdCdUJBLE9BQU8sQ0FBQyxVQUFEO0lBQXRCQyxzQkFBQUE7O0FBQ1IsSUFBTUMsV0FBVyxHQUFHRixP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LE1BQWpCLEVBQXlCO0FBQ3JCbUIsTUFBQUEsR0FBRyxHQUFNSyxJQUFOLFNBQWNsQyxJQUFJLENBQUN5QyxLQUFMLENBQVcsQ0FBWCxFQUFjLENBQWQsQ0FBZCxTQUFrQ3pDLElBQWxDLEdBQXlDdUMsR0FBekMsU0FBZ0RwRCxJQUFJLENBQUNOLE9BQUwsQ0FBYTZELGNBQWhFO0FBQ0gsS0FGRCxNQUdLO0FBQ0RiLE1BQUFBLEdBQUcsR0FBTUssSUFBTixTQUFjbEMsSUFBSSxDQUFDeUMsS0FBTCxDQUFXLENBQVgsRUFBYyxDQUFkLENBQWQsU0FBa0N6QyxJQUFsQyxHQUF5Q3VDLEdBQXpDLEdBQStDcEQsSUFBSSxDQUFDdUIsR0FBdkQ7QUFDSDs7QUFFRHZCLElBQUFBLElBQUksQ0FBQzBDLEdBQUwsR0FBV0EsR0FBWDtBQUNIOztBQUNELFNBQU8sSUFBUDtBQUNIOztBQUVEYyxNQUFNLENBQUNDLE9BQVAsR0FBaUI7QUFBRWxFLEVBQUFBLEtBQUssRUFBTEEsS0FBRjtBQUFTdUQsRUFBQUEsT0FBTyxFQUFQQTtBQUFULENBQWpCIiwic291cmNlc0NvbnRlbnQiOlsiLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcbiBDb3B5cmlnaHQgKGMpIDIwMTkgWGlhbWVuIFlhamkgU29mdHdhcmUgQ28uLCBMdGQuXG5cbiBodHRwczovL3d3dy5jb2Nvcy5jb20vXG5cbiBQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5XG4gb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBlbmdpbmUgc291cmNlIGNvZGUgKHRoZSBcIlNvZnR3YXJlXCIpLCBhIGxpbWl0ZWQsXG4gIHdvcmxkd2lkZSwgcm95YWx0eS1mcmVlLCBub24tYXNzaWduYWJsZSwgcmV2b2NhYmxlIGFuZCBub24tZXhjbHVzaXZlIGxpY2Vuc2VcbiB0byB1c2UgQ29jb3MgQ3JlYXRvciBzb2xlbHkgdG8gZGV2ZWxvcCBnYW1lcyBvbiB5b3VyIHRhcmdldCBwbGF0Zm9ybXMuIFlvdSBzaGFsbFxuICBub3QgdXNlIENvY29zIENyZWF0b3Igc29mdHdhcmUgZm9yIGRldmVsb3Bpbmcgb3RoZXIgc29mdHdhcmUgb3IgdG9vbHMgdGhhdCdzXG4gIHVzZWQgZm9yIGRldmVsb3BpbmcgZ2FtZXMuIFlvdSBhcmUgbm90IGdyYW50ZWQgdG8gcHVibGlzaCwgZGlzdHJpYnV0ZSxcbiAgc3VibGljZW5zZSwgYW5kL29yIHNlbGwgY29waWVzIG9mIENvY29zIENyZWF0b3IuXG5cbiBUaGUgc29mdHdhcmUgb3IgdG9vbHMgaW4gdGhpcyBMaWNlbnNlIEFncmVlbWVudCBhcmUgbGljZW5zZWQsIG5vdCBzb2xkLlxuIFhpYW1lbiBZYWppIFNvZnR3YXJlIENvLiwgTHRkLiByZXNlcnZlcyBhbGwgcmlnaHRzIG5vdCBleHByZXNzbHkgZ3JhbnRlZCB0byB5b3UuXG5cbiBUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgXCJBUyBJU1wiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SXG4gSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksXG4gRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFXG4gQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUlxuIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sXG4gT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTlxuIFRIRSBTT0ZUV0FSRS5cbiAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xuY29uc3QgeyBkZWNvZGVVdWlkIH0gPSByZXF1aXJlKCcuL2hlbHBlcicpO1xuY29uc3QgUmVxdWVzdEl0ZW0gPSByZXF1aXJlKCcuL3JlcXVlc3QtaXRlbScpO1xuY29uc3QgeyBSZXF1ZXN0VHlwZSwgYnVuZGxlcyB9ID0gcmVxdWlyZSgnLi9zaGFyZWQnKTtcblxuZnVuY3Rpb24gcGFyc2UgKHRhc2spIHtcblxuICAgIHZhciBpbnB1dCA9IHRhc2suaW5wdXQsIG9wdGlvbnMgPSB0YXNrLm9wdGlvbnM7XG4gICAgaW5wdXQgPSBBcnJheS5pc0FycmF5KGlucHV0KSA/IGlucHV0IDogWyBpbnB1dCBdO1xuXG4gICAgdGFzay5vdXRwdXQgPSBbXTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGlucHV0Lmxlbmd0aDsgaSArKyApIHtcbiAgICAgICAgdmFyIGl0ZW0gPSBpbnB1dFtpXTtcbiAgICAgICAgdmFyIG91dCA9IFJlcXVlc3RJdGVtLmNyZWF0ZSgpO1xuICAgICAgICBpZiAodHlwZW9mIGl0ZW0gPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICBpdGVtID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiAgICAgICAgICAgIGl0ZW1bb3B0aW9ucy5fX3JlcXVlc3RUeXBlX18gfHwgUmVxdWVzdFR5cGUuVVVJRF0gPSBpbnB1dFtpXTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodHlwZW9mIGl0ZW0gPT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgICAvLyBsb2NhbCBvcHRpb25zIHdpbGwgb3ZlcmxhcCBnbGFiYWwgb3B0aW9uc1xuICAgICAgICAgICAgY2MuanMuYWRkb24oaXRlbSwgb3B0aW9ucyk7XG4gICAgICAgICAgICBpZiAoaXRlbS5wcmVzZXQpIHtcbiAgICAgICAgICAgICAgICBjYy5qcy5hZGRvbihpdGVtLCBjYy5hc3NldE1hbmFnZXIucHJlc2V0c1tpdGVtLnByZXNldF0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZm9yICh2YXIga2V5IGluIGl0ZW0pIHtcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKGtleSkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlIFJlcXVlc3RUeXBlLlVVSUQ6IFxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHV1aWQgPSBvdXQudXVpZCA9IGRlY29kZVV1aWQoaXRlbS51dWlkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChidW5kbGVzLmhhcyhpdGVtLmJ1bmRsZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgY29uZmlnID0gYnVuZGxlcy5nZXQoaXRlbS5idW5kbGUpLl9jb25maWc7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGluZm8gPSBjb25maWcuZ2V0QXNzZXRJbmZvKHV1aWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpbmZvICYmIGluZm8ucmVkaXJlY3QpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFidW5kbGVzLmhhcyhpbmZvLnJlZGlyZWN0KSkgdGhyb3cgbmV3IEVycm9yKGBQbGVhc2UgbG9hZCBidW5kbGUgJHtpbmZvLnJlZGlyZWN0fSBmaXJzdGApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25maWcgPSBidW5kbGVzLmdldChpbmZvLnJlZGlyZWN0KS5fY29uZmlnO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmZvID0gY29uZmlnLmdldEFzc2V0SW5mbyh1dWlkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb3V0LmNvbmZpZyA9IGNvbmZpZztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvdXQuaW5mbyA9IGluZm87XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBvdXQuZXh0ID0gaXRlbS5leHQgfHwgJy5qc29uJztcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlICdfX3JlcXVlc3RUeXBlX18nOlxuICAgICAgICAgICAgICAgICAgICBjYXNlICdleHQnOiBcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnYnVuZGxlJzpcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAncHJlc2V0JzpcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAndHlwZSc6IGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIFJlcXVlc3RUeXBlLkRJUjogXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYnVuZGxlcy5oYXMoaXRlbS5idW5kbGUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGluZm9zID0gW107XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnVuZGxlcy5nZXQoaXRlbS5idW5kbGUpLl9jb25maWcuZ2V0RGlyV2l0aFBhdGgoaXRlbS5kaXIsIGl0ZW0udHlwZSwgaW5mb3MpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBsID0gaW5mb3MubGVuZ3RoOyBpIDwgbDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpbmZvID0gaW5mb3NbaV07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlucHV0LnB1c2goe3V1aWQ6IGluZm8udXVpZCwgX19pc05hdGl2ZV9fOiBmYWxzZSwgZXh0OiAnLmpzb24nLCBidW5kbGU6IGl0ZW0uYnVuZGxlfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgb3V0LnJlY3ljbGUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG91dCA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBSZXF1ZXN0VHlwZS5QQVRIOiBcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChidW5kbGVzLmhhcyhpdGVtLmJ1bmRsZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgY29uZmlnID0gYnVuZGxlcy5nZXQoaXRlbS5idW5kbGUpLl9jb25maWc7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGluZm8gPSBjb25maWcuZ2V0SW5mb1dpdGhQYXRoKGl0ZW0ucGF0aCwgaXRlbS50eXBlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5mbyAmJiBpbmZvLnJlZGlyZWN0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghYnVuZGxlcy5oYXMoaW5mby5yZWRpcmVjdCkpIHRocm93IG5ldyBFcnJvcihgeW91IG5lZWQgdG8gbG9hZCBidW5kbGUgJHtpbmZvLnJlZGlyZWN0fSBmaXJzdGApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25maWcgPSBidW5kbGVzLmdldChpbmZvLnJlZGlyZWN0KS5fY29uZmlnO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmZvID0gY29uZmlnLmdldEFzc2V0SW5mbyhpbmZvLnV1aWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghaW5mbykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvdXQucmVjeWNsZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEJ1bmRsZSAke2l0ZW0uYnVuZGxlfSBkb2Vzbid0IGNvbnRhaW4gJHtpdGVtLnBhdGh9YCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG91dC5jb25maWcgPSBjb25maWc7IFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG91dC51dWlkID0gaW5mby51dWlkO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG91dC5pbmZvID0gaW5mbztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIG91dC5leHQgPSBpdGVtLmV4dCB8fCAnLmpzb24nO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgUmVxdWVzdFR5cGUuU0NFTkU6XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYnVuZGxlcy5oYXMoaXRlbS5idW5kbGUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvbmZpZyA9IGJ1bmRsZXMuZ2V0KGl0ZW0uYnVuZGxlKS5fY29uZmlnO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpbmZvID0gY29uZmlnLmdldFNjZW5lSW5mbyhpdGVtLnNjZW5lKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5mbyAmJiBpbmZvLnJlZGlyZWN0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghYnVuZGxlcy5oYXMoaW5mby5yZWRpcmVjdCkpIHRocm93IG5ldyBFcnJvcihgeW91IG5lZWQgdG8gbG9hZCBidW5kbGUgJHtpbmZvLnJlZGlyZWN0fSBmaXJzdGApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25maWcgPSBidW5kbGVzLmdldChpbmZvLnJlZGlyZWN0KS5fY29uZmlnO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmZvID0gY29uZmlnLmdldEFzc2V0SW5mbyhpbmZvLnV1aWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWluZm8pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3V0LnJlY3ljbGUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBCdW5kbGUgJHtjb25maWcubmFtZX0gZG9lc24ndCBjb250YWluIHNjZW5lICR7aXRlbS5zY2VuZX1gKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb3V0LmNvbmZpZyA9IGNvbmZpZzsgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb3V0LnV1aWQgPSBpbmZvLnV1aWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb3V0LmluZm8gPSBpbmZvO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ19faXNOYXRpdmVfXyc6IFxuICAgICAgICAgICAgICAgICAgICAgICAgb3V0LmlzTmF0aXZlID0gaXRlbS5fX2lzTmF0aXZlX187XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBSZXF1ZXN0VHlwZS5VUkw6IFxuICAgICAgICAgICAgICAgICAgICAgICAgb3V0LnVybCA9IGl0ZW0udXJsO1xuICAgICAgICAgICAgICAgICAgICAgICAgb3V0LnV1aWQgPSBpdGVtLnV1aWQgfHwgaXRlbS51cmw7XG4gICAgICAgICAgICAgICAgICAgICAgICBvdXQuZXh0ID0gaXRlbS5leHQgfHwgY2MucGF0aC5leHRuYW1lKGl0ZW0udXJsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG91dC5pc05hdGl2ZSA9IGl0ZW0uX19pc05hdGl2ZV9fICE9PSB1bmRlZmluZWQgPyBpdGVtLl9faXNOYXRpdmVfXyA6IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDogb3V0Lm9wdGlvbnNba2V5XSA9IGl0ZW1ba2V5XTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKCFvdXQpIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICghb3V0KSBjb250aW51ZTtcbiAgICAgICAgdGFzay5vdXRwdXQucHVzaChvdXQpO1xuICAgICAgICBpZiAoIW91dC51dWlkICYmICFvdXQudXJsKSB0aHJvdyBuZXcgRXJyb3IoJ3Vua25vd24gaW5wdXQ6JyArIGl0ZW0udG9TdHJpbmcoKSk7XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xufVxuXG5mdW5jdGlvbiBjb21iaW5lICh0YXNrKSB7XG4gICAgdmFyIGlucHV0ID0gdGFzay5vdXRwdXQgPSB0YXNrLmlucHV0O1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaW5wdXQubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgdmFyIGl0ZW0gPSBpbnB1dFtpXTtcbiAgICAgICAgaWYgKGl0ZW0udXJsKSBjb250aW51ZTtcblxuICAgICAgICB2YXIgdXJsID0gJycsIGJhc2UgPSAnJztcbiAgICAgICAgdmFyIGNvbmZpZyA9IGl0ZW0uY29uZmlnO1xuICAgICAgICBpZiAoaXRlbS5pc05hdGl2ZSkge1xuICAgICAgICAgICAgYmFzZSA9IChjb25maWcgJiYgY29uZmlnLm5hdGl2ZUJhc2UpID8gKGNvbmZpZy5iYXNlICsgY29uZmlnLm5hdGl2ZUJhc2UpIDogY2MuYXNzZXRNYW5hZ2VyLmdlbmVyYWxOYXRpdmVCYXNlO1xuICAgICAgICB9IFxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGJhc2UgPSAoY29uZmlnICYmIGNvbmZpZy5pbXBvcnRCYXNlKSA/IChjb25maWcuYmFzZSArIGNvbmZpZy5pbXBvcnRCYXNlKSA6IGNjLmFzc2V0TWFuYWdlci5nZW5lcmFsSW1wb3J0QmFzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCB1dWlkID0gaXRlbS51dWlkO1xuICAgICAgICAgICAgXG4gICAgICAgIHZhciB2ZXIgPSAnJztcbiAgICAgICAgaWYgKGl0ZW0uaW5mbykge1xuICAgICAgICAgICAgaWYgKGl0ZW0uaXNOYXRpdmUpIHtcbiAgICAgICAgICAgICAgICB2ZXIgPSBpdGVtLmluZm8ubmF0aXZlVmVyID8gKCcuJyArIGl0ZW0uaW5mby5uYXRpdmVWZXIpIDogJyc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB2ZXIgPSBpdGVtLmluZm8udmVyID8gKCcuJyArIGl0ZW0uaW5mby52ZXIpIDogJyc7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyB1Z2x5IGhhY2ssIFdlQ2hhdCBkb2VzIG5vdCBzdXBwb3J0IGxvYWRpbmcgZm9udCBsaWtlcyAnbXlmb250LmR3MjEzLnR0ZicuIFNvIGFwcGVuZCBoYXNoIHRvIGRpcmVjdG9yeVxuICAgICAgICBpZiAoaXRlbS5leHQgPT09ICcudHRmJykge1xuICAgICAgICAgICAgdXJsID0gYCR7YmFzZX0vJHt1dWlkLnNsaWNlKDAsIDIpfS8ke3V1aWR9JHt2ZXJ9LyR7aXRlbS5vcHRpb25zLl9fbmF0aXZlTmFtZV9ffWA7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB1cmwgPSBgJHtiYXNlfS8ke3V1aWQuc2xpY2UoMCwgMil9LyR7dXVpZH0ke3Zlcn0ke2l0ZW0uZXh0fWA7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGl0ZW0udXJsID0gdXJsO1xuICAgIH1cbiAgICByZXR1cm4gbnVsbDtcbn1cblxubW9kdWxlLmV4cG9ydHMgPSB7IHBhcnNlLCBjb21iaW5lIH07Il0sInNvdXJjZVJvb3QiOiIvIn0=