
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'engine-dev/cocos2d/core/platform/preprocess-class.js';
                    var __require = nodeEnv ? function (request) {
                        return require(request);
                    } : function (request) {
                        return __quick_compile_engine__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_engine__.registerModule(__filename, module);}"use strict";

/****************************************************************************
 Copyright (c) 2013-2016 Chukong Technologies Inc.
 Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.

 https://www.cocos.com/

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated engine source code (the "Software"), a limited,
  worldwide, royalty-free, non-assignable, revocable and non-exclusive license
 to use Cocos Creator solely to develop games on your target platforms. You shall
  not use Cocos Creator software for developing other software or tools that's
  used for developing games. You are not granted to publish, distribute,
  sublicense, and/or sell copies of Cocos Creator.

 The software or tools in this License Agreement are licensed, not sold.
 Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 THE SOFTWARE.
 ****************************************************************************/
var js = require('./js');

var Attrs = require('./attribute'); // 增加预处理属性这个步骤的目的是降低 CCClass 的实现难度，将比较稳定的通用逻辑和一些需求比较灵活的属性需求分隔开。


var SerializableAttrs = {
  "default": {},
  serializable: {},
  editorOnly: {},
  formerlySerializedAs: {}
};
var TYPO_TO_CORRECT_DEV = CC_DEV && {
  extend: 'extends',
  property: 'properties',
  "static": 'statics',
  constructor: 'ctor'
}; // 预处理 notify 等扩展属性

function parseNotify(val, propName, notify, properties) {
  if (val.get || val.set) {
    if (CC_DEV) {
      cc.warnID(5500);
    }

    return;
  }

  if (val.hasOwnProperty('default')) {
    // 添加新的内部属性，将原来的属性修改为 getter/setter 形式
    // （以 _ 开头将自动设置property 为 visible: false）
    var newKey = "_N$" + propName;

    val.get = function () {
      return this[newKey];
    };

    val.set = function (value) {
      var oldValue = this[newKey];
      this[newKey] = value;
      notify.call(this, oldValue);
    };

    if (CC_EDITOR) {
      val.notifyFor = newKey;
    }

    var newValue = {};
    properties[newKey] = newValue; // 将不能用于get方法中的属性移动到newValue中

    for (var attr in SerializableAttrs) {
      var v = SerializableAttrs[attr];

      if (val.hasOwnProperty(attr)) {
        newValue[attr] = val[attr];

        if (!v.canUsedInGet) {
          delete val[attr];
        }
      }
    }
  } else if (CC_DEV) {
    cc.warnID(5501);
  }
}

function parseType(val, type, className, propName) {
  var STATIC_CHECK = CC_EDITOR && CC_DEV || CC_TEST;

  if (Array.isArray(type)) {
    if (STATIC_CHECK && 'default' in val) {
      var isArray = require('./CCClass').isArray; // require lazily to avoid circular require() calls


      if (!isArray(val["default"])) {
        cc.warnID(5507, className, propName);
      }
    }

    if (type.length > 0) {
      val.type = type = type[0];
    } else {
      return cc.errorID(5508, className, propName);
    }
  }

  if (typeof type === 'function') {
    if (type === String) {
      val.type = cc.String;

      if (STATIC_CHECK) {
        cc.warnID(3608, "\"" + className + "." + propName + "\"");
      }
    } else if (type === Boolean) {
      val.type = cc.Boolean;

      if (STATIC_CHECK) {
        cc.warnID(3609, "\"" + className + "." + propName + "\"");
      }
    } else if (type === Number) {
      val.type = cc.Float;

      if (STATIC_CHECK) {
        cc.warnID(3610, "\"" + className + "." + propName + "\"");
      }
    }
  } else if (STATIC_CHECK) {
    switch (type) {
      case 'Number':
        cc.warnID(5510, className, propName);
        break;

      case 'String':
        cc.warn("The type of \"" + className + "." + propName + "\" must be cc.String, not \"String\".");
        break;

      case 'Boolean':
        cc.warn("The type of \"" + className + "." + propName + "\" must be cc.Boolean, not \"Boolean\".");
        break;

      case 'Float':
        cc.warn("The type of \"" + className + "." + propName + "\" must be cc.Float, not \"Float\".");
        break;

      case 'Integer':
        cc.warn("The type of \"" + className + "." + propName + "\" must be cc.Integer, not \"Integer\".");
        break;

      case null:
        cc.warnID(5511, className, propName);
        break;
    }
  }

  if (CC_EDITOR && typeof type === 'function') {
    if (cc.Class._isCCClass(type) && val.serializable !== false && !js._getClassId(type, false)) {
      cc.warnID(5512, className, propName, className, propName);
    }
  }
}

function getBaseClassWherePropertyDefined_DEV(propName, cls) {
  if (CC_DEV) {
    var res;

    for (; cls && cls.__props__ && cls.__props__.indexOf(propName) !== -1; cls = cls.$super) {
      res = cls;
    }

    if (!res) {
      cc.error('unknown error');
    }

    return res;
  }
}

function _wrapOptions(isES6Getset, _default, type) {
  var res = isES6Getset ? {
    _short: true
  } : {
    _short: true,
    "default": _default
  };

  if (type) {
    res.type = type;
  }

  return res;
}

exports.getFullFormOfProperty = function (options, isES6Getset) {
  var isLiteral = options && options.constructor === Object;

  if (isLiteral) {
    return null;
  }

  if (Array.isArray(options) && options.length > 0) {
    return _wrapOptions(isES6Getset, [], options);
  } else if (typeof options === 'function') {
    return _wrapOptions(isES6Getset, js.isChildClassOf(options, cc.ValueType) ? new options() : null, options);
  } else if (options instanceof Attrs.PrimitiveType) {
    return _wrapOptions(isES6Getset, options["default"]);
  } else {
    return _wrapOptions(isES6Getset, options);
  }
};

exports.preprocessAttrs = function (properties, className, cls, es6) {
  for (var propName in properties) {
    var val = properties[propName];
    var fullForm = exports.getFullFormOfProperty(val, false);

    if (fullForm) {
      val = properties[propName] = fullForm;
    }

    if (val) {
      if (CC_EDITOR) {
        if ('default' in val) {
          if (val.get) {
            cc.errorID(5513, className, propName);
          } else if (val.set) {
            cc.errorID(5514, className, propName);
          } else if (cc.Class._isCCClass(val["default"])) {
            val["default"] = null;
            cc.errorID(5515, className, propName);
          }
        } else if (!val.get && !val.set) {
          var maybeTypeScript = es6;

          if (!maybeTypeScript) {
            cc.errorID(5516, className, propName);
          }
        }
      }

      if (CC_DEV && !val.override && cls.__props__.indexOf(propName) !== -1) {
        // check override
        var baseClass = js.getClassName(getBaseClassWherePropertyDefined_DEV(propName, cls));
        cc.warnID(5517, className, propName, baseClass, propName);
      }

      var notify = val.notify;

      if (notify) {
        if (CC_DEV && es6) {
          cc.error('not yet support notify attribute for ES6 Classes');
        } else {
          parseNotify(val, propName, notify, properties);
        }
      }

      if ('type' in val) {
        parseType(val, val.type, className, propName);
      }
    }
  }
};

if (CC_DEV) {
  var CALL_SUPER_DESTROY_REG_DEV = /\b\._super\b|destroy\s*\.\s*call\s*\(\s*\w+\s*[,|)]/;

  exports.doValidateMethodWithProps_DEV = function (func, funcName, className, cls, base) {
    if (cls.__props__ && cls.__props__.indexOf(funcName) >= 0) {
      // find class that defines this method as a property
      var baseClassName = js.getClassName(getBaseClassWherePropertyDefined_DEV(funcName, cls));
      cc.errorID(3648, className, funcName, baseClassName);
      return false;
    }

    if (funcName === 'destroy' && js.isChildClassOf(base, cc.Component) && !CALL_SUPER_DESTROY_REG_DEV.test(func)) {
      cc.error("Overwriting '" + funcName + "' function in '" + className + "' class without calling super is not allowed. Call the super function in '" + funcName + "' please.");
    }
  };
}

exports.validateMethodWithProps = function (func, funcName, className, cls, base) {
  if (CC_DEV && funcName === 'constructor') {
    cc.errorID(3643, className);
    return false;
  }

  if (typeof func === 'function' || func === null) {
    if (CC_DEV) {
      this.doValidateMethodWithProps_DEV(func, funcName, className, cls, base);
    }
  } else {
    if (CC_DEV) {
      if (func === false && base && base.prototype) {
        // check override
        var overrided = base.prototype[funcName];

        if (typeof overrided === 'function') {
          var baseFuc = js.getClassName(base) + '.' + funcName;
          var subFuc = className + '.' + funcName;
          cc.warnID(3624, subFuc, baseFuc, subFuc, subFuc);
        }
      }

      var correct = TYPO_TO_CORRECT_DEV[funcName];

      if (correct) {
        cc.warnID(3621, className, funcName, correct);
      } else if (func) {
        cc.errorID(3622, className, funcName);
      }
    }

    return false;
  }

  return true;
};
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_engine__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImVuZ2luZS1kZXYvY29jb3MyZC9jb3JlL3BsYXRmb3JtL3ByZXByb2Nlc3MtY2xhc3MuanMiXSwibmFtZXMiOlsianMiLCJyZXF1aXJlIiwiQXR0cnMiLCJTZXJpYWxpemFibGVBdHRycyIsInNlcmlhbGl6YWJsZSIsImVkaXRvck9ubHkiLCJmb3JtZXJseVNlcmlhbGl6ZWRBcyIsIlRZUE9fVE9fQ09SUkVDVF9ERVYiLCJDQ19ERVYiLCJleHRlbmQiLCJwcm9wZXJ0eSIsImNvbnN0cnVjdG9yIiwicGFyc2VOb3RpZnkiLCJ2YWwiLCJwcm9wTmFtZSIsIm5vdGlmeSIsInByb3BlcnRpZXMiLCJnZXQiLCJzZXQiLCJjYyIsIndhcm5JRCIsImhhc093blByb3BlcnR5IiwibmV3S2V5IiwidmFsdWUiLCJvbGRWYWx1ZSIsImNhbGwiLCJDQ19FRElUT1IiLCJub3RpZnlGb3IiLCJuZXdWYWx1ZSIsImF0dHIiLCJ2IiwiY2FuVXNlZEluR2V0IiwicGFyc2VUeXBlIiwidHlwZSIsImNsYXNzTmFtZSIsIlNUQVRJQ19DSEVDSyIsIkNDX1RFU1QiLCJBcnJheSIsImlzQXJyYXkiLCJsZW5ndGgiLCJlcnJvcklEIiwiU3RyaW5nIiwiQm9vbGVhbiIsIk51bWJlciIsIkZsb2F0Iiwid2FybiIsIkNsYXNzIiwiX2lzQ0NDbGFzcyIsIl9nZXRDbGFzc0lkIiwiZ2V0QmFzZUNsYXNzV2hlcmVQcm9wZXJ0eURlZmluZWRfREVWIiwiY2xzIiwicmVzIiwiX19wcm9wc19fIiwiaW5kZXhPZiIsIiRzdXBlciIsImVycm9yIiwiX3dyYXBPcHRpb25zIiwiaXNFUzZHZXRzZXQiLCJfZGVmYXVsdCIsIl9zaG9ydCIsImV4cG9ydHMiLCJnZXRGdWxsRm9ybU9mUHJvcGVydHkiLCJvcHRpb25zIiwiaXNMaXRlcmFsIiwiT2JqZWN0IiwiaXNDaGlsZENsYXNzT2YiLCJWYWx1ZVR5cGUiLCJQcmltaXRpdmVUeXBlIiwicHJlcHJvY2Vzc0F0dHJzIiwiZXM2IiwiZnVsbEZvcm0iLCJtYXliZVR5cGVTY3JpcHQiLCJvdmVycmlkZSIsImJhc2VDbGFzcyIsImdldENsYXNzTmFtZSIsIkNBTExfU1VQRVJfREVTVFJPWV9SRUdfREVWIiwiZG9WYWxpZGF0ZU1ldGhvZFdpdGhQcm9wc19ERVYiLCJmdW5jIiwiZnVuY05hbWUiLCJiYXNlIiwiYmFzZUNsYXNzTmFtZSIsIkNvbXBvbmVudCIsInRlc3QiLCJ2YWxpZGF0ZU1ldGhvZFdpdGhQcm9wcyIsInByb3RvdHlwZSIsIm92ZXJyaWRlZCIsImJhc2VGdWMiLCJzdWJGdWMiLCJjb3JyZWN0Il0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7O0FBQUE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUEwQkEsSUFBTUEsRUFBRSxHQUFHQyxPQUFPLENBQUMsTUFBRCxDQUFsQjs7QUFDQSxJQUFNQyxLQUFLLEdBQUdELE9BQU8sQ0FBQyxhQUFELENBQXJCLEVBRUE7OztBQUVBLElBQUlFLGlCQUFpQixHQUFHO0FBQ3BCLGFBQVMsRUFEVztBQUVwQkMsRUFBQUEsWUFBWSxFQUFFLEVBRk07QUFHcEJDLEVBQUFBLFVBQVUsRUFBRSxFQUhRO0FBSXBCQyxFQUFBQSxvQkFBb0IsRUFBRTtBQUpGLENBQXhCO0FBT0EsSUFBSUMsbUJBQW1CLEdBQUdDLE1BQU0sSUFBSTtBQUNoQ0MsRUFBQUEsTUFBTSxFQUFFLFNBRHdCO0FBRWhDQyxFQUFBQSxRQUFRLEVBQUUsWUFGc0I7QUFHaEMsWUFBUSxTQUh3QjtBQUloQ0MsRUFBQUEsV0FBVyxFQUFFO0FBSm1CLENBQXBDLEVBT0E7O0FBQ0EsU0FBU0MsV0FBVCxDQUFzQkMsR0FBdEIsRUFBMkJDLFFBQTNCLEVBQXFDQyxNQUFyQyxFQUE2Q0MsVUFBN0MsRUFBeUQ7QUFDckQsTUFBSUgsR0FBRyxDQUFDSSxHQUFKLElBQVdKLEdBQUcsQ0FBQ0ssR0FBbkIsRUFBd0I7QUFDcEIsUUFBSVYsTUFBSixFQUFZO0FBQ1JXLE1BQUFBLEVBQUUsQ0FBQ0MsTUFBSCxDQUFVLElBQVY7QUFDSDs7QUFDRDtBQUNIOztBQUNELE1BQUlQ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QUFJLENBQUNLLFNBQW5DLEVBQThDO0FBQzFDO0FBQ0EsWUFBSUMsU0FBUyxHQUFHTixJQUFJLENBQUNLLFNBQUwsQ0FBZU4sUUFBZixDQUFoQjs7QUFDQSxZQUFJLE9BQU9PLFNBQVAsS0FBcUIsVUFBekIsRUFBcUM7QUFDakMsY0FBSUMsT0FBTyxHQUFHdEYsRUFBRSxDQUFDMEUsWUFBSCxDQUFnQkssSUFBaEIsSUFBd0IsR0FBeEIsR0FBOEJELFFBQTVDO0FBQ0EsY0FBSVMsTUFBTSxHQUFHckQsU0FBUyxHQUFHLEdBQVosR0FBa0I0QyxRQUEvQjtBQUNBM0QsVUFBQUEsRUFBRSxDQUFDQyxNQUFILENBQVUsSUFBVixFQUFnQm1FLE1BQWhCLEVBQXdCRCxPQUF4QixFQUFpQ0MsTUFBakMsRUFBeUNBLE1BQXpDO0FBQ0g7QUFDSjs7QUFDRCxVQUFJQyxPQUFPLEdBQUdqRixtQkFBbUIsQ0FBQ3VFLFFBQUQsQ0FBakM7O0FBQ0EsVUFBSVUsT0FBSixFQUFhO0FBQ1RyRSxRQUFBQSxFQUFFLENBQUNDLE1BQUgsQ0FBVSxJQUFWLEVBQWdCYyxTQUFoQixFQUEyQjRDLFFBQTNCLEVBQXFDVSxPQUFyQztBQUNILE9BRkQsTUFHSyxJQUFJWCxJQUFKLEVBQVU7QUFDWDFELFFBQUFBLEVBQUUsQ0FBQ3FCLE9BQUgsQ0FBVyxJQUFYLEVBQWlCTixTQUFqQixFQUE0QjRDLFFBQTVCO0FBQ0g7QUFDSjs7QUFDRCxXQUFPLEtBQVA7QUFDSDs7QUFDRCxTQUFPLElBQVA7QUFDSCxDQWhDRCIsInNvdXJjZXNDb250ZW50IjpbIi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXG4gQ29weXJpZ2h0IChjKSAyMDEzLTIwMTYgQ2h1a29uZyBUZWNobm9sb2dpZXMgSW5jLlxuIENvcHlyaWdodCAoYykgMjAxNy0yMDE4IFhpYW1lbiBZYWppIFNvZnR3YXJlIENvLiwgTHRkLlxuXG4gaHR0cHM6Ly93d3cuY29jb3MuY29tL1xuXG4gUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weVxuIG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZW5naW5lIHNvdXJjZSBjb2RlICh0aGUgXCJTb2Z0d2FyZVwiKSwgYSBsaW1pdGVkLFxuICB3b3JsZHdpZGUsIHJveWFsdHktZnJlZSwgbm9uLWFzc2lnbmFibGUsIHJldm9jYWJsZSBhbmQgbm9uLWV4Y2x1c2l2ZSBsaWNlbnNlXG4gdG8gdXNlIENvY29zIENyZWF0b3Igc29sZWx5IHRvIGRldmVsb3AgZ2FtZXMgb24geW91ciB0YXJnZXQgcGxhdGZvcm1zLiBZb3Ugc2hhbGxcbiAgbm90IHVzZSBDb2NvcyBDcmVhdG9yIHNvZnR3YXJlIGZvciBkZXZlbG9waW5nIG90aGVyIHNvZnR3YXJlIG9yIHRvb2xzIHRoYXQnc1xuICB1c2VkIGZvciBkZXZlbG9waW5nIGdhbWVzLiBZb3UgYXJlIG5vdCBncmFudGVkIHRvIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsXG4gIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsIGNvcGllcyBvZiBDb2NvcyBDcmVhdG9yLlxuXG4gVGhlIHNvZnR3YXJlIG9yIHRvb2xzIGluIHRoaXMgTGljZW5zZSBBZ3JlZW1lbnQgYXJlIGxpY2Vuc2VkLCBub3Qgc29sZC5cbiBYaWFtZW4gWWFqaSBTb2Z0d2FyZSBDby4sIEx0ZC4gcmVzZXJ2ZXMgYWxsIHJpZ2h0cyBub3QgZXhwcmVzc2x5IGdyYW50ZWQgdG8geW91LlxuXG4gVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUlxuIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLFxuIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRVxuIEFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVJcbiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLFxuIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU5cbiBUSEUgU09GVFdBUkUuXG4gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cblxuY29uc3QganMgPSByZXF1aXJlKCcuL2pzJyk7XG5jb25zdCBBdHRycyA9IHJlcXVpcmUoJy4vYXR0cmlidXRlJyk7XG5cbi8vIOWinuWKoOmihOWkhOeQhuWxnuaAp+i/meS4quatpemqpOeahOebrueahOaYr+mZjeS9jiBDQ0NsYXNzIOeahOWunueOsOmavuW6pu+8jOWwhuavlOi+g+eos+WumueahOmAmueUqOmAu+i+keWSjOS4gOS6m+mcgOaxguavlOi+g+eBtea0u+eahOWxnuaAp+mcgOaxguWIhumalOW8gOOAglxuXG52YXIgU2VyaWFsaXphYmxlQXR0cnMgPSB7XG4gICAgZGVmYXVsdDoge30sXG4gICAgc2VyaWFsaXphYmxlOiB7fSxcbiAgICBlZGl0b3JPbmx5OiB7fSxcbiAgICBmb3JtZXJseVNlcmlhbGl6ZWRBczoge31cbn07XG5cbnZhciBUWVBPX1RPX0NPUlJFQ1RfREVWID0gQ0NfREVWICYmIHtcbiAgICBleHRlbmQ6ICdleHRlbmRzJyxcbiAgICBwcm9wZXJ0eTogJ3Byb3BlcnRpZXMnLFxuICAgIHN0YXRpYzogJ3N0YXRpY3MnLFxuICAgIGNvbnN0cnVjdG9yOiAnY3Rvcidcbn07XG5cbi8vIOmihOWkhOeQhiBub3RpZnkg562J5omp5bGV5bGe5oCnXG5mdW5jdGlvbiBwYXJzZU5vdGlmeSAodmFsLCBwcm9wTmFtZSwgbm90aWZ5LCBwcm9wZXJ0aWVzKSB7XG4gICAgaWYgKHZhbC5nZXQgfHwgdmFsLnNldCkge1xuICAgICAgICBpZiAoQ0NfREVWKSB7XG4gICAgICAgICAgICBjYy53YXJuSUQoNTUwMCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAodmFsLmhhc093blByb3BlcnR5KCdkZWZhdWx0JykpIHtcbiAgICAgICAgLy8g5re75Yqg5paw55qE5YaF6YOo5bGe5oCn77yM5bCG5Y6f5p2l55qE5bGe5oCn5L+u5pS55Li6IGdldHRlci9zZXR0ZXIg5b2i5byPXG4gICAgICAgIC8vIO+8iOS7pSBfIOW8gOWktOWwhuiHquWKqOiuvue9rnByb3BlcnR5IOS4uiB2aXNpYmxlOiBmYWxzZe+8iVxuICAgICAgICB2YXIgbmV3S2V5ID0gXCJfTiRcIiArIHByb3BOYW1lO1xuXG4gICAgICAgIHZhbC5nZXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpc1tuZXdLZXldO1xuICAgICAgICB9O1xuICAgICAgICB2YWwuc2V0ID0gZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgICAgICB2YXIgb2xkVmFsdWUgPSB0aGlzW25ld0tleV07XG4gICAgICAgICAgICB0aGlzW25ld0tleV0gPSB2YWx1ZTtcbiAgICAgICAgICAgIG5vdGlmeS5jYWxsKHRoaXMsIG9sZFZhbHVlKTtcbiAgICAgICAgfTtcblxuICAgICAgICBpZiAoQ0NfRURJVE9SKSB7XG4gICAgICAgICAgICB2YWwubm90aWZ5Rm9yID0gbmV3S2V5O1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIG5ld1ZhbHVlID0ge307XG4gICAgICAgIHByb3BlcnRpZXNbbmV3S2V5XSA9IG5ld1ZhbHVlO1xuICAgICAgICAvLyDlsIbkuI3og73nlKjkuo5nZXTmlrnms5XkuK3nmoTlsZ7mgKfnp7vliqjliLBuZXdWYWx1ZeS4rVxuICAgICAgICBmb3IgKHZhciBhdHRyIGluIFNlcmlhbGl6YWJsZUF0dHJzKSB7XG4gICAgICAgICAgICB2YXIgdiA9IFNlcmlhbGl6YWJsZUF0dHJzW2F0dHJdO1xuICAgICAgICAgICAgaWYgKHZhbC5oYXNPd25Qcm9wZXJ0eShhdHRyKSkge1xuICAgICAgICAgICAgICAgIG5ld1ZhbHVlW2F0dHJdID0gdmFsW2F0dHJdO1xuICAgICAgICAgICAgICAgIGlmICghdi5jYW5Vc2VkSW5HZXQpIHtcbiAgICAgICAgICAgICAgICAgICAgZGVsZXRlIHZhbFthdHRyXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgZWxzZSBpZiAoQ0NfREVWKSB7XG4gICAgICAgIGNjLndhcm5JRCg1NTAxKTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIHBhcnNlVHlwZSAodmFsLCB0eXBlLCBjbGFzc05hbWUsIHByb3BOYW1lKSB7XG4gICAgY29uc3QgU1RBVElDX0NIRUNLID0gKENDX0VESVRPUiAmJiBDQ19ERVYpIHx8IENDX1RFU1Q7XG5cbiAgICBpZiAoQXJyYXkuaXNBcnJheSh0eXBlKSkge1xuICAgICAgICBpZiAoU1RBVElDX0NIRUNLICYmICdkZWZhdWx0JyBpbiB2YWwpIHtcbiAgICAgICAgICAgIHZhciBpc0FycmF5ID0gcmVxdWlyZSgnLi9DQ0NsYXNzJykuaXNBcnJheTsgICAvLyByZXF1aXJlIGxhemlseSB0byBhdm9pZCBjaXJjdWxhciByZXF1aXJlKCkgY2FsbHNcbiAgICAgICAgICAgIGlmICghaXNBcnJheSh2YWwuZGVmYXVsdCkpIHtcbiAgICAgICAgICAgICAgICBjYy53YXJuSUQoNTUwNywgY2xhc3NOYW1lLCBwcm9wTmFtZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHR5cGUubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgdmFsLnR5cGUgPSB0eXBlID0gdHlwZVswXTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBjYy5lcnJvcklEKDU1MDgsIGNsYXNzTmFtZSwgcHJvcE5hbWUpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGlmICh0eXBlb2YgdHlwZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICBpZiAodHlwZSA9PT0gU3RyaW5nKSB7XG4gICAgICAgICAgICB2YWwudHlwZSA9IGNjLlN0cmluZztcbiAgICAgICAgICAgIGlmIChTVEFUSUNfQ0hFQ0spIHtcbiAgICAgICAgICAgICAgICBjYy53YXJuSUQoMzYwOCwgYFwiJHtjbGFzc05hbWV9LiR7cHJvcE5hbWV9XCJgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh0eXBlID09PSBCb29sZWFuKSB7XG4gICAgICAgICAgICB2YWwudHlwZSA9IGNjLkJvb2xlYW47XG4gICAgICAgICAgICBpZiAoU1RBVElDX0NIRUNLKSB7XG4gICAgICAgICAgICAgICAgY2Mud2FybklEKDM2MDksIGBcIiR7Y2xhc3NOYW1lfS4ke3Byb3BOYW1lfVwiYCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodHlwZSA9PT0gTnVtYmVyKSB7XG4gICAgICAgICAgICB2YWwudHlwZSA9IGNjLkZsb2F0O1xuICAgICAgICAgICAgaWYgKFNUQVRJQ19DSEVDSykge1xuICAgICAgICAgICAgICAgIGNjLndhcm5JRCgzNjEwLCBgXCIke2NsYXNzTmFtZX0uJHtwcm9wTmFtZX1cImApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIGVsc2UgaWYgKFNUQVRJQ19DSEVDSykge1xuICAgICAgICBzd2l0Y2ggKHR5cGUpIHtcbiAgICAgICAgY2FzZSAnTnVtYmVyJzpcbiAgICAgICAgICAgIGNjLndhcm5JRCg1NTEwLCBjbGFzc05hbWUsIHByb3BOYW1lKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICdTdHJpbmcnOlxuICAgICAgICAgICAgY2Mud2FybihgVGhlIHR5cGUgb2YgXCIke2NsYXNzTmFtZX0uJHtwcm9wTmFtZX1cIiBtdXN0IGJlIGNjLlN0cmluZywgbm90IFwiU3RyaW5nXCIuYCk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAnQm9vbGVhbic6XG4gICAgICAgICAgICBjYy53YXJuKGBUaGUgdHlwZSBvZiBcIiR7Y2xhc3NOYW1lfS4ke3Byb3BOYW1lfVwiIG11c3QgYmUgY2MuQm9vbGVhbiwgbm90IFwiQm9vbGVhblwiLmApO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgJ0Zsb2F0JzpcbiAgICAgICAgICAgIGNjLndhcm4oYFRoZSB0eXBlIG9mIFwiJHtjbGFzc05hbWV9LiR7cHJvcE5hbWV9XCIgbXVzdCBiZSBjYy5GbG9hdCwgbm90IFwiRmxvYXRcIi5gKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICdJbnRlZ2VyJzpcbiAgICAgICAgICAgIGNjLndhcm4oYFRoZSB0eXBlIG9mIFwiJHtjbGFzc05hbWV9LiR7cHJvcE5hbWV9XCIgbXVzdCBiZSBjYy5JbnRlZ2VyLCBub3QgXCJJbnRlZ2VyXCIuYCk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBudWxsOlxuICAgICAgICAgICAgY2Mud2FybklEKDU1MTEsIGNsYXNzTmFtZSwgcHJvcE5hbWUpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoQ0NfRURJVE9SICYmIHR5cGVvZiB0eXBlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIGlmIChjYy5DbGFzcy5faXNDQ0NsYXNzKHR5cGUpICYmIHZhbC5zZXJpYWxpemFibGUgIT09IGZhbHNlICYmICFqcy5fZ2V0Q2xhc3NJZCh0eXBlLCBmYWxzZSkpIHtcbiAgICAgICAgICAgIGNjLndhcm5JRCg1NTEyLCBjbGFzc05hbWUsIHByb3BOYW1lLCBjbGFzc05hbWUsIHByb3BOYW1lKTtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuZnVuY3Rpb24gZ2V0QmFzZUNsYXNzV2hlcmVQcm9wZXJ0eURlZmluZWRfREVWIChwcm9wTmFtZSwgY2xzKSB7XG4gICAgaWYgKENDX0RFVikge1xuICAgICAgICB2YXIgcmVzO1xuICAgICAgICBmb3IgKDsgY2xzICYmIGNscy5fX3Byb3BzX18gJiYgY2xzLl9fcHJvcHNfXy5pbmRleE9mKHByb3BOYW1lKSAhPT0gLTE7IGNscyA9IGNscy4kc3VwZXIpIHtcbiAgICAgICAgICAgIHJlcyA9IGNscztcbiAgICAgICAgfVxuICAgICAgICBpZiAoIXJlcykge1xuICAgICAgICAgICAgY2MuZXJyb3IoJ3Vua25vd24gZXJyb3InKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmVzO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gX3dyYXBPcHRpb25zIChpc0VTNkdldHNldCwgX2RlZmF1bHQsIHR5cGUpIHtcbiAgICBsZXQgcmVzID0gaXNFUzZHZXRzZXQgPyB7IF9zaG9ydDogdHJ1ZSB9IDogeyBfc2hvcnQ6IHRydWUsIGRlZmF1bHQ6IF9kZWZhdWx0IH07XG4gICAgaWYgKHR5cGUpIHtcbiAgICAgICAgcmVzLnR5cGUgPSB0eXBlO1xuICAgIH1cbiAgICByZXR1cm4gcmVzO1xufVxuXG5leHBvcnRzLmdldEZ1bGxGb3JtT2ZQcm9wZXJ0eSA9IGZ1bmN0aW9uIChvcHRpb25zLCBpc0VTNkdldHNldCkge1xuICAgIHZhciBpc0xpdGVyYWwgPSBvcHRpb25zICYmIG9wdGlvbnMuY29uc3RydWN0b3IgPT09IE9iamVjdDtcbiAgICBpZiAoaXNMaXRlcmFsKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBpZiAoQXJyYXkuaXNBcnJheShvcHRpb25zKSAmJiBvcHRpb25zLmxlbmd0aCA+IDApIHtcbiAgICAgICAgcmV0dXJuIF93cmFwT3B0aW9ucyhpc0VTNkdldHNldCwgW10sIG9wdGlvbnMpO1xuICAgIH1cbiAgICBlbHNlIGlmICh0eXBlb2Ygb3B0aW9ucyA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICByZXR1cm4gX3dyYXBPcHRpb25zKGlzRVM2R2V0c2V0LCBqcy5pc0NoaWxkQ2xhc3NPZihvcHRpb25zLCBjYy5WYWx1ZVR5cGUpID8gbmV3IG9wdGlvbnMoKSA6IG51bGwsIG9wdGlvbnMpO1xuICAgIH1cbiAgICBlbHNlIGlmIChvcHRpb25zIGluc3RhbmNlb2YgQXR0cnMuUHJpbWl0aXZlVHlwZSkge1xuICAgICAgICByZXR1cm4gX3dyYXBPcHRpb25zKGlzRVM2R2V0c2V0LCBvcHRpb25zLmRlZmF1bHQpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgcmV0dXJuIF93cmFwT3B0aW9ucyhpc0VTNkdldHNldCwgb3B0aW9ucyk7XG4gICAgfVxufTtcblxuZXhwb3J0cy5wcmVwcm9jZXNzQXR0cnMgPSBmdW5jdGlvbiAocHJvcGVydGllcywgY2xhc3NOYW1lLCBjbHMsIGVzNikge1xuICAgIGZvciAodmFyIHByb3BOYW1lIGluIHByb3BlcnRpZXMpIHtcbiAgICAgICAgdmFyIHZhbCA9IHByb3BlcnRpZXNbcHJvcE5hbWVdO1xuICAgICAgICB2YXIgZnVsbEZvcm0gPSBleHBvcnRzLmdldEZ1bGxGb3JtT2ZQcm9wZXJ0eSh2YWwsIGZhbHNlKTtcbiAgICAgICAgaWYgKGZ1bGxGb3JtKSB7XG4gICAgICAgICAgICB2YWwgPSBwcm9wZXJ0aWVzW3Byb3BOYW1lXSA9IGZ1bGxGb3JtO1xuICAgICAgICB9XG4gICAgICAgIGlmICh2YWwpIHtcbiAgICAgICAgICAgIGlmIChDQ19FRElUT1IpIHtcbiAgICAgICAgICAgICAgICBpZiAoJ2RlZmF1bHQnIGluIHZhbCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodmFsLmdldCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2MuZXJyb3JJRCg1NTEzLCBjbGFzc05hbWUsIHByb3BOYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICh2YWwuc2V0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYy5lcnJvcklEKDU1MTQsIGNsYXNzTmFtZSwgcHJvcE5hbWUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGNjLkNsYXNzLl9pc0NDQ2xhc3ModmFsLmRlZmF1bHQpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YWwuZGVmYXVsdCA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYy5lcnJvcklEKDU1MTUsIGNsYXNzTmFtZSwgcHJvcE5hbWUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKCF2YWwuZ2V0ICYmICF2YWwuc2V0KSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBtYXliZVR5cGVTY3JpcHQgPSBlczY7XG4gICAgICAgICAgICAgICAgICAgIGlmICghbWF5YmVUeXBlU2NyaXB0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYy5lcnJvcklEKDU1MTYsIGNsYXNzTmFtZSwgcHJvcE5hbWUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKENDX0RFViAmJiAhdmFsLm92ZXJyaWRlICYmIGNscy5fX3Byb3BzX18uaW5kZXhPZihwcm9wTmFtZSkgIT09IC0xKSB7XG4gICAgICAgICAgICAgICAgLy8gY2hlY2sgb3ZlcnJpZGVcbiAgICAgICAgICAgICAgICB2YXIgYmFzZUNsYXNzID0ganMuZ2V0Q2xhc3NOYW1lKGdldEJhc2VDbGFzc1doZXJlUHJvcGVydHlEZWZpbmVkX0RFVihwcm9wTmFtZSwgY2xzKSk7XG4gICAgICAgICAgICAgICAgY2Mud2FybklEKDU1MTcsIGNsYXNzTmFtZSwgcHJvcE5hbWUsIGJhc2VDbGFzcywgcHJvcE5hbWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIG5vdGlmeSA9IHZhbC5ub3RpZnk7XG4gICAgICAgICAgICBpZiAobm90aWZ5KSB7XG4gICAgICAgICAgICAgICAgaWYgKENDX0RFViAmJiBlczYpIHtcbiAgICAgICAgICAgICAgICAgICAgY2MuZXJyb3IoJ25vdCB5ZXQgc3VwcG9ydCBub3RpZnkgYXR0cmlidXRlIGZvciBFUzYgQ2xhc3NlcycpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcGFyc2VOb3RpZnkodmFsLCBwcm9wTmFtZSwgbm90aWZ5LCBwcm9wZXJ0aWVzKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICgndHlwZScgaW4gdmFsKSB7XG4gICAgICAgICAgICAgICAgcGFyc2VUeXBlKHZhbCwgdmFsLnR5cGUsIGNsYXNzTmFtZSwgcHJvcE5hbWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxufTtcblxuaWYgKENDX0RFVikge1xuICAgIGNvbnN0IENBTExfU1VQRVJfREVTVFJPWV9SRUdfREVWID0gL1xcYlxcLl9zdXBlclxcYnxkZXN0cm95XFxzKlxcLlxccypjYWxsXFxzKlxcKFxccypcXHcrXFxzKlssfCldLztcbiAgICBleHBvcnRzLmRvVmFsaWRhdGVNZXRob2RXaXRoUHJvcHNfREVWID0gZnVuY3Rpb24gKGZ1bmMsIGZ1bmNOYW1lLCBjbGFzc05hbWUsIGNscywgYmFzZSkge1xuICAgICAgICBpZiAoY2xzLl9fcHJvcHNfXyAmJiBjbHMuX19wcm9wc19fLmluZGV4T2YoZnVuY05hbWUpID49IDApIHtcbiAgICAgICAgICAgIC8vIGZpbmQgY2xhc3MgdGhhdCBkZWZpbmVzIHRoaXMgbWV0aG9kIGFzIGEgcHJvcGVydHlcbiAgICAgICAgICAgIHZhciBiYXNlQ2xhc3NOYW1lID0ganMuZ2V0Q2xhc3NOYW1lKGdldEJhc2VDbGFzc1doZXJlUHJvcGVydHlEZWZpbmVkX0RFVihmdW5jTmFtZSwgY2xzKSk7XG4gICAgICAgICAgICBjYy5lcnJvcklEKDM2NDgsIGNsYXNzTmFtZSwgZnVuY05hbWUsIGJhc2VDbGFzc05hbWUpO1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGlmIChmdW5jTmFtZSA9PT0gJ2Rlc3Ryb3knICYmXG4gICAgICAgICAgICBqcy5pc0NoaWxkQ2xhc3NPZihiYXNlLCBjYy5Db21wb25lbnQpICYmXG4gICAgICAgICAgICAhQ0FMTF9TVVBFUl9ERVNUUk9ZX1JFR19ERVYudGVzdChmdW5jKVxuICAgICAgICApIHtcbiAgICAgICAgICAgIGNjLmVycm9yKGBPdmVyd3JpdGluZyAnJHtmdW5jTmFtZX0nIGZ1bmN0aW9uIGluICcke2NsYXNzTmFtZX0nIGNsYXNzIHdpdGhvdXQgY2FsbGluZyBzdXBlciBpcyBub3QgYWxsb3dlZC4gQ2FsbCB0aGUgc3VwZXIgZnVuY3Rpb24gaW4gJyR7ZnVuY05hbWV9JyBwbGVhc2UuYCk7XG4gICAgICAgIH1cbiAgICB9O1xufVxuXG5leHBvcnRzLnZhbGlkYXRlTWV0aG9kV2l0aFByb3BzID0gZnVuY3Rpb24gKGZ1bmMsIGZ1bmNOYW1lLCBjbGFzc05hbWUsIGNscywgYmFzZSkge1xuICAgIGlmIChDQ19ERVYgJiYgZnVuY05hbWUgPT09ICdjb25zdHJ1Y3RvcicpIHtcbiAgICAgICAgY2MuZXJyb3JJRCgzNjQzLCBjbGFzc05hbWUpO1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGlmICh0eXBlb2YgZnVuYyA9PT0gJ2Z1bmN0aW9uJyB8fCBmdW5jID09PSBudWxsKSB7XG4gICAgICAgIGlmIChDQ19ERVYpIHtcbiAgICAgICAgICAgIHRoaXMuZG9WYWxpZGF0ZU1ldGhvZFdpdGhQcm9wc19ERVYoZnVuYywgZnVuY05hbWUsIGNsYXNzTmFtZSwgY2xzLCBiYXNlKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgaWYgKENDX0RFVikge1xuICAgICAgICAgICAgaWYgKGZ1bmMgPT09IGZhbHNlICYmIGJhc2UgJiYgYmFzZS5wcm90b3R5cGUpIHtcbiAgICAgICAgICAgICAgICAvLyBjaGVjayBvdmVycmlkZVxuICAgICAgICAgICAgICAgIHZhciBvdmVycmlkZWQgPSBiYXNlLnByb3RvdHlwZVtmdW5jTmFtZV07XG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBvdmVycmlkZWQgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGJhc2VGdWMgPSBqcy5nZXRDbGFzc05hbWUoYmFzZSkgKyAnLicgKyBmdW5jTmFtZTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHN1YkZ1YyA9IGNsYXNzTmFtZSArICcuJyArIGZ1bmNOYW1lO1xuICAgICAgICAgICAgICAgICAgICBjYy53YXJuSUQoMzYyNCwgc3ViRnVjLCBiYXNlRnVjLCBzdWJGdWMsIHN1YkZ1Yyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIGNvcnJlY3QgPSBUWVBPX1RPX0NPUlJFQ1RfREVWW2Z1bmNOYW1lXTtcbiAgICAgICAgICAgIGlmIChjb3JyZWN0KSB7XG4gICAgICAgICAgICAgICAgY2Mud2FybklEKDM2MjEsIGNsYXNzTmFtZSwgZnVuY05hbWUsIGNvcnJlY3QpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoZnVuYykge1xuICAgICAgICAgICAgICAgIGNjLmVycm9ySUQoMzYyMiwgY2xhc3NOYW1lLCBmdW5jTmFtZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbn07XG4iXSwic291cmNlUm9vdCI6Ii8ifQ==