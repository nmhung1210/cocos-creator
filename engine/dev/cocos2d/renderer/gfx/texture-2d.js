
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'engine-dev/cocos2d/renderer/gfx/texture-2d.js';
                    var __require = nodeEnv ? function (request) {
                        return require(request);
                    } : function (request) {
                        return __quick_compile_engine__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_engine__.registerModule(__filename, module);}"use strict";

exports.__esModule = true;
exports["default"] = void 0;

var _texture = _interopRequireDefault(require("./texture"));

var _enums = require("./enums");

var _misc = require("./misc");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

function _inheritsLoose(subClass, superClass) { subClass.prototype = Object.create(superClass.prototype); subClass.prototype.constructor = subClass; subClass.__proto__ = superClass; }

/**
 * @typedef {HTMLImageElement | HTMLCanvasElement} HTMLImageSource
 * @typedef {HTMLImageSource | ArrayBufferView} ImageSource
 * @typedef {{width?: number, height?: number, minFilter?: number, magFilter?: number, mipFilter?: number, wrapS?: number, wrapT?: number, format?: number, genMipmaps?: boolean, images?: ImageSource[], image?: ImageSource, flipY?: boolean, premultiplyAlpha?: boolean, anisotropy?: number}} TextureUpdateOpts
 * @typedef {import("../gfx/device").default} Device
 */
var Texture2D = /*#__PURE__*/function (_Texture) {
  _inheritsLoose(Texture2D, _Texture);

  /**
   * @constructor
   * @param {Device} device
   * @param {TextureUpdateOpts} options
   */
  function Texture2D(device, options) {
    var _this;

    _this = _Texture.call(this, device) || this;
    var gl = _this._device._gl;
    _this._target = gl.TEXTURE_2D;
    _this._glID = gl.createTexture(); // always alloc texture in GPU when we create it.

    options.images = options.images || [null];

    _this.update(options);

    return _this;
  }
  /**
   * @method update
   * @param {TextureUpdateOpts} options
   */


  var _proto = Texture2D.prototype;

  _proto.update = function update(options) {
    var gl = this._device._gl;
    var genMipmaps = this._genMipmap;

    if (options) {
      if (options.width !== undefined) {
        this._width = options.width;
      }

      if (options.height !== undefined) {
        this._height = options.height;
      }

      if (options.anisotropy !== undefined) {
        this._anisotropy = options.anisotropy;
      }

      if (options.minFilter !== undefined) {
        this._minFilter = options.minFilter;
      }

      if (options.magFilter !== undefined) {
        this._magFilter = options.magFilter;
      }

      if (options.mipFilter !== undefined) {
        this._mipFilter = options.mipFilter;
      }

      if (options.wrapS !== undefined) {
        this._wrapS = options.wrapS;
      }

      if (options.wrapT !== undefined) {
        this._wrapT = options.wrapT;
      }

      if (options.format !== undefined) {
        this._format = options.format;
        this._compressed = this._format >= _enums.enums.TEXTURE_FMT_RGB_DXT1 && this._format <= _enums.enums.TEXTURE_FMT_RGBA_PVRTC_4BPPV1 || this._format >= _enums.enums.TEXTURE_FMT_RGB_ETC2 && this._format <= _enums.enums.TEXTURE_FMT_RGBA_ETC2;
      } // check if generate mipmap


      if (options.genMipmaps !== undefined) {
        this._genMipmap = options.genMipmaps;
        genMipmaps = options.genMipmaps;
      }

      var maxSize = this._device.caps.maxTextureSize || Number.MAX_VALUE;
      var textureMaxSize = Math.max(options.width || 0, options.height || 0);
      if (maxSize < textureMaxSize) console.warn("The current texture size " + textureMaxSize + " exceeds the maximum size [" + maxSize + "] supported on the device.");

      if (options.images !== undefined) {
        if (options.images.length > 1) {
          genMipmaps = false;
          var maxLength = options.width > options.height ? options.width : options.height;

          if (maxLength >> options.images.length - 1 !== 1) {
            console.error('texture-2d mipmap is invalid, should have a 1x1 mipmap.');
          }
        }
      }
    } // NOTE: get pot after this._width, this._height has been assigned.


    var pot = (0, _misc.isPow2)(this._width) && (0, _misc.isPow2)(this._height);

    if (!pot) {
      genMipmaps = false;
    }

    gl.activeTexture(gl.TEXTURE0);
    gl.bindTexture(gl.TEXTURE_2D, this._glID);

    if (options.images !== undefined && options.images.length > 0) {
      this._setMipmap(options.images, options.flipY, options.premultiplyAlpha);

      if (options.images.length > 1) this._genMipmap = true;
    }

    if (genMipmaps) {
      gl.hint(gl.GENERATE_MIPMAP_HINT, gl.NICEST);
      gl.generateMipmap(gl.TEXTURE_2D);
      this._genMipmap = true;
    }

    this._setTexInfo();

    this._device._restoreTexture(0);
  }
  /**
   * @method updateSubImage
   * @param {Object} options
   * @param {Number} options.x
   * @param {Number} options.y
   * @param {Number} options.width
   * @param {Number} options.height
   * @param {Number} options.level
   * @param {HTMLCanvasElement | HTMLImageElement | HTMLVideoElement | ArrayBufferView} options.image
   * @param {Boolean} options.flipY
   * @param {Boolean} options.premultiplyAlpha
   */
  ;

  _proto.updateSubImage = function updateSubImage(options) {
    var gl = this._device._gl;
    var glFmt = (0, _enums.glTextureFmt)(this._format);
    gl.activeTexture(gl.TEXTURE0);
    gl.bindTexture(gl.TEXTURE_2D, this._glID);

    this._setSubImage(glFmt, options);

    this._device._restoreTexture(0);
  }
  /**
   * @method updateImage
   * @param {Object} options
   * @param {Number} options.width
   * @param {Number} options.height
   * @param {Number} options.level
   * @param {HTMLCanvasElement | HTMLImageElement | HTMLVideoElement | ArrayBufferView} options.image
   * @param {Boolean} options.flipY
   * @param {Boolean} options.premultiplyAlpha
   */
  ;

  _proto.updateImage = function updateImage(options) {
    var gl = this._device._gl;
    var glFmt = (0, _enums.glTextureFmt)(this._format);
    gl.activeTexture(gl.TEXTURE0);
    gl.bindTexture(gl.TEXTURE_2D, this._glID);

    this._setImage(glFmt, options);

    this._device._restoreTexture(0);
  };

  _proto._setSubImage = function _setSubImage(glFmt, options) {
    var gl = this._device._gl;
    var flipY = options.flipY;
    var premultiplyAlpha = options.premultiplyAlpha;
    var img = options.image;

    if (img && !ArrayBuffer.isView(img) && !(img instanceof ArrayBuffer)) {
      if (flipY === undefined) {
        gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, true);
      } else {
        gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, flipY);
      }

      if (premultiplyAlpha === undefined) {
        gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, false);
      } else {
        gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, premultiplyAlpha);
      }

      gl.texSubImage2D(gl.TEXTURE_2D, options.level, options.x, options.y, glFmt.format, glFmt.pixelType, img);
    } else {
      if (flipY === undefined) {
        gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, false);
      } else {
        gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, flipY);
      }

      if (premultiplyAlpha === undefined) {
        gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, false);
      } else {
        gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, premultiplyAlpha);
      }

      if (this._compressed) {
        gl.compressedTexSubImage2D(gl.TEXTURE_2D, options.level, options.x, options.y, options.width, options.height, glFmt.format, img);
      } else {
        gl.texSubImage2D(gl.TEXTURE_2D, options.level, options.x, options.y, options.width, options.height, glFmt.format, glFmt.pixelType, img);
      }
    }
  };

  _proto._setImage = function _setImage(glFmt, options) {
    var gl = this._device._gl;
    var flipY = options.flipY;
    var premultiplyAlpha = options.premultiplyAlpha;
    var img = options.image;

    if (img && !ArrayBuffer.isView(img) && !(img instanceof ArrayBuffer)) {
      if (flipY === undefined) {
        gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, true);
      } else {
        gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, flipY);
      }

      if (premultiplyAlpha === undefined) {
        gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, false);
      } else {
        gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, premultiplyAlpha);
      }

      gl.texImage2D(gl.TEXTURE_2D, options.level, glFmt.internalFormat, glFmt.format, glFmt.pixelType, img);
    } else {
      if (flipY === undefined) {
        gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, false);
      } else {
        gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, flipY);
      }

      if (premultiplyAlpha === undefined) {
        gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, false);
      } else {
        gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, premultiplyAlpha);
      }

      if (this._compressed) {
        gl.compressedTexImage2D(gl.TEXTURE_2D, options.level, glFmt.internalFormat, options.width, options.height, 0, img);
      } else {
        gl.texImage2D(gl.TEXTURE_2D, options.level, glFmt.internalFormat, options.width, options.height, 0, glFmt.format, glFmt.pixelType, img);
      }
    }
  };

  _proto._setMipmap = function _setMipmap(images, flipY, premultiplyAlpha) {
    var glFmt = (0, _enums.glTextureFmt)(this._format);
    var options = {
      width: this._width,
      height: this._height,
      flipY: flipY,
      premultiplyAlpha: premultiplyAlpha,
      level: 0,
      image: null
    };

    for (var i = 0; i < images.length; ++i) {
      options.level = i;
      options.width = this._width >> i;
      options.height = this._height >> i;
      options.image = images[i];

      this._setImage(glFmt, options);
    }
  };

  _proto._setTexInfo = function _setTexInfo() {
    var gl = this._device._gl;
    var pot = (0, _misc.isPow2)(this._width) && (0, _misc.isPow2)(this._height); // WebGL1 doesn't support all wrap modes with NPOT textures

    if (!pot && (this._wrapS !== _enums.enums.WRAP_CLAMP || this._wrapT !== _enums.enums.WRAP_CLAMP)) {
      console.warn('WebGL1 doesn\'t support all wrap modes with NPOT textures');
      this._wrapS = _enums.enums.WRAP_CLAMP;
      this._wrapT = _enums.enums.WRAP_CLAMP;
    }

    var mipFilter = this._genMipmap ? this._mipFilter : -1;

    if (!pot && mipFilter !== -1) {
      console.warn('NPOT textures do not support mipmap filter');
      mipFilter = -1;
    }

    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, (0, _enums.glFilter)(gl, this._minFilter, mipFilter));
    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, (0, _enums.glFilter)(gl, this._magFilter, -1));
    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, this._wrapS);
    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, this._wrapT);

    var ext = this._device.ext('EXT_texture_filter_anisotropic');

    if (ext) {
      gl.texParameteri(gl.TEXTURE_2D, ext.TEXTURE_MAX_ANISOTROPY_EXT, this._anisotropy);
    }
  };

  return Texture2D;
}(_texture["default"]);

exports["default"] = Texture2D;
module.exports = exports["default"];
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_engine__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImVuZ2luZS1kZXYvY29jb3MyZC9yZW5kZXJlci9nZngvdGV4dHVyZS0yZC5qcyJdLCJuYW1lcyI6WyJUZXh0dXJlMkQiLCJkZXZpY2UiLCJvcHRpb25zIiwiZ2wiLCJfZGV2aWNlIiwiX2dsIiwiX3RhcmdldCIsIlRFWFRVUkVfMkQiLCJfZ2xJRCIsImNyZWF0ZVRleHR1cmUiLCJpbWFnZXMiLCJ1cGRhdGUiLCJnZW5NaXBtYXBzIiwiX2dlbk1pcG1hcCIsIndpZHRoIiwidW5kZWZpbmVkIiwiX3dpZHRoIiwiaGVpZ2h0IiwiX2hlaWdodCIsImFuaXNvdHJvcHkiLCJfYW5pc290cm9weSIsIm1pbkZpbHRlciIsIl9taW5GaWx0ZXIiLCJtYWdGaWx0ZXIiLCJfbWFnRmlsdGVyIiwibWlwRmlsdGVyIiwiX21pcEZpbHRlciIsIndyYXBTIiwiX3dyYXBTIiwid3JhcFQiLCJfd3JhcFQiLCJmb3JtYXQiLCJfZm9ybWF0IiwiX2NvbXByZXNzZWQiLCJlbnVtcyIsIlRFWFRVUkVfRk1UX1JHQl9EWFQxIiwiVEVYVFVSRV9GTVRfUkdCQV9QVlJUQ180QlBQVjEiLCJURVhUVVJFX0ZNVF9SR0JfRVRDMiIsIlRFWFRVUkVfRk1UX1JHQkFfRVRDMiIsIm1heFNpemUiLCJjYXBzIiwibWF4VGV4dHVyZVNpemUiLCJOdW1iZXIiLCJNQVhfVkFMVUUiLCJ0ZXh0dXJlTWF4U2l6ZSIsIk1hdGgiLCJtYXgiLCJjb25zb2xlIiwid2FybiIsImxlbmd0aCIsIm1heExlbmd0aCIsImVycm9yIiwicG90IiwiYWN0aXZlVGV4dHVyZSIsIlRFWFRVUkUwIiwiYmluZFRleHR1cmUiLCJfc2V0TWlwbWFwIiwiZmxpcFkiLCJwcmVtdWx0aXBseUFscGhhIiwiaGludCIsIkdFTkVSQVRFX01JUE1BUF9ISU5UIiwiTklDRVNUIiwiZ2VuZXJhdGVNaXBtYXAiLCJfc2V0VGV4SW5mbyIsIl9yZXN0b3JlVGV4dHVyZSIsInVwZGF0ZVN1YkltYWdlIiwiZ2xGbXQiLCJfc2V0U3ViSW1hZ2UiLCJ1cGRhdGVJbWFnZSIsIl9zZXRJbWFnZSIsImltZyIsImltYWdlIiwiQXJyYXlCdWZmZXIiLCJpc1ZpZXciLCJwaXhlbFN0b3JlaSIsIlVOUEFDS19GTElQX1lfV0VCR0wiLCJVTlBBQ0tfUFJFTVVMVElQTFlfQUxQSEFfV0VCR0wiLCJ0ZXhTdWJJbWFnZTJEIiwibGV2ZWwiLCJ4IiwieSIsInBpeGVsVHlwZSIsImNvbXByZXNzZWRUZXhTdWJJbWFnZTJEIiwidGV4SW1hZ2UyRCIsImludGVybmFsRm9ybWF0IiwiY29tcHJlc3NlZFRleEltYWdlMkQiLCJpIiwiV1JBUF9DTEFNUCIsInRleFBhcmFtZXRlcmkiLCJURVhUVVJFX01JTl9GSUxURVIiLCJURVhUVVJFX01BR19GSUxURVIiLCJURVhUVVJFX1dSQVBfUyIsIlRFWFRVUkVfV1JBUF9UIiwiZXh0IiwiVEVYVFVSRV9NQVhfQU5JU09UUk9QWV9FWFQiLCJUZXh0dXJlIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7OztBQUVBOzs7Ozs7SUFPcUJBOzs7QUFDbkI7Ozs7O0FBS0EscUJBQVlDLE1BQVosRUFBb0JDLE9BQXBCLEVBQTZCO0FBQUE7O0FBQzNCLGdDQUFNRCxNQUFOO0FBRUEsUUFBSUUsRUFBRSxHQUFHLE1BQUtDLE9BQUwsQ0FBYUMsR0FBdEI7QUFDQSxVQUFLQyxPQUFMLEdBQWVILEVBQUUsQ0FBQ0ksVUFBbEI7QUFDQSxVQUFLQyxLQUFMLEdBQWFMLEVBQUUsQ0FBQ00sYUFBSCxFQUFiLENBTDJCLENBTzNCOztBQUNBUCxJQUFBQSxPQUFPLENBQUNRLE1BQVIsR0FBaUJSLE9BQU8sQ0FBQ1EsTUFBUixJQUFrQixDQUFDLElBQUQsQ0FBbkM7O0FBQ0EsVUFBS0MsTUFBTCxDQUFZVCxPQUFaOztBQVQyQjtBQVU1QjtBQUVEOzs7Ozs7OztTQUlBUyxTQUFBLGdCQUFPVCxPQUFQLEVBQWdCO0FBQ2QsUUFBSUMsRUFBRSxHQUFHLEtBQUtDLE9BQUwsQ0FBYUMsR0FBdEI7QUFDQSxRQUFJTyxVQUFV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QUEsT0FBTyxDQUFDQyxJQUFSLENBQWEsNENBQWI7QUFDQXZCLE1BQUFBLFNBQVMsR0FBRyxDQUFDLENBQWI7QUFDRDs7QUFFRHRCLElBQUFBLEVBQUUsQ0FBQ3FGLGFBQUgsQ0FBaUJyRixFQUFFLENBQUNJLFVBQXBCLEVBQWdDSixFQUFFLENBQUNzRixrQkFBbkMsRUFBdUQscUJBQVN0RixFQUFULEVBQWEsS0FBS21CLFVBQWxCLEVBQThCRyxTQUE5QixDQUF2RDtBQUNBdEIsSUFBQUEsRUFBRSxDQUFDcUYsYUFBSCxDQUFpQnJGLEVBQUUsQ0FBQ0ksVUFBcEIsRUFBZ0NKLEVBQUUsQ0FBQ3VGLGtCQUFuQyxFQUF1RCxxQkFBU3ZGLEVBQVQsRUFBYSxLQUFLcUIsVUFBbEIsRUFBOEIsQ0FBQyxDQUEvQixDQUF2RDtBQUNBckIsSUFBQUEsRUFBRSxDQUFDcUYsYUFBSCxDQUFpQnJGLEVBQUUsQ0FBQ0ksVUFBcEIsRUFBZ0NKLEVBQUUsQ0FBQ3dGLGNBQW5DLEVBQW1ELEtBQUsvRCxNQUF4RDtBQUNBekIsSUFBQUEsRUFBRSxDQUFDcUYsYUFBSCxDQUFpQnJGLEVBQUUsQ0FBQ0ksVUFBcEIsRUFBZ0NKLEVBQUUsQ0FBQ3lGLGNBQW5DLEVBQW1ELEtBQUs5RCxNQUF4RDs7QUFFQSxRQUFJK0QsR0FBRyxHQUFHLEtBQUt6RixPQUFMLENBQWF5RixHQUFiLENBQWlCLGdDQUFqQixDQUFWOztBQUNBLFFBQUlBLEdBQUosRUFBUztBQUNQMUYsTUFBQUEsRUFBRSxDQUFDcUYsYUFBSCxDQUFpQnJGLEVBQUUsQ0FBQ0ksVUFBcEIsRUFBZ0NzRixHQUFHLENBQUNDLDBCQUFwQyxFQUFnRSxLQUFLMUUsV0FBckU7QUFDRDtBQUNGOzs7RUE1VG9DMkUiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBAdHMtY2hlY2tcbmltcG9ydCBUZXh0dXJlIGZyb20gJy4vdGV4dHVyZSc7XG5pbXBvcnQgeyBlbnVtcywgZ2xGaWx0ZXIsIGdsVGV4dHVyZUZtdCB9IGZyb20gJy4vZW51bXMnO1xuaW1wb3J0IHsgaXNQb3cyIH0gZnJvbSAnLi9taXNjJztcblxuLyoqXG4gKiBAdHlwZWRlZiB7SFRNTEltYWdlRWxlbWVudCB8IEhUTUxDYW52YXNFbGVtZW50fSBIVE1MSW1hZ2VTb3VyY2VcbiAqIEB0eXBlZGVmIHtIVE1MSW1hZ2VTb3VyY2UgfCBBcnJheUJ1ZmZlclZpZXd9IEltYWdlU291cmNlXG4gKiBAdHlwZWRlZiB7e3dpZHRoPzogbnVtYmVyLCBoZWlnaHQ/OiBudW1iZXIsIG1pbkZpbHRlcj86IG51bWJlciwgbWFnRmlsdGVyPzogbnVtYmVyLCBtaXBGaWx0ZXI/OiBudW1iZXIsIHdyYXBTPzogbnVtYmVyLCB3cmFwVD86IG51bWJlciwgZm9ybWF0PzogbnVtYmVyLCBnZW5NaXBtYXBzPzogYm9vbGVhbiwgaW1hZ2VzPzogSW1hZ2VTb3VyY2VbXSwgaW1hZ2U/OiBJbWFnZVNvdXJjZSwgZmxpcFk/OiBib29sZWFuLCBwcmVtdWx0aXBseUFscGhhPzogYm9vbGVhbiwgYW5pc290cm9weT86IG51bWJlcn19IFRleHR1cmVVcGRhdGVPcHRzXG4gKiBAdHlwZWRlZiB7aW1wb3J0KFwiLi4vZ2Z4L2RldmljZVwiKS5kZWZhdWx0fSBEZXZpY2VcbiAqL1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBUZXh0dXJlMkQgZXh0ZW5kcyBUZXh0dXJlIHtcbiAgLyoqXG4gICAqIEBjb25zdHJ1Y3RvclxuICAgKiBAcGFyYW0ge0RldmljZX0gZGV2aWNlXG4gICAqIEBwYXJhbSB7VGV4dHVyZVVwZGF0ZU9wdHN9IG9wdGlvbnNcbiAgICovXG4gIGNvbnN0cnVjdG9yKGRldmljZSwgb3B0aW9ucykge1xuICAgIHN1cGVyKGRldmljZSk7XG5cbiAgICBsZXQgZ2wgPSB0aGlzLl9kZXZpY2UuX2dsO1xuICAgIHRoaXMuX3RhcmdldCA9IGdsLlRFWFRVUkVfMkQ7XG4gICAgdGhpcy5fZ2xJRCA9IGdsLmNyZWF0ZVRleHR1cmUoKTtcblxuICAgIC8vIGFsd2F5cyBhbGxvYyB0ZXh0dXJlIGluIEdQVSB3aGVuIHdlIGNyZWF0ZSBpdC5cbiAgICBvcHRpb25zLmltYWdlcyA9IG9wdGlvbnMuaW1hZ2VzIHx8IFtudWxsXTtcbiAgICB0aGlzLnVwZGF0ZShvcHRpb25zKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBAbWV0aG9kIHVwZGF0ZVxuICAgKiBAcGFyYW0ge1RleHR1cmVVcGRhdGVPcHRzfSBvcHRpb25zXG4gICAqL1xuICB1cGRhdGUob3B0aW9ucykge1xuICAgIGxldCBnbCA9IHRoaXMuX2RldmljZS5fZ2w7XG4gICAgbGV0IGdlbk1pcG1hcHMgPSB0aGlzLl9nZW5NaXBtYXA7XG5cbiAgICBpZiAob3B0aW9ucykge1xuICAgICAgaWYgKG9wdGlvbnMud2lkdGggIT09IHVuZGVmaW5lZCkge1xuICAgICAgICB0aGlzLl93aWR0aCA9IG9wdGlvbnMud2lkdGg7XG4gICAgICB9XG4gICAgICBpZiAob3B0aW9ucy5oZWlnaHQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICB0aGlzLl9oZWlnaHQgPSBvcHRpb25zLmhlaWdodDtcbiAgICAgIH1cbiAgICAgIGlmIChvcHRpb25zLmFuaXNvdHJvcHkgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICB0aGlzLl9hbmlzb3Ryb3B5ID0gb3B0aW9ucy5hbmlzb3Ryb3B5O1xuICAgICAgfVxuICAgICAgaWYgKG9wdGlvbnMubWluRmlsdGVyICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgdGhpcy5fbWluRmlsdGVyID0gb3B0aW9ucy5taW5GaWx0ZXI7XG4gICAgICB9XG4gICAgICBpZiAob3B0aW9ucy5tYWdGaWx0ZXIgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICB0aGlzLl9tYWdGaWx0ZXIgPSBvcHRpb25zLm1hZ0ZpbHRlcjtcbiAgICAgIH1cbiAgICAgIGlmIChvcHRpb25zLm1pcEZpbHRlciAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHRoaXMuX21pcEZpbHRlciA9IG9wdGlvbnMubWlwRmlsdGVyO1xuICAgICAgfVxuICAgICAgaWYgKG9wdGlvbnMud3JhcFMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICB0aGlzLl93cmFwUyA9IG9wdGlvbnMud3JhcFM7XG4gICAgICB9XG4gICAgICBpZiAob3B0aW9ucy53cmFwVCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHRoaXMuX3dyYXBUID0gb3B0aW9ucy53cmFwVDtcbiAgICAgIH1cbiAgICAgIGlmIChvcHRpb25zLmZvcm1hdCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHRoaXMuX2Zvcm1hdCA9IG9wdGlvbnMuZm9ybWF0O1xuICAgICAgICB0aGlzLl9jb21wcmVzc2VkID0gXG4gICAgICAgICAgKHRoaXMuX2Zvcm1hdCA+PSBlbnVtcy5URVhUVVJFX0ZNVF9SR0JfRFhUMSAmJiB0aGlzLl9mb3JtYXQgPD0gZW51bXMuVEVYVFVSRV9GTVRfUkdCQV9QVlJUQ180QlBQVjEpIHx8IFxuICAgICAgICAgICh0aGlzLl9mb3JtYXQgPj0gZW51bXMuVEVYVFVSRV9GTVRfUkdCX0VUQzIgJiYgdGhpcy5fZm9ybWF0IDw9IGVudW1zLlRFWFRVUkVfRk1UX1JHQkFfRVRDMilcbiAgICAgICAgO1xuICAgICAgfVxuXG4gICAgICAvLyBjaGVjayBpZiBnZW5lcmF0ZSBtaXBtYXBcbiAgICAgIGlmIChvcHRpb25zLmdlbk1pcG1hcHMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICB0aGlzLl9nZW5NaXBtYXAgPSBvcHRpb25zLmdlbk1pcG1hcHM7XG4gICAgICAgIGdlbk1pcG1hcHMgPSBvcHRpb25zLmdlbk1pcG1hcHM7XG4gICAgICB9XG5cbiAgICAgIGxldCBtYXhTaXplID0gdGhpcy5fZGV2aWNlLmNhcHMubWF4VGV4dHVyZVNpemUgfHwgTnVtYmVyLk1BWF9WQUxVRTtcbiAgICAgIGxldCB0ZXh0dXJlTWF4U2l6ZSA9IE1hdGgubWF4KG9wdGlvbnMud2lkdGggfHwgMCwgb3B0aW9ucy5oZWlnaHQgfHwgMCk7XG4gICAgICBpZiAobWF4U2l6ZSA8IHRleHR1cmVNYXhTaXplKVxuICAgICAgICBjb25zb2xlLndhcm4oYFRoZSBjdXJyZW50IHRleHR1cmUgc2l6ZSAke3RleHR1cmVNYXhTaXplfSBleGNlZWRzIHRoZSBtYXhpbXVtIHNpemUgWyR7bWF4U2l6ZX1dIHN1cHBvcnRlZCBvbiB0aGUgZGV2aWNlLmApO1xuXG4gICAgICBpZiAob3B0aW9ucy5pbWFnZXMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBpZiAob3B0aW9ucy5pbWFnZXMubGVuZ3RoID4gMSkge1xuICAgICAgICAgIGdlbk1pcG1hcHMgPSBmYWxzZTtcbiAgICAgICAgICBsZXQgbWF4TGVuZ3RoID0gb3B0aW9ucy53aWR0aCA+IG9wdGlvbnMuaGVpZ2h0ID8gb3B0aW9ucy53aWR0aCA6IG9wdGlvbnMuaGVpZ2h0O1xuICAgICAgICAgIGlmIChtYXhMZW5ndGggPj4gKG9wdGlvbnMuaW1hZ2VzLmxlbmd0aCAtIDEpICE9PSAxKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCd0ZXh0dXJlLTJkIG1pcG1hcCBpcyBpbnZhbGlkLCBzaG91bGQgaGF2ZSBhIDF4MSBtaXBtYXAuJyk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gTk9URTogZ2V0IHBvdCBhZnRlciB0aGlzLl93aWR0aCwgdGhpcy5faGVpZ2h0IGhhcyBiZWVuIGFzc2lnbmVkLlxuICAgIGxldCBwb3QgPSBpc1BvdzIodGhpcy5fd2lkdGgpICYmIGlzUG93Mih0aGlzLl9oZWlnaHQpO1xuICAgIGlmICghcG90KSB7XG4gICAgICBnZW5NaXBtYXBzID0gZmFsc2U7XG4gICAgfVxuXG4gICAgZ2wuYWN0aXZlVGV4dHVyZShnbC5URVhUVVJFMCk7XG4gICAgZ2wuYmluZFRleHR1cmUoZ2wuVEVYVFVSRV8yRCwgdGhpcy5fZ2xJRCk7XG4gICAgaWYgKG9wdGlvbnMuaW1hZ2VzICE9PSB1bmRlZmluZWQgJiYgb3B0aW9ucy5pbWFnZXMubGVuZ3RoID4gMCkge1xuICAgICAgdGhpcy5fc2V0TWlwbWFwKG9wdGlvbnMuaW1hZ2VzLCBvcHRpb25zLmZsaXBZLCBvcHRpb25zLnByZW11bHRpcGx5QWxwaGEpO1xuICAgICAgaWYgKG9wdGlvbnMuaW1hZ2VzLmxlbmd0aCA+IDEpIHRoaXMuX2dlbk1pcG1hcCA9IHRydWU7XG4gICAgfVxuICAgIGlmIChnZW5NaXBtYXBzKSB7XG4gICAgICBnbC5oaW50KGdsLkdFTkVSQVRFX01JUE1BUF9ISU5ULCBnbC5OSUNFU1QpO1xuICAgICAgZ2wuZ2VuZXJhdGVNaXBtYXAoZ2wuVEVYVFVSRV8yRCk7XG4gICAgICB0aGlzLl9nZW5NaXBtYXAgPSB0cnVlO1xuICAgIH1cblxuICAgIHRoaXMuX3NldFRleEluZm8oKTtcbiAgICB0aGlzLl9kZXZpY2UuX3Jlc3RvcmVUZXh0dXJlKDApO1xuICB9XG5cbiAgLyoqXG4gICAqIEBtZXRob2QgdXBkYXRlU3ViSW1hZ2VcbiAgICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnNcbiAgICogQHBhcmFtIHtOdW1iZXJ9IG9wdGlvbnMueFxuICAgKiBAcGFyYW0ge051bWJlcn0gb3B0aW9ucy55XG4gICAqIEBwYXJhbSB7TnVtYmVyfSBvcHRpb25zLndpZHRoXG4gICAqIEBwYXJhbSB7TnVtYmVyfSBvcHRpb25zLmhlaWdodFxuICAgKiBAcGFyYW0ge051bWJlcn0gb3B0aW9ucy5sZXZlbFxuICAgKiBAcGFyYW0ge0hUTUxDYW52YXNFbGVtZW50IHwgSFRNTEltYWdlRWxlbWVudCB8IEhUTUxWaWRlb0VsZW1lbnQgfCBBcnJheUJ1ZmZlclZpZXd9IG9wdGlvbnMuaW1hZ2VcbiAgICogQHBhcmFtIHtCb29sZWFufSBvcHRpb25zLmZsaXBZXG4gICAqIEBwYXJhbSB7Qm9vbGVhbn0gb3B0aW9ucy5wcmVtdWx0aXBseUFscGhhXG4gICAqL1xuICB1cGRhdGVTdWJJbWFnZShvcHRpb25zKSB7XG4gICAgbGV0IGdsID0gdGhpcy5fZGV2aWNlLl9nbDtcbiAgICBsZXQgZ2xGbXQgPSBnbFRleHR1cmVGbXQodGhpcy5fZm9ybWF0KTtcblxuICAgIGdsLmFjdGl2ZVRleHR1cmUoZ2wuVEVYVFVSRTApO1xuICAgIGdsLmJpbmRUZXh0dXJlKGdsLlRFWFRVUkVfMkQsIHRoaXMuX2dsSUQpO1xuICAgIHRoaXMuX3NldFN1YkltYWdlKGdsRm10LCBvcHRpb25zKTtcbiAgICB0aGlzLl9kZXZpY2UuX3Jlc3RvcmVUZXh0dXJlKDApO1xuICB9XG5cbiAgLyoqXG4gICAqIEBtZXRob2QgdXBkYXRlSW1hZ2VcbiAgICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnNcbiAgICogQHBhcmFtIHtOdW1iZXJ9IG9wdGlvbnMud2lkdGhcbiAgICogQHBhcmFtIHtOdW1iZXJ9IG9wdGlvbnMuaGVpZ2h0XG4gICAqIEBwYXJhbSB7TnVtYmVyfSBvcHRpb25zLmxldmVsXG4gICAqIEBwYXJhbSB7SFRNTENhbnZhc0VsZW1lbnQgfCBIVE1MSW1hZ2VFbGVtZW50IHwgSFRNTFZpZGVvRWxlbWVudCB8IEFycmF5QnVmZmVyVmlld30gb3B0aW9ucy5pbWFnZVxuICAgKiBAcGFyYW0ge0Jvb2xlYW59IG9wdGlvbnMuZmxpcFlcbiAgICogQHBhcmFtIHtCb29sZWFufSBvcHRpb25zLnByZW11bHRpcGx5QWxwaGFcbiAgICovXG4gIHVwZGF0ZUltYWdlKG9wdGlvbnMpIHtcbiAgICBsZXQgZ2wgPSB0aGlzLl9kZXZpY2UuX2dsO1xuICAgIGxldCBnbEZtdCA9IGdsVGV4dHVyZUZtdCh0aGlzLl9mb3JtYXQpO1xuXG4gICAgZ2wuYWN0aXZlVGV4dHVyZShnbC5URVhUVVJFMCk7XG4gICAgZ2wuYmluZFRleHR1cmUoZ2wuVEVYVFVSRV8yRCwgdGhpcy5fZ2xJRCk7XG4gICAgdGhpcy5fc2V0SW1hZ2UoZ2xGbXQsIG9wdGlvbnMpO1xuICAgIHRoaXMuX2RldmljZS5fcmVzdG9yZVRleHR1cmUoMCk7XG4gIH1cblxuICBfc2V0U3ViSW1hZ2UoZ2xGbXQsIG9wdGlvbnMpIHtcbiAgICBsZXQgZ2wgPSB0aGlzLl9kZXZpY2UuX2dsO1xuICAgIGxldCBmbGlwWSA9IG9wdGlvbnMuZmxpcFk7XG4gICAgbGV0IHByZW11bHRpcGx5QWxwaGEgPSBvcHRpb25zLnByZW11bHRpcGx5QWxwaGE7XG4gICAgbGV0IGltZyA9IG9wdGlvbnMuaW1hZ2U7XG5cbiAgICBpZiAoaW1nICYmICFBcnJheUJ1ZmZlci5pc1ZpZXcoaW1nKSAmJiAhKGltZyBpbnN0YW5jZW9mIEFycmF5QnVmZmVyKSkge1xuICAgICAgaWYgKGZsaXBZID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgZ2wucGl4ZWxTdG9yZWkoZ2wuVU5QQUNLX0ZMSVBfWV9XRUJHTCwgdHJ1ZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBnbC5waXhlbFN0b3JlaShnbC5VTlBBQ0tfRkxJUF9ZX1dFQkdMLCBmbGlwWSk7XG4gICAgICB9XG5cbiAgICAgIGlmIChwcmVtdWx0aXBseUFscGhhID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgZ2wucGl4ZWxTdG9yZWkoZ2wuVU5QQUNLX1BSRU1VTFRJUExZX0FMUEhBX1dFQkdMLCBmYWxzZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBnbC5waXhlbFN0b3JlaShnbC5VTlBBQ0tfUFJFTVVMVElQTFlfQUxQSEFfV0VCR0wsIHByZW11bHRpcGx5QWxwaGEpO1xuICAgICAgfVxuXG4gICAgICBnbC50ZXhTdWJJbWFnZTJEKGdsLlRFWFRVUkVfMkQsIG9wdGlvbnMubGV2ZWwsIG9wdGlvbnMueCwgb3B0aW9ucy55LCBnbEZtdC5mb3JtYXQsIGdsRm10LnBpeGVsVHlwZSwgaW1nKTtcbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKGZsaXBZID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgZ2wucGl4ZWxTdG9yZWkoZ2wuVU5QQUNLX0ZMSVBfWV9XRUJHTCwgZmFsc2UpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZ2wucGl4ZWxTdG9yZWkoZ2wuVU5QQUNLX0ZMSVBfWV9XRUJHTCwgZmxpcFkpO1xuICAgICAgfVxuXG4gICAgICBpZiAocHJlbXVsdGlwbHlBbHBoYSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGdsLnBpeGVsU3RvcmVpKGdsLlVOUEFDS19QUkVNVUxUSVBMWV9BTFBIQV9XRUJHTCwgZmFsc2UpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZ2wucGl4ZWxTdG9yZWkoZ2wuVU5QQUNLX1BSRU1VTFRJUExZX0FMUEhBX1dFQkdMLCBwcmVtdWx0aXBseUFscGhhKTtcbiAgICAgIH1cblxuICAgICAgaWYgKHRoaXMuX2NvbXByZXNzZWQpIHtcbiAgICAgICAgZ2wuY29tcHJlc3NlZFRleFN1YkltYWdlMkQoZ2wuVEVYVFVSRV8yRCxcbiAgICAgICAgICBvcHRpb25zLmxldmVsLFxuICAgICAgICAgIG9wdGlvbnMueCxcbiAgICAgICAgICBvcHRpb25zLnksXG4gICAgICAgICAgb3B0aW9ucy53aWR0aCxcbiAgICAgICAgICBvcHRpb25zLmhlaWdodCxcbiAgICAgICAgICBnbEZtdC5mb3JtYXQsXG4gICAgICAgICAgaW1nXG4gICAgICAgICk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBnbC50ZXhTdWJJbWFnZTJEKFxuICAgICAgICAgIGdsLlRFWFRVUkVfMkQsXG4gICAgICAgICAgb3B0aW9ucy5sZXZlbCxcbiAgICAgICAgICBvcHRpb25zLngsXG4gICAgICAgICAgb3B0aW9ucy55LFxuICAgICAgICAgIG9wdGlvbnMud2lkdGgsXG4gICAgICAgICAgb3B0aW9ucy5oZWlnaHQsXG4gICAgICAgICAgZ2xGbXQuZm9ybWF0LFxuICAgICAgICAgIGdsRm10LnBpeGVsVHlwZSxcbiAgICAgICAgICBpbWdcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBfc2V0SW1hZ2UoZ2xGbXQsIG9wdGlvbnMpIHtcbiAgICBsZXQgZ2wgPSB0aGlzLl9kZXZpY2UuX2dsO1xuICAgIGxldCBmbGlwWSA9IG9wdGlvbnMuZmxpcFk7XG4gICAgbGV0IHByZW11bHRpcGx5QWxwaGEgPSBvcHRpb25zLnByZW11bHRpcGx5QWxwaGE7XG4gICAgbGV0IGltZyA9IG9wdGlvbnMuaW1hZ2U7XG5cbiAgICBpZiAoaW1nICYmICFBcnJheUJ1ZmZlci5pc1ZpZXcoaW1nKSAmJiAhKGltZyBpbnN0YW5jZW9mIEFycmF5QnVmZmVyKSkge1xuICAgICAgaWYgKGZsaXBZID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgZ2wucGl4ZWxTdG9yZWkoZ2wuVU5QQUNLX0ZMSVBfWV9XRUJHTCwgdHJ1ZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBnbC5waXhlbFN0b3JlaShnbC5VTlBBQ0tfRkxJUF9ZX1dFQkdMLCBmbGlwWSk7XG4gICAgICB9XG5cbiAgICAgIGlmIChwcmVtdWx0aXBseUFscGhhID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgZ2wucGl4ZWxTdG9yZWkoZ2wuVU5QQUNLX1BSRU1VTFRJUExZX0FMUEhBX1dFQkdMLCBmYWxzZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBnbC5waXhlbFN0b3JlaShnbC5VTlBBQ0tfUFJFTVVMVElQTFlfQUxQSEFfV0VCR0wsIHByZW11bHRpcGx5QWxwaGEpO1xuICAgICAgfVxuXG4gICAgICBnbC50ZXhJbWFnZTJEKFxuICAgICAgICBnbC5URVhUVVJFXzJELFxuICAgICAgICBvcHRpb25zLmxldmVsLFxuICAgICAgICBnbEZtdC5pbnRlcm5hbEZvcm1hdCxcbiAgICAgICAgZ2xGbXQuZm9ybWF0LFxuICAgICAgICBnbEZtdC5waXhlbFR5cGUsXG4gICAgICAgIGltZ1xuICAgICAgKTtcbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKGZsaXBZID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgZ2wucGl4ZWxTdG9yZWkoZ2wuVU5QQUNLX0ZMSVBfWV9XRUJHTCwgZmFsc2UpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZ2wucGl4ZWxTdG9yZWkoZ2wuVU5QQUNLX0ZMSVBfWV9XRUJHTCwgZmxpcFkpO1xuICAgICAgfVxuXG4gICAgICBpZiAocHJlbXVsdGlwbHlBbHBoYSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGdsLnBpeGVsU3RvcmVpKGdsLlVOUEFDS19QUkVNVUxUSVBMWV9BTFBIQV9XRUJHTCwgZmFsc2UpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZ2wucGl4ZWxTdG9yZWkoZ2wuVU5QQUNLX1BSRU1VTFRJUExZX0FMUEhBX1dFQkdMLCBwcmVtdWx0aXBseUFscGhhKTtcbiAgICAgIH1cblxuICAgICAgaWYgKHRoaXMuX2NvbXByZXNzZWQpIHtcbiAgICAgICAgZ2wuY29tcHJlc3NlZFRleEltYWdlMkQoXG4gICAgICAgICAgZ2wuVEVYVFVSRV8yRCxcbiAgICAgICAgICBvcHRpb25zLmxldmVsLFxuICAgICAgICAgIGdsRm10LmludGVybmFsRm9ybWF0LFxuICAgICAgICAgIG9wdGlvbnMud2lkdGgsXG4gICAgICAgICAgb3B0aW9ucy5oZWlnaHQsXG4gICAgICAgICAgMCxcbiAgICAgICAgICBpbWdcbiAgICAgICAgKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGdsLnRleEltYWdlMkQoXG4gICAgICAgICAgZ2wuVEVYVFVSRV8yRCxcbiAgICAgICAgICBvcHRpb25zLmxldmVsLFxuICAgICAgICAgIGdsRm10LmludGVybmFsRm9ybWF0LFxuICAgICAgICAgIG9wdGlvbnMud2lkdGgsXG4gICAgICAgICAgb3B0aW9ucy5oZWlnaHQsXG4gICAgICAgICAgMCxcbiAgICAgICAgICBnbEZtdC5mb3JtYXQsXG4gICAgICAgICAgZ2xGbXQucGl4ZWxUeXBlLFxuICAgICAgICAgIGltZ1xuICAgICAgICApO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIF9zZXRNaXBtYXAoaW1hZ2VzLCBmbGlwWSwgcHJlbXVsdGlwbHlBbHBoYSkge1xuICAgIGxldCBnbEZtdCA9IGdsVGV4dHVyZUZtdCh0aGlzLl9mb3JtYXQpO1xuICAgIGxldCBvcHRpb25zID0ge1xuICAgICAgd2lkdGg6IHRoaXMuX3dpZHRoLFxuICAgICAgaGVpZ2h0OiB0aGlzLl9oZWlnaHQsXG4gICAgICBmbGlwWTogZmxpcFksXG4gICAgICBwcmVtdWx0aXBseUFscGhhOiBwcmVtdWx0aXBseUFscGhhLFxuICAgICAgbGV2ZWw6IDAsXG4gICAgICBpbWFnZTogbnVsbFxuICAgIH07XG5cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGltYWdlcy5sZW5ndGg7ICsraSkge1xuICAgICAgb3B0aW9ucy5sZXZlbCA9IGk7XG4gICAgICBvcHRpb25zLndpZHRoID0gdGhpcy5fd2lkdGggPj4gaTtcbiAgICAgIG9wdGlvbnMuaGVpZ2h0ID0gdGhpcy5faGVpZ2h0ID4+IGk7XG4gICAgICBvcHRpb25zLmltYWdlID0gaW1hZ2VzW2ldO1xuICAgICAgdGhpcy5fc2V0SW1hZ2UoZ2xGbXQsIG9wdGlvbnMpO1xuICAgIH1cbiAgfVxuXG4gIF9zZXRUZXhJbmZvKCkge1xuICAgIGxldCBnbCA9IHRoaXMuX2RldmljZS5fZ2w7XG4gICAgbGV0IHBvdCA9IGlzUG93Mih0aGlzLl93aWR0aCkgJiYgaXNQb3cyKHRoaXMuX2hlaWdodCk7XG5cbiAgICAvLyBXZWJHTDEgZG9lc24ndCBzdXBwb3J0IGFsbCB3cmFwIG1vZGVzIHdpdGggTlBPVCB0ZXh0dXJlc1xuICAgIGlmICghcG90ICYmICh0aGlzLl93cmFwUyAhPT0gZW51bXMuV1JBUF9DTEFNUCB8fCB0aGlzLl93cmFwVCAhPT0gZW51bXMuV1JBUF9DTEFNUCkpIHtcbiAgICAgIGNvbnNvbGUud2FybignV2ViR0wxIGRvZXNuXFwndCBzdXBwb3J0IGFsbCB3cmFwIG1vZGVzIHdpdGggTlBPVCB0ZXh0dXJlcycpO1xuICAgICAgdGhpcy5fd3JhcFMgPSBlbnVtcy5XUkFQX0NMQU1QO1xuICAgICAgdGhpcy5fd3JhcFQgPSBlbnVtcy5XUkFQX0NMQU1QO1xuICAgIH1cblxuICAgIGxldCBtaXBGaWx0ZXIgPSB0aGlzLl9nZW5NaXBtYXAgPyB0aGlzLl9taXBGaWx0ZXIgOiAtMTtcbiAgICBpZiAoIXBvdCAmJiBtaXBGaWx0ZXIgIT09IC0xKSB7XG4gICAgICBjb25zb2xlLndhcm4oJ05QT1QgdGV4dHVyZXMgZG8gbm90IHN1cHBvcnQgbWlwbWFwIGZpbHRlcicpO1xuICAgICAgbWlwRmlsdGVyID0gLTE7XG4gICAgfVxuXG4gICAgZ2wudGV4UGFyYW1ldGVyaShnbC5URVhUVVJFXzJELCBnbC5URVhUVVJFX01JTl9GSUxURVIsIGdsRmlsdGVyKGdsLCB0aGlzLl9taW5GaWx0ZXIsIG1pcEZpbHRlcikpO1xuICAgIGdsLnRleFBhcmFtZXRlcmkoZ2wuVEVYVFVSRV8yRCwgZ2wuVEVYVFVSRV9NQUdfRklMVEVSLCBnbEZpbHRlcihnbCwgdGhpcy5fbWFnRmlsdGVyLCAtMSkpO1xuICAgIGdsLnRleFBhcmFtZXRlcmkoZ2wuVEVYVFVSRV8yRCwgZ2wuVEVYVFVSRV9XUkFQX1MsIHRoaXMuX3dyYXBTKTtcbiAgICBnbC50ZXhQYXJhbWV0ZXJpKGdsLlRFWFRVUkVfMkQsIGdsLlRFWFRVUkVfV1JBUF9ULCB0aGlzLl93cmFwVCk7XG5cbiAgICBsZXQgZXh0ID0gdGhpcy5fZGV2aWNlLmV4dCgnRVhUX3RleHR1cmVfZmlsdGVyX2FuaXNvdHJvcGljJyk7XG4gICAgaWYgKGV4dCkge1xuICAgICAgZ2wudGV4UGFyYW1ldGVyaShnbC5URVhUVVJFXzJELCBleHQuVEVYVFVSRV9NQVhfQU5JU09UUk9QWV9FWFQsIHRoaXMuX2FuaXNvdHJvcHkpO1xuICAgIH1cbiAgfVxufSJdLCJzb3VyY2VSb290IjoiLyJ9