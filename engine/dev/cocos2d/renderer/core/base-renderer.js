
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'engine-dev/cocos2d/renderer/core/base-renderer.js';
                    var __require = nodeEnv ? function (request) {
                        return require(request);
                    } : function (request) {
                        return __quick_compile_engine__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_engine__.registerModule(__filename, module);}"use strict";

exports.__esModule = true;
exports["default"] = void 0;

var _memop = require("../memop");

var _enums = _interopRequireDefault(require("../enums"));

var _valueTypes = require("../../core/value-types");

var _programLib = _interopRequireDefault(require("./program-lib"));

var _view = _interopRequireDefault(require("./view"));

var _gfx = _interopRequireDefault(require("../gfx"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

// Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd. 
var _m4_tmp = new _valueTypes.Mat4();

var _stageInfos = new _memop.RecyclePool(function () {
  return {
    stage: null,
    items: null
  };
}, 8);

var _float2_pool = new _memop.RecyclePool(function () {
  return new Float32Array(2);
}, 8);

var _float3_pool = new _memop.RecyclePool(function () {
  return new Float32Array(3);
}, 8);

var _float4_pool = new _memop.RecyclePool(function () {
  return new Float32Array(4);
}, 8);

var _float9_pool = new _memop.RecyclePool(function () {
  return new Float32Array(9);
}, 8);

var _float16_pool = new _memop.RecyclePool(function () {
  return new Float32Array(16);
}, 8);

var _float64_pool = new _memop.RecyclePool(function () {
  return new Float32Array(64);
}, 8);

var _int2_pool = new _memop.RecyclePool(function () {
  return new Int32Array(2);
}, 8);

var _int3_pool = new _memop.RecyclePool(function () {
  return new Int32Array(3);
}, 8);

var _int4_pool = new _memop.RecyclePool(function () {
  return new Int32Array(4);
}, 8);

var _int64_pool = new _memop.RecyclePool(function () {
  return new Int32Array(64);
}, 8);

var Base = /*#__PURE__*/function () {
  /**
   * @param {gfx.Device} device
   * @param {Object} opts
   * @param {gfx.Texture2D} opts.defaultTexture
   * @param {gfx.TextureCube} opts.defaultTextureCube
   */
  function Base(device, opts) {
    var _this$_type2defaultVa;

    this._device = device;
    this._programLib = new _programLib["default"](device);
    this._opts = opts;
    this._type2defaultValue = (_this$_type2defaultVa = {}, _this$_type2defaultVa[_enums["default"].PARAM_INT] = 0, _this$_type2defaultVa[_enums["default"].PARAM_INT2] = new _valueTypes.Vec2(0, 0), _this$_type2defaultVa[_enums["default"].PARAM_INT3] = new _valueTypes.Vec3(0, 0, 0), _this$_type2defaultVa[_enums["default"].PARAM_INT4] = new _valueTypes.Vec4(0, 0, 0, 0), _this$_type2defaultVa[_enums["default"].PARAM_FLOAT] = 0.0, _this$_type2defaultVa[_enums["default"].PARAM_FLOAT2] = new _valueTypes.Vec2(0, 0), _this$_type2defaultVa[_enums["default"].PARAM_FLOAT3] = new _valueTypes.Vec3(0, 0, 0), _this$_type2defaultVa[_enums["default"].PARAM_FLOAT4] = new _valueTypes.Vec4(0, 0, 0, 0), _this$_type2defaultVa[_enums["default"].PARAM_COLOR4] = new _valueTypes.Color(0, 0, 0, 1), _this$_type2defaultVa[_enums["default"].PARAM_MAT3] = new _valueTypes.Mat3(), _this$_type2defaultVa[_enums["default"].PARAM_MAT4] = new _valueTypes.Mat4(), _this$_type2defaultVa[_enums["default"].PARAM_TEXTURE_2D] = opts.defaultTexture, _this$_type2defaultVa[_enums["default"].PARAM_TEXTURE_CUBE] = opts.defaultTextureCube, _this$_type2defaultVa);
    this._stage2fn = {};
    this._usedTextureUnits = 0;
    this._viewPools = new _memop.RecyclePool(function () {
      return new _view["default"]();
    }, 8);
    this._drawItemsPools = new _memop.RecyclePool(function () {
      return {
        model: null,
        node: null,
        ia: null,
        effect: null,
        defines: null,
        uniforms: null
      };
    }, 100);
    this._stageItemsPools = new _memop.RecyclePool(function () {
      return new _memop.RecyclePool(function () {
        return {
          model: null,
          node: null,
          ia: null,
          effect: null,
          defines: null,
          passes: [],
          sortKey: -1,
          uniforms: null
        };
      }, 100);
    }, 16);
  }

  var _proto = Base.prototype;

  _proto._resetTextuerUnit = function _resetTextuerUnit() {
    this._usedTextureUnits = 0;
  };

  _proto._allocTextureUnit = function _allocTextureUnit() {
    var device = this._device;
    var unit = this._usedTextureUnits;

    if (unit >= device._caps.maxTextureUnits) {
      console.warn("Trying to use " + unit + " texture units while this GPU supports only " + device._caps.maxTextureUnits);
    }

    this._usedTextureUnits += 1;
    return unit;
  };

  _proto._registerStage = function _registerStage(name, fn) {
    this._stage2fn[name] = fn;
  };

  _proto.clear = function clear() {
    this._programLib.clear();

    this.reset();
  };

  _proto.reset = function reset() {
    this._viewPools.reset();

    this._stageItemsPools.reset();
  };

  _proto._requestView = function _requestView() {
    return this._viewPools.add();
  };

  _proto._render = function _render(view, scene) {
    var device = this._device; // setup framebuffer

    device.setFrameBuffer(view._framebuffer); // setup viewport

    device.setViewport(view._rect.x, view._rect.y, view._rect.w, view._rect.h); // setup clear

    var clearOpts = {};

    if (view._clearFlags & _enums["default"].CLEAR_COLOR) {
      clearOpts.color = _valueTypes.Vec4.toArray([], view._color);
    }

    if (view._clearFlags & _enums["default"].CLEAR_DEPTH) {
      clearOpts.depth = view._depth;
    }

    if (view._clearFlags & _enums["default"].CLEAR_STENCIL) {
      clearOpts.stencil = view._stencil;
    }

    device.clear(clearOpts); // get all draw items

    this._drawItemsPools.reset();

    for (var i = 0; i < scene._models.length; ++i) {
      var model = scene._models.data[i]; // filter model by view

      if ((model._cullingMask & view._cullingMask) === 0) {
        continue;
      }

      var drawItem = this._drawItemsPools.add();

      model.extractDrawItem(drawItem);
    } // dispatch draw items to different stage


    _stageInfos.reset();

    for (var _i = 0; _i < view._stages.length; ++_i) {
      var stage = view._stages[_i];

      var stageItems = this._stageItemsPools.add();

      stageItems.reset();

      for (var j = 0; j < this._drawItemsPools.length; ++j) {
        var _drawItem = this._drawItemsPools.data[j];
        var passes = _drawItem.effect.stagePasses[stage];
        if (!passes || passes.length === 0) continue;
        var stageItem = stageItems.add();
        stageItem.passes = passes;
        stageItem.model = _drawItem.model;
        stageItem.node = _drawItem.node;
        stageItem.ia = _drawItem.ia;
        stageItem.effect = _drawItem.effect;
        stageItem.defines = _drawItem.defines;
        stageItem.sortKey = -1;
        stageItem.uniforms = _drawItem.uniforms;
      }

      var stageInfo = _stageInfos.add();

      stageInfo.stage = stage;
      stageInfo.items = stageItems;
    } // render stages


    for (var _i2 = 0; _i2 < _stageInfos.length; ++_i2) {
      var info = _stageInfos.data[_i2];
      var fn = this._stage2fn[info.stage];
      fn(view, info.items);
    }
  };

  _proto._setProperty = function _setProperty(prop) {
    var device = this._device;
    var param = prop.value;

    if (param === undefined) {
      param = prop.val;
    }

    if (param === undefined) {
      param = this._type2defaultValue[prop.type];
    }

    if (param === undefined) {
      console.warn("Failed to set technique property " + prop.name + ", value not found.");
      return;
    }

    if (prop.type === _enums["default"].PARAM_TEXTURE_2D || prop.type === _enums["default"].PARAM_TEXTURE_CUBE) {
      if (Array.isArray(param)) {
        if (param.length > prop.count) {
          console.error("Failed to set property [" + prop.name + "] : The length of texture array [" + param.length + "] is bigger than [" + prop.count + "].");
          return;
        }

        var slots = _int64_pool.add();

        for (var index = 0; index < param.length; ++index) {
          slots[index] = this._allocTextureUnit();
        }

        device.setTextureArray(prop.name, param, slots);
      } else {
        device.setTexture(prop.name, param, this._allocTextureUnit());
      }
    } else {
      if (prop.directly) {
        device.setUniformDirectly(prop.name, param);
      } else {
        device.setUniform(prop.name, param);
      }
    }
  };

  _proto._draw = function _draw(item) {
    var device = this._device;
    var programLib = this._programLib;
    var node = item.node,
        ia = item.ia,
        passes = item.passes,
        effect = item.effect; // reset the pool
    // NOTE: we can use drawCounter optimize this
    // TODO: should be configurable

    _float2_pool.reset();

    _float3_pool.reset();

    _float4_pool.reset();

    _float9_pool.reset();

    _float16_pool.reset();

    _float64_pool.reset();

    _int2_pool.reset();

    _int3_pool.reset();

    _int4_pool.reset();

    _int64_pool.reset(); // set common uniforms
    // TODO: try commit this depends on effect
    // {


    node.getWorldMatrix(_m4_tmp);
    device.setUniform('cc_matWorld', _valueTypes.Mat4.toArray(_float16_pool.add(), _m4_tmp)); // let wq = node.getWorldRotation(cc.quat());

    _valueTypes.Mat4.invert(_m4_tmp, _m4_tmp);

    _valueTypes.Mat4.transpose(_m4_tmp, _m4_tmp);

    device.setUniform('cc_matWorldIT', _valueTypes.Mat4.toArray(_float16_pool.add(), _m4_tmp)); // }

    var defines = this._defines; // for each pass

    for (var i = 0; i < passes.length; ++i) {
      var pass = passes[i];
      var count = ia.count; // set vertex buffer

      if (ia._vertexBuffer) {
        device.setVertexBuffer(0, ia._vertexBuffer);
      } // set index buffer


      if (ia._indexBuffer) {
        device.setIndexBuffer(ia._indexBuffer);
      } // set primitive type


      device.setPrimitiveType(ia._primitiveType); // set program

      Object.setPrototypeOf(defines, pass._defines);
      var program = programLib.getProgram(pass._programName, defines, effect.name);
      device.setProgram(program);
      var uniforms = program._uniforms;
      var variants = pass._properties;

      for (var j = 0; j < uniforms.length; j++) {
        var prop = variants[uniforms[j].name];
        if (prop !== undefined) this._setProperty(prop);
      } // cull mode


      device.setCullMode(pass._cullMode); // blend

      if (pass._blend) {
        device.enableBlend();
        device.setBlendFuncSep(pass._blendSrc, pass._blendDst, pass._blendSrcAlpha, pass._blendDstAlpha);
        device.setBlendEqSep(pass._blendEq, pass._blendAlphaEq);
        device.setBlendColor32(pass._blendColor);
      } // depth test & write


      if (pass._depthTest) {
        device.enableDepthTest();
        device.setDepthFunc(pass._depthFunc);
      }

      if (pass._depthWrite) {
        device.enableDepthWrite();
      } // stencil


      device.setStencilTest(pass._stencilTest);

      if (pass._stencilTest === _gfx["default"].STENCIL_ENABLE) {
        // front
        device.setStencilFuncFront(pass._stencilFuncFront, pass._stencilRefFront, pass._stencilMaskFront);
        device.setStencilOpFront(pass._stencilFailOpFront, pass._stencilZFailOpFront, pass._stencilZPassOpFront, pass._stencilWriteMaskFront); // back

        device.setStencilFuncBack(pass._stencilFuncBack, pass._stencilRefBack, pass._stencilMaskBack);
        device.setStencilOpBack(pass._stencilFailOpBack, pass._stencilZFailOpBack, pass._stencilZPassOpBack, pass._stencilWriteMaskBack);
      } // draw pass


      device.draw(ia._start, count);

      this._resetTextuerUnit();
    }
  };

  return Base;
}();

exports["default"] = Base;
module.exports = exports["default"];
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_engine__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImVuZ2luZS1kZXYvY29jb3MyZC9yZW5kZXJlci9jb3JlL2Jhc2UtcmVuZGVyZXIuanMiXSwibmFtZXMiOlsiX200X3RtcCIsIk1hdDQiLCJfc3RhZ2VJbmZvcyIsIlJlY3ljbGVQb29sIiwic3RhZ2UiLCJpdGVtcyIsIl9mbG9hdDJfcG9vbCIsIkZsb2F0MzJBcnJheSIsIl9mbG9hdDNfcG9vbCIsIl9mbG9hdDRfcG9vbCIsIl9mbG9hdDlfcG9vbCIsIl9mbG9hdDE2X3Bvb2wiLCJfZmxvYXQ2NF9wb29sIiwiX2ludDJfcG9vbCIsIkludDMyQXJyYXkiLCJfaW50M19wb29sIiwiX2ludDRfcG9vbCIsIl9pbnQ2NF9wb29sIiwiQmFzZSIsImRldmljZSIsIm9wdHMiLCJfZGV2aWNlIiwiX3Byb2dyYW1MaWIiLCJQcm9ncmFtTGliIiwiX29wdHMiLCJfdHlwZTJkZWZhdWx0VmFsdWUiLCJlbnVtcyIsIlBBUkFNX0lOVCIsIlBBUkFNX0lOVDIiLCJWZWMyIiwiUEFSQU1fSU5UMyIsIlZlYzMiLCJQQVJBTV9JTlQ0IiwiVmVjNCIsIlBBUkFNX0ZMT0FUIiwiUEFSQU1fRkxPQVQyIiwiUEFSQU1fRkxPQVQzIiwiUEFSQU1fRkxPQVQ0IiwiUEFSQU1fQ09MT1I0IiwiQ29sb3IiLCJQQVJBTV9NQVQzIiwiTWF0MyIsIlBBUkFNX01BVDQiLCJQQVJBTV9URVhUVVJFXzJEIiwiZGVmYXVsdFRleHR1cmUiLCJQQVJBTV9URVhUVVJFX0NVQkUiLCJkZWZhdWx0VGV4dHVyZUN1YmUiLCJfc3RhZ2UyZm4iLCJfdXNlZFRleHR1cmVVbml0cyIsIl92aWV3UG9vbHMiLCJWaWV3IiwiX2RyYXdJdGVtc1Bvb2xzIiwibW9kZWwiLCJub2RlIiwiaWEiLCJlZmZlY3QiLCJkZWZpbmVzIiwidW5pZm9ybXMiLCJfc3RhZ2VJdGVtc1Bvb2xzIiwicGFzc2VzIiwic29ydEtleSIsIl9yZXNldFRleHR1ZXJVbml0IiwiX2FsbG9jVGV4dHVyZVVuaXQiLCJ1bml0IiwiX2NhcHMiLCJtYXhUZXh0dXJlVW5pdHMiLCJjb25zb2xlIiwid2FybiIsIl9yZWdpc3RlclN0YWdlIiwibmFtZSIsImZuIiwiY2xlYXIiLCJyZXNldCIsIl9yZXF1ZXN0VmlldyIsImFkZCIsIl9yZW5kZXIiLCJ2aWV3Iiwic2NlbmUiLCJzZXRGcmFtZUJ1ZmZlciIsIl9mcmFtZWJ1ZmZlciIsInNldFZpZXdwb3J0IiwiX3JlY3QiLCJ4IiwieSIsInciLCJoIiwiY2xlYXJPcHRzIiwiX2NsZWFyRmxhZ3MiLCJDTEVBUl9DT0xPUiIsImNvbG9yIiwidG9BcnJheSIsIl9jb2xvciIsIkNMRUFSX0RFUFRIIiwiZGVwdGgiLCJfZGVwdGgiLCJDTEVBUl9TVEVOQ0lMIiwic3RlbmNpbCIsIl9zdGVuY2lsIiwiaSIsIl9tb2RlbHMiLCJsZW5ndGgiLCJkYXRhIiwiX2N1bGxpbmdNYXNrIiwiZHJhd0l0ZW0iLCJleHRyYWN0RHJhd0l0ZW0iLCJfc3RhZ2VzIiwic3RhZ2VJdGVtcyIsImoiLCJzdGFnZVBhc3NlcyIsInN0YWdlSXRlbSIsInN0YWdlSW5mbyIsImluZm8iLCJfc2V0UHJvcGVydHkiLCJwcm9wIiwicGFyYW0iLCJ2YWx1ZSIsInVuZGVmaW5lZCIsInZhbCIsInR5cGUiLCJBcnJheSIsImlzQXJyYXkiLCJjb3VudCIsImVycm9yIiwic2xvdHMiLCJpbmRleCIsInNldFRleHR1cmVBcnJheSIsInNldFRleHR1cmUiLCJkaXJlY3RseSIsInNldFVuaWZvcm1EaXJlY3RseSIsInNldFVuaWZvcm0iLCJfZHJhdyIsIml0ZW0iLCJwcm9ncmFtTGliIiwiZ2V0V29ybGRNYXRyaXgiLCJpbnZlcnQiLCJ0cmFuc3Bvc2UiLCJfZGVmaW5lcyIsInBhc3MiLCJfdmVydGV4QnVmZmVyIiwic2V0VmVydGV4QnVmZmVyIiwiX2luZGV4QnVmZmVyIiwic2V0SW5kZXhCdWZmZXIiLCJzZXRQcmltaXRpdmVUeXBlIiwiX3ByaW1pdGl2ZVR5cGUiLCJPYmplY3QiLCJzZXRQcm90b3R5cGVPZiIsInByb2dyYW0iLCJnZXRQcm9ncmFtIiwiX3Byb2dyYW1OYW1lIiwic2V0UHJvZ3JhbSIsIl91bmlmb3JtcyIsInZhcmlhbnRzIiwiX3Byb3BlcnRpZXMiLCJzZXRDdWxsTW9kZSIsIl9jdWxsTW9kZSIsIl9ibGVuZCIsImVuYWJsZUJsZW5kIiwic2V0QmxlbmRGdW5jU2VwIiwiX2JsZW5kU3JjIiwiX2JsZW5kRHN0IiwiX2JsZW5kU3JjQWxwaGEiLCJfYmxlbmREc3RBbHBoYSIsInNldEJsZW5kRXFTZXAiLCJfYmxlbmRFcSIsIl9ibGVuZEFscGhhRXEiLCJzZXRCbGVuZENvbG9yMzIiLCJfYmxlbmRDb2xvciIsIl9kZXB0aFRlc3QiLCJlbmFibGVEZXB0aFRlc3QiLCJzZXREZXB0aEZ1bmMiLCJfZGVwdGhGdW5jIiwiX2RlcHRoV3JpdGUiLCJlbmFibGVEZXB0aFdyaXRlIiwic2V0U3RlbmNpbFRlc3QiLCJfc3RlbmNpbFRlc3QiLCJnZngiLCJTVEVOQ0lMX0VOQUJMRSIsInNldFN0ZW5jaWxGdW5jRnJvbnQiLCJfc3RlbmNpbEZ1bmNGcm9udCIsIl9zdGVuY2lsUmVmRnJvbnQiLCJfc3RlbmNpbE1hc2tGcm9udCIsInNldFN0ZW5jaWxPcEZyb250IiwiX3N0ZW5jaWxGYWlsT3BGcm9udCIsIl9zdGVuY2lsWkZhaWxPcEZyb250IiwiX3N0ZW5jaWxaUGFzc09wRnJvbnQiLCJfc3RlbmNpbFdyaXRlTWFza0Zyb250Iiwic2V0U3RlbmNpbEZ1bmNCYWNrIiwiX3N0ZW5jaWxGdW5jQmFjayIsIl9zdGVuY2lsUmVmQmFjayIsIl9zdGVuY2lsTWFza0JhY2siLCJzZXRTdGVuY2lsT3BCYWNrIiwiX3N0ZW5jaWxGYWlsT3BCYWNrIiwiX3N0ZW5jaWxaRmFpbE9wQmFjayIsIl9zdGVuY2lsWlBhc3NPcEJhY2siLCJfc3RlbmNpbFdyaXRlTWFza0JhY2siLCJkcmF3IiwiX3N0YXJ0Il0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7O0FBRUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7QUFQQTtBQVNBLElBQUlBLE9BQU8sR0FBRyxJQUFJ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LElBQUksQ0FBQ2dELHNCQUpQLEVBUDRDLENBYzVDOztBQUNBdEssUUFBQUEsTUFBTSxDQUFDdUssa0JBQVAsQ0FDRWpELElBQUksQ0FBQ2tELGdCQURQLEVBRUVsRCxJQUFJLENBQUNtRCxlQUZQLEVBR0VuRCxJQUFJLENBQUNvRCxnQkFIUDtBQUtBMUssUUFBQUEsTUFBTSxDQUFDMkssZ0JBQVAsQ0FDRXJELElBQUksQ0FBQ3NELGtCQURQLEVBRUV0RCxJQUFJLENBQUN1RCxtQkFGUCxFQUdFdkQsSUFBSSxDQUFDd0QsbUJBSFAsRUFJRXhELElBQUksQ0FBQ3lELHFCQUpQO0FBTUQsT0F4RnFDLENBMEZ0Qzs7O0FBQ0EvSyxNQUFBQSxNQUFNLENBQUNnTCxJQUFQLENBQVk3SSxFQUFFLENBQUM4SSxNQUFmLEVBQXVCM0UsS0FBdkI7O0FBRUEsV0FBSzVELGlCQUFMO0FBQ0Q7QUFDRiIsInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAoYykgMjAxNy0yMDE4IFhpYW1lbiBZYWppIFNvZnR3YXJlIENvLiwgTHRkLiBcblxuaW1wb3J0IHsgUmVjeWNsZVBvb2wgfSBmcm9tICcuLi9tZW1vcCc7XG5pbXBvcnQgZW51bXMgZnJvbSAnLi4vZW51bXMnO1xuaW1wb3J0IHsgVmVjMiwgVmVjNCwgTWF0MywgTWF0NCwgQ29sb3IsIFZlYzMgfSBmcm9tICcuLi8uLi9jb3JlL3ZhbHVlLXR5cGVzJztcbmltcG9ydCBQcm9ncmFtTGliIGZyb20gJy4vcHJvZ3JhbS1saWInO1xuaW1wb3J0IFZpZXcgZnJvbSAnLi92aWV3JztcbmltcG9ydCBnZnggZnJvbSAnLi4vZ2Z4JztcblxubGV0IF9tNF90bXAgPSBuZXcgTWF0NCgpO1xuXG5sZXQgX3N0YWdlSW5mb3MgPSBuZXcgUmVjeWNsZVBvb2woKCkgPT4ge1xuICByZXR1cm4ge1xuICAgIHN0YWdlOiBudWxsLFxuICAgIGl0ZW1zOiBudWxsLFxuICB9O1xufSwgOCk7XG5cbmxldCBfZmxvYXQyX3Bvb2wgPSBuZXcgUmVjeWNsZVBvb2woKCkgPT4ge1xuICByZXR1cm4gbmV3IEZsb2F0MzJBcnJheSgyKTtcbn0sIDgpO1xuXG5sZXQgX2Zsb2F0M19wb29sID0gbmV3IFJlY3ljbGVQb29sKCgpID0+IHtcbiAgcmV0dXJuIG5ldyBGbG9hdDMyQXJyYXkoMyk7XG59LCA4KTtcblxubGV0IF9mbG9hdDRfcG9vbCA9IG5ldyBSZWN5Y2xlUG9vbCgoKSA9PiB7XG4gIHJldHVybiBuZXcgRmxvYXQzMkFycmF5KDQpO1xufSwgOCk7XG5cbmxldCBfZmxvYXQ5X3Bvb2wgPSBuZXcgUmVjeWNsZVBvb2woKCkgPT4ge1xuICByZXR1cm4gbmV3IEZsb2F0MzJBcnJheSg5KTtcbn0sIDgpO1xuXG5sZXQgX2Zsb2F0MTZfcG9vbCA9IG5ldyBSZWN5Y2xlUG9vbCgoKSA9PiB7XG4gIHJldHVybiBuZXcgRmxvYXQzMkFycmF5KDE2KTtcbn0sIDgpO1xuXG5sZXQgX2Zsb2F0NjRfcG9vbCA9IG5ldyBSZWN5Y2xlUG9vbCgoKSA9PiB7XG4gIHJldHVybiBuZXcgRmxvYXQzMkFycmF5KDY0KTtcbn0sIDgpO1xuXG5sZXQgX2ludDJfcG9vbCA9IG5ldyBSZWN5Y2xlUG9vbCgoKSA9PiB7XG4gIHJldHVybiBuZXcgSW50MzJBcnJheSgyKTtcbn0sIDgpO1xuXG5sZXQgX2ludDNfcG9vbCA9IG5ldyBSZWN5Y2xlUG9vbCgoKSA9PiB7XG4gIHJldHVybiBuZXcgSW50MzJBcnJheSgzKTtcbn0sIDgpO1xuXG5sZXQgX2ludDRfcG9vbCA9IG5ldyBSZWN5Y2xlUG9vbCgoKSA9PiB7XG4gIHJldHVybiBuZXcgSW50MzJBcnJheSg0KTtcbn0sIDgpO1xuXG5sZXQgX2ludDY0X3Bvb2wgPSBuZXcgUmVjeWNsZVBvb2woKCkgPT4ge1xuICByZXR1cm4gbmV3IEludDMyQXJyYXkoNjQpO1xufSwgOCk7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEJhc2Uge1xuICAvKipcbiAgICogQHBhcmFtIHtnZnguRGV2aWNlfSBkZXZpY2VcbiAgICogQHBhcmFtIHtPYmplY3R9IG9wdHNcbiAgICogQHBhcmFtIHtnZnguVGV4dHVyZTJEfSBvcHRzLmRlZmF1bHRUZXh0dXJlXG4gICAqIEBwYXJhbSB7Z2Z4LlRleHR1cmVDdWJlfSBvcHRzLmRlZmF1bHRUZXh0dXJlQ3ViZVxuICAgKi9cbiAgY29uc3RydWN0b3IgKGRldmljZSwgb3B0cykge1xuICAgIHRoaXMuX2RldmljZSA9IGRldmljZTtcbiAgICB0aGlzLl9wcm9ncmFtTGliID0gbmV3IFByb2dyYW1MaWIoZGV2aWNlKTtcbiAgICB0aGlzLl9vcHRzID0gb3B0cztcbiAgICB0aGlzLl90eXBlMmRlZmF1bHRWYWx1ZSA9IHtcbiAgICAgIFtlbnVtcy5QQVJBTV9JTlRdOiAwLFxuICAgICAgW2VudW1zLlBBUkFNX0lOVDJdOiBuZXcgVmVjMigwLCAwKSxcbiAgICAgIFtlbnVtcy5QQVJBTV9JTlQzXTogbmV3IFZlYzMoMCwgMCwgMCksXG4gICAgICBbZW51bXMuUEFSQU1fSU5UNF06IG5ldyBWZWM0KDAsIDAsIDAsIDApLFxuICAgICAgW2VudW1zLlBBUkFNX0ZMT0FUXTogMC4wLFxuICAgICAgW2VudW1zLlBBUkFNX0ZMT0FUMl06IG5ldyBWZWMyKDAsIDApLFxuICAgICAgW2VudW1zLlBBUkFNX0ZMT0FUM106IG5ldyBWZWMzKDAsIDAsIDApLFxuICAgICAgW2VudW1zLlBBUkFNX0ZMT0FUNF06IG5ldyBWZWM0KDAsIDAsIDAsIDApLFxuICAgICAgW2VudW1zLlBBUkFNX0NPTE9SNF06IG5ldyBDb2xvcigwLCAwLCAwLCAxKSxcbiAgICAgIFtlbnVtcy5QQVJBTV9NQVQzXTogbmV3IE1hdDMoKSxcbiAgICAgIFtlbnVtcy5QQVJBTV9NQVQ0XTogbmV3IE1hdDQoKSxcbiAgICAgIFtlbnVtcy5QQVJBTV9URVhUVVJFXzJEXTogb3B0cy5kZWZhdWx0VGV4dHVyZSxcbiAgICAgIFtlbnVtcy5QQVJBTV9URVhUVVJFX0NVQkVdOiBvcHRzLmRlZmF1bHRUZXh0dXJlQ3ViZSxcbiAgICB9O1xuICAgIHRoaXMuX3N0YWdlMmZuID0ge307XG4gICAgdGhpcy5fdXNlZFRleHR1cmVVbml0cyA9IDA7XG5cbiAgICB0aGlzLl92aWV3UG9vbHMgPSBuZXcgUmVjeWNsZVBvb2woKCkgPT4ge1xuICAgICAgcmV0dXJuIG5ldyBWaWV3KCk7XG4gICAgfSwgOCk7XG5cbiAgICB0aGlzLl9kcmF3SXRlbXNQb29scyA9IG5ldyBSZWN5Y2xlUG9vbCgoKSA9PiB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBtb2RlbDogbnVsbCxcbiAgICAgICAgbm9kZTogbnVsbCxcbiAgICAgICAgaWE6IG51bGwsXG4gICAgICAgIGVmZmVjdDogbnVsbCxcbiAgICAgICAgZGVmaW5lczogbnVsbCxcbiAgICAgICAgdW5pZm9ybXM6IG51bGxcbiAgICAgIH07XG4gICAgfSwgMTAwKTtcblxuICAgIHRoaXMuX3N0YWdlSXRlbXNQb29scyA9IG5ldyBSZWN5Y2xlUG9vbCgoKSA9PiB7XG4gICAgICByZXR1cm4gbmV3IFJlY3ljbGVQb29sKCgpID0+IHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBtb2RlbDogbnVsbCxcbiAgICAgICAgICBub2RlOiBudWxsLFxuICAgICAgICAgIGlhOiBudWxsLFxuICAgICAgICAgIGVmZmVjdDogbnVsbCxcbiAgICAgICAgICBkZWZpbmVzOiBudWxsLFxuICAgICAgICAgIHBhc3NlczogW10sXG4gICAgICAgICAgc29ydEtleTogLTEsXG4gICAgICAgICAgdW5pZm9ybXM6IG51bGxcbiAgICAgICAgfTtcbiAgICAgIH0sIDEwMCk7XG4gICAgfSwgMTYpO1xuICB9XG5cbiAgX3Jlc2V0VGV4dHVlclVuaXQgKCkge1xuICAgIHRoaXMuX3VzZWRUZXh0dXJlVW5pdHMgPSAwO1xuICB9XG5cbiAgX2FsbG9jVGV4dHVyZVVuaXQgKCkge1xuICAgIGNvbnN0IGRldmljZSA9IHRoaXMuX2RldmljZTtcblxuICAgIGxldCB1bml0ID0gdGhpcy5fdXNlZFRleHR1cmVVbml0cztcbiAgICBpZiAodW5pdCA+PSBkZXZpY2UuX2NhcHMubWF4VGV4dHVyZVVuaXRzKSB7XG4gICAgICBjb25zb2xlLndhcm4oYFRyeWluZyB0byB1c2UgJHt1bml0fSB0ZXh0dXJlIHVuaXRzIHdoaWxlIHRoaXMgR1BVIHN1cHBvcnRzIG9ubHkgJHtkZXZpY2UuX2NhcHMubWF4VGV4dHVyZVVuaXRzfWApO1xuICAgIH1cblxuICAgIHRoaXMuX3VzZWRUZXh0dXJlVW5pdHMgKz0gMTtcbiAgICByZXR1cm4gdW5pdDtcbiAgfVxuXG4gIF9yZWdpc3RlclN0YWdlIChuYW1lLCBmbikge1xuICAgIHRoaXMuX3N0YWdlMmZuW25hbWVdID0gZm47XG4gIH1cblxuICBjbGVhciAoKSB7XG4gICAgdGhpcy5fcHJvZ3JhbUxpYi5jbGVhcigpO1xuICAgIHRoaXMucmVzZXQoKTtcbiAgfVxuXG4gIHJlc2V0ICgpIHtcbiAgICB0aGlzLl92aWV3UG9vbHMucmVzZXQoKTtcbiAgICB0aGlzLl9zdGFnZUl0ZW1zUG9vbHMucmVzZXQoKTtcbiAgfVxuXG4gIF9yZXF1ZXN0VmlldyAoKSB7XG4gICAgcmV0dXJuIHRoaXMuX3ZpZXdQb29scy5hZGQoKTtcbiAgfVxuXG4gIF9yZW5kZXIgKHZpZXcsIHNjZW5lKSB7XG4gICAgY29uc3QgZGV2aWNlID0gdGhpcy5fZGV2aWNlO1xuXG4gICAgLy8gc2V0dXAgZnJhbWVidWZmZXJcbiAgICBkZXZpY2Uuc2V0RnJhbWVCdWZmZXIodmlldy5fZnJhbWVidWZmZXIpO1xuXG4gICAgLy8gc2V0dXAgdmlld3BvcnRcbiAgICBkZXZpY2Uuc2V0Vmlld3BvcnQoXG4gICAgICB2aWV3Ll9yZWN0LngsXG4gICAgICB2aWV3Ll9yZWN0LnksXG4gICAgICB2aWV3Ll9yZWN0LncsXG4gICAgICB2aWV3Ll9yZWN0LmhcbiAgICApO1xuXG4gICAgLy8gc2V0dXAgY2xlYXJcbiAgICBsZXQgY2xlYXJPcHRzID0ge307XG4gICAgaWYgKHZpZXcuX2NsZWFyRmxhZ3MgJiBlbnVtcy5DTEVBUl9DT0xPUikge1xuICAgICAgY2xlYXJPcHRzLmNvbG9yID0gVmVjNC50b0FycmF5KFtdLCB2aWV3Ll9jb2xvcik7XG4gICAgfVxuICAgIGlmICh2aWV3Ll9jbGVhckZsYWdzICYgZW51bXMuQ0xFQVJfREVQVEgpIHtcbiAgICAgIGNsZWFyT3B0cy5kZXB0aCA9IHZpZXcuX2RlcHRoO1xuICAgIH1cbiAgICBpZiAodmlldy5fY2xlYXJGbGFncyAmIGVudW1zLkNMRUFSX1NURU5DSUwpIHtcbiAgICAgIGNsZWFyT3B0cy5zdGVuY2lsID0gdmlldy5fc3RlbmNpbDtcbiAgICB9XG4gICAgZGV2aWNlLmNsZWFyKGNsZWFyT3B0cyk7XG5cbiAgICAvLyBnZXQgYWxsIGRyYXcgaXRlbXNcbiAgICB0aGlzLl9kcmF3SXRlbXNQb29scy5yZXNldCgpO1xuXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzY2VuZS5fbW9kZWxzLmxlbmd0aDsgKytpKSB7XG4gICAgICBsZXQgbW9kZWwgPSBzY2VuZS5fbW9kZWxzLmRhdGFbaV07XG5cbiAgICAgIC8vIGZpbHRlciBtb2RlbCBieSB2aWV3XG4gICAgICBpZiAoKG1vZGVsLl9jdWxsaW5nTWFzayAmIHZpZXcuX2N1bGxpbmdNYXNrKSA9PT0gMCkge1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cblxuICAgICAgbGV0IGRyYXdJdGVtID0gdGhpcy5fZHJhd0l0ZW1zUG9vbHMuYWRkKCk7XG4gICAgICBtb2RlbC5leHRyYWN0RHJhd0l0ZW0oZHJhd0l0ZW0pO1xuICAgIH1cblxuICAgIC8vIGRpc3BhdGNoIGRyYXcgaXRlbXMgdG8gZGlmZmVyZW50IHN0YWdlXG4gICAgX3N0YWdlSW5mb3MucmVzZXQoKTtcblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdmlldy5fc3RhZ2VzLmxlbmd0aDsgKytpKSB7XG4gICAgICBsZXQgc3RhZ2UgPSB2aWV3Ll9zdGFnZXNbaV07XG4gICAgICBsZXQgc3RhZ2VJdGVtcyA9IHRoaXMuX3N0YWdlSXRlbXNQb29scy5hZGQoKTtcbiAgICAgIHN0YWdlSXRlbXMucmVzZXQoKTtcblxuICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCB0aGlzLl9kcmF3SXRlbXNQb29scy5sZW5ndGg7ICsraikge1xuICAgICAgICBsZXQgZHJhd0l0ZW0gPSB0aGlzLl9kcmF3SXRlbXNQb29scy5kYXRhW2pdO1xuICAgICAgICBsZXQgcGFzc2VzID0gZHJhd0l0ZW0uZWZmZWN0LnN0YWdlUGFzc2VzW3N0YWdlXTtcbiAgICAgICAgaWYgKCFwYXNzZXMgfHwgcGFzc2VzLmxlbmd0aCA9PT0gMCkgY29udGludWU7XG5cbiAgICAgICAgbGV0IHN0YWdlSXRlbSA9IHN0YWdlSXRlbXMuYWRkKCk7XG4gICAgICAgIHN0YWdlSXRlbS5wYXNzZXMgPSBwYXNzZXM7XG4gICAgICAgIHN0YWdlSXRlbS5tb2RlbCA9IGRyYXdJdGVtLm1vZGVsO1xuICAgICAgICBzdGFnZUl0ZW0ubm9kZSA9IGRyYXdJdGVtLm5vZGU7XG4gICAgICAgIHN0YWdlSXRlbS5pYSA9IGRyYXdJdGVtLmlhO1xuICAgICAgICBzdGFnZUl0ZW0uZWZmZWN0ID0gZHJhd0l0ZW0uZWZmZWN0O1xuICAgICAgICBzdGFnZUl0ZW0uZGVmaW5lcyA9IGRyYXdJdGVtLmRlZmluZXM7XG4gICAgICAgIHN0YWdlSXRlbS5zb3J0S2V5ID0gLTE7XG4gICAgICAgIHN0YWdlSXRlbS51bmlmb3JtcyA9IGRyYXdJdGVtLnVuaWZvcm1zO1xuICAgICAgfVxuXG4gICAgICBsZXQgc3RhZ2VJbmZvID0gX3N0YWdlSW5mb3MuYWRkKCk7XG4gICAgICBzdGFnZUluZm8uc3RhZ2UgPSBzdGFnZTtcbiAgICAgIHN0YWdlSW5mby5pdGVtcyA9IHN0YWdlSXRlbXM7XG4gICAgfVxuXG4gICAgLy8gcmVuZGVyIHN0YWdlc1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgX3N0YWdlSW5mb3MubGVuZ3RoOyArK2kpIHtcbiAgICAgIGxldCBpbmZvID0gX3N0YWdlSW5mb3MuZGF0YVtpXTtcbiAgICAgIGxldCBmbiA9IHRoaXMuX3N0YWdlMmZuW2luZm8uc3RhZ2VdO1xuICAgICAgZm4odmlldywgaW5mby5pdGVtcyk7XG4gICAgfVxuICB9XG5cbiAgX3NldFByb3BlcnR5IChwcm9wKSB7XG4gICAgY29uc3QgZGV2aWNlID0gdGhpcy5fZGV2aWNlO1xuICAgIGxldCBwYXJhbSA9IHByb3AudmFsdWU7XG5cbiAgICBpZiAocGFyYW0gPT09IHVuZGVmaW5lZCkge1xuICAgICAgcGFyYW0gPSBwcm9wLnZhbDtcbiAgICB9XG5cbiAgICBpZiAocGFyYW0gPT09IHVuZGVmaW5lZCkge1xuICAgICAgcGFyYW0gPSB0aGlzLl90eXBlMmRlZmF1bHRWYWx1ZVtwcm9wLnR5cGVdO1xuICAgIH1cblxuICAgIGlmIChwYXJhbSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICBjb25zb2xlLndhcm4oYEZhaWxlZCB0byBzZXQgdGVjaG5pcXVlIHByb3BlcnR5ICR7cHJvcC5uYW1lfSwgdmFsdWUgbm90IGZvdW5kLmApO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmIChcbiAgICAgIHByb3AudHlwZSA9PT0gZW51bXMuUEFSQU1fVEVYVFVSRV8yRCB8fFxuICAgICAgcHJvcC50eXBlID09PSBlbnVtcy5QQVJBTV9URVhUVVJFX0NVQkVcbiAgICApIHtcbiAgICAgIGlmIChBcnJheS5pc0FycmF5KHBhcmFtKSkge1xuICAgICAgICBpZiAocGFyYW0ubGVuZ3RoID4gcHJvcC5jb3VudCkge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYEZhaWxlZCB0byBzZXQgcHJvcGVydHkgWyR7cHJvcC5uYW1lfV0gOiBUaGUgbGVuZ3RoIG9mIHRleHR1cmUgYXJyYXkgWyR7cGFyYW0ubGVuZ3RofV0gaXMgYmlnZ2VyIHRoYW4gWyR7cHJvcC5jb3VudH1dLmApO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBsZXQgc2xvdHMgPSBfaW50NjRfcG9vbC5hZGQoKTtcbiAgICAgICAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IHBhcmFtLmxlbmd0aDsgKytpbmRleCkge1xuICAgICAgICAgIHNsb3RzW2luZGV4XSA9IHRoaXMuX2FsbG9jVGV4dHVyZVVuaXQoKTtcbiAgICAgICAgfVxuICAgICAgICBkZXZpY2Uuc2V0VGV4dHVyZUFycmF5KHByb3AubmFtZSwgcGFyYW0sIHNsb3RzKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGRldmljZS5zZXRUZXh0dXJlKHByb3AubmFtZSwgcGFyYW0sIHRoaXMuX2FsbG9jVGV4dHVyZVVuaXQoKSk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmIChwcm9wLmRpcmVjdGx5KSB7XG4gICAgICAgIGRldmljZS5zZXRVbmlmb3JtRGlyZWN0bHkocHJvcC5uYW1lLCBwYXJhbSk7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgZGV2aWNlLnNldFVuaWZvcm0ocHJvcC5uYW1lLCBwYXJhbSk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgX2RyYXcgKGl0ZW0pIHtcbiAgICBjb25zdCBkZXZpY2UgPSB0aGlzLl9kZXZpY2U7XG4gICAgY29uc3QgcHJvZ3JhbUxpYiA9IHRoaXMuX3Byb2dyYW1MaWI7XG4gICAgY29uc3QgeyBub2RlLCBpYSwgcGFzc2VzLCBlZmZlY3QgfSA9IGl0ZW07XG5cbiAgICAvLyByZXNldCB0aGUgcG9vbFxuICAgIC8vIE5PVEU6IHdlIGNhbiB1c2UgZHJhd0NvdW50ZXIgb3B0aW1pemUgdGhpc1xuICAgIC8vIFRPRE86IHNob3VsZCBiZSBjb25maWd1cmFibGVcbiAgICBfZmxvYXQyX3Bvb2wucmVzZXQoKTtcbiAgICBfZmxvYXQzX3Bvb2wucmVzZXQoKTtcbiAgICBfZmxvYXQ0X3Bvb2wucmVzZXQoKTtcbiAgICBfZmxvYXQ5X3Bvb2wucmVzZXQoKTtcbiAgICBfZmxvYXQxNl9wb29sLnJlc2V0KCk7XG4gICAgX2Zsb2F0NjRfcG9vbC5yZXNldCgpO1xuICAgIF9pbnQyX3Bvb2wucmVzZXQoKTtcbiAgICBfaW50M19wb29sLnJlc2V0KCk7XG4gICAgX2ludDRfcG9vbC5yZXNldCgpO1xuICAgIF9pbnQ2NF9wb29sLnJlc2V0KCk7XG5cbiAgICAvLyBzZXQgY29tbW9uIHVuaWZvcm1zXG4gICAgLy8gVE9ETzogdHJ5IGNvbW1pdCB0aGlzIGRlcGVuZHMgb24gZWZmZWN0XG4gICAgLy8ge1xuICAgIG5vZGUuZ2V0V29ybGRNYXRyaXgoX200X3RtcCk7XG4gICAgZGV2aWNlLnNldFVuaWZvcm0oJ2NjX21hdFdvcmxkJywgTWF0NC50b0FycmF5KF9mbG9hdDE2X3Bvb2wuYWRkKCksIF9tNF90bXApKTtcblxuICAgIC8vIGxldCB3cSA9IG5vZGUuZ2V0V29ybGRSb3RhdGlvbihjYy5xdWF0KCkpO1xuICAgIE1hdDQuaW52ZXJ0KF9tNF90bXAsIF9tNF90bXApO1xuICAgIE1hdDQudHJhbnNwb3NlKF9tNF90bXAsIF9tNF90bXApO1xuICAgIGRldmljZS5zZXRVbmlmb3JtKCdjY19tYXRXb3JsZElUJywgTWF0NC50b0FycmF5KF9mbG9hdDE2X3Bvb2wuYWRkKCksIF9tNF90bXApKTtcbiAgICAvLyB9XG5cbiAgICBsZXQgZGVmaW5lcyA9IHRoaXMuX2RlZmluZXM7XG5cbiAgICAvLyBmb3IgZWFjaCBwYXNzXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwYXNzZXMubGVuZ3RoOyArK2kpIHtcbiAgICAgIGxldCBwYXNzID0gcGFzc2VzW2ldO1xuICAgICAgbGV0IGNvdW50ID0gaWEuY291bnQ7XG5cbiAgICAgIC8vIHNldCB2ZXJ0ZXggYnVmZmVyXG4gICAgICBpZiAoaWEuX3ZlcnRleEJ1ZmZlcikge1xuICAgICAgICBkZXZpY2Uuc2V0VmVydGV4QnVmZmVyKDAsIGlhLl92ZXJ0ZXhCdWZmZXIpO1xuICAgICAgfVxuXG4gICAgICAvLyBzZXQgaW5kZXggYnVmZmVyXG4gICAgICBpZiAoaWEuX2luZGV4QnVmZmVyKSB7XG4gICAgICAgIGRldmljZS5zZXRJbmRleEJ1ZmZlcihpYS5faW5kZXhCdWZmZXIpO1xuICAgICAgfVxuXG4gICAgICAvLyBzZXQgcHJpbWl0aXZlIHR5cGVcbiAgICAgIGRldmljZS5zZXRQcmltaXRpdmVUeXBlKGlhLl9wcmltaXRpdmVUeXBlKTtcblxuICAgICAgLy8gc2V0IHByb2dyYW1cbiAgICAgIE9iamVjdC5zZXRQcm90b3R5cGVPZihkZWZpbmVzLCBwYXNzLl9kZWZpbmVzKTtcblxuICAgICAgbGV0IHByb2dyYW0gPSBwcm9ncmFtTGliLmdldFByb2dyYW0ocGFzcy5fcHJvZ3JhbU5hbWUsIGRlZmluZXMsIGVmZmVjdC5uYW1lKTtcbiAgICAgIGRldmljZS5zZXRQcm9ncmFtKHByb2dyYW0pO1xuXG4gICAgICBsZXQgdW5pZm9ybXMgPSBwcm9ncmFtLl91bmlmb3JtcztcbiAgICAgIGxldCB2YXJpYW50cyA9IHBhc3MuX3Byb3BlcnRpZXM7XG4gICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHVuaWZvcm1zLmxlbmd0aDsgaisrKSB7XG4gICAgICAgIGxldCBwcm9wID0gdmFyaWFudHNbdW5pZm9ybXNbal0ubmFtZV07XG4gICAgICAgIGlmIChwcm9wICE9PSB1bmRlZmluZWQpXG4gICAgICAgIHRoaXMuX3NldFByb3BlcnR5KHByb3ApO1xuICAgICAgfVxuXG5cbiAgICAgIC8vIGN1bGwgbW9kZVxuICAgICAgZGV2aWNlLnNldEN1bGxNb2RlKHBhc3MuX2N1bGxNb2RlKTtcblxuICAgICAgLy8gYmxlbmRcbiAgICAgIGlmIChwYXNzLl9ibGVuZCkge1xuICAgICAgICBkZXZpY2UuZW5hYmxlQmxlbmQoKTtcbiAgICAgICAgZGV2aWNlLnNldEJsZW5kRnVuY1NlcChcbiAgICAgICAgICBwYXNzLl9ibGVuZFNyYyxcbiAgICAgICAgICBwYXNzLl9ibGVuZERzdCxcbiAgICAgICAgICBwYXNzLl9ibGVuZFNyY0FscGhhLFxuICAgICAgICAgIHBhc3MuX2JsZW5kRHN0QWxwaGFcbiAgICAgICAgKTtcbiAgICAgICAgZGV2aWNlLnNldEJsZW5kRXFTZXAoXG4gICAgICAgICAgcGFzcy5fYmxlbmRFcSxcbiAgICAgICAgICBwYXNzLl9ibGVuZEFscGhhRXFcbiAgICAgICAgKTtcbiAgICAgICAgZGV2aWNlLnNldEJsZW5kQ29sb3IzMihwYXNzLl9ibGVuZENvbG9yKTtcbiAgICAgIH1cblxuICAgICAgLy8gZGVwdGggdGVzdCAmIHdyaXRlXG4gICAgICBpZiAocGFzcy5fZGVwdGhUZXN0KSB7XG4gICAgICAgIGRldmljZS5lbmFibGVEZXB0aFRlc3QoKTtcbiAgICAgICAgZGV2aWNlLnNldERlcHRoRnVuYyhwYXNzLl9kZXB0aEZ1bmMpO1xuICAgICAgfVxuICAgICAgaWYgKHBhc3MuX2RlcHRoV3JpdGUpIHtcbiAgICAgICAgZGV2aWNlLmVuYWJsZURlcHRoV3JpdGUoKTtcbiAgICAgIH1cblxuICAgICAgLy8gc3RlbmNpbFxuICAgICAgZGV2aWNlLnNldFN0ZW5jaWxUZXN0KHBhc3MuX3N0ZW5jaWxUZXN0KTtcbiAgICAgIGlmIChwYXNzLl9zdGVuY2lsVGVzdCA9PT0gZ2Z4LlNURU5DSUxfRU5BQkxFKSB7XG4gICAgICAgIC8vIGZyb250XG4gICAgICAgIGRldmljZS5zZXRTdGVuY2lsRnVuY0Zyb250KFxuICAgICAgICAgIHBhc3MuX3N0ZW5jaWxGdW5jRnJvbnQsXG4gICAgICAgICAgcGFzcy5fc3RlbmNpbFJlZkZyb250LFxuICAgICAgICAgIHBhc3MuX3N0ZW5jaWxNYXNrRnJvbnRcbiAgICAgICAgKTtcbiAgICAgICAgZGV2aWNlLnNldFN0ZW5jaWxPcEZyb250KFxuICAgICAgICAgIHBhc3MuX3N0ZW5jaWxGYWlsT3BGcm9udCxcbiAgICAgICAgICBwYXNzLl9zdGVuY2lsWkZhaWxPcEZyb250LFxuICAgICAgICAgIHBhc3MuX3N0ZW5jaWxaUGFzc09wRnJvbnQsXG4gICAgICAgICAgcGFzcy5fc3RlbmNpbFdyaXRlTWFza0Zyb250XG4gICAgICAgICk7XG5cbiAgICAgICAgLy8gYmFja1xuICAgICAgICBkZXZpY2Uuc2V0U3RlbmNpbEZ1bmNCYWNrKFxuICAgICAgICAgIHBhc3MuX3N0ZW5jaWxGdW5jQmFjayxcbiAgICAgICAgICBwYXNzLl9zdGVuY2lsUmVmQmFjayxcbiAgICAgICAgICBwYXNzLl9zdGVuY2lsTWFza0JhY2tcbiAgICAgICAgKTtcbiAgICAgICAgZGV2aWNlLnNldFN0ZW5jaWxPcEJhY2soXG4gICAgICAgICAgcGFzcy5fc3RlbmNpbEZhaWxPcEJhY2ssXG4gICAgICAgICAgcGFzcy5fc3RlbmNpbFpGYWlsT3BCYWNrLFxuICAgICAgICAgIHBhc3MuX3N0ZW5jaWxaUGFzc09wQmFjayxcbiAgICAgICAgICBwYXNzLl9zdGVuY2lsV3JpdGVNYXNrQmFja1xuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICAvLyBkcmF3IHBhc3NcbiAgICAgIGRldmljZS5kcmF3KGlhLl9zdGFydCwgY291bnQpO1xuXG4gICAgICB0aGlzLl9yZXNldFRleHR1ZXJVbml0KCk7XG4gICAgfVxuICB9XG59Il0sInNvdXJjZVJvb3QiOiIvIn0=