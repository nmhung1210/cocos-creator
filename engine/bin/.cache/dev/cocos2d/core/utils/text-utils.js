
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'engine-dev/cocos2d/core/utils/text-utils.js';
                    var __require = nodeEnv ? function (request) {
                        return require(request);
                    } : function (request) {
                        return __quick_compile_engine__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_engine__.registerModule(__filename, module);}"use strict";

var _js = _interopRequireDefault(require("../platform/js"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

/****************************************************************************
 Copyright (c) 2013-2016 Chukong Technologies Inc.
 Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.

 https://www.cocos.com/

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated engine source code (the "Software"), a limited,
 worldwide, royalty-free, non-assignable, revocable and non-exclusive license
 to use Cocos Creator solely to develop games on your target platforms. You shall
 not use Cocos Creator software for developing other software or tools that's
 used for developing games. You are not granted to publish, distribute,
 sublicense, and/or sell copies of Cocos Creator.

 The software or tools in this License Agreement are licensed, not sold.
 Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 THE SOFTWARE.
 ****************************************************************************/
// Draw text the textBaseline ratio (Can adjust the appropriate baseline ratio based on the platform)
var _BASELINE_RATIO = 0.26;
var _BASELINE_OFFSET = 0;

if (CC_RUNTIME) {
  _BASELINE_OFFSET = _BASELINE_RATIO * 2 / 3;
}

var MAX_CACHE_SIZE = 100;
var pool = new _js["default"].Pool(2);

pool.get = function () {
  var node = this._get() || {
    key: null,
    value: null,
    prev: null,
    next: null
  };
  return node;
};

function LRUCache(size) {
  this.count = 0;
  this.limit = size;
  this.datas = {};
  this.head = null;
  this.tail = null;
}

LRUCache.prototype.moveToHead = function (node) {
  node.next = this.head;
  node.prev = null;
  if (this.head !== null) this.head.prev = node;
  this.head = node;
  if (this.tail === null) this.tail = node;
  this.count++;
  this.datas[node.key] = node;
};

LRUCache.prototype.put = function (key, value) {
  var node = pool.get();
  node.key = key;
  node.value = value;

  if (this.count >= this.limit) {
    var discard = this.tail;
    delete this.datas[discard.key];
    this.count--;
    this.tail = discard.prev;
    this.tail.next = null;
    discard.prev = null;
    discard.next = null;
    pool.put(discard);
  }

  this.moveToHead(node);
};

LRUCache.prototype.remove = function (node) {
  if (node.prev !== null) {
    node.prev.next = node.next;
  } else {
    this.head = node.next;
  }

  if (node.next !== null) {
    node.next.prev = node.prev;
  } else {
    this.tail = node.prev;
  }

  delete this.datas[node.key];
  this.count--;
};

LRUCache.prototype.get = function (key) {
  var node = this.datas[key];

  if (node) {
    this.remove(node);
    this.moveToHead(node);
    return node.value;
  }

  return null;
};

LRUCache.prototype.clear = function () {
  this.count = 0;
  this.datas = {};
  this.head = null;
  this.tail = null;
};

LRUCache.prototype.has = function (key) {
  return !!this.datas[key];
};

LRUCache.prototype["delete"] = function (key) {
  var node = this.datas[key];
  this.remove(node);
};

var measureCache = new LRUCache(MAX_CACHE_SIZE);
var textUtils = {
  BASELINE_RATIO: _BASELINE_RATIO,
  MIDDLE_RATIO: (_BASELINE_RATIO + 1) / 2 - _BASELINE_RATIO,
  BASELINE_OFFSET: _BASELINE_OFFSET,
  label_wordRex: /([a-zA-Z0-9ÄÖÜäöüßéèçàùêâîôûа-яА-ЯЁё]+|\S)/,
  label_symbolRex: /^[!,.:;'}\]%\?>、‘“》？。，！]/,
  label_lastWordRex: /([a-zA-Z0-9ÄÖÜäöüßéèçàùêâîôûаíìÍÌïÁÀáàÉÈÒÓòóŐőÙÚŰúűñÑæÆœŒÃÂãÔõěščřžýáíéóúůťďňĚŠČŘŽÁÍÉÓÚŤżźśóńłęćąŻŹŚÓŃŁĘĆĄ-яА-ЯЁё]+|\S)$/,
  label_lastEnglish: /[a-zA-Z0-9ÄÖÜäöüßéèçàùêâîôûаíìÍÌïÁÀáàÉÈÒÓòóŐőÙÚŰúűñÑæÆœŒÃÂãÔõěščřžýáíéóúůťďňĚŠČŘŽÁÍÉÓÚŤżźśóńłęćąŻŹŚÓŃŁĘĆĄ-яА-ЯЁё]+$/,
  label_firstEnglish: /^[a-zA-Z0-9ÄÖÜäöüßéèçàùêâîôûаíìÍÌïÁÀáàÉÈÒÓòóŐőÙÚŰúűñÑæÆœŒÃÂãÔõěščřžýáíéóúůťďňĚŠČŘŽÁÍÉÓÚŤżźśóńłęćąŻŹŚÓŃŁĘĆĄ-яА-ЯЁё]/,
  // The unicode standard will never assign a character from code point 0xD800 to 0xDFFF
  // high surrogate (0xD800-0xDBFF) and low surrogate(0xDC00-0xDFFF) combines to a character on the Supplementary Multilingual Plane
  // reference: https://en.wikipedia.org/wiki/UTF-16
  highSurrogateRex: /[\uD800-\uDBFF]/,
  lowSurrogateRex: /[\uDC00-\uDFFF]/,
  label_wrapinspection: true,
  __CHINESE_REG: /^[\u4E00-\u9FFF\u3400-\u4DFF]+$/,
  __JAPANESE_REG: /[\u3000-\u303F]|[\u3040-\u309F]|[\u30A0-\u30FF]|[\uFF00-\uFFEF]|[\u4E00-\u9FAF]|[\u2605-\u2606]|[\u2190-\u2195]|\u203B/g,
  __KOREAN_REG: /^[\u1100-\u11FF]|[\u3130-\u318F]|[\uA960-\uA97F]|[\uAC00-\uD7AF]|[\uD7B0-\uD7FF]+$/,
  isUnicodeCJK: function isUnicodeCJK(ch) {
    return this.__CHINESE_REG.test(ch) || this.__JAPANESE_REG.test(ch) || this.__KOREAN_REG.test(ch);
  },
  //Checking whether the character is a whitespace
  isUnicodeSpace: function isUnicodeSpace(ch) {
    ch = ch.charCodeAt(0);
    return ch >= 9 && ch <= 13 || ch === 32 || ch === 133 || ch === 160 || ch === 5760 || ch >= 8192 && ch <= 8202 || ch === 8232 || ch === 8233 || ch === 8239 || ch === 8287 || ch === 12288;
  },
  safeMeasureText: function safeMeasureText(ctx, string, desc) {
    var font = desc || ctx.font;
    var key = font + "\uD83C\uDFAE" + string;
    var cache = measureCache.get(key);

    if (cache !== null) {
      return cache;
    }

    var metric = ctx.measureText(string);
    var width = metric && metric.width || 0;
    measureCache.put(key, width);
    return width;
  },
  // in case truncate a character on the Supplementary Multilingual Plane
  // test case: a = '😉🚗'
  // _safeSubstring(a, 1) === '😉🚗'
  // _safeSubstring(a, 0, 1) === '😉'
  // _safeSubstring(a, 0, 2) === '😉'
  // _safeSubstring(a, 0, 3) === '😉'
  // _safeSubstring(a, 0, 4) === '😉🚗'
  // _safeSubstring(a, 1, 2) === _safeSubstring(a, 1, 3) === '😉'
  // _safeSubstring(a, 2, 3) === _safeSubstring(a, 2, 4) === '🚗'
  _safeSubstring: function _safeSubstring(targetString, startIndex, endIndex) {
    var newStartIndex = startIndex,
        newEndIndex = endIndex;
    var startChar = targetString[startIndex];

    if (this.lowSurrogateRex.test(startChar)) {
      newStartIndex--;
    }

    if (endIndex !== undefined) {
      if (endIndex - 1 !== startIndex) {
        var endChar = targetString[endIndex - 1];

        if (this.highSurrogateRex.test(endChar)) {
          newEndIndex--;
        }
      } else if (this.highSurrogateRex.test(startChar)) {
        newEndIndex++;
      }
    }

    return targetString.substring(newStartIndex, newEndIndex);
  },
  fragmentText: function fragmentText(stringToken, allWidth, maxWidth, measureText) {
    //check the first character
    var wrappedWords = []; //fast return if strArr is empty

    if (stringToken.length === 0 || maxWidth < 0) {
      wrappedWords.push('');
      return wrappedWords;
    }

    var text = stringToken;

    while (allWidth > maxWidth && text.length > 1) {
      var fuzzyLen = text.length * (maxWidth / allWidth) | 0;

      var tmpText = this._safeSubstring(text, fuzzyLen);

      var width = allWidth - measureText(tmpText);
      var sLine = tmpText;
      var pushNum = 0;
      var checkWhile = 0;
      var checkCount = 10; //Exceeded the size

      while (width > maxWidth && checkWhile++ < checkCount) {
        fuzzyLen *= maxWidth / width;
        fuzzyLen = fuzzyLen | 0;
        tmpText = this._safeSubstring(text, fuzzyLen);
        width = allWidth - measureText(tmpText);
      }

      checkWhile = 0; //Find the truncation point

      while (width <= maxWidth && checkWhile++ < checkCount) {
        if (tmpText) {
          var exec = this.label_wordRex.exec(tmpText);
          pushNum = exec ? exec[0].length : 1;
          sLine = tmpText;
        }

        fuzzyLen = fuzzyLen + pushNum;
        tmpText = this._safeSubstring(text, fuzzyLen);
        width = allWidth - measureText(tmpText);
      }

      fuzzyLen -= pushNum; // in case maxWidth cannot contain any characters, need at least one character per line

      if (fuzzyLen === 0) {
        fuzzyLen = 1;
        sLine = this._safeSubstring(text, 1);
      } else if (fuzzyLen === 1 && this.highSurrogateRex.test(text[0])) {
        fuzzyLen = 2;
        sLine = this._safeSubstring(text, 2);
      }

      var sText = this._safeSubstring(text, 0, fuzzyLen),
          result; //symbol in the first


      if (this.label_wrapinspection) {
        if (this.label_symbolRex.test(sLine || tmpText)) {
          result = this.label_lastWordRex.exec(sText);
          fuzzyLen -= result ? result[0].length : 0;
          if (fuzzyLen === 0) fuzzyLen = 1;
          sLine = this._safeSubstring(text, fuzzyLen);
          sText = this._safeSubstring(text, 0, fuzzyLen);
        }
      } //To judge whether a English words are truncated


      if (this.label_firstEnglish.test(sLine)) {
        result = this.label_lastEnglish.exec(sText);

        if (result && sText !== result[0]) {
          fuzzyLen -= result[0].length;
          sLine = this._safeSubstring(text, fuzzyLen);
          sText = this._safeSubstring(text, 0, fuzzyLen);
        }
      } // The first line And do not wrap should not remove the space


      if (wrappedWords.length === 0) {
        wrappedWords.push(sText);
      } else {
        sText = sText.trimLeft();

        if (sText.length > 0) {
          wrappedWords.push(sText);
        }
      }

      text = sLine || tmpText;
      allWidth = measureText(text);
    }

    if (wrappedWords.length === 0) {
      wrappedWords.push(text);
    } else {
      text = text.trimLeft();

      if (text.length > 0) {
        wrappedWords.push(text);
      }
    }

    return wrappedWords;
  }
};
cc.textUtils = module.exports = textUtils;
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_engine__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImVuZ2luZS1kZXYvY29jb3MyZC9jb3JlL3V0aWxzL3RleHQtdXRpbHMuanMiXSwibmFtZXMiOlsiX0JBU0VMSU5FX1JBVElPIiwiX0JBU0VMSU5FX09GRlNFVCIsIkNDX1JVTlRJTUUiLCJNQVhfQ0FDSEVfU0laRSIsInBvb2wiLCJqcyIsIlBvb2wiLCJnZXQiLCJub2RlIiwiX2dldCIsImtleSIsInZhbHVlIiwicHJldiIsIm5leHQiLCJMUlVDYWNoZSIsInNpemUiLCJjb3VudCIsImxpbWl0IiwiZGF0YXMiLCJoZWFkIiwidGFpbCIsInByb3RvdHlwZSIsIm1vdmVUb0hlYWQiLCJwdXQiLCJkaXNjYXJkIiwicmVtb3ZlIiwiY2xlYXIiLCJoYXMiLCJtZWFzdXJlQ2FjaGUiLCJ0ZXh0VXRpbHMiLCJCQVNFTElORV9SQVRJTyIsIk1JRERMRV9SQVRJTyIsIkJBU0VMSU5FX09GRlNFVCIsImxhYmVsX3dvcmRSZXgiLCJsYWJlbF9zeW1ib2xSZXgiLCJsYWJlbF9sYXN0V29yZFJleCIsImxhYmVsX2xhc3RFbmdsaXNoIiwibGFiZWxfZmlyc3RFbmdsaXNoIiwiaGlnaFN1cnJvZ2F0ZVJleCIsImxvd1N1cnJvZ2F0ZVJleCIsImxhYmVsX3dyYXBpbnNwZWN0aW9uIiwiX19DSElORVNFX1JFRyIsIl9fSkFQQU5FU0VfUkVHIiwiX19LT1JFQU5fUkVHIiwiaXNVbmljb2RlQ0pLIiwiY2giLCJ0ZXN0IiwiaXNVbmljb2RlU3BhY2UiLCJjaGFyQ29kZUF0Iiwic2FmZU1lYXN1cmVUZXh0IiwiY3R4Iiwic3RyaW5nIiwiZGVzYyIsImZvbnQiLCJjYWNoZSIsIm1ldHJpYyIsIm1lYXN1cmVUZXh0Iiwid2lkdGgiLCJfc2FmZVN1YnN0cmluZyIsInRhcmdldFN0cmluZyIsInN0YXJ0SW5kZXgiLCJlbmRJbmRleCIsIm5ld1N0YXJ0SW5kZXgiLCJuZXdFbmRJbmRleCIsInN0YXJ0Q2hhciIsInVuZGVmaW5lZCIsImVuZENoYXIiLCJzdWJzdHJpbmciLCJmcmFnbWVudFRleHQiLCJzdHJpbmdUb2tlbiIsImFsbFdpZHRoIiwibWF4V2lkdGgiLCJ3cmFwcGVkV29yZHMiLCJsZW5ndGgiLCJwdXNoIiwidGV4dCIsImZ1enp5TGVuIiwidG1wVGV4dCIsInNMaW5lIiwicHVzaE51bSIsImNoZWNrV2hpbGUiLCJjaGVja0NvdW50IiwiZXhlYyIsInNUZXh0IiwicmVzdWx0IiwidHJpbUxlZnQiLCJjYyIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7QUEwQkE7Ozs7QUExQkE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUE0QkE7QUFDQSxJQUFJQSxlQUFlLEdBQUcsSUFBdEI7QUFDQSxJQUFJQyxnQkFBZ0IsR0FBRyxDQUF2Qjs7QUFDQSxJQUFJQyxVQUFKLEVBQWdCO0FBQ1pELEVBQUFBLGdCQUFnQixHQUFHRCxlQUFlLEdBQUcsQ0FBbEIsR0FBc0IsQ0FBekM7QUFDSDs7QUFFRCxJQUFNRyxjQUFjLEdBQUcsR0FBdkI7QUFFQSxJQUFJQyxJQUFJLEdBQUcsSUFBSUMsZUFBR0MsSUFBUCxDQUFZLENBQVosQ0FBWDs7QUFDQUYsSUFBSSxDQUFDRyxHQUFMLEdBQVcsWUFBWTtBQUNuQixNQUFJQyxJQUFJLEdBQUcsS0FBS0MsSUFBTCxNQUFlO0FBQ3RCQyxJQUFBQSxHQUFHLEVBQUUsSUFEaUI7QUFFdEJDLElBQUFBLEtBQUssRUFBRSxJQUZlO0FBR3RCQyxJQUFBQSxJQUFJLEVBQUUsSUFIZ0I7QUFJdEJDLElBQUFBLElBQUksRUFBRTtBQUpnQixHQUExQjtBQU9BLFNBQU9MLElBQVA7QUFDSCxDQVREOztBQVdBLFNBQVNNLFFBQVQsQ0FBa0JDLElBQWxCLEVBQXdCO0FBQ3BCLE9BQUtDLEtBQUwsR0FBYSxDQUFiO0FBQ0EsT0FBS0MsS0FBTCxHQUFhRixJQUFiO0FBQ0EsT0FBS0csS0FBTCxHQUFhLEVBQWI7QUFDQSxPQUFLQyxJQUFMLEdBQVksSUFBWjtBQUNBLE9BQUtDLElBQUwsR0FBWSxJQUFaO0FBQ0g7O0FBRUROLFFBQVEsQ0FBQ08s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QUF3QixDQUE1QixFQUErQjtBQUMzQkQsUUFBQUEsWUFBWSxDQUFDRSxJQUFiLENBQWtCUyxLQUFsQjtBQUNILE9BRkQsTUFHSztBQUNEQSxRQUFBQSxLQUFLLEdBQUdBLEtBQUssQ0FBQ0UsUUFBTixFQUFSOztBQUNBLFlBQUlGLEtBQUssQ0FBQ1YsTUFBTixHQUFlLENBQW5CLEVBQXNCO0FBQ2xCRCxVQUFBQSxZQUFZLENBQUNFLElBQWIsQ0FBa0JTLEtBQWxCO0FBQ0g7QUFDSjs7QUFDRFIsTUFBQUEsSUFBSSxHQUFHRyxLQUFLLElBQUlELE9BQWhCO0FBQ0FQLE1BQUFBLFFBQVEsR0FBR2QsV0FBVyxDQUFDbUIsSUFBRCxDQUF0QjtBQUNIOztBQUVELFFBQUlILFlBQVksQ0FBQ0MsTUFBYixLQUF3QixDQUE1QixFQUErQjtBQUMzQkQsTUFBQUEsWUFBWSxDQUFDRSxJQUFiLENBQWtCQyxJQUFsQjtBQUNILEtBRkQsTUFHSztBQUNEQSxNQUFBQSxJQUFJLEdBQUdBLElBQUksQ0FBQ1UsUUFBTCxFQUFQOztBQUNBLFVBQUlWLElBQUksQ0FBQ0YsTUFBTCxHQUFjLENBQWxCLEVBQXFCO0FBQ2pCRCxRQUFBQSxZQUFZLENBQUNFLElBQWIsQ0FBa0JDLElBQWxCO0FBQ0g7QUFDSjs7QUFDRCxXQUFPSCxZQUFQO0FBQ0g7QUFuTFcsQ0FBaEI7QUFzTEFjLEVBQUUsQ0FBQ3pELFNBQUgsR0FBZTBELE1BQU0sQ0FBQ0MsT0FBUCxHQUFpQjNELFNBQWhDIiwic291cmNlc0NvbnRlbnQiOlsiLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcbiBDb3B5cmlnaHQgKGMpIDIwMTMtMjAxNiBDaHVrb25nIFRlY2hub2xvZ2llcyBJbmMuXG4gQ29weXJpZ2h0IChjKSAyMDE3LTIwMTggWGlhbWVuIFlhamkgU29mdHdhcmUgQ28uLCBMdGQuXG5cbiBodHRwczovL3d3dy5jb2Nvcy5jb20vXG5cbiBQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5XG4gb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBlbmdpbmUgc291cmNlIGNvZGUgKHRoZSBcIlNvZnR3YXJlXCIpLCBhIGxpbWl0ZWQsXG4gd29ybGR3aWRlLCByb3lhbHR5LWZyZWUsIG5vbi1hc3NpZ25hYmxlLCByZXZvY2FibGUgYW5kIG5vbi1leGNsdXNpdmUgbGljZW5zZVxuIHRvIHVzZSBDb2NvcyBDcmVhdG9yIHNvbGVseSB0byBkZXZlbG9wIGdhbWVzIG9uIHlvdXIgdGFyZ2V0IHBsYXRmb3Jtcy4gWW91IHNoYWxsXG4gbm90IHVzZSBDb2NvcyBDcmVhdG9yIHNvZnR3YXJlIGZvciBkZXZlbG9waW5nIG90aGVyIHNvZnR3YXJlIG9yIHRvb2xzIHRoYXQnc1xuIHVzZWQgZm9yIGRldmVsb3BpbmcgZ2FtZXMuIFlvdSBhcmUgbm90IGdyYW50ZWQgdG8gcHVibGlzaCwgZGlzdHJpYnV0ZSxcbiBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbCBjb3BpZXMgb2YgQ29jb3MgQ3JlYXRvci5cblxuIFRoZSBzb2Z0d2FyZSBvciB0b29scyBpbiB0aGlzIExpY2Vuc2UgQWdyZWVtZW50IGFyZSBsaWNlbnNlZCwgbm90IHNvbGQuXG4gWGlhbWVuIFlhamkgU29mdHdhcmUgQ28uLCBMdGQuIHJlc2VydmVzIGFsbCByaWdodHMgbm90IGV4cHJlc3NseSBncmFudGVkIHRvIHlvdS5cblxuIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCBcIkFTIElTXCIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1JcbiBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSxcbiBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEVcbiBBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSXG4gTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSxcbiBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOXG4gVEhFIFNPRlRXQVJFLlxuICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG5cbmltcG9ydCBqcyBmcm9tICcuLi9wbGF0Zm9ybS9qcydcblxuLy8gRHJhdyB0ZXh0IHRoZSB0ZXh0QmFzZWxpbmUgcmF0aW8gKENhbiBhZGp1c3QgdGhlIGFwcHJvcHJpYXRlIGJhc2VsaW5lIHJhdGlvIGJhc2VkIG9uIHRoZSBwbGF0Zm9ybSlcbmxldCBfQkFTRUxJTkVfUkFUSU8gPSAwLjI2O1xubGV0IF9CQVNFTElORV9PRkZTRVQgPSAwO1xuaWYgKENDX1JVTlRJTUUpIHtcbiAgICBfQkFTRUxJTkVfT0ZGU0VUID0gX0JBU0VMSU5FX1JBVElPICogMiAvIDM7XG59XG5cbmNvbnN0IE1BWF9DQUNIRV9TSVpFID0gMTAwO1xuXG5sZXQgcG9vbCA9IG5ldyBqcy5Qb29sKDIpO1xucG9vbC5nZXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIG5vZGUgPSB0aGlzLl9nZXQoKSB8fCB7XG4gICAgICAgIGtleTogbnVsbCxcbiAgICAgICAgdmFsdWU6IG51bGwsXG4gICAgICAgIHByZXY6IG51bGwsXG4gICAgICAgIG5leHQ6IG51bGxcbiAgICB9O1xuXG4gICAgcmV0dXJuIG5vZGU7XG59O1xuXG5mdW5jdGlvbiBMUlVDYWNoZShzaXplKSB7XG4gICAgdGhpcy5jb3VudCA9IDA7XG4gICAgdGhpcy5saW1pdCA9IHNpemU7XG4gICAgdGhpcy5kYXRhcyA9IHt9O1xuICAgIHRoaXMuaGVhZCA9IG51bGw7XG4gICAgdGhpcy50YWlsID0gbnVsbDtcbn1cblxuTFJVQ2FjaGUucHJvdG90eXBlLm1vdmVUb0hlYWQgPSBmdW5jdGlvbiAobm9kZSkge1xuICAgIG5vZGUubmV4dCA9IHRoaXMuaGVhZDtcbiAgICBub2RlLnByZXYgPSBudWxsO1xuICAgIGlmICh0aGlzLmhlYWQgIT09IG51bGwpIFxuICAgICAgICB0aGlzLmhlYWQucHJldiA9IG5vZGU7XG4gICAgdGhpcy5oZWFkID0gbm9kZTtcbiAgICBpZiAodGhpcy50YWlsID09PSBudWxsKSBcbiAgICAgICAgdGhpcy50YWlsID0gbm9kZTtcbiAgICB0aGlzLmNvdW50Kys7XG4gICAgdGhpcy5kYXRhc1tub2RlLmtleV0gPSBub2RlO1xufVxuXG5MUlVDYWNoZS5wcm90b3R5cGUucHV0ID0gZnVuY3Rpb24gKGtleSwgdmFsdWUpIHtcbiAgICBjb25zdCBub2RlID0gcG9vbC5nZXQoKTtcbiAgICBub2RlLmtleSA9IGtleTtcbiAgICBub2RlLnZhbHVlID0gdmFsdWU7XG4gICAgXG4gICAgaWYgKHRoaXMuY291bnQgPj0gdGhpcy5saW1pdCkge1xuICAgICAgICBsZXQgZGlzY2FyZCA9IHRoaXMudGFpbDtcbiAgICAgICAgZGVsZXRlIHRoaXMuZGF0YXNbZGlzY2FyZC5rZXldO1xuICAgICAgICB0aGlzLmNvdW50LS07XG4gICAgICAgIHRoaXMudGFpbCA9IGRpc2NhcmQucHJldjtcbiAgICAgICAgdGhpcy50YWlsLm5leHQgPSBudWxsO1xuICAgICAgICBkaXNjYXJkLnByZXYgPSBudWxsO1xuICAgICAgICBkaXNjYXJkLm5leHQgPSBudWxsO1xuICAgICAgICBwb29sLnB1dChkaXNjYXJkKTtcbiAgICB9XG4gICAgdGhpcy5tb3ZlVG9IZWFkKG5vZGUpO1xufVxuXG5MUlVDYWNoZS5wcm90b3R5cGUucmVtb3ZlID0gZnVuY3Rpb24gKG5vZGUpIHtcbiAgICBpZiAobm9kZS5wcmV2ICE9PSBudWxsKSB7XG4gICAgICAgIG5vZGUucHJldi5uZXh0ID0gbm9kZS5uZXh0O1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuaGVhZCA9IG5vZGUubmV4dDtcbiAgICB9XG4gICAgaWYgKG5vZGUubmV4dCAhPT0gbnVsbCkge1xuICAgICAgICBub2RlLm5leHQucHJldiA9IG5vZGUucHJldjtcbiAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLnRhaWwgPSBub2RlLnByZXY7XG4gICAgfVxuICAgIGRlbGV0ZSB0aGlzLmRhdGFzW25vZGUua2V5XTtcbiAgICB0aGlzLmNvdW50LS07XG59XG5cbkxSVUNhY2hlLnByb3RvdHlwZS5nZXQgPSBmdW5jdGlvbiAoa2V5KSB7XG4gICAgY29uc3Qgbm9kZSA9IHRoaXMuZGF0YXNba2V5XTtcbiAgICBpZiAobm9kZSkge1xuICAgICAgICB0aGlzLnJlbW92ZShub2RlKTtcbiAgICAgICAgdGhpcy5tb3ZlVG9IZWFkKG5vZGUpO1xuICAgICAgICByZXR1cm4gbm9kZS52YWx1ZTtcbiAgICB9XG4gICAgcmV0dXJuIG51bGw7XG59XG5cbkxSVUNhY2hlLnByb3RvdHlwZS5jbGVhciA9IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLmNvdW50ID0gMDtcbiAgICB0aGlzLmRhdGFzID0ge307XG4gICAgdGhpcy5oZWFkID0gbnVsbDtcbiAgICB0aGlzLnRhaWwgPSBudWxsO1xufVxuXG5MUlVDYWNoZS5wcm90b3R5cGUuaGFzID0gZnVuY3Rpb24gKGtleSkge1xuICAgIHJldHVybiAhIXRoaXMuZGF0YXNba2V5XTtcbn1cblxuTFJVQ2FjaGUucHJvdG90eXBlLmRlbGV0ZSA9IGZ1bmN0aW9uIChrZXkpIHtcbiAgICBjb25zdCBub2RlID0gdGhpcy5kYXRhc1trZXldO1xuICAgIHRoaXMucmVtb3ZlKG5vZGUpO1xufVxuXG5sZXQgbWVhc3VyZUNhY2hlID0gbmV3IExSVUNhY2hlKE1BWF9DQUNIRV9TSVpFKTtcblxudmFyIHRleHRVdGlscyA9IHtcblxuICAgIEJBU0VMSU5FX1JBVElPOiBfQkFTRUxJTkVfUkFUSU8sXG4gICAgTUlERExFX1JBVElPOiAoX0JBU0VMSU5FX1JBVElPICsgMSkgLyAyIC0gX0JBU0VMSU5FX1JBVElPLFxuICAgIEJBU0VMSU5FX09GRlNFVDogX0JBU0VMSU5FX09GRlNFVCxcblxuICAgIGxhYmVsX3dvcmRSZXggOiAvKFthLXpBLVowLTnDhMOWw5zDpMO2w7zDn8Opw6jDp8Ogw7nDqsOiw67DtMO70LAt0Y/QkC3Qr9CB0ZFdK3xcXFMpLyxcbiAgICBsYWJlbF9zeW1ib2xSZXggOiAvXlshLC46Oyd9XFxdJVxcPz7jgIHigJjigJzjgIvvvJ/jgILvvIzvvIFdLyxcbiAgICBsYWJlbF9sYXN0V29yZFJleCA6IC8oW2EtekEtWjAtOcOEw5bDnMOkw7bDvMOfw6nDqMOnw6DDucOqw6LDrsO0w7vQsMOtw6zDjcOMw6/DgcOAw6HDoMOJw4jDksOTw7LDs8WQxZHDmcOaxbDDusWxw7HDkcOmw4bFk8WSw4PDgsOjw5TDtcSbxaHEjcWZxb7DvcOhw63DqcOzw7rFr8WlxI/FiMSaxaDEjMWYxb3DgcONw4nDk8OaxaTFvMW6xZvDs8WExYLEmcSHxIXFu8W5xZrDk8WDxYHEmMSGxIQt0Y/QkC3Qr9CB0ZFdK3xcXFMpJC8sXG4gICAgbGFiZWxfbGFzdEVuZ2xpc2ggOiAvW2EtekEtWjAtOcOEw5bDnMOkw7bDvMOfw6nDqMOnw6DDucOqw6LDrsO0w7vQsMOtw6zDjcOMw6/DgcOAw6HDoMOJw4jDksOTw7LDs8WQxZHDmcOaxbDDusWxw7HDkcOmw4bFk8WSw4PDgsOjw5TDtcSbxaHEjcWZxb7DvcOhw63DqcOzw7rFr8WlxI/FiMSaxaDEjMWYxb3DgcONw4nDk8OaxaTFvMW6xZvDs8WExYLEmcSHxIXFu8W5xZrDk8WDxYHEmMSGxIQt0Y/QkC3Qr9CB0ZFdKyQvLFxuICAgIGxhYmVsX2ZpcnN0RW5nbGlzaCA6IC9eW2EtekEtWjAtOcOEw5bDnMOkw7bDvMOfw6nDqMOnw6DDucOqw6LDrsO0w7vQsMOtw6zDjcOMw6/DgcOAw6HDoMOJw4jDksOTw7LDs8WQxZHDmcOaxbDDusWxw7HDkcOmw4bFk8WSw4PDgsOjw5TDtcSbxaHEjcWZxb7DvcOhw63DqcOzw7rFr8WlxI/FiMSaxaDEjMWYxb3DgcONw4nDk8OaxaTFvMW6xZvDs8WExYLEmcSHxIXFu8W5xZrDk8WDxYHEmMSGxIQt0Y/QkC3Qr9CB0ZFdLyxcbiAgICAvLyBUaGUgdW5pY29kZSBzdGFuZGFyZCB3aWxsIG5ldmVyIGFzc2lnbiBhIGNoYXJhY3RlciBmcm9tIGNvZGUgcG9pbnQgMHhEODAwIHRvIDB4REZGRlxuICAgIC8vIGhpZ2ggc3Vycm9nYXRlICgweEQ4MDAtMHhEQkZGKSBhbmQgbG93IHN1cnJvZ2F0ZSgweERDMDAtMHhERkZGKSBjb21iaW5lcyB0byBhIGNoYXJhY3RlciBvbiB0aGUgU3VwcGxlbWVudGFyeSBNdWx0aWxpbmd1YWwgUGxhbmVcbiAgICAvLyByZWZlcmVuY2U6IGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL1VURi0xNlxuICAgIGhpZ2hTdXJyb2dhdGVSZXg6IC9bXFx1RDgwMC1cXHVEQkZGXS8sXG4gICAgbG93U3Vycm9nYXRlUmV4OiAvW1xcdURDMDAtXFx1REZGRl0vLFxuICAgIGxhYmVsX3dyYXBpbnNwZWN0aW9uIDogdHJ1ZSxcblxuICAgIF9fQ0hJTkVTRV9SRUc6IC9eW1xcdTRFMDAtXFx1OUZGRlxcdTM0MDAtXFx1NERGRl0rJC8sXG4gICAgX19KQVBBTkVTRV9SRUc6IC9bXFx1MzAwMC1cXHUzMDNGXXxbXFx1MzA0MC1cXHUzMDlGXXxbXFx1MzBBMC1cXHUzMEZGXXxbXFx1RkYwMC1cXHVGRkVGXXxbXFx1NEUwMC1cXHU5RkFGXXxbXFx1MjYwNS1cXHUyNjA2XXxbXFx1MjE5MC1cXHUyMTk1XXxcXHUyMDNCL2csXG4gICAgX19LT1JFQU5fUkVHOiAvXltcXHUxMTAwLVxcdTExRkZdfFtcXHUzMTMwLVxcdTMxOEZdfFtcXHVBOTYwLVxcdUE5N0ZdfFtcXHVBQzAwLVxcdUQ3QUZdfFtcXHVEN0IwLVxcdUQ3RkZdKyQvLFxuXG4gICAgaXNVbmljb2RlQ0pLOiBmdW5jdGlvbihjaCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fX0NISU5FU0VfUkVHLnRlc3QoY2gpIHx8IHRoaXMuX19KQVBBTkVTRV9SRUcudGVzdChjaCkgfHwgdGhpcy5fX0tPUkVBTl9SRUcudGVzdChjaCk7XG4gICAgfSxcblxuICAgIC8vQ2hlY2tpbmcgd2hldGhlciB0aGUgY2hhcmFjdGVyIGlzIGEgd2hpdGVzcGFjZVxuICAgIGlzVW5pY29kZVNwYWNlOiBmdW5jdGlvbihjaCkge1xuICAgICAgICBjaCA9IGNoLmNoYXJDb2RlQXQoMCk7XG4gICAgICAgIHJldHVybiAoKGNoID49IDkgJiYgY2ggPD0gMTMpIHx8IGNoID09PSAzMiB8fCBjaCA9PT0gMTMzIHx8IGNoID09PSAxNjAgfHwgY2ggPT09IDU3NjAgfHwgKGNoID49IDgxOTIgJiYgY2ggPD0gODIwMikgfHwgY2ggPT09IDgyMzIgfHwgY2ggPT09IDgyMzMgfHwgY2ggPT09IDgyMzkgfHwgY2ggPT09IDgyODcgfHwgY2ggPT09IDEyMjg4KTtcbiAgICB9LFxuXG4gICAgc2FmZU1lYXN1cmVUZXh0OiBmdW5jdGlvbiAoY3R4LCBzdHJpbmcsIGRlc2MpIHtcbiAgICAgICAgbGV0IGZvbnQgPSBkZXNjIHx8IGN0eC5mb250O1xuICAgICAgICBsZXQga2V5ID0gZm9udCArIFwiXFx1RDgzQ1xcdURGQUVcIiArIHN0cmluZztcbiAgICAgICAgbGV0IGNhY2hlID0gbWVhc3VyZUNhY2hlLmdldChrZXkpO1xuICAgICAgICBpZiAoY2FjaGUgIT09IG51bGwpIHtcbiAgICAgICAgICAgIHJldHVybiBjYWNoZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBtZXRyaWMgPSBjdHgubWVhc3VyZVRleHQoc3RyaW5nKTtcbiAgICAgICAgbGV0IHdpZHRoID0gbWV0cmljICYmIG1ldHJpYy53aWR0aCB8fCAwO1xuICAgICAgICBtZWFzdXJlQ2FjaGUucHV0KGtleSwgd2lkdGgpO1xuXG4gICAgICAgIHJldHVybiB3aWR0aDtcbiAgICB9LFxuXG4gICAgLy8gaW4gY2FzZSB0cnVuY2F0ZSBhIGNoYXJhY3RlciBvbiB0aGUgU3VwcGxlbWVudGFyeSBNdWx0aWxpbmd1YWwgUGxhbmVcbiAgICAvLyB0ZXN0IGNhc2U6IGEgPSAn8J+YifCfmpcnXG4gICAgLy8gX3NhZmVTdWJzdHJpbmcoYSwgMSkgPT09ICfwn5iJ8J+alydcbiAgICAvLyBfc2FmZVN1YnN0cmluZyhhLCAwLCAxKSA9PT0gJ/CfmIknXG4gICAgLy8gX3NhZmVTdWJzdHJpbmcoYSwgMCwgMikgPT09ICfwn5iJJ1xuICAgIC8vIF9zYWZlU3Vic3RyaW5nKGEsIDAsIDMpID09PSAn8J+YiSdcbiAgICAvLyBfc2FmZVN1YnN0cmluZyhhLCAwLCA0KSA9PT0gJ/CfmInwn5qXJ1xuICAgIC8vIF9zYWZlU3Vic3RyaW5nKGEsIDEsIDIpID09PSBfc2FmZVN1YnN0cmluZyhhLCAxLCAzKSA9PT0gJ/CfmIknXG4gICAgLy8gX3NhZmVTdWJzdHJpbmcoYSwgMiwgMykgPT09IF9zYWZlU3Vic3RyaW5nKGEsIDIsIDQpID09PSAn8J+alydcbiAgICBfc2FmZVN1YnN0cmluZyAodGFyZ2V0U3RyaW5nLCBzdGFydEluZGV4LCBlbmRJbmRleCkge1xuICAgICAgICBsZXQgbmV3U3RhcnRJbmRleCA9IHN0YXJ0SW5kZXgsIG5ld0VuZEluZGV4ID0gZW5kSW5kZXg7XG4gICAgICAgIGxldCBzdGFydENoYXIgPSB0YXJnZXRTdHJpbmdbc3RhcnRJbmRleF07XG4gICAgICAgIGlmICh0aGlzLmxvd1N1cnJvZ2F0ZVJleC50ZXN0KHN0YXJ0Q2hhcikpIHtcbiAgICAgICAgICAgIG5ld1N0YXJ0SW5kZXgtLTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZW5kSW5kZXggIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgaWYgKGVuZEluZGV4IC0gMSAhPT0gc3RhcnRJbmRleCkge1xuICAgICAgICAgICAgICAgIGxldCBlbmRDaGFyID0gdGFyZ2V0U3RyaW5nW2VuZEluZGV4IC0gMV07XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaGlnaFN1cnJvZ2F0ZVJleC50ZXN0KGVuZENoYXIpKSB7XG4gICAgICAgICAgICAgICAgICAgIG5ld0VuZEluZGV4LS07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodGhpcy5oaWdoU3Vycm9nYXRlUmV4LnRlc3Qoc3RhcnRDaGFyKSkge1xuICAgICAgICAgICAgICAgIG5ld0VuZEluZGV4Kys7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRhcmdldFN0cmluZy5zdWJzdHJpbmcobmV3U3RhcnRJbmRleCwgbmV3RW5kSW5kZXgpO1xuICAgIH0sXG5cbiAgICBmcmFnbWVudFRleHQ6IGZ1bmN0aW9uIChzdHJpbmdUb2tlbiwgYWxsV2lkdGgsIG1heFdpZHRoLCBtZWFzdXJlVGV4dCkge1xuICAgICAgICAvL2NoZWNrIHRoZSBmaXJzdCBjaGFyYWN0ZXJcbiAgICAgICAgdmFyIHdyYXBwZWRXb3JkcyA9IFtdO1xuICAgICAgICAvL2Zhc3QgcmV0dXJuIGlmIHN0ckFyciBpcyBlbXB0eVxuICAgICAgICBpZihzdHJpbmdUb2tlbi5sZW5ndGggPT09IDAgfHwgbWF4V2lkdGggPCAwKSB7XG4gICAgICAgICAgICB3cmFwcGVkV29yZHMucHVzaCgnJyk7XG4gICAgICAgICAgICByZXR1cm4gd3JhcHBlZFdvcmRzO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIHRleHQgPSBzdHJpbmdUb2tlbjtcbiAgICAgICAgd2hpbGUgKGFsbFdpZHRoID4gbWF4V2lkdGggJiYgdGV4dC5sZW5ndGggPiAxKSB7XG5cbiAgICAgICAgICAgIHZhciBmdXp6eUxlbiA9IHRleHQubGVuZ3RoICogKCBtYXhXaWR0aCAvIGFsbFdpZHRoICkgfCAwO1xuICAgICAgICAgICAgdmFyIHRtcFRleHQgPSB0aGlzLl9zYWZlU3Vic3RyaW5nKHRleHQsIGZ1enp5TGVuKTtcbiAgICAgICAgICAgIHZhciB3aWR0aCA9IGFsbFdpZHRoIC0gbWVhc3VyZVRleHQodG1wVGV4dCk7XG4gICAgICAgICAgICB2YXIgc0xpbmUgPSB0bXBUZXh0O1xuICAgICAgICAgICAgdmFyIHB1c2hOdW0gPSAwO1xuXG4gICAgICAgICAgICB2YXIgY2hlY2tXaGlsZSA9IDA7XG4gICAgICAgICAgICB2YXIgY2hlY2tDb3VudCA9IDEwO1xuXG4gICAgICAgICAgICAvL0V4Y2VlZGVkIHRoZSBzaXplXG4gICAgICAgICAgICB3aGlsZSAod2lkdGggPiBtYXhXaWR0aCAmJiBjaGVja1doaWxlKysgPCBjaGVja0NvdW50KSB7XG4gICAgICAgICAgICAgICAgZnV6enlMZW4gKj0gbWF4V2lkdGggLyB3aWR0aDtcbiAgICAgICAgICAgICAgICBmdXp6eUxlbiA9IGZ1enp5TGVuIHwgMDtcbiAgICAgICAgICAgICAgICB0bXBUZXh0ID0gdGhpcy5fc2FmZVN1YnN0cmluZyh0ZXh0LCBmdXp6eUxlbik7XG4gICAgICAgICAgICAgICAgd2lkdGggPSBhbGxXaWR0aCAtIG1lYXN1cmVUZXh0KHRtcFRleHQpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjaGVja1doaWxlID0gMDtcblxuICAgICAgICAgICAgLy9GaW5kIHRoZSB0cnVuY2F0aW9uIHBvaW50XG4gICAgICAgICAgICB3aGlsZSAod2lkdGggPD0gbWF4V2lkdGggJiYgY2hlY2tXaGlsZSsrIDwgY2hlY2tDb3VudCkge1xuICAgICAgICAgICAgICAgIGlmICh0bXBUZXh0KSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBleGVjID0gdGhpcy5sYWJlbF93b3JkUmV4LmV4ZWModG1wVGV4dCk7XG4gICAgICAgICAgICAgICAgICAgIHB1c2hOdW0gPSBleGVjID8gZXhlY1swXS5sZW5ndGggOiAxO1xuICAgICAgICAgICAgICAgICAgICBzTGluZSA9IHRtcFRleHQ7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgZnV6enlMZW4gPSBmdXp6eUxlbiArIHB1c2hOdW07XG4gICAgICAgICAgICAgICAgdG1wVGV4dCA9IHRoaXMuX3NhZmVTdWJzdHJpbmcodGV4dCwgZnV6enlMZW4pO1xuICAgICAgICAgICAgICAgIHdpZHRoID0gYWxsV2lkdGggLSBtZWFzdXJlVGV4dCh0bXBUZXh0KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnV6enlMZW4gLT0gcHVzaE51bTtcbiAgICAgICAgICAgIC8vIGluIGNhc2UgbWF4V2lkdGggY2Fubm90IGNvbnRhaW4gYW55IGNoYXJhY3RlcnMsIG5lZWQgYXQgbGVhc3Qgb25lIGNoYXJhY3RlciBwZXIgbGluZVxuICAgICAgICAgICAgaWYgKGZ1enp5TGVuID09PSAwKSB7XG4gICAgICAgICAgICAgICAgZnV6enlMZW4gPSAxO1xuICAgICAgICAgICAgICAgIHNMaW5lID0gdGhpcy5fc2FmZVN1YnN0cmluZyh0ZXh0LCAxKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGZ1enp5TGVuID09PSAxICYmIHRoaXMuaGlnaFN1cnJvZ2F0ZVJleC50ZXN0KHRleHRbMF0pKSB7XG4gICAgICAgICAgICAgICAgZnV6enlMZW4gPSAyO1xuICAgICAgICAgICAgICAgIHNMaW5lID0gdGhpcy5fc2FmZVN1YnN0cmluZyh0ZXh0LCAyKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIHNUZXh0ID0gdGhpcy5fc2FmZVN1YnN0cmluZyh0ZXh0LCAwLCBmdXp6eUxlbiksIHJlc3VsdDtcblxuICAgICAgICAgICAgLy9zeW1ib2wgaW4gdGhlIGZpcnN0XG4gICAgICAgICAgICBpZiAodGhpcy5sYWJlbF93cmFwaW5zcGVjdGlvbikge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmxhYmVsX3N5bWJvbFJleC50ZXN0KHNMaW5lIHx8IHRtcFRleHQpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IHRoaXMubGFiZWxfbGFzdFdvcmRSZXguZXhlYyhzVGV4dCk7XG4gICAgICAgICAgICAgICAgICAgIGZ1enp5TGVuIC09IHJlc3VsdCA/IHJlc3VsdFswXS5sZW5ndGggOiAwO1xuICAgICAgICAgICAgICAgICAgICBpZiAoZnV6enlMZW4gPT09IDApIGZ1enp5TGVuID0gMTtcblxuICAgICAgICAgICAgICAgICAgICBzTGluZSA9IHRoaXMuX3NhZmVTdWJzdHJpbmcodGV4dCwgZnV6enlMZW4pO1xuICAgICAgICAgICAgICAgICAgICBzVGV4dCA9IHRoaXMuX3NhZmVTdWJzdHJpbmcodGV4dCwgMCwgZnV6enlMZW4pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy9UbyBqdWRnZSB3aGV0aGVyIGEgRW5nbGlzaCB3b3JkcyBhcmUgdHJ1bmNhdGVkXG4gICAgICAgICAgICBpZiAodGhpcy5sYWJlbF9maXJzdEVuZ2xpc2gudGVzdChzTGluZSkpIHtcbiAgICAgICAgICAgICAgICByZXN1bHQgPSB0aGlzLmxhYmVsX2xhc3RFbmdsaXNoLmV4ZWMoc1RleHQpO1xuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQgJiYgc1RleHQgIT09IHJlc3VsdFswXSkge1xuICAgICAgICAgICAgICAgICAgICBmdXp6eUxlbiAtPSByZXN1bHRbMF0ubGVuZ3RoO1xuICAgICAgICAgICAgICAgICAgICBzTGluZSA9IHRoaXMuX3NhZmVTdWJzdHJpbmcodGV4dCwgZnV6enlMZW4pO1xuICAgICAgICAgICAgICAgICAgICBzVGV4dCA9IHRoaXMuX3NhZmVTdWJzdHJpbmcodGV4dCwgMCwgZnV6enlMZW4pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gVGhlIGZpcnN0IGxpbmUgQW5kIGRvIG5vdCB3cmFwIHNob3VsZCBub3QgcmVtb3ZlIHRoZSBzcGFjZVxuICAgICAgICAgICAgaWYgKHdyYXBwZWRXb3Jkcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICB3cmFwcGVkV29yZHMucHVzaChzVGV4dCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBzVGV4dCA9IHNUZXh0LnRyaW1MZWZ0KCk7XG4gICAgICAgICAgICAgICAgaWYgKHNUZXh0Lmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgd3JhcHBlZFdvcmRzLnB1c2goc1RleHQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRleHQgPSBzTGluZSB8fCB0bXBUZXh0O1xuICAgICAgICAgICAgYWxsV2lkdGggPSBtZWFzdXJlVGV4dCh0ZXh0KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh3cmFwcGVkV29yZHMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICB3cmFwcGVkV29yZHMucHVzaCh0ZXh0KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRleHQgPSB0ZXh0LnRyaW1MZWZ0KCk7XG4gICAgICAgICAgICBpZiAodGV4dC5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgd3JhcHBlZFdvcmRzLnB1c2godGV4dCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHdyYXBwZWRXb3JkcztcbiAgICB9LFxufTtcblxuY2MudGV4dFV0aWxzID0gbW9kdWxlLmV4cG9ydHMgPSB0ZXh0VXRpbHM7XG4iXSwic291cmNlUm9vdCI6Ii8ifQ==