
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'engine-dev/cocos2d/core/asset-manager/factory.js';
                    var __require = nodeEnv ? function (request) {
                        return require(request);
                    } : function (request) {
                        return __quick_compile_engine__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_engine__.registerModule(__filename, module);}"use strict";

/****************************************************************************
 Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.

 https://www.cocos.com/

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated engine source code (the "Software"), a limited,
  worldwide, royalty-free, non-assignable, revocable and non-exclusive license
 to use Cocos Creator solely to develop games on your target platforms. You shall
  not use Cocos Creator software for developing other software or tools that's
  used for developing games. You are not granted to publish, distribute,
  sublicense, and/or sell copies of Cocos Creator.

 The software or tools in this License Agreement are licensed, not sold.
 Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 THE SOFTWARE.
 ****************************************************************************/
var Bundle = require('./bundle');

var Cache = require('./cache');

var _require = require('./shared'),
    assets = _require.assets;

var _creating = new Cache();

function createTexture(id, data, options, onComplete) {
  var out = null,
      err = null;

  try {
    out = new cc.Texture2D();
    out._nativeUrl = id;
    out._nativeAsset = data;
  } catch (e) {
    err = e;
  }

  onComplete && onComplete(err, out);
}

function createAudioClip(id, data, options, onComplete) {
  var out = new cc.AudioClip();
  out._nativeUrl = id;
  out._nativeAsset = data;
  out.duration = data.duration;
  onComplete && onComplete(null, out);
}

function createJsonAsset(id, data, options, onComplete) {
  var out = new cc.JsonAsset();
  out.json = data;
  onComplete && onComplete(null, out);
}

function createTextAsset(id, data, options, onComplete) {
  var out = new cc.TextAsset();
  out.text = data;
  onComplete && onComplete(null, out);
}

function createFont(id, data, options, onComplete) {
  var out = new cc.TTFFont();
  out._nativeUrl = id;
  out._nativeAsset = data;
  onComplete && onComplete(null, out);
}

function createBufferAsset(id, data, options, onComplete) {
  var out = new cc.BufferAsset();
  out._nativeUrl = id;
  out._nativeAsset = data;
  onComplete && onComplete(null, out);
}

function createAsset(id, data, options, onComplete) {
  var out = new cc.Asset();
  out._nativeUrl = id;
  out._nativeAsset = data;
  onComplete && onComplete(null, out);
}

function createBundle(id, data, options, onComplete) {
  var bundle = new Bundle();
  data.base = data.base || id + '/';
  bundle.init(data);
  onComplete && onComplete(null, bundle);
}

var factory = {
  register: function register(type, handler) {
    if (typeof type === 'object') {
      cc.js.mixin(producers, type);
    } else {
      producers[type] = handler;
    }
  },
  create: function create(id, data, type, options, onComplete) {
    var func = producers[type] || producers['default'];
    var asset, creating;

    if (asset = assets.get(id)) {
      onComplete(null, asset);
    } else if (creating = _creating.get(id)) {
      creating.push(onComplete);
    } else {
      _creating.add(id, [onComplete]);

      func(id, data, options, function (err, data) {
        if (!err && data instanceof cc.Asset) {
          data._uuid = id;
          assets.add(id, data);
        }

        var callbacks = _creating.remove(id);

        for (var i = 0, l = callbacks.length; i < l; i++) {
          callbacks[i](err, data);
        }
      });
    }
  }
};
var producers = {
  // Images
  '.png': createTexture,
  '.jpg': createTexture,
  '.bmp': createTexture,
  '.jpeg': createTexture,
  '.gif': createTexture,
  '.ico': createTexture,
  '.tiff': createTexture,
  '.webp': createTexture,
  '.image': createTexture,
  '.pvr': createTexture,
  '.pkm': createTexture,
  // Audio
  '.mp3': createAudioClip,
  '.ogg': createAudioClip,
  '.wav': createAudioClip,
  '.m4a': createAudioClip,
  // Txt
  '.txt': createTextAsset,
  '.xml': createTextAsset,
  '.vsh': createTextAsset,
  '.fsh': createTextAsset,
  '.atlas': createTextAsset,
  '.tmx': createTextAsset,
  '.tsx': createTextAsset,
  '.fnt': createTextAsset,
  '.json': createJsonAsset,
  '.ExportJson': createJsonAsset,
  // font
  '.font': createFont,
  '.eot': createFont,
  '.ttf': createFont,
  '.woff': createFont,
  '.svg': createFont,
  '.ttc': createFont,
  // Binary
  '.binary': createBufferAsset,
  '.bin': createBufferAsset,
  '.dbbin': createBufferAsset,
  '.skel': createBufferAsset,
  'bundle': createBundle,
  'default': createAsset
};
module.exports = factory;
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_engine__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImVuZ2luZS1kZXYvY29jb3MyZC9jb3JlL2Fzc2V0LW1hbmFnZXIvZmFjdG9yeS5qcyJdLCJuYW1lcyI6WyJCdW5kbGUiLCJyZXF1aXJlIiwiQ2FjaGUiLCJhc3NldHMiLCJfY3JlYXRpbmciLCJjcmVhdGVUZXh0dXJlIiwiaWQiLCJkYXRhIiwib3B0aW9ucyIsIm9uQ29tcGxldGUiLCJvdXQiLCJlcnIiLCJjYyIsIlRleHR1cmUyRCIsIl9uYXRpdmVVcmwiLCJfbmF0aXZlQXNzZXQiLCJlIiwiY3JlYXRlQXVkaW9DbGlwIiwiQXVkaW9DbGlwIiwiZHVyYXRpb24iLCJjcmVhdGVKc29uQXNzZXQiLCJKc29uQXNzZXQiLCJqc29uIiwiY3JlYXRlVGV4dEFzc2V0IiwiVGV4dEFzc2V0IiwidGV4dCIsImNyZWF0ZUZvbnQiLCJUVEZGb250IiwiY3JlYXRlQnVmZmVyQXNzZXQiLCJCdWZmZXJBc3NldCIsImNyZWF0ZUFzc2V0IiwiQXNzZXQiLCJjcmVhdGVCdW5kbGUiLCJidW5kbGUiLCJiYXNlIiwiaW5pdCIsImZhY3RvcnkiLCJyZWdpc3RlciIsInR5cGUiLCJoYW5kbGVyIiwianMiLCJtaXhpbiIsInByb2R1Y2VycyIsImNyZWF0ZSIsImZ1bmMiLCJhc3NldCIsImNyZWF0aW5nIiwiZ2V0IiwicHVzaCIsImFkZCIsIl91dWlkIiwiY2FsbGJhY2tzIiwicmVtb3ZlIiwiaSIsImwiLCJsZW5ndGgiLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7O0FBQUE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQXdCQSxJQUFNQSxNQUFNLEdBQUdDLE9BQU8sQ0FBQyxVQUFELENBQXRCOztBQUNBLElBQU1DLEtBQUssR0FBR0QsT0FBTyxDQUFDLFNBQUQsQ0FBckI7O2VBQ21CQSxPQUFPLENBQUMsVUFBRDtJQUFsQkUsa0JBQUFBOztBQUVSLElBQU1DLFNBQVMsR0FBRyxJQUFJRixLQUFKLEVBQWxCOztBQUVBLFNBQVNHLGFBQVQsQ0FBd0JD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STtBQU1kLFVBQVNBLGFBTks7QUFPZCxVQUFTQSxhQVBLO0FBUWQsV0FBVUEsYUFSSTtBQVNkLFdBQVVBLGFBVEk7QUFVZCxZQUFXQSxhQVZHO0FBV2QsVUFBUUEsYUFYTTtBQVlkLFVBQVFBLGFBWk07QUFjZDtBQUNBLFVBQVNZLGVBZks7QUFnQmQsVUFBU0EsZUFoQks7QUFpQmQsVUFBU0EsZUFqQks7QUFrQmQsVUFBU0EsZUFsQks7QUFvQmQ7QUFDQSxVQUFTTSxlQXJCSztBQXNCZCxVQUFTQSxlQXRCSztBQXVCZCxVQUFTQSxlQXZCSztBQXdCZCxVQUFTQSxlQXhCSztBQXlCZCxZQUFXQSxlQXpCRztBQTJCZCxVQUFTQSxlQTNCSztBQTRCZCxVQUFTQSxlQTVCSztBQTZCZCxVQUFTQSxlQTdCSztBQStCZCxXQUFVSCxlQS9CSTtBQWdDZCxpQkFBZ0JBLGVBaENGO0FBa0NkO0FBQ0EsV0FBVU0sVUFuQ0k7QUFvQ2QsVUFBU0EsVUFwQ0s7QUFxQ2QsVUFBU0EsVUFyQ0s7QUFzQ2QsV0FBVUEsVUF0Q0k7QUF1Q2QsVUFBU0EsVUF2Q0s7QUF3Q2QsVUFBU0EsVUF4Q0s7QUEwQ2Q7QUFDQSxhQUFXRSxpQkEzQ0c7QUE0Q2QsVUFBUUEsaUJBNUNNO0FBNkNkLFlBQVVBLGlCQTdDSTtBQThDZCxXQUFTQSxpQkE5Q0s7QUFnRGQsWUFBVUksWUFoREk7QUFrRGQsYUFBV0Y7QUFsREcsQ0FBbEI7QUFzREEwQixNQUFNLENBQUNDLE9BQVAsR0FBaUJyQixPQUFqQiIsInNvdXJjZXNDb250ZW50IjpbIi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXG4gQ29weXJpZ2h0IChjKSAyMDIwIFhpYW1lbiBZYWppIFNvZnR3YXJlIENvLiwgTHRkLlxuXG4gaHR0cHM6Ly93d3cuY29jb3MuY29tL1xuXG4gUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weVxuIG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZW5naW5lIHNvdXJjZSBjb2RlICh0aGUgXCJTb2Z0d2FyZVwiKSwgYSBsaW1pdGVkLFxuICB3b3JsZHdpZGUsIHJveWFsdHktZnJlZSwgbm9uLWFzc2lnbmFibGUsIHJldm9jYWJsZSBhbmQgbm9uLWV4Y2x1c2l2ZSBsaWNlbnNlXG4gdG8gdXNlIENvY29zIENyZWF0b3Igc29sZWx5IHRvIGRldmVsb3AgZ2FtZXMgb24geW91ciB0YXJnZXQgcGxhdGZvcm1zLiBZb3Ugc2hhbGxcbiAgbm90IHVzZSBDb2NvcyBDcmVhdG9yIHNvZnR3YXJlIGZvciBkZXZlbG9waW5nIG90aGVyIHNvZnR3YXJlIG9yIHRvb2xzIHRoYXQnc1xuICB1c2VkIGZvciBkZXZlbG9waW5nIGdhbWVzLiBZb3UgYXJlIG5vdCBncmFudGVkIHRvIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsXG4gIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsIGNvcGllcyBvZiBDb2NvcyBDcmVhdG9yLlxuXG4gVGhlIHNvZnR3YXJlIG9yIHRvb2xzIGluIHRoaXMgTGljZW5zZSBBZ3JlZW1lbnQgYXJlIGxpY2Vuc2VkLCBub3Qgc29sZC5cbiBYaWFtZW4gWWFqaSBTb2Z0d2FyZSBDby4sIEx0ZC4gcmVzZXJ2ZXMgYWxsIHJpZ2h0cyBub3QgZXhwcmVzc2x5IGdyYW50ZWQgdG8geW91LlxuXG4gVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUlxuIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLFxuIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRVxuIEFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVJcbiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLFxuIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU5cbiBUSEUgU09GVFdBUkUuXG4gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cbmNvbnN0IEJ1bmRsZSA9IHJlcXVpcmUoJy4vYnVuZGxlJyk7XG5jb25zdCBDYWNoZSA9IHJlcXVpcmUoJy4vY2FjaGUnKTtcbmNvbnN0IHsgYXNzZXRzIH0gPSByZXF1aXJlKCcuL3NoYXJlZCcpO1xuXG5jb25zdCBfY3JlYXRpbmcgPSBuZXcgQ2FjaGUoKTtcblxuZnVuY3Rpb24gY3JlYXRlVGV4dHVyZSAoaWQsIGRhdGEsIG9wdGlvbnMsIG9uQ29tcGxldGUpIHtcbiAgICBsZXQgb3V0ID0gbnVsbCwgZXJyID0gbnVsbDtcbiAgICB0cnkge1xuICAgICAgICBvdXQgPSBuZXcgY2MuVGV4dHVyZTJEKCk7XG4gICAgICAgIG91dC5fbmF0aXZlVXJsID0gaWQ7XG4gICAgICAgIG91dC5fbmF0aXZlQXNzZXQgPSBkYXRhO1xuICAgIH1cbiAgICBjYXRjaCAoZSkge1xuICAgICAgICBlcnIgPSBlO1xuICAgIH1cbiAgICBvbkNvbXBsZXRlICYmIG9uQ29tcGxldGUoZXJyLCBvdXQpO1xufVxuXG5mdW5jdGlvbiBjcmVhdGVBdWRpb0NsaXAgKGlkLCBkYXRhLCBvcHRpb25zLCBvbkNvbXBsZXRlKSB7XG4gICAgbGV0IG91dCA9IG5ldyBjYy5BdWRpb0NsaXAoKTtcbiAgICBvdXQuX25hdGl2ZVVybCA9IGlkO1xuICAgIG91dC5fbmF0aXZlQXNzZXQgPSBkYXRhO1xuICAgIG91dC5kdXJhdGlvbiA9IGRhdGEuZHVyYXRpb247XG4gICAgb25Db21wbGV0ZSAmJiBvbkNvbXBsZXRlKG51bGwsIG91dCk7XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZUpzb25Bc3NldCAoaWQsIGRhdGEsIG9wdGlvbnMsIG9uQ29tcGxldGUpIHtcbiAgICBsZXQgb3V0ID0gbmV3IGNjLkpzb25Bc3NldCgpO1xuICAgIG91dC5qc29uID0gZGF0YTtcbiAgICBvbkNvbXBsZXRlICYmIG9uQ29tcGxldGUobnVsbCwgb3V0KTtcbn1cblxuZnVuY3Rpb24gY3JlYXRlVGV4dEFzc2V0IChpZCwgZGF0YSwgb3B0aW9ucywgb25Db21wbGV0ZSkge1xuICAgIGxldCBvdXQgPSBuZXcgY2MuVGV4dEFzc2V0KCk7XG4gICAgb3V0LnRleHQgPSBkYXRhO1xuICAgIG9uQ29tcGxldGUgJiYgb25Db21wbGV0ZShudWxsLCBvdXQpO1xufVxuXG5mdW5jdGlvbiBjcmVhdGVGb250IChpZCwgZGF0YSwgb3B0aW9ucywgb25Db21wbGV0ZSkge1xuICAgIGxldCBvdXQgPSBuZXcgY2MuVFRGRm9udCgpO1xuICAgIG91dC5fbmF0aXZlVXJsID0gaWQ7XG4gICAgb3V0Ll9uYXRpdmVBc3NldCA9IGRhdGE7XG4gICAgb25Db21wbGV0ZSAmJiBvbkNvbXBsZXRlKG51bGwsIG91dCk7XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZUJ1ZmZlckFzc2V0IChpZCwgZGF0YSwgb3B0aW9ucywgb25Db21wbGV0ZSkge1xuICAgIGxldCBvdXQgPSBuZXcgY2MuQnVmZmVyQXNzZXQoKTtcbiAgICBvdXQuX25hdGl2ZVVybCA9IGlkO1xuICAgIG91dC5fbmF0aXZlQXNzZXQgPSBkYXRhO1xuICAgIG9uQ29tcGxldGUgJiYgb25Db21wbGV0ZShudWxsLCBvdXQpO1xufVxuXG5mdW5jdGlvbiBjcmVhdGVBc3NldCAoaWQsIGRhdGEsIG9wdGlvbnMsIG9uQ29tcGxldGUpIHtcbiAgICBsZXQgb3V0ID0gbmV3IGNjLkFzc2V0KCk7XG4gICAgb3V0Ll9uYXRpdmVVcmwgPSBpZDtcbiAgICBvdXQuX25hdGl2ZUFzc2V0ID0gZGF0YTtcbiAgICBvbkNvbXBsZXRlICYmIG9uQ29tcGxldGUobnVsbCwgb3V0KTtcbn1cblxuZnVuY3Rpb24gY3JlYXRlQnVuZGxlIChpZCwgZGF0YSwgb3B0aW9ucywgb25Db21wbGV0ZSkge1xuICAgIGxldCBidW5kbGUgPSBuZXcgQnVuZGxlKCk7XG4gICAgZGF0YS5iYXNlID0gZGF0YS5iYXNlIHx8IGlkICsgJy8nO1xuICAgIGJ1bmRsZS5pbml0KGRhdGEpO1xuICAgIG9uQ29tcGxldGUgJiYgb25Db21wbGV0ZShudWxsLCBidW5kbGUpO1xufVxuXG5jb25zdCBmYWN0b3J5ID0ge1xuXG4gICAgcmVnaXN0ZXIgKHR5cGUsIGhhbmRsZXIpIHtcbiAgICAgICAgaWYgKHR5cGVvZiB0eXBlID09PSAnb2JqZWN0Jykge1xuICAgICAgICAgICAgY2MuanMubWl4aW4ocHJvZHVjZXJzLCB0eXBlKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHByb2R1Y2Vyc1t0eXBlXSA9IGhhbmRsZXI7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgY3JlYXRlIChpZCwgZGF0YSwgdHlwZSwgb3B0aW9ucywgb25Db21wbGV0ZSkge1xuICAgICAgICB2YXIgZnVuYyA9IHByb2R1Y2Vyc1t0eXBlXSB8fCBwcm9kdWNlcnNbJ2RlZmF1bHQnXTtcbiAgICAgICAgbGV0IGFzc2V0LCBjcmVhdGluZztcbiAgICAgICAgaWYgKGFzc2V0ID0gYXNzZXRzLmdldChpZCkpIHtcbiAgICAgICAgICAgIG9uQ29tcGxldGUobnVsbCwgYXNzZXQpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGNyZWF0aW5nID0gX2NyZWF0aW5nLmdldChpZCkpIHtcbiAgICAgICAgICAgIGNyZWF0aW5nLnB1c2gob25Db21wbGV0ZSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBfY3JlYXRpbmcuYWRkKGlkLCBbb25Db21wbGV0ZV0pO1xuICAgICAgICAgICAgZnVuYyhpZCwgZGF0YSwgb3B0aW9ucywgZnVuY3Rpb24gKGVyciwgZGF0YSkge1xuICAgICAgICAgICAgICAgIGlmICghZXJyICYmIGRhdGEgaW5zdGFuY2VvZiBjYy5Bc3NldCkge1xuICAgICAgICAgICAgICAgICAgICBkYXRhLl91dWlkID0gaWQ7XG4gICAgICAgICAgICAgICAgICAgIGFzc2V0cy5hZGQoaWQsIGRhdGEpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBsZXQgY2FsbGJhY2tzID0gX2NyZWF0aW5nLnJlbW92ZShpZCk7XG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSBjYWxsYmFja3MubGVuZ3RoOyBpIDwgbDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrc1tpXShlcnIsIGRhdGEpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxufTtcblxuY29uc3QgcHJvZHVjZXJzID0ge1xuICAgIC8vIEltYWdlc1xuICAgICcucG5nJyA6IGNyZWF0ZVRleHR1cmUsXG4gICAgJy5qcGcnIDogY3JlYXRlVGV4dHVyZSxcbiAgICAnLmJtcCcgOiBjcmVhdGVUZXh0dXJlLFxuICAgICcuanBlZycgOiBjcmVhdGVUZXh0dXJlLFxuICAgICcuZ2lmJyA6IGNyZWF0ZVRleHR1cmUsXG4gICAgJy5pY28nIDogY3JlYXRlVGV4dHVyZSxcbiAgICAnLnRpZmYnIDogY3JlYXRlVGV4dHVyZSxcbiAgICAnLndlYnAnIDogY3JlYXRlVGV4dHVyZSxcbiAgICAnLmltYWdlJyA6IGNyZWF0ZVRleHR1cmUsXG4gICAgJy5wdnInOiBjcmVhdGVUZXh0dXJlLFxuICAgICcucGttJzogY3JlYXRlVGV4dHVyZSxcblxuICAgIC8vIEF1ZGlvXG4gICAgJy5tcDMnIDogY3JlYXRlQXVkaW9DbGlwLFxuICAgICcub2dnJyA6IGNyZWF0ZUF1ZGlvQ2xpcCxcbiAgICAnLndhdicgOiBjcmVhdGVBdWRpb0NsaXAsXG4gICAgJy5tNGEnIDogY3JlYXRlQXVkaW9DbGlwLFxuXG4gICAgLy8gVHh0XG4gICAgJy50eHQnIDogY3JlYXRlVGV4dEFzc2V0LFxuICAgICcueG1sJyA6IGNyZWF0ZVRleHRBc3NldCxcbiAgICAnLnZzaCcgOiBjcmVhdGVUZXh0QXNzZXQsXG4gICAgJy5mc2gnIDogY3JlYXRlVGV4dEFzc2V0LFxuICAgICcuYXRsYXMnIDogY3JlYXRlVGV4dEFzc2V0LFxuXG4gICAgJy50bXgnIDogY3JlYXRlVGV4dEFzc2V0LFxuICAgICcudHN4JyA6IGNyZWF0ZVRleHRBc3NldCxcbiAgICAnLmZudCcgOiBjcmVhdGVUZXh0QXNzZXQsXG5cbiAgICAnLmpzb24nIDogY3JlYXRlSnNvbkFzc2V0LFxuICAgICcuRXhwb3J0SnNvbicgOiBjcmVhdGVKc29uQXNzZXQsXG5cbiAgICAvLyBmb250XG4gICAgJy5mb250JyA6IGNyZWF0ZUZvbnQsXG4gICAgJy5lb3QnIDogY3JlYXRlRm9udCxcbiAgICAnLnR0ZicgOiBjcmVhdGVGb250LFxuICAgICcud29mZicgOiBjcmVhdGVGb250LFxuICAgICcuc3ZnJyA6IGNyZWF0ZUZvbnQsXG4gICAgJy50dGMnIDogY3JlYXRlRm9udCxcblxuICAgIC8vIEJpbmFyeVxuICAgICcuYmluYXJ5JzogY3JlYXRlQnVmZmVyQXNzZXQsXG4gICAgJy5iaW4nOiBjcmVhdGVCdWZmZXJBc3NldCxcbiAgICAnLmRiYmluJzogY3JlYXRlQnVmZmVyQXNzZXQsXG4gICAgJy5za2VsJzogY3JlYXRlQnVmZmVyQXNzZXQsXG5cbiAgICAnYnVuZGxlJzogY3JlYXRlQnVuZGxlLFxuXG4gICAgJ2RlZmF1bHQnOiBjcmVhdGVBc3NldFxuXG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IGZhY3Rvcnk7XG4iXSwic291cmNlUm9vdCI6Ii8ifQ==