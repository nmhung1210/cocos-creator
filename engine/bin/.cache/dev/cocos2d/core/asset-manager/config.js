
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'engine-dev/cocos2d/core/asset-manager/config.js';
                    var __require = nodeEnv ? function (request) {
                        return require(request);
                    } : function (request) {
                        return __quick_compile_engine__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_engine__.registerModule(__filename, module);}"use strict";

/****************************************************************************
 Copyright (c) 2019 Xiamen Yaji Software Co., Ltd.

 https://www.cocos.com/

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated engine source code (the "Software"), a limited,
  worldwide, royalty-free, non-assignable, revocable and non-exclusive license
 to use Cocos Creator solely to develop games on your target platforms. You shall
  not use Cocos Creator software for developing other software or tools that's
  used for developing games. You are not granted to publish, distribute,
  sublicense, and/or sell copies of Cocos Creator.

 The software or tools in this License Agreement are licensed, not sold.
 Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 THE SOFTWARE.
 ****************************************************************************/
var js = require('../platform/js');

var Cache = require('./cache');

var _require = require('./helper'),
    normalize = _require.normalize;

var _require2 = require('./utilities'),
    processOptions = _require2.processOptions;

function Config() {
  this.name = '';
  this.base = '';
  this.importBase = '';
  this.nativeBase = '';
  this.deps = null;
  this.assetInfos = new Cache();
  this.scenes = new Cache();
  this.paths = new Cache();
}

Config.prototype = {
  constructor: Config,
  init: function init(options) {
    processOptions(options);
    this.importBase = options.importBase || '';
    this.nativeBase = options.nativeBase || '';
    this.base = options.base || '';
    this.name = options.name || '';
    this.deps = options.deps || []; // init

    this._initUuid(options.uuids);

    this._initPath(options.paths);

    this._initScene(options.scenes);

    this._initPackage(options.packs);

    this._initVersion(options.versions);

    this._initRedirect(options.redirect);
  },
  _initUuid: function _initUuid(uuidList) {
    if (!uuidList) return;
    this.assetInfos.clear();

    for (var i = 0, l = uuidList.length; i < l; i++) {
      var uuid = uuidList[i];
      this.assetInfos.add(uuid, {
        uuid: uuid
      });
    }
  },
  _initPath: function _initPath(pathList) {
    if (!pathList) return;
    var paths = this.paths;
    paths.clear();

    for (var uuid in pathList) {
      var info = pathList[uuid];
      var path = info[0];
      var type = info[1];
      var isSubAsset = info.length === 3;
      var assetInfo = this.assetInfos.get(uuid);
      assetInfo.path = path;
      assetInfo.ctor = js._getClassById(type);

      if (paths.has(path)) {
        if (isSubAsset) {
          paths.get(path).push(assetInfo);
        } else {
          paths.get(path).splice(0, 0, assetInfo);
        }
      } else {
        paths.add(path, [assetInfo]);
      }
    }
  },
  _initScene: function _initScene(sceneList) {
    if (!sceneList) return;
    var scenes = this.scenes;
    scenes.clear();
    var assetInfos = this.assetInfos;

    for (var sceneName in sceneList) {
      var uuid = sceneList[sceneName];
      var assetInfo = assetInfos.get(uuid);
      assetInfo.url = sceneName;
      scenes.add(sceneName, assetInfo);
    }
  },
  _initPackage: function _initPackage(packageList) {
    if (!packageList) return;
    var assetInfos = this.assetInfos;

    for (var packUuid in packageList) {
      var uuids = packageList[packUuid];
      var pack = {
        uuid: packUuid,
        packs: uuids,
        ext: '.json'
      };
      assetInfos.add(packUuid, pack);

      for (var i = 0, l = uuids.length; i < l; i++) {
        var uuid = uuids[i];
        var assetInfo = assetInfos.get(uuid);
        var assetPacks = assetInfo.packs;

        if (assetPacks) {
          if (l === 1) {
            assetPacks.splice(0, 0, pack);
          } else {
            assetPacks.push(pack);
          }
        } else {
          assetInfo.packs = [pack];
        }
      }
    }
  },
  _initVersion: function _initVersion(versions) {
    if (!versions) return;
    var assetInfos = this.assetInfos;
    var entries = versions["import"];

    if (entries) {
      for (var i = 0, l = entries.length; i < l; i += 2) {
        var uuid = entries[i];
        var assetInfo = assetInfos.get(uuid);
        assetInfo.ver = entries[i + 1];
      }
    }

    entries = versions["native"];

    if (entries) {
      for (var i = 0, l = entries.length; i < l; i += 2) {
        var uuid = entries[i];
        var assetInfo = assetInfos.get(uuid);
        assetInfo.nativeVer = entries[i + 1];
      }
    }
  },
  _initRedirect: function _initRedirect(redirect) {
    if (!redirect) return;
    var assetInfos = this.assetInfos;

    for (var i = 0, l = redirect.length; i < l; i += 2) {
      var uuid = redirect[i];
      var assetInfo = assetInfos.get(uuid);
      assetInfo.redirect = redirect[i + 1];
    }
  },
  getInfoWithPath: function getInfoWithPath(path, type) {
    if (!path) {
      return null;
    }

    path = normalize(path);
    var items = this.paths.get(path);

    if (items) {
      if (type) {
        for (var i = 0, l = items.length; i < l; i++) {
          var assetInfo = items[i];

          if (js.isChildClassOf(assetInfo.ctor, type)) {
            return assetInfo;
          }
        }
      } else {
        return items[0];
      }
    }

    return null;
  },
  getDirWithPath: function getDirWithPath(path, type, out) {
    path = normalize(path);

    if (path[path.length - 1] === '/') {
      path = path.slice(0, -1);
    }

    var infos = out || [];

    function isMatchByWord(path, test) {
      if (path.length > test.length) {
        var nextAscii = path.charCodeAt(test.length);
        return nextAscii === 47; // '/'
      }

      return true;
    }

    this.paths.forEach(function (items, p) {
      if (p.startsWith(path) && isMatchByWord(p, path) || !path) {
        for (var i = 0, l = items.length; i < l; i++) {
          var entry = items[i];

          if (!type || js.isChildClassOf(entry.ctor, type)) {
            infos.push(entry);
          }
        }
      }
    });
    return infos;
  },
  getAssetInfo: function getAssetInfo(uuid) {
    return this.assetInfos.get(uuid);
  },
  getSceneInfo: function getSceneInfo(name) {
    if (!name.endsWith('.fire')) {
      name += '.fire';
    }

    if (name[0] !== '/' && !name.startsWith('db://')) {
      name = '/' + name; // 使用全名匹配
    } // search scene


    var info = this.scenes.find(function (val, key) {
      return key.endsWith(name);
    });
    return info;
  },
  destroy: function destroy() {
    this.paths.destroy();
    this.scenes.destroy();
    this.assetInfos.destroy();
  }
};

if (CC_TEST) {
  cc._Test.Config = Config;
}

module.exports = Config;
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_engine__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImVuZ2luZS1kZXYvY29jb3MyZC9jb3JlL2Fzc2V0LW1hbmFnZXIvY29uZmlnLmpzIl0sIm5hbWVzIjpbImpzIiwicmVxdWlyZSIsIkNhY2hlIiwibm9ybWFsaXplIiwicHJvY2Vzc09wdGlvbnMiLCJDb25maWciLCJuYW1lIiwiYmFzZSIsImltcG9ydEJhc2UiLCJuYXRpdmVCYXNlIiwiZGVwcyIsImFzc2V0SW5mb3MiLCJzY2VuZXMiLCJwYXRocyIsInByb3RvdHlwZSIsImNvbnN0cnVjdG9yIiwiaW5pdCIsIm9wdGlvbnMiLCJfaW5pdFV1aWQiLCJ1dWlkcyIsIl9pbml0UGF0aCIsIl9pbml0U2NlbmUiLCJfaW5pdFBhY2thZ2UiLCJwYWNrcyIsIl9pbml0VmVyc2lvbiIsInZlcnNpb25zIiwiX2luaXRSZWRpcmVjdCIsInJlZGlyZWN0IiwidXVpZExpc3QiLCJjbGVhciIsImkiLCJsIiwibGVuZ3RoIiwidXVpZCIsImFkZCIsInBhdGhMaXN0IiwiaW5mbyIsInBhdGgiLCJ0eXBlIiwiaXNTdWJBc3NldCIsImFzc2V0SW5mbyIsImdldCIsImN0b3IiLCJfZ2V0Q2xhc3NCeUlkIiwiaGFzIiwicHVzaCIsInNwbGljZSIsInNjZW5lTGlzdCIsInNjZW5lTmFtZSIsInVybCIsInBhY2thZ2VMaXN0IiwicGFja1V1aWQiLCJwYWNrIiwiZXh0IiwiYXNzZXRQYWNrcyIsImVudHJpZXMiLCJ2ZXIiLCJuYXRpdmVWZXIiLCJnZXRJbmZvV2l0aFBhdGgiLCJpdGVtcyIsImlzQ2hpbGRDbGFzc09mIiwiZ2V0RGlyV2l0aFBhdGgiLCJvdXQiLCJzbGljZSIsImluZm9zIiwiaXNNYXRjaEJ5V29yZCIsInRlc3QiLCJuZXh0QXNjaWkiLCJjaGFyQ29kZUF0IiwiZm9yRWFjaCIsInAiLCJzdGFydHNXaXRoIiwiZW50cnkiLCJnZXRBc3NldEluZm8iLCJnZXRTY2VuZUluZm8iLCJlbmRzV2l0aCIsImZpbmQiLCJ2YWwiLCJrZXkiLCJkZXN0cm95IiwiQ0NfVEVTVCIsImNj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UDtBQUNILEtBRlUsQ0FBWDtBQUdBLFdBQU84QixJQUFQO0FBQ0gsR0FuTWM7QUFxTWYyQyxFQUFBQSxPQUFPLEVBQUUsbUJBQVk7QUFDakIsU0FBS2xFLEtBQUwsQ0FBV2tFLE9BQVg7QUFDQSxTQUFLbkUsTUFBTCxDQUFZbUUsT0FBWjtBQUNBLFNBQUtwRSxVQUFMLENBQWdCb0UsT0FBaEI7QUFDSDtBQXpNYyxDQUFuQjs7QUE0TUEsSUFBSUMsT0FBSixFQUFhO0FBQ1RDLEVBQUFBLEVBQUUsQ0FBQ0MsS0FBSCxDQUFTN0UsTUFBVCxHQUFrQkEsTUFBbEI7QUFDSDs7QUFFRDhFLE1BQU0sQ0FBQ0MsT0FBUCxHQUFpQi9FLE1BQWpCIiwic291cmNlc0NvbnRlbnQiOlsiLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcbiBDb3B5cmlnaHQgKGMpIDIwMTkgWGlhbWVuIFlhamkgU29mdHdhcmUgQ28uLCBMdGQuXG5cbiBodHRwczovL3d3dy5jb2Nvcy5jb20vXG5cbiBQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5XG4gb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBlbmdpbmUgc291cmNlIGNvZGUgKHRoZSBcIlNvZnR3YXJlXCIpLCBhIGxpbWl0ZWQsXG4gIHdvcmxkd2lkZSwgcm95YWx0eS1mcmVlLCBub24tYXNzaWduYWJsZSwgcmV2b2NhYmxlIGFuZCBub24tZXhjbHVzaXZlIGxpY2Vuc2VcbiB0byB1c2UgQ29jb3MgQ3JlYXRvciBzb2xlbHkgdG8gZGV2ZWxvcCBnYW1lcyBvbiB5b3VyIHRhcmdldCBwbGF0Zm9ybXMuIFlvdSBzaGFsbFxuICBub3QgdXNlIENvY29zIENyZWF0b3Igc29mdHdhcmUgZm9yIGRldmVsb3Bpbmcgb3RoZXIgc29mdHdhcmUgb3IgdG9vbHMgdGhhdCdzXG4gIHVzZWQgZm9yIGRldmVsb3BpbmcgZ2FtZXMuIFlvdSBhcmUgbm90IGdyYW50ZWQgdG8gcHVibGlzaCwgZGlzdHJpYnV0ZSxcbiAgc3VibGljZW5zZSwgYW5kL29yIHNlbGwgY29waWVzIG9mIENvY29zIENyZWF0b3IuXG5cbiBUaGUgc29mdHdhcmUgb3IgdG9vbHMgaW4gdGhpcyBMaWNlbnNlIEFncmVlbWVudCBhcmUgbGljZW5zZWQsIG5vdCBzb2xkLlxuIFhpYW1lbiBZYWppIFNvZnR3YXJlIENvLiwgTHRkLiByZXNlcnZlcyBhbGwgcmlnaHRzIG5vdCBleHByZXNzbHkgZ3JhbnRlZCB0byB5b3UuXG5cbiBUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgXCJBUyBJU1wiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SXG4gSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksXG4gRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFXG4gQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUlxuIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sXG4gT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTlxuIFRIRSBTT0ZUV0FSRS5cbiAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xuY29uc3QganMgPSByZXF1aXJlKCcuLi9wbGF0Zm9ybS9qcycpO1xuY29uc3QgQ2FjaGUgPSByZXF1aXJlKCcuL2NhY2hlJyk7XG5jb25zdCB7IG5vcm1hbGl6ZSB9ID0gcmVxdWlyZSgnLi9oZWxwZXInKTtcbmNvbnN0IHsgcHJvY2Vzc09wdGlvbnMgfSA9IHJlcXVpcmUoJy4vdXRpbGl0aWVzJyk7XG5cbmZ1bmN0aW9uIENvbmZpZyAoKSB7XG5cbiAgICB0aGlzLm5hbWUgPSAnJztcblxuICAgIHRoaXMuYmFzZSA9ICcnO1xuXG4gICAgdGhpcy5pbXBvcnRCYXNlID0gJyc7XG5cbiAgICB0aGlzLm5hdGl2ZUJhc2UgPSAnJztcblxuICAgIHRoaXMuZGVwcyA9IG51bGw7XG5cbiAgICB0aGlzLmFzc2V0SW5mb3MgPSBuZXcgQ2FjaGUoKTtcblxuICAgIHRoaXMuc2NlbmVzID0gbmV3IENhY2hlKCk7XG5cbiAgICB0aGlzLnBhdGhzID0gbmV3IENhY2hlKCk7XG59XG5cbkNvbmZpZy5wcm90b3R5cGUgPSB7XG5cbiAgICBjb25zdHJ1Y3RvcjogQ29uZmlnLFxuXG4gICAgaW5pdDogZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICAgICAgcHJvY2Vzc09wdGlvbnMob3B0aW9ucyk7XG5cbiAgICAgICAgdGhpcy5pbXBvcnRCYXNlID0gb3B0aW9ucy5pbXBvcnRCYXNlIHx8ICcnO1xuICAgICAgICB0aGlzLm5hdGl2ZUJhc2UgPSBvcHRpb25zLm5hdGl2ZUJhc2UgfHwgJyc7XG4gICAgICAgIHRoaXMuYmFzZSA9IG9wdGlvbnMuYmFzZSB8fCAnJztcbiAgICAgICAgdGhpcy5uYW1lID0gb3B0aW9ucy5uYW1lIHx8ICcnO1xuICAgICAgICB0aGlzLmRlcHMgPSBvcHRpb25zLmRlcHMgfHwgW107XG4gICAgICAgIC8vIGluaXRcbiAgICAgICAgdGhpcy5faW5pdFV1aWQob3B0aW9ucy51dWlkcyk7XG4gICAgICAgIHRoaXMuX2luaXRQYXRoKG9wdGlvbnMucGF0aHMpO1xuICAgICAgICB0aGlzLl9pbml0U2NlbmUob3B0aW9ucy5zY2VuZXMpO1xuICAgICAgICB0aGlzLl9pbml0UGFja2FnZShvcHRpb25zLnBhY2tzKTtcbiAgICAgICAgdGhpcy5faW5pdFZlcnNpb24ob3B0aW9ucy52ZXJzaW9ucyk7XG4gICAgICAgIHRoaXMuX2luaXRSZWRpcmVjdChvcHRpb25zLnJlZGlyZWN0KTtcbiAgICB9LFxuXG4gICAgX2luaXRVdWlkOiBmdW5jdGlvbiAodXVpZExpc3QpIHtcbiAgICAgICAgaWYgKCF1dWlkTGlzdCkgcmV0dXJuO1xuICAgICAgICB0aGlzLmFzc2V0SW5mb3MuY2xlYXIoKTtcbiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGwgPSB1dWlkTGlzdC5sZW5ndGg7IGkgPCBsOyBpKyspIHtcbiAgICAgICAgICAgIHZhciB1dWlkID0gdXVpZExpc3RbaV07XG4gICAgICAgICAgICB0aGlzLmFzc2V0SW5mb3MuYWRkKHV1aWQsIHt1dWlkfSk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgX2luaXRQYXRoOiBmdW5jdGlvbiAocGF0aExpc3QpIHtcbiAgICAgICAgaWYgKCFwYXRoTGlzdCkgcmV0dXJuO1xuICAgICAgICB2YXIgcGF0aHMgPSB0aGlzLnBhdGhzO1xuICAgICAgICBwYXRocy5jbGVhcigpO1xuICAgICAgICBmb3IgKHZhciB1dWlkIGluIHBhdGhMaXN0KSB7XG4gICAgICAgICAgICB2YXIgaW5mbyA9IHBhdGhMaXN0W3V1aWRdO1xuICAgICAgICAgICAgdmFyIHBhdGggPSBpbmZvWzBdO1xuICAgICAgICAgICAgdmFyIHR5cGUgPSBpbmZvWzFdO1xuICAgICAgICAgICAgdmFyIGlzU3ViQXNzZXQgPSBpbmZvLmxlbmd0aCA9PT0gMztcblxuICAgICAgICAgICAgdmFyIGFzc2V0SW5mbyA9IHRoaXMuYXNzZXRJbmZvcy5nZXQodXVpZCk7XG4gICAgICAgICAgICBhc3NldEluZm8ucGF0aCA9IHBhdGg7XG4gICAgICAgICAgICBhc3NldEluZm8uY3RvciA9IGpzLl9nZXRDbGFzc0J5SWQodHlwZSk7XG4gICAgICAgICAgICBpZiAocGF0aHMuaGFzKHBhdGgpKSB7XG4gICAgICAgICAgICAgICAgaWYgKGlzU3ViQXNzZXQpIHtcbiAgICAgICAgICAgICAgICAgICAgcGF0aHMuZ2V0KHBhdGgpLnB1c2goYXNzZXRJbmZvKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHBhdGhzLmdldChwYXRoKS5zcGxpY2UoMCwgMCwgYXNzZXRJbmZvKTtcbiAgICAgICAgICAgICAgICB9IFxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcGF0aHMuYWRkKHBhdGgsIFthc3NldEluZm9dKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBfaW5pdFNjZW5lOiBmdW5jdGlvbiAoc2NlbmVMaXN0KSB7XG4gICAgICAgIGlmICghc2NlbmVMaXN0KSByZXR1cm47XG4gICAgICAgIHZhciBzY2VuZXMgPSB0aGlzLnNjZW5lcztcbiAgICAgICAgc2NlbmVzLmNsZWFyKCk7XG4gICAgICAgIHZhciBhc3NldEluZm9zID0gdGhpcy5hc3NldEluZm9zO1xuICAgICAgICBmb3IgKHZhciBzY2VuZU5hbWUgaW4gc2NlbmVMaXN0KSB7XG4gICAgICAgICAgICB2YXIgdXVpZCA9IHNjZW5lTGlzdFtzY2VuZU5hbWVdO1xuICAgICAgICAgICAgdmFyIGFzc2V0SW5mbyA9IGFzc2V0SW5mb3MuZ2V0KHV1aWQpO1xuICAgICAgICAgICAgYXNzZXRJbmZvLnVybCA9IHNjZW5lTmFtZTtcbiAgICAgICAgICAgIHNjZW5lcy5hZGQoc2NlbmVOYW1lLCBhc3NldEluZm8pO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIF9pbml0UGFja2FnZTogZnVuY3Rpb24gKHBhY2thZ2VMaXN0KSB7XG4gICAgICAgIGlmICghcGFja2FnZUxpc3QpIHJldHVybjtcbiAgICAgICAgdmFyIGFzc2V0SW5mb3MgPSB0aGlzLmFzc2V0SW5mb3M7XG4gICAgICAgIGZvciAodmFyIHBhY2tVdWlkIGluIHBhY2thZ2VMaXN0KSB7XG4gICAgICAgICAgICB2YXIgdXVpZHMgPSBwYWNrYWdlTGlzdFtwYWNrVXVpZF07XG4gICAgICAgICAgICB2YXIgcGFjayA9IHt1dWlkOiBwYWNrVXVpZCwgcGFja3M6IHV1aWRzLCBleHQ6Jy5qc29uJ307XG4gICAgICAgICAgICBhc3NldEluZm9zLmFkZChwYWNrVXVpZCwgcGFjayk7XG5cbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBsID0gdXVpZHMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgdmFyIHV1aWQgPSB1dWlkc1tpXTtcbiAgICAgICAgICAgICAgICB2YXIgYXNzZXRJbmZvID0gYXNzZXRJbmZvcy5nZXQodXVpZCk7XG4gICAgICAgICAgICAgICAgdmFyIGFzc2V0UGFja3MgPSBhc3NldEluZm8ucGFja3M7XG4gICAgICAgICAgICAgICAgaWYgKGFzc2V0UGFja3MpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGwgPT09IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFzc2V0UGFja3Muc3BsaWNlKDAsIDAsIHBhY2spO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgYXNzZXRQYWNrcy5wdXNoKHBhY2spO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBhc3NldEluZm8ucGFja3MgPSBbcGFja107XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSxcblxuICAgIF9pbml0VmVyc2lvbjogZnVuY3Rpb24gKHZlcnNpb25zKSB7XG4gICAgICAgIGlmICghdmVyc2lvbnMpIHJldHVybjtcbiAgICAgICAgdmFyIGFzc2V0SW5mb3MgPSB0aGlzLmFzc2V0SW5mb3M7XG4gICAgICAgIHZhciBlbnRyaWVzID0gdmVyc2lvbnMuaW1wb3J0O1xuICAgICAgICBpZiAoZW50cmllcykge1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGwgPSBlbnRyaWVzLmxlbmd0aDsgaSA8IGw7IGkgKz0gMikge1xuICAgICAgICAgICAgICAgIHZhciB1dWlkID0gZW50cmllc1tpXTtcbiAgICAgICAgICAgICAgICB2YXIgYXNzZXRJbmZvID0gYXNzZXRJbmZvcy5nZXQodXVpZCk7XG4gICAgICAgICAgICAgICAgYXNzZXRJbmZvLnZlciA9IGVudHJpZXNbaSArIDFdO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVudHJpZXMgPSB2ZXJzaW9ucy5uYXRpdmU7XG4gICAgICAgIGlmIChlbnRyaWVzKSB7XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgbCA9IGVudHJpZXMubGVuZ3RoOyBpIDwgbDsgaSArPSAyKSB7XG4gICAgICAgICAgICAgICAgdmFyIHV1aWQgPSBlbnRyaWVzW2ldO1xuICAgICAgICAgICAgICAgIHZhciBhc3NldEluZm8gPSBhc3NldEluZm9zLmdldCh1dWlkKTtcbiAgICAgICAgICAgICAgICBhc3NldEluZm8ubmF0aXZlVmVyID0gZW50cmllc1tpICsgMV07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgX2luaXRSZWRpcmVjdDogZnVuY3Rpb24gKHJlZGlyZWN0KSB7XG4gICAgICAgIGlmICghcmVkaXJlY3QpIHJldHVybjtcbiAgICAgICAgdmFyIGFzc2V0SW5mb3MgPSB0aGlzLmFzc2V0SW5mb3M7XG4gICAgICAgIGZvciAodmFyIGkgPSAwLCBsID0gcmVkaXJlY3QubGVuZ3RoOyBpIDwgbDsgaSArPSAyKSB7XG4gICAgICAgICAgICB2YXIgdXVpZCA9IHJlZGlyZWN0W2ldO1xuICAgICAgICAgICAgdmFyIGFzc2V0SW5mbyA9IGFzc2V0SW5mb3MuZ2V0KHV1aWQpO1xuICAgICAgICAgICAgYXNzZXRJbmZvLnJlZGlyZWN0ID0gcmVkaXJlY3RbaSArIDFdO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIGdldEluZm9XaXRoUGF0aDogZnVuY3Rpb24gKHBhdGgsIHR5cGUpIHtcblxuICAgICAgICBpZiAoIXBhdGgpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIHBhdGggPSBub3JtYWxpemUocGF0aCk7XG4gICAgICAgIHZhciBpdGVtcyA9IHRoaXMucGF0aHMuZ2V0KHBhdGgpO1xuICAgICAgICBpZiAoaXRlbXMpIHtcbiAgICAgICAgICAgIGlmICh0eXBlKSB7XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGwgPSBpdGVtcy5sZW5ndGg7IGkgPCBsOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGFzc2V0SW5mbyA9IGl0ZW1zW2ldO1xuICAgICAgICAgICAgICAgICAgICBpZiAoanMuaXNDaGlsZENsYXNzT2YoYXNzZXRJbmZvLmN0b3IsIHR5cGUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYXNzZXRJbmZvO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW1zWzBdO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH0sXG5cbiAgICBnZXREaXJXaXRoUGF0aDogZnVuY3Rpb24gKHBhdGgsIHR5cGUsIG91dCkge1xuICAgICAgICBwYXRoID0gbm9ybWFsaXplKHBhdGgpO1xuICAgICAgICBpZiAocGF0aFtwYXRoLmxlbmd0aCAtIDFdID09PSAnLycpIHtcbiAgICAgICAgICAgIHBhdGggPSBwYXRoLnNsaWNlKDAsIC0xKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBpbmZvcyA9IG91dCB8fCBbXTtcbiAgICAgICAgZnVuY3Rpb24gaXNNYXRjaEJ5V29yZCAocGF0aCwgdGVzdCkge1xuICAgICAgICAgICAgaWYgKHBhdGgubGVuZ3RoID4gdGVzdC5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICB2YXIgbmV4dEFzY2lpID0gcGF0aC5jaGFyQ29kZUF0KHRlc3QubGVuZ3RoKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV4dEFzY2lpID09PSA0NzsgLy8gJy8nXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnBhdGhzLmZvckVhY2goZnVuY3Rpb24gKGl0ZW1zLCBwKSB7XG4gICAgICAgICAgICBpZiAoKHAuc3RhcnRzV2l0aChwYXRoKSAmJiBpc01hdGNoQnlXb3JkKHAsIHBhdGgpKSB8fCAhcGF0aCkge1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBsID0gaXRlbXMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBlbnRyeSA9IGl0ZW1zW2ldO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIXR5cGUgfHwganMuaXNDaGlsZENsYXNzT2YoZW50cnkuY3RvciwgdHlwZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGluZm9zLnB1c2goZW50cnkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4gaW5mb3M7XG4gICAgfSxcblxuICAgIGdldEFzc2V0SW5mbzogZnVuY3Rpb24gKHV1aWQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYXNzZXRJbmZvcy5nZXQodXVpZCk7XG4gICAgfSxcblxuICAgIGdldFNjZW5lSW5mbzogZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgICAgaWYgKCFuYW1lLmVuZHNXaXRoKCcuZmlyZScpKSB7XG4gICAgICAgICAgICBuYW1lICs9ICcuZmlyZSc7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG5hbWVbMF0gIT09ICcvJyAmJiAhbmFtZS5zdGFydHNXaXRoKCdkYjovLycpKSB7XG4gICAgICAgICAgICBuYW1lID0gJy8nICsgbmFtZTsgICAgLy8g5L2/55So5YWo5ZCN5Yy56YWNXG4gICAgICAgIH1cbiAgICAgICAgLy8gc2VhcmNoIHNjZW5lXG4gICAgICAgIHZhciBpbmZvID0gdGhpcy5zY2VuZXMuZmluZChmdW5jdGlvbiAodmFsLCBrZXkpIHtcbiAgICAgICAgICAgIHJldHVybiBrZXkuZW5kc1dpdGgobmFtZSk7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gaW5mbztcbiAgICB9LFxuXG4gICAgZGVzdHJveTogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLnBhdGhzLmRlc3Ryb3koKTtcbiAgICAgICAgdGhpcy5zY2VuZXMuZGVzdHJveSgpO1xuICAgICAgICB0aGlzLmFzc2V0SW5mb3MuZGVzdHJveSgpO1xuICAgIH1cbn07XG5cbmlmIChDQ19URVNUKSB7XG4gICAgY2MuX1Rlc3QuQ29uZmlnID0gQ29uZmlnO1xufVxuXG5tb2R1bGUuZXhwb3J0cyA9IENvbmZpZzsiXSwic291cmNlUm9vdCI6Ii8ifQ==