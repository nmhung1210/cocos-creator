
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'engine-dev/cocos2d/core/renderer/webgl/assemblers/sprite/2d/sliced.js';
                    var __require = nodeEnv ? function (request) {
                        return require(request);
                    } : function (request) {
                        return __quick_compile_engine__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_engine__.registerModule(__filename, module);}"use strict";

exports.__esModule = true;
exports["default"] = void 0;

var _assembler2d = _interopRequireDefault(require("../../../../assembler-2d"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

function _inheritsLoose(subClass, superClass) { subClass.prototype = Object.create(superClass.prototype); subClass.prototype.constructor = subClass; subClass.__proto__ = superClass; }

var SlicedAssembler = /*#__PURE__*/function (_Assembler2D) {
  _inheritsLoose(SlicedAssembler, _Assembler2D);

  function SlicedAssembler() {
    return _Assembler2D.apply(this, arguments) || this;
  }

  var _proto = SlicedAssembler.prototype;

  _proto.initData = function initData(sprite) {
    if (this._renderData.meshCount > 0) return;

    this._renderData.createData(0, this.verticesFloats, this.indicesCount);

    var indices = this._renderData.iDatas[0];
    var indexOffset = 0;

    for (var r = 0; r < 3; ++r) {
      for (var c = 0; c < 3; ++c) {
        var start = r * 4 + c;
        indices[indexOffset++] = start;
        indices[indexOffset++] = start + 1;
        indices[indexOffset++] = start + 4;
        indices[indexOffset++] = start + 1;
        indices[indexOffset++] = start + 5;
        indices[indexOffset++] = start + 4;
      }
    }
  };

  _proto.initLocal = function initLocal() {
    this._local = [];
    this._local.length = 8;
  };

  _proto.updateRenderData = function updateRenderData(sprite) {
    var frame = sprite._spriteFrame;
    this.packToDynamicAtlas(sprite, frame);

    if (sprite._vertsDirty) {
      this.updateUVs(sprite);
      this.updateVerts(sprite);
      sprite._vertsDirty = false;
    }
  };

  _proto.updateVerts = function updateVerts(sprite) {
    var node = sprite.node,
        width = node.width,
        height = node.height,
        appx = node.anchorX * width,
        appy = node.anchorY * height;
    var frame = sprite.spriteFrame;
    var leftWidth = frame.insetLeft;
    var rightWidth = frame.insetRight;
    var topHeight = frame.insetTop;
    var bottomHeight = frame.insetBottom;
    var sizableWidth = width - leftWidth - rightWidth;
    var sizableHeight = height - topHeight - bottomHeight;
    var xScale = width / (leftWidth + rightWidth);
    var yScale = height / (topHeight + bottomHeight);
    xScale = isNaN(xScale) || xScale > 1 ? 1 : xScale;
    yScale = isNaN(yScale) || yScale > 1 ? 1 : yScale;
    sizableWidth = sizableWidth < 0 ? 0 : sizableWidth;
    sizableHeight = sizableHeight < 0 ? 0 : sizableHeight; // update local

    var local = this._local;
    local[0] = -appx;
    local[1] = -appy;
    local[2] = leftWidth * xScale - appx;
    local[3] = bottomHeight * yScale - appy;
    local[4] = local[2] + sizableWidth;
    local[5] = local[3] + sizableHeight;
    local[6] = width - appx;
    local[7] = height - appy;
    this.updateWorldVerts(sprite);
  };

  _proto.updateUVs = function updateUVs(sprite) {
    var verts = this._renderData.vDatas[0];
    var uvSliced = sprite.spriteFrame.uvSliced;
    var uvOffset = this.uvOffset;
    var floatsPerVert = this.floatsPerVert;

    for (var row = 0; row < 4; ++row) {
      for (var col = 0; col < 4; ++col) {
        var vid = row * 4 + col;
        var uv = uvSliced[vid];
        var voffset = vid * floatsPerVert;
        verts[voffset + uvOffset] = uv.u;
        verts[voffset + uvOffset + 1] = uv.v;
      }
    }
  };

  _proto.updateWorldVerts = function updateWorldVerts(sprite) {
    var matrix = sprite.node._worldMatrix;
    var matrixm = matrix.m,
        a = matrixm[0],
        b = matrixm[1],
        c = matrixm[4],
        d = matrixm[5],
        tx = matrixm[12],
        ty = matrixm[13];
    var local = this._local;
    var world = this._renderData.vDatas[0];
    var floatsPerVert = this.floatsPerVert;

    for (var row = 0; row < 4; ++row) {
      var localRowY = local[row * 2 + 1];

      for (var col = 0; col < 4; ++col) {
        var localColX = local[col * 2];
        var worldIndex = (row * 4 + col) * floatsPerVert;
        world[worldIndex] = localColX * a + localRowY * c + tx;
        world[worldIndex + 1] = localColX * b + localRowY * d + ty;
      }
    }
  };

  return SlicedAssembler;
}(_assembler2d["default"]);

exports["default"] = SlicedAssembler;
Object.assign(SlicedAssembler.prototype, {
  verticesCount: 16,
  indicesCount: 54
});
module.exports = exports["default"];
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_engine__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImVuZ2luZS1kZXYvY29jb3MyZC9jb3JlL3JlbmRlcmVyL3dlYmdsL2Fzc2VtYmxlcnMvc3ByaXRlLzJkL3NsaWNlZC5qcyJdLCJuYW1lcyI6WyJTbGljZWRBc3NlbWJsZXIiLCJpbml0RGF0YSIsInNwcml0ZSIsIl9yZW5kZXJEYXRhIiwibWVzaENvdW50IiwiY3JlYXRlRGF0YSIsInZlcnRpY2VzRmxvYXRzIiwiaW5kaWNlc0NvdW50IiwiaW5kaWNlcyIsImlEYXRhcyIsImluZGV4T2Zmc2V0IiwiciIsImMiLCJzdGFydCIsImluaXRMb2NhbCIsIl9sb2NhbCIsImxlbmd0aCIsInVwZGF0ZVJlbmRlckRhdGEiLCJmcmFtZSIsIl9zcHJpdGVGcmFtZSIsInBhY2tUb0R5bmFtaWNBdGxhcyIsIl92ZXJ0c0RpcnR5IiwidXBkYXRlVVZzIiwidXBkYXRlVmVydHMiLCJub2RlIiwid2lkdGgiLCJoZWlnaHQiLCJhcHB4IiwiYW5jaG9yWCIsImFwcHkiLCJhbmNob3JZIiwic3ByaXRlRnJhbWUiLCJsZWZ0V2lkdGgiLCJpbnNldExlZnQiLCJyaWdodFdpZHRoIiwiaW5zZXRSaWdodCIsInRvcEhlaWdodCIsImluc2V0VG9wIiwiYm90dG9tSGVpZ2h0IiwiaW5zZXRCb3R0b20iLCJzaXphYmxlV2lkdGgiLCJzaXphYmxlSGVpZ2h0IiwieFNjYWxlIiwieVNjYWxlIiwiaXNOYU4iLCJsb2NhbCIsInVwZGF0ZVdvcmxkVmVydHMiLCJ2ZXJ0cyIsInZEYXRhcyIsInV2U2xpY2VkIiwidXZPZmZzZXQiLCJmbG9hdHNQZXJWZXJ0Iiwicm93IiwiY29sIiwidmlkIiwidXYiLCJ2b2Zmc2V0IiwidSIsInYiLCJtYXRyaXgiLCJfd29ybGRNYXRyaXgiLCJtYXRyaXhtIiwibSIsImEiLCJiIiwiZCIsInR4IiwidHkiLCJ3b3JsZCIsImxvY2FsUm93WSIsImxvY2FsQ29sWCIsIndvcmxkSW5kZXgiLCJBc3NlbWJsZXIyRCIsIk9iamVjdCIsImFzc2lnbiIsInByb3RvdHlwZSIs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LEdBQXdCRCxTQUFTLEdBQUdOLENBQVosR0FBZ0JLLFNBQVMsR0FBR0osQ0FBNUIsR0FBZ0NFLEVBQXhEO0FBQ0g7QUFDSjtBQUNKOzs7RUF6R3dDSzs7O0FBNEc3Q0MsTUFBTSxDQUFDQyxNQUFQLENBQWMxRSxlQUFlLENBQUMyRSxTQUE5QixFQUF5QztBQUNyQ0MsRUFBQUEsYUFBYSxFQUFFLEVBRHNCO0FBRXJDckUsRUFBQUEsWUFBWSxFQUFFO0FBRnVCLENBQXpDIiwic291cmNlc0NvbnRlbnQiOlsiLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcbiBDb3B5cmlnaHQgKGMpIDIwMTctMjAxOCBYaWFtZW4gWWFqaSBTb2Z0d2FyZSBDby4sIEx0ZC5cblxuIGh0dHA6Ly93d3cuY29jb3MuY29tXG5cbiBQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5XG4gb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBlbmdpbmUgc291cmNlIGNvZGUgKHRoZSBcIlNvZnR3YXJlXCIpLCBhIGxpbWl0ZWQsXG4gd29ybGR3aWRlLCByb3lhbHR5LWZyZWUsIG5vbi1hc3NpZ25hYmxlLCByZXZvY2FibGUgYW5kIG5vbi1leGNsdXNpdmUgbGljZW5zZVxuIHRvIHVzZSBDb2NvcyBDcmVhdG9yIHNvbGVseSB0byBkZXZlbG9wIGdhbWVzIG9uIHlvdXIgdGFyZ2V0IHBsYXRmb3Jtcy4gWW91IHNoYWxsXG4gbm90IHVzZSBDb2NvcyBDcmVhdG9yIHNvZnR3YXJlIGZvciBkZXZlbG9waW5nIG90aGVyIHNvZnR3YXJlIG9yIHRvb2xzIHRoYXQnc1xuIHVzZWQgZm9yIGRldmVsb3BpbmcgZ2FtZXMuIFlvdSBhcmUgbm90IGdyYW50ZWQgdG8gcHVibGlzaCwgZGlzdHJpYnV0ZSxcbiBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbCBjb3BpZXMgb2YgQ29jb3MgQ3JlYXRvci5cblxuIFRoZSBzb2Z0d2FyZSBvciB0b29scyBpbiB0aGlzIExpY2Vuc2UgQWdyZWVtZW50IGFyZSBsaWNlbnNlZCwgbm90IHNvbGQuXG4gWGlhbWVuIFlhamkgU29mdHdhcmUgQ28uLCBMdGQuIHJlc2VydmVzIGFsbCByaWdodHMgbm90IGV4cHJlc3NseSBncmFudGVkIHRvIHlvdS5cblxuIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCBcIkFTIElTXCIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1JcbiBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSxcbiBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEVcbiBBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSXG4gTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSxcbiBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOXG4gVEhFIFNPRlRXQVJFLlxuICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG5cbmltcG9ydCBBc3NlbWJsZXIyRCBmcm9tICcuLi8uLi8uLi8uLi9hc3NlbWJsZXItMmQnO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBTbGljZWRBc3NlbWJsZXIgZXh0ZW5kcyBBc3NlbWJsZXIyRCB7XG4gICAgaW5pdERhdGEgKHNwcml0ZSkge1xuICAgICAgICBpZiAodGhpcy5fcmVuZGVyRGF0YS5tZXNoQ291bnQgPiAwKSByZXR1cm47XG4gICAgICAgIHRoaXMuX3JlbmRlckRhdGEuY3JlYXRlRGF0YSgwLCB0aGlzLnZlcnRpY2VzRmxvYXRzLCB0aGlzLmluZGljZXNDb3VudCk7XG5cbiAgICAgICAgbGV0IGluZGljZXMgPSB0aGlzLl9yZW5kZXJEYXRhLmlEYXRhc1swXTtcbiAgICAgICAgbGV0IGluZGV4T2Zmc2V0ID0gMDtcbiAgICAgICAgZm9yIChsZXQgciA9IDA7IHIgPCAzOyArK3IpIHtcbiAgICAgICAgICAgIGZvciAobGV0IGMgPSAwOyBjIDwgMzsgKytjKSB7XG4gICAgICAgICAgICAgICAgbGV0IHN0YXJ0ID0gciAqIDQgKyBjO1xuICAgICAgICAgICAgICAgIGluZGljZXNbaW5kZXhPZmZzZXQrK10gPSBzdGFydDtcbiAgICAgICAgICAgICAgICBpbmRpY2VzW2luZGV4T2Zmc2V0KytdID0gc3RhcnQgKyAxO1xuICAgICAgICAgICAgICAgIGluZGljZXNbaW5kZXhPZmZzZXQrK10gPSBzdGFydCArIDQ7XG4gICAgICAgICAgICAgICAgaW5kaWNlc1tpbmRleE9mZnNldCsrXSA9IHN0YXJ0ICsgMTtcbiAgICAgICAgICAgICAgICBpbmRpY2VzW2luZGV4T2Zmc2V0KytdID0gc3RhcnQgKyA1O1xuICAgICAgICAgICAgICAgIGluZGljZXNbaW5kZXhPZmZzZXQrK10gPSBzdGFydCArIDQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBpbml0TG9jYWwgKCkge1xuICAgICAgICB0aGlzLl9sb2NhbCA9IFtdO1xuICAgICAgICB0aGlzLl9sb2NhbC5sZW5ndGggPSA4O1xuICAgIH1cblxuICAgIHVwZGF0ZVJlbmRlckRhdGEgKHNwcml0ZSkge1xuICAgICAgICBsZXQgZnJhbWUgPSBzcHJpdGUuX3Nwcml0ZUZyYW1lO1xuICAgICAgICB0aGlzLnBhY2tUb0R5bmFtaWNBdGxhcyhzcHJpdGUsIGZyYW1lKTtcblxuICAgICAgICBpZiAoc3ByaXRlLl92ZXJ0c0RpcnR5KSB7XG4gICAgICAgICAgICB0aGlzLnVwZGF0ZVVWcyhzcHJpdGUpO1xuICAgICAgICAgICAgdGhpcy51cGRhdGVWZXJ0cyhzcHJpdGUpO1xuICAgICAgICAgICAgc3ByaXRlLl92ZXJ0c0RpcnR5ID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICB1cGRhdGVWZXJ0cyAoc3ByaXRlKSB7XG4gICAgICAgIGxldCBub2RlID0gc3ByaXRlLm5vZGUsXG4gICAgICAgICAgICB3aWR0aCA9IG5vZGUud2lkdGgsIGhlaWdodCA9IG5vZGUuaGVpZ2h0LFxuICAgICAgICAgICAgYXBweCA9IG5vZGUuYW5jaG9yWCAqIHdpZHRoLCBhcHB5ID0gbm9kZS5hbmNob3JZICogaGVpZ2h0O1xuXG4gICAgICAgIGxldCBmcmFtZSA9IHNwcml0ZS5zcHJpdGVGcmFtZTtcbiAgICAgICAgbGV0IGxlZnRXaWR0aCA9IGZyYW1lLmluc2V0TGVmdDtcbiAgICAgICAgbGV0IHJpZ2h0V2lkdGggPSBmcmFtZS5pbnNldFJpZ2h0O1xuICAgICAgICBsZXQgdG9wSGVpZ2h0ID0gZnJhbWUuaW5zZXRUb3A7XG4gICAgICAgIGxldCBib3R0b21IZWlnaHQgPSBmcmFtZS5pbnNldEJvdHRvbTtcblxuICAgICAgICBsZXQgc2l6YWJsZVdpZHRoID0gd2lkdGggLSBsZWZ0V2lkdGggLSByaWdodFdpZHRoO1xuICAgICAgICBsZXQgc2l6YWJsZUhlaWdodCA9IGhlaWdodCAtIHRvcEhlaWdodCAtIGJvdHRvbUhlaWdodDtcbiAgICAgICAgbGV0IHhTY2FsZSA9IHdpZHRoIC8gKGxlZnRXaWR0aCArIHJpZ2h0V2lkdGgpO1xuICAgICAgICBsZXQgeVNjYWxlID0gaGVpZ2h0IC8gKHRvcEhlaWdodCArIGJvdHRvbUhlaWdodCk7XG4gICAgICAgIHhTY2FsZSA9IChpc05hTih4U2NhbGUpIHx8IHhTY2FsZSA+IDEpID8gMSA6IHhTY2FsZTtcbiAgICAgICAgeVNjYWxlID0gKGlzTmFOKHlTY2FsZSkgfHwgeVNjYWxlID4gMSkgPyAxIDogeVNjYWxlO1xuICAgICAgICBzaXphYmxlV2lkdGggPSBzaXphYmxlV2lkdGggPCAwID8gMCA6IHNpemFibGVXaWR0aDtcbiAgICAgICAgc2l6YWJsZUhlaWdodCA9IHNpemFibGVIZWlnaHQgPCAwID8gMCA6IHNpemFibGVIZWlnaHQ7XG5cbiAgICAgICAgLy8gdXBkYXRlIGxvY2FsXG4gICAgICAgIGxldCBsb2NhbCA9IHRoaXMuX2xvY2FsO1xuICAgICAgICBsb2NhbFswXSA9IC1hcHB4O1xuICAgICAgICBsb2NhbFsxXSA9IC1hcHB5O1xuICAgICAgICBsb2NhbFsyXSA9IGxlZnRXaWR0aCAqIHhTY2FsZSAtIGFwcHg7XG4gICAgICAgIGxvY2FsWzNdID0gYm90dG9tSGVpZ2h0ICogeVNjYWxlIC0gYXBweTtcbiAgICAgICAgbG9jYWxbNF0gPSBsb2NhbFsyXSArIHNpemFibGVXaWR0aDtcbiAgICAgICAgbG9jYWxbNV0gPSBsb2NhbFszXSArIHNpemFibGVIZWlnaHQ7XG4gICAgICAgIGxvY2FsWzZdID0gd2lkdGggLSBhcHB4O1xuICAgICAgICBsb2NhbFs3XSA9IGhlaWdodCAtIGFwcHk7XG5cbiAgICAgICAgdGhpcy51cGRhdGVXb3JsZFZlcnRzKHNwcml0ZSk7XG4gICAgfVxuXG4gICAgdXBkYXRlVVZzIChzcHJpdGUpIHtcbiAgICAgICAgbGV0IHZlcnRzID0gdGhpcy5fcmVuZGVyRGF0YS52RGF0YXNbMF07XG4gICAgICAgIGxldCB1dlNsaWNlZCA9IHNwcml0ZS5zcHJpdGVGcmFtZS51dlNsaWNlZDtcbiAgICAgICAgbGV0IHV2T2Zmc2V0ID0gdGhpcy51dk9mZnNldDtcbiAgICAgICAgbGV0IGZsb2F0c1BlclZlcnQgPSB0aGlzLmZsb2F0c1BlclZlcnQ7XG4gICAgICAgIGZvciAobGV0IHJvdyA9IDA7IHJvdyA8IDQ7ICsrcm93KSB7XG4gICAgICAgICAgICBmb3IgKGxldCBjb2wgPSAwOyBjb2wgPCA0OyArK2NvbCkge1xuICAgICAgICAgICAgICAgIGxldCB2aWQgPSByb3cgKiA0ICsgY29sO1xuICAgICAgICAgICAgICAgIGxldCB1diA9IHV2U2xpY2VkW3ZpZF07XG4gICAgICAgICAgICAgICAgbGV0IHZvZmZzZXQgPSB2aWQgKiBmbG9hdHNQZXJWZXJ0O1xuICAgICAgICAgICAgICAgIHZlcnRzW3ZvZmZzZXQgKyB1dk9mZnNldF0gPSB1di51O1xuICAgICAgICAgICAgICAgIHZlcnRzW3ZvZmZzZXQgKyB1dk9mZnNldCArIDFdID0gdXYudjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIHVwZGF0ZVdvcmxkVmVydHMgKHNwcml0ZSkge1xuICAgICAgICBsZXQgbWF0cml4ID0gc3ByaXRlLm5vZGUuX3dvcmxkTWF0cml4O1xuICAgICAgICBsZXQgbWF0cml4bSA9IG1hdHJpeC5tLFxuICAgICAgICAgICAgYSA9IG1hdHJpeG1bMF0sIGIgPSBtYXRyaXhtWzFdLCBjID0gbWF0cml4bVs0XSwgZCA9IG1hdHJpeG1bNV0sXG4gICAgICAgICAgICB0eCA9IG1hdHJpeG1bMTJdLCB0eSA9IG1hdHJpeG1bMTNdO1xuXG4gICAgICAgIGxldCBsb2NhbCA9IHRoaXMuX2xvY2FsO1xuICAgICAgICBsZXQgd29ybGQgPSB0aGlzLl9yZW5kZXJEYXRhLnZEYXRhc1swXTtcblxuICAgICAgICBsZXQgZmxvYXRzUGVyVmVydCA9IHRoaXMuZmxvYXRzUGVyVmVydDtcbiAgICAgICAgZm9yIChsZXQgcm93ID0gMDsgcm93IDwgNDsgKytyb3cpIHtcbiAgICAgICAgICAgIGxldCBsb2NhbFJvd1kgPSBsb2NhbFtyb3cgKiAyICsgMV07XG4gICAgICAgICAgICBmb3IgKGxldCBjb2wgPSAwOyBjb2wgPCA0OyArK2NvbCkge1xuICAgICAgICAgICAgICAgIGxldCBsb2NhbENvbFggPSBsb2NhbFtjb2wgKiAyXTtcbiAgICAgICAgICAgICAgICBsZXQgd29ybGRJbmRleCA9IChyb3cgKiA0ICsgY29sKSAqIGZsb2F0c1BlclZlcnQ7XG4gICAgICAgICAgICAgICAgd29ybGRbd29ybGRJbmRleF0gPSBsb2NhbENvbFggKiBhICsgbG9jYWxSb3dZICogYyArIHR4O1xuICAgICAgICAgICAgICAgIHdvcmxkW3dvcmxkSW5kZXggKyAxXSA9IGxvY2FsQ29sWCAqIGIgKyBsb2NhbFJvd1kgKiBkICsgdHk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG59XG5cbk9iamVjdC5hc3NpZ24oU2xpY2VkQXNzZW1ibGVyLnByb3RvdHlwZSwge1xuICAgIHZlcnRpY2VzQ291bnQ6IDE2LFxuICAgIGluZGljZXNDb3VudDogNTRcbn0pO1xuIl0sInNvdXJjZVJvb3QiOiIvIn0=