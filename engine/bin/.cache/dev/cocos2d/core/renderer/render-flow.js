
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'engine-dev/cocos2d/core/renderer/render-flow.js';
                    var __require = nodeEnv ? function (request) {
                        return require(request);
                    } : function (request) {
                        return __quick_compile_engine__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_engine__.registerModule(__filename, module);}"use strict";

var FlagOfset = 0;
var DONOTHING = 1 << FlagOfset++;
var BREAK_FLOW = 1 << FlagOfset++;
var LOCAL_TRANSFORM = 1 << FlagOfset++;
var WORLD_TRANSFORM = 1 << FlagOfset++;
var TRANSFORM = LOCAL_TRANSFORM | WORLD_TRANSFORM;
var UPDATE_RENDER_DATA = 1 << FlagOfset++;
var OPACITY = 1 << FlagOfset++;
var COLOR = 1 << FlagOfset++;
var OPACITY_COLOR = OPACITY | COLOR;
var RENDER = 1 << FlagOfset++;
var CHILDREN = 1 << FlagOfset++;
var POST_RENDER = 1 << FlagOfset++;
var FINAL = 1 << FlagOfset++;

var _batcher, _forward;

var _cullingMask = 0;

function RenderFlow() {
  this._func = init;
  this._next = null;
}

var _proto = RenderFlow.prototype;

_proto._doNothing = function () {};

_proto._localTransform = function (node) {
  node._updateLocalMatrix();

  node._renderFlag &= ~LOCAL_TRANSFORM;

  this._next._func(node);
};

_proto._worldTransform = function (node) {
  _batcher.worldMatDirty++;
  var t = node._matrix;
  var trs = node._trs;
  var tm = t.m;
  tm[12] = trs[0];
  tm[13] = trs[1];
  tm[14] = trs[2];

  node._mulMat(node._worldMatrix, node._parent._worldMatrix, t);

  node._renderFlag &= ~WORLD_TRANSFORM;

  this._next._func(node);

  _batcher.worldMatDirty--;
};

_proto._opacity = function (node) {
  _batcher.parentOpacityDirty++;

  this._next._func(node);

  node._renderFlag &= ~OPACITY;
  _batcher.parentOpacityDirty--;
};

_proto._color = function (node) {
  var comp = node._renderComponent;

  if (comp) {
    comp._updateColor();
  }

  node._renderFlag &= ~COLOR;

  this._next._func(node);
};

_proto._updateRenderData = function (node) {
  var comp = node._renderComponent;

  comp._assembler.updateRenderData(comp);

  node._renderFlag &= ~UPDATE_RENDER_DATA;

  this._next._func(node);
};

_proto._render = function (node) {
  var comp = node._renderComponent;

  comp._checkBacth(_batcher, node._cullingMask);

  comp._assembler.fillBuffers(comp, _batcher);

  this._next._func(node);
};

_proto._children = function (node) {
  var cullingMask = _cullingMask;
  var batcher = _batcher;
  var parentOpacity = batcher.parentOpacity;
  var opacity = batcher.parentOpacity *= node._opacity / 255;
  var worldTransformFlag = batcher.worldMatDirty ? WORLD_TRANSFORM : 0;
  var worldOpacityFlag = batcher.parentOpacityDirty ? OPACITY_COLOR : 0;
  var worldDirtyFlag = worldTransformFlag | worldOpacityFlag;
  var children = node._children;

  for (var i = 0, l = children.length; i < l; i++) {
    var c = children[i]; // Advance the modification of the flag to avoid node attribute modification is invalid when opacity === 0.

    c._renderFlag |= worldDirtyFlag;
    if (!c._activeInHierarchy || c._opacity === 0) continue;
    _cullingMask = c._cullingMask = c.groupIndex === 0 ? cullingMask : 1 << c.groupIndex; // TODO: Maybe has better way to implement cascade opacity

    var colorVal = c._color._val;

    c._color._fastSetA(c._opacity * opacity);

    flows[c._renderFlag]._func(c);

    c._color._val = colorVal;
  }

  batcher.parentOpacity = parentOpacity;

  this._next._func(node);
};

_proto._postRender = function (node) {
  var comp = node._renderComponent;

  comp._checkBacth(_batcher, node._cullingMask);

  comp._assembler.postFillBuffers(comp, _batcher);

  this._next._func(node);
};

var EMPTY_FLOW = new RenderFlow();
EMPTY_FLOW._func = EMPTY_FLOW._doNothing;
EMPTY_FLOW._next = EMPTY_FLOW;
var flows = {};

function createFlow(flag, next) {
  var flow = new RenderFlow();
  flow._next = next || EMPTY_FLOW;

  switch (flag) {
    case DONOTHING:
      flow._func = flow._doNothing;
      break;

    case BREAK_FLOW:
      flow._func = flow._doNothing;
      break;

    case LOCAL_TRANSFORM:
      flow._func = flow._localTransform;
      break;

    case WORLD_TRANSFORM:
      flow._func = flow._worldTransform;
      break;

    case OPACITY:
      flow._func = flow._opacity;
      break;

    case COLOR:
      flow._func = flow._color;
      break;

    case UPDATE_RENDER_DATA:
      flow._func = flow._updateRenderData;
      break;

    case RENDER:
      flow._func = flow._render;
      break;

    case CHILDREN:
      flow._func = flow._children;
      break;

    case POST_RENDER:
      flow._func = flow._postRender;
      break;
  }

  return flow;
}

function getFlow(flag) {
  var flow = null;
  var tFlag = FINAL;

  while (tFlag > 0) {
    if (tFlag & flag) flow = createFlow(tFlag, flow);
    tFlag = tFlag >> 1;
  }

  return flow;
} // 


function init(node) {
  var flag = node._renderFlag;
  var r = flows[flag] = getFlow(flag);

  r._func(node);
}

RenderFlow.flows = flows;
RenderFlow.createFlow = createFlow; // validate whether render component is ready to be rendered.

var _validateList = [];

RenderFlow.registerValidate = function (renderComp) {
  if (renderComp._inValidateList) return;

  _validateList.push(renderComp);

  renderComp._inValidateList = true;
};

RenderFlow.validateRenderers = function () {
  for (var i = 0, l = _validateList.length; i < l; i++) {
    var renderComp = _validateList[i];
    if (!renderComp.isValid) continue;

    if (!renderComp.enabledInHierarchy) {
      renderComp.disableRender();
    } else {
      renderComp._validateRender();
    }

    renderComp._inValidateList = false;
  }

  _validateList.length = 0;
};

RenderFlow.visitRootNode = function (rootNode) {
  RenderFlow.validateRenderers();
  var preCullingMask = _cullingMask;
  _cullingMask = rootNode._cullingMask;

  if (rootNode._renderFlag & WORLD_TRANSFORM) {
    _batcher.worldMatDirty++;

    rootNode._calculWorldMatrix();

    rootNode._renderFlag &= ~WORLD_TRANSFORM;

    flows[rootNode._renderFlag]._func(rootNode);

    _batcher.worldMatDirty--;
  } else {
    flows[rootNode._renderFlag]._func(rootNode);
  }

  _cullingMask = preCullingMask;
};

RenderFlow.render = function (rootNode, dt) {
  _batcher.reset();

  _batcher.walking = true;
  RenderFlow.visitRootNode(rootNode);

  _batcher.terminate();

  _batcher.walking = false;

  _forward.render(_batcher._renderScene, dt);
};

RenderFlow.renderCamera = function (camera, rootNode) {
  _batcher.reset();

  _batcher.walking = true;
  RenderFlow.visitRootNode(rootNode);

  _batcher.terminate();

  _batcher.walking = false;

  _forward.renderCamera(camera, _batcher._renderScene);
};

RenderFlow.init = function (batcher, forwardRenderer) {
  _batcher = batcher;
  _forward = forwardRenderer;
  flows[0] = EMPTY_FLOW;

  for (var i = 1; i < FINAL; i++) {
    flows[i] = new RenderFlow();
  }
};

RenderFlow.getBachther = function () {
  return _batcher;
};

RenderFlow.FLAG_DONOTHING = DONOTHING;
RenderFlow.FLAG_BREAK_FLOW = BREAK_FLOW;
RenderFlow.FLAG_LOCAL_TRANSFORM = LOCAL_TRANSFORM;
RenderFlow.FLAG_WORLD_TRANSFORM = WORLD_TRANSFORM;
RenderFlow.FLAG_TRANSFORM = TRANSFORM;
RenderFlow.FLAG_OPACITY = OPACITY;
RenderFlow.FLAG_COLOR = COLOR;
RenderFlow.FLAG_OPACITY_COLOR = OPACITY_COLOR;
RenderFlow.FLAG_UPDATE_RENDER_DATA = UPDATE_RENDER_DATA;
RenderFlow.FLAG_RENDER = RENDER;
RenderFlow.FLAG_CHILDREN = CHILDREN;
RenderFlow.FLAG_POST_RENDER = POST_RENDER;
RenderFlow.FLAG_FINAL = FINAL;
module.exports = cc.RenderFlow = RenderFlow;
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_engine__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImVuZ2luZS1kZXYvY29jb3MyZC9jb3JlL3JlbmRlcmVyL3JlbmRlci1mbG93LmpzIl0sIm5hbWVzIjpbIkZsYWdPZnNldCIsIkRPTk9USElORyIsIkJSRUFLX0ZMT1ciLCJMT0NBTF9UUkFOU0ZPUk0iLCJXT1JMRF9UUkFOU0ZPUk0iLCJUUkFOU0ZPUk0iLCJVUERBVEVfUkVOREVSX0RBVEEiLCJPUEFDSVRZIiwiQ09MT1IiLCJPUEFDSVRZX0NPTE9SIiwiUkVOREVSIiwiQ0hJTERSRU4iLCJQT1NUX1JFTkRFUiIsIkZJTkFMIiwiX2JhdGNoZXIiLCJfZm9yd2FyZCIsIl9jdWxsaW5nTWFzayIsIlJlbmRlckZsb3ciLCJfZnVuYyIsImluaXQiLCJfbmV4dCIsIl9wcm90byIsInByb3RvdHlwZSIsIl9kb05vdGhpbmciLCJfbG9jYWxUcmFuc2Zvcm0iLCJub2RlIiwiX3VwZGF0ZUxvY2FsTWF0cml4IiwiX3JlbmRlckZsYWciLCJfd29ybGRUcmFuc2Zvcm0iLCJ3b3JsZE1hdERpcnR5IiwidCIsIl9tYXRyaXgiLCJ0cnMiLCJfdHJzIiwidG0iLCJtIiwiX211bE1hdCIsIl93b3JsZE1hdHJpeCIsIl9wYXJlbnQiLCJfb3BhY2l0eSIsInBhcmVudE9wYWNpdHlEaXJ0eSIsIl9jb2xvciIsImNvbXAiLCJfcmVuZGVyQ29tcG9uZW50IiwiX3VwZGF0ZUNvbG9yIiwiX3VwZGF0ZVJlbmRlckRhdGEiLCJfYXNzZW1ibGVyIiwidXBkYXRlUmVuZGVyRGF0YSIsIl9yZW5kZXIiLCJfY2hlY2tCYWN0aCIsImZpbGxCdWZmZXJzIiwiX2NoaWxkcmVuIiwiY3VsbGluZ01hc2siLCJiYXRjaGVyIiwicGFyZW50T3BhY2l0eSIsIm9wYWNpdHkiLCJ3b3JsZFRyYW5zZm9ybUZsYWciLCJ3b3JsZE9wYWNpdHlGbGFnIiwid29ybGREaXJ0eUZsYWciLCJjaGlsZHJlbiIsImkiLCJsIiwibGVuZ3RoIiwiYyIsIl9hY3RpdmVJbkhpZXJhcmNoeSIsImdyb3VwSW5kZXgiLCJjb2xvclZhbCIsIl92YWwiLCJfZmFzdFNldEEiLCJmbG93cyIsIl9wb3N0UmVuZGVyIiwicG9zdEZpbGxCdWZmZXJzIiwiRU1QVFlfRkxPVyIsImNyZWF0ZUZsb3ciLCJmbGFnIiwibmV4dCIsImZsb3ciLCJnZXRGbG93IiwidEZsYWciLCJyIiwiX3ZhbGlkYXRlTGlzdCIsInJlZ2lzdGVyVmFsaWRhdGUiLCJyZW5kZXJDb21wIiwiX2luVmFsaWRhdGVMaXN0IiwicHVzaCIsInZhbGlkYXRlUmVuZGVyZXJzIiwiaXNWYWxpZCIsImVuYWJsZWRJbkhpZXJhcmNoeSIsImRpc2FibGVSZW5kZXIiLCJfdmFsaWRhdGVSZW5kZXIiLCJ2aXNpdFJvb3ROb2RlIiwicm9vdE5vZGUiLCJwcmVDdWxsaW5nTWFzayIsIl9jYWxjdWxXb3JsZE1hdHJpeCIsInJlbmRlciIsImR0IiwicmVzZXQiLCJ3YWxraW5nIiwidGVybWluYXRlIiwiX3JlbmRlclNjZW5lIiwicmVuZGVyQ2FtZXJhIiwiY2FtZXJhIiwiZm9yd2FyZFJlbmRlcmVyIiwiZ2V0QmFjaHRoZXIiLCJGTEFHX0RPTk9USElORyIsIkZMQUdfQlJFQUtfRkxPVyIsIkZMQUdfTE9DQUxfVFJBTlNGT1JNIiwiRkxBR19XT1JMRF9UUkFOU0ZPUk0iLCJGTEFHX1RSQU5TRk9STSIsIkZMQUdfT1BBQ0lUWSIsIkZMQUdfQ09MT1IiLCJGTEFHX09QQUNJVFlfQ09MT1IiLCJGTEFHX1VQREFURV9SRU5ERVJfREFUQSIsIkZMQUdfUkVOREVSIiwiRkxBR19DSElMRFJFTiIsIkZMQUdfUE9TVF9SRU5ERVIiLCJGTEFHX0ZJTkFMIiwibW9kdWxlIiwiZXhwb3J0cyIsImNjIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7O0FBQUEsSUFBSUEsU0FBUyxHQUFHLENBQWhCO0FBRUEsSUFBTUMsU0FBUyxHQUFHLEtBQUtELFNBQVMsRUFBaEM7QUFDQSxJQUFNRSxVQUFVLEdBQUcsS0FBS0YsU0FBUyxFQUFqQztBQUNBLElBQU1HLGVBQWUsR0FBRyxLQUFLSCxTQUFTLEVBQXRDO0FB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QztBQUNBUSxVQUFVLENBQUMrRix1QkFBWCxHQUFxQzFHLGtCQUFyQztBQUNBVyxVQUFVLENBQUNnRyxXQUFYLEdBQXlCdkcsTUFBekI7QUFDQU8sVUFBVSxDQUFDaUcsYUFBWCxHQUEyQnZHLFFBQTNCO0FBQ0FNLFVBQVUsQ0FBQ2tHLGdCQUFYLEdBQThCdkcsV0FBOUI7QUFDQUssVUFBVSxDQUFDbUcsVUFBWCxHQUF3QnZHLEtBQXhCO0FBRUF3RyxNQUFNLENBQUNDLE9BQVAsR0FBaUJDLEVBQUUsQ0FBQ3RHLFVBQUgsR0FBZ0JBLFVBQWpDIiwic291cmNlc0NvbnRlbnQiOlsibGV0IEZsYWdPZnNldCA9IDA7XG5cbmNvbnN0IERPTk9USElORyA9IDEgPDwgRmxhZ09mc2V0Kys7XG5jb25zdCBCUkVBS19GTE9XID0gMSA8PCBGbGFnT2ZzZXQrKztcbmNvbnN0IExPQ0FMX1RSQU5TRk9STSA9IDEgPDwgRmxhZ09mc2V0Kys7XG5jb25zdCBXT1JMRF9UUkFOU0ZPUk0gPSAxIDw8IEZsYWdPZnNldCsrO1xuY29uc3QgVFJBTlNGT1JNID0gTE9DQUxfVFJBTlNGT1JNIHwgV09STERfVFJBTlNGT1JNO1xuY29uc3QgVVBEQVRFX1JFTkRFUl9EQVRBID0gMSA8PCBGbGFnT2ZzZXQrKztcbmNvbnN0IE9QQUNJVFkgPSAxIDw8IEZsYWdPZnNldCsrO1xuY29uc3QgQ09MT1IgPSAxIDw8IEZsYWdPZnNldCsrO1xuY29uc3QgT1BBQ0lUWV9DT0xPUiA9IE9QQUNJVFkgfCBDT0xPUjtcbmNvbnN0IFJFTkRFUiA9IDEgPDwgRmxhZ09mc2V0Kys7XG5jb25zdCBDSElMRFJFTiA9IDEgPDwgRmxhZ09mc2V0Kys7XG5jb25zdCBQT1NUX1JFTkRFUiA9IDEgPDwgRmxhZ09mc2V0Kys7XG5jb25zdCBGSU5BTCA9IDEgPDwgRmxhZ09mc2V0Kys7XG5cbmxldCBfYmF0Y2hlciwgX2ZvcndhcmQ7XG5sZXQgX2N1bGxpbmdNYXNrID0gMDtcblxuZnVuY3Rpb24gUmVuZGVyRmxvdyAoKSB7XG4gICAgdGhpcy5fZnVuYyA9IGluaXQ7XG4gICAgdGhpcy5fbmV4dCA9IG51bGw7XG59XG5cbmxldCBfcHJvdG8gPSBSZW5kZXJGbG93LnByb3RvdHlwZTtcbl9wcm90by5fZG9Ob3RoaW5nID0gZnVuY3Rpb24gKCkge1xufTtcblxuX3Byb3RvLl9sb2NhbFRyYW5zZm9ybSA9IGZ1bmN0aW9uIChub2RlKSB7XG4gICAgbm9kZS5fdXBkYXRlTG9jYWxNYXRyaXgoKTtcbiAgICBub2RlLl9yZW5kZXJGbGFnICY9IH5MT0NBTF9UUkFOU0ZPUk07XG4gICAgdGhpcy5fbmV4dC5fZnVuYyhub2RlKTtcbn07XG5cbl9wcm90by5fd29ybGRUcmFuc2Zvcm0gPSBmdW5jdGlvbiAobm9kZSkge1xuICAgIF9iYXRjaGVyLndvcmxkTWF0RGlydHkgKys7XG5cbiAgICBsZXQgdCA9IG5vZGUuX21hdHJpeDtcbiAgICBsZXQgdHJzID0gbm9kZS5fdHJzO1xuICAgIGxldCB0bSA9IHQubTtcbiAgICB0bVsxMl0gPSB0cnNbMF07XG4gICAgdG1bMTNdID0gdHJzWzFdO1xuICAgIHRtWzE0XSA9IHRyc1syXTtcblxuICAgIG5vZGUuX211bE1hdChub2RlLl93b3JsZE1hdHJpeCwgbm9kZS5fcGFyZW50Ll93b3JsZE1hdHJpeCwgdCk7XG4gICAgbm9kZS5fcmVuZGVyRmxhZyAmPSB+V09STERfVFJBTlNGT1JNO1xuICAgIHRoaXMuX25leHQuX2Z1bmMobm9kZSk7XG5cbiAgICBfYmF0Y2hlci53b3JsZE1hdERpcnR5IC0tO1xufTtcblxuX3Byb3RvLl9vcGFjaXR5ID0gZnVuY3Rpb24gKG5vZGUpIHtcbiAgICBfYmF0Y2hlci5wYXJlbnRPcGFjaXR5RGlydHkrKztcblxuICAgIHRoaXMuX25leHQuX2Z1bmMobm9kZSk7XG5cbiAgICBub2RlLl9yZW5kZXJGbGFnICY9IH5PUEFDSVRZO1xuICAgIF9iYXRjaGVyLnBhcmVudE9wYWNpdHlEaXJ0eS0tO1xufTtcblxuX3Byb3RvLl9jb2xvciA9IGZ1bmN0aW9uIChub2RlKSB7XG4gICAgbGV0IGNvbXAgPSBub2RlLl9yZW5kZXJDb21wb25lbnQ7XG4gICAgaWYgKGNvbXApIHtcbiAgICAgICAgY29tcC5fdXBkYXRlQ29sb3IoKTtcbiAgICB9XG5cbiAgICBub2RlLl9yZW5kZXJGbGFnICY9IH5DT0xPUjtcbiAgICB0aGlzLl9uZXh0Ll9mdW5jKG5vZGUpO1xufTtcblxuX3Byb3RvLl91cGRhdGVSZW5kZXJEYXRhID0gZnVuY3Rpb24gKG5vZGUpIHtcbiAgICBsZXQgY29tcCA9IG5vZGUuX3JlbmRlckNvbXBvbmVudDtcbiAgICBjb21wLl9hc3NlbWJsZXIudXBkYXRlUmVuZGVyRGF0YShjb21wKTtcbiAgICBub2RlLl9yZW5kZXJGbGFnICY9IH5VUERBVEVfUkVOREVSX0RBVEE7XG4gICAgdGhpcy5fbmV4dC5fZnVuYyhub2RlKTtcbn07XG5cbl9wcm90by5fcmVuZGVyID0gZnVuY3Rpb24gKG5vZGUpIHtcbiAgICBsZXQgY29tcCA9IG5vZGUuX3JlbmRlckNvbXBvbmVudDtcbiAgICBjb21wLl9jaGVja0JhY3RoKF9iYXRjaGVyLCBub2RlLl9jdWxsaW5nTWFzayk7XG4gICAgY29tcC5fYXNzZW1ibGVyLmZpbGxCdWZmZXJzKGNvbXAsIF9iYXRjaGVyKTtcbiAgICB0aGlzLl9uZXh0Ll9mdW5jKG5vZGUpO1xufTtcblxuXG5fcHJvdG8uX2NoaWxkcmVuID0gZnVuY3Rpb24gKG5vZGUpIHtcbiAgICBsZXQgY3VsbGluZ01hc2sgPSBfY3VsbGluZ01hc2s7XG4gICAgbGV0IGJhdGNoZXIgPSBfYmF0Y2hlcjtcblxuICAgIGxldCBwYXJlbnRPcGFjaXR5ID0gYmF0Y2hlci5wYXJlbnRPcGFjaXR5O1xuICAgIGxldCBvcGFjaXR5ID0gKGJhdGNoZXIucGFyZW50T3BhY2l0eSAqPSAobm9kZS5fb3BhY2l0eSAvIDI1NSkpO1xuXG4gICAgbGV0IHdvcmxkVHJhbnNmb3JtRmxhZyA9IGJhdGNoZXIud29ybGRNYXREaXJ0eSA/IFdPUkxEX1RSQU5TRk9STSA6IDA7XG4gICAgbGV0IHdvcmxkT3BhY2l0eUZsYWcgPSBiYXRjaGVyLnBhcmVudE9wYWNpdHlEaXJ0eSA/IE9QQUNJVFlfQ09MT1IgOiAwO1xuICAgIGxldCB3b3JsZERpcnR5RmxhZyA9IHdvcmxkVHJhbnNmb3JtRmxhZyB8IHdvcmxkT3BhY2l0eUZsYWc7XG5cbiAgICBsZXQgY2hpbGRyZW4gPSBub2RlLl9jaGlsZHJlbjtcbiAgICBmb3IgKGxldCBpID0gMCwgbCA9IGNoaWxkcmVuLmxlbmd0aDsgaSA8IGw7IGkrKykge1xuICAgICAgICBsZXQgYyA9IGNoaWxkcmVuW2ldO1xuXG4gICAgICAgIC8vIEFkdmFuY2UgdGhlIG1vZGlmaWNhdGlvbiBvZiB0aGUgZmxhZyB0byBhdm9pZCBub2RlIGF0dHJpYnV0ZSBtb2RpZmljYXRpb24gaXMgaW52YWxpZCB3aGVuIG9wYWNpdHkgPT09IDAuXG4gICAgICAgIGMuX3JlbmRlckZsYWcgfD0gd29ybGREaXJ0eUZsYWc7XG4gICAgICAgIGlmICghYy5fYWN0aXZlSW5IaWVyYXJjaHkgfHwgYy5fb3BhY2l0eSA9PT0gMCkgY29udGludWU7XG5cbiAgICAgICAgX2N1bGxpbmdNYXNrID0gYy5fY3VsbGluZ01hc2sgPSBjLmdyb3VwSW5kZXggPT09IDAgPyBjdWxsaW5nTWFzayA6IDEgPDwgYy5ncm91cEluZGV4O1xuXG4gICAgICAgIC8vIFRPRE86IE1heWJlIGhhcyBiZXR0ZXIgd2F5IHRvIGltcGxlbWVudCBjYXNjYWRlIG9wYWNpdHlcbiAgICAgICAgbGV0IGNvbG9yVmFsID0gYy5fY29sb3IuX3ZhbDtcbiAgICAgICAgYy5fY29sb3IuX2Zhc3RTZXRBKGMuX29wYWNpdHkgKiBvcGFjaXR5KTtcbiAgICAgICAgZmxvd3NbYy5fcmVuZGVyRmxhZ10uX2Z1bmMoYyk7XG4gICAgICAgIGMuX2NvbG9yLl92YWwgPSBjb2xvclZhbDtcbiAgICB9XG5cbiAgICBiYXRjaGVyLnBhcmVudE9wYWNpdHkgPSBwYXJlbnRPcGFjaXR5O1xuXG4gICAgdGhpcy5fbmV4dC5fZnVuYyhub2RlKTtcbn07XG5cbl9wcm90by5fcG9zdFJlbmRlciA9IGZ1bmN0aW9uIChub2RlKSB7XG4gICAgbGV0IGNvbXAgPSBub2RlLl9yZW5kZXJDb21wb25lbnQ7XG4gICAgY29tcC5fY2hlY2tCYWN0aChfYmF0Y2hlciwgbm9kZS5fY3VsbGluZ01hc2spO1xuICAgIGNvbXAuX2Fzc2VtYmxlci5wb3N0RmlsbEJ1ZmZlcnMoY29tcCwgX2JhdGNoZXIpO1xuICAgIHRoaXMuX25leHQuX2Z1bmMobm9kZSk7XG59O1xuXG5jb25zdCBFTVBUWV9GTE9XID0gbmV3IFJlbmRlckZsb3coKTtcbkVNUFRZX0ZMT1cuX2Z1bmMgPSBFTVBUWV9GTE9XLl9kb05vdGhpbmc7XG5FTVBUWV9GTE9XLl9uZXh0ID0gRU1QVFlfRkxPVztcblxubGV0IGZsb3dzID0ge307XG5cbmZ1bmN0aW9uIGNyZWF0ZUZsb3cgKGZsYWcsIG5leHQpIHtcbiAgICBsZXQgZmxvdyA9IG5ldyBSZW5kZXJGbG93KCk7XG4gICAgZmxvdy5fbmV4dCA9IG5leHQgfHwgRU1QVFlfRkxPVztcblxuICAgIHN3aXRjaCAoZmxhZykge1xuICAgICAgICBjYXNlIERPTk9USElORzogXG4gICAgICAgICAgICBmbG93Ll9mdW5jID0gZmxvdy5fZG9Ob3RoaW5nO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgQlJFQUtfRkxPVzpcbiAgICAgICAgICAgIGZsb3cuX2Z1bmMgPSBmbG93Ll9kb05vdGhpbmc7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBMT0NBTF9UUkFOU0ZPUk06IFxuICAgICAgICAgICAgZmxvdy5fZnVuYyA9IGZsb3cuX2xvY2FsVHJhbnNmb3JtO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgV09STERfVFJBTlNGT1JNOiBcbiAgICAgICAgICAgIGZsb3cuX2Z1bmMgPSBmbG93Ll93b3JsZFRyYW5zZm9ybTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIE9QQUNJVFk6XG4gICAgICAgICAgICBmbG93Ll9mdW5jID0gZmxvdy5fb3BhY2l0eTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIENPTE9SOlxuICAgICAgICAgICAgZmxvdy5fZnVuYyA9IGZsb3cuX2NvbG9yO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgVVBEQVRFX1JFTkRFUl9EQVRBOlxuICAgICAgICAgICAgZmxvdy5fZnVuYyA9IGZsb3cuX3VwZGF0ZVJlbmRlckRhdGE7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBSRU5ERVI6IFxuICAgICAgICAgICAgZmxvdy5fZnVuYyA9IGZsb3cuX3JlbmRlcjtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIENISUxEUkVOOiBcbiAgICAgICAgICAgIGZsb3cuX2Z1bmMgPSBmbG93Ll9jaGlsZHJlbjtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFBPU1RfUkVOREVSOiBcbiAgICAgICAgICAgIGZsb3cuX2Z1bmMgPSBmbG93Ll9wb3N0UmVuZGVyO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgfVxuXG4gICAgcmV0dXJuIGZsb3c7XG59XG5cbmZ1bmN0aW9uIGdldEZsb3cgKGZsYWcpIHtcbiAgICBsZXQgZmxvdyA9IG51bGw7XG4gICAgbGV0IHRGbGFnID0gRklOQUw7XG4gICAgd2hpbGUgKHRGbGFnID4gMCkge1xuICAgICAgICBpZiAodEZsYWcgJiBmbGFnKVxuICAgICAgICAgICAgZmxvdyA9IGNyZWF0ZUZsb3codEZsYWcsIGZsb3cpO1xuICAgICAgICB0RmxhZyA9IHRGbGFnID4+IDE7XG4gICAgfVxuICAgIHJldHVybiBmbG93O1xufVxuXG4vLyBcbmZ1bmN0aW9uIGluaXQgKG5vZGUpIHtcbiAgICBsZXQgZmxhZyA9IG5vZGUuX3JlbmRlckZsYWc7XG4gICAgbGV0IHIgPSBmbG93c1tmbGFnXSA9IGdldEZsb3coZmxhZyk7XG4gICAgci5fZnVuYyhub2RlKTtcbn1cblxuUmVuZGVyRmxvdy5mbG93cyA9IGZsb3dzO1xuUmVuZGVyRmxvdy5jcmVhdGVGbG93ID0gY3JlYXRlRmxvdztcblxuLy8gdmFsaWRhdGUgd2hldGhlciByZW5kZXIgY29tcG9uZW50IGlzIHJlYWR5IHRvIGJlIHJlbmRlcmVkLlxubGV0IF92YWxpZGF0ZUxpc3QgPSBbXTtcblJlbmRlckZsb3cucmVnaXN0ZXJWYWxpZGF0ZSA9IGZ1bmN0aW9uIChyZW5kZXJDb21wKSB7XG4gICAgaWYgKHJlbmRlckNvbXAuX2luVmFsaWRhdGVMaXN0KSByZXR1cm47XG4gICAgX3ZhbGlkYXRlTGlzdC5wdXNoKHJlbmRlckNvbXApO1xuICAgIHJlbmRlckNvbXAuX2luVmFsaWRhdGVMaXN0ID0gIHRydWU7XG59O1xuUmVuZGVyRmxvdy52YWxpZGF0ZVJlbmRlcmVycyA9IGZ1bmN0aW9uICgpIHtcbiAgICBmb3IgKGxldCBpID0gMCwgbCA9IF92YWxpZGF0ZUxpc3QubGVuZ3RoOyBpIDwgbDsgaSsrKSB7XG4gICAgICAgIGxldCByZW5kZXJDb21wID0gX3ZhbGlkYXRlTGlzdFtpXTtcbiAgICAgICAgaWYgKCFyZW5kZXJDb21wLmlzVmFsaWQpIGNvbnRpbnVlO1xuICAgICAgICBpZiAoIXJlbmRlckNvbXAuZW5hYmxlZEluSGllcmFyY2h5KSB7XG4gICAgICAgICAgICByZW5kZXJDb21wLmRpc2FibGVSZW5kZXIoKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJlbmRlckNvbXAuX3ZhbGlkYXRlUmVuZGVyKCk7XG4gICAgICAgIH1cbiAgICAgICAgcmVuZGVyQ29tcC5faW5WYWxpZGF0ZUxpc3QgPSBmYWxzZTtcbiAgICB9XG4gICAgX3ZhbGlkYXRlTGlzdC5sZW5ndGggPSAwO1xufTtcblxuXG5SZW5kZXJGbG93LnZpc2l0Um9vdE5vZGUgPSBmdW5jdGlvbiAocm9vdE5vZGUpIHtcbiAgICBSZW5kZXJGbG93LnZhbGlkYXRlUmVuZGVyZXJzKCk7ICAgIFxuXG4gICAgbGV0IHByZUN1bGxpbmdNYXNrID0gX2N1bGxpbmdNYXNrO1xuICAgIF9jdWxsaW5nTWFzayA9IHJvb3ROb2RlLl9jdWxsaW5nTWFzaztcblxuICAgIGlmIChyb290Tm9kZS5fcmVuZGVyRmxhZyAmIFdPUkxEX1RSQU5TRk9STSkge1xuICAgICAgICBfYmF0Y2hlci53b3JsZE1hdERpcnR5ICsrO1xuICAgICAgICByb290Tm9kZS5fY2FsY3VsV29ybGRNYXRyaXgoKTtcbiAgICAgICAgcm9vdE5vZGUuX3JlbmRlckZsYWcgJj0gfldPUkxEX1RSQU5TRk9STTtcblxuICAgICAgICBmbG93c1tyb290Tm9kZS5fcmVuZGVyRmxhZ10uX2Z1bmMocm9vdE5vZGUpO1xuXG4gICAgICAgIF9iYXRjaGVyLndvcmxkTWF0RGlydHkgLS07XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBmbG93c1tyb290Tm9kZS5fcmVuZGVyRmxhZ10uX2Z1bmMocm9vdE5vZGUpO1xuICAgIH1cblxuICAgIF9jdWxsaW5nTWFzayA9IHByZUN1bGxpbmdNYXNrO1xufTtcblxuUmVuZGVyRmxvdy5yZW5kZXIgPSBmdW5jdGlvbiAocm9vdE5vZGUsIGR0KSB7XG4gICAgX2JhdGNoZXIucmVzZXQoKTtcbiAgICBfYmF0Y2hlci53YWxraW5nID0gdHJ1ZTtcblxuICAgIFJlbmRlckZsb3cudmlzaXRSb290Tm9kZShyb290Tm9kZSk7XG5cbiAgICBfYmF0Y2hlci50ZXJtaW5hdGUoKTtcbiAgICBfYmF0Y2hlci53YWxraW5nID0gZmFsc2U7XG5cbiAgICBfZm9yd2FyZC5yZW5kZXIoX2JhdGNoZXIuX3JlbmRlclNjZW5lLCBkdCk7XG59O1xuXG5SZW5kZXJGbG93LnJlbmRlckNhbWVyYSA9IGZ1bmN0aW9uIChjYW1lcmEsIHJvb3ROb2RlKSB7XG4gICAgX2JhdGNoZXIucmVzZXQoKTtcbiAgICBfYmF0Y2hlci53YWxraW5nID0gdHJ1ZTtcblxuICAgIFJlbmRlckZsb3cudmlzaXRSb290Tm9kZShyb290Tm9kZSk7XG5cbiAgICBfYmF0Y2hlci50ZXJtaW5hdGUoKTtcbiAgICBfYmF0Y2hlci53YWxraW5nID0gZmFsc2U7XG5cbiAgICBfZm9yd2FyZC5yZW5kZXJDYW1lcmEoY2FtZXJhLCBfYmF0Y2hlci5fcmVuZGVyU2NlbmUpO1xufTtcblxuUmVuZGVyRmxvdy5pbml0ID0gZnVuY3Rpb24gKGJhdGNoZXIsIGZvcndhcmRSZW5kZXJlcikge1xuICAgIF9iYXRjaGVyID0gYmF0Y2hlcjtcbiAgICBfZm9yd2FyZCA9IGZvcndhcmRSZW5kZXJlcjtcblxuICAgIGZsb3dzWzBdID0gRU1QVFlfRkxPVztcbiAgICBmb3IgKGxldCBpID0gMTsgaSA8IEZJTkFMOyBpKyspIHtcbiAgICAgICAgZmxvd3NbaV0gPSBuZXcgUmVuZGVyRmxvdygpO1xuICAgIH1cbn07XG5cblJlbmRlckZsb3cuZ2V0QmFjaHRoZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIF9iYXRjaGVyO1xufTtcblxuUmVuZGVyRmxvdy5GTEFHX0RPTk9USElORyA9IERPTk9USElORztcblJlbmRlckZsb3cuRkxBR19CUkVBS19GTE9XID0gQlJFQUtfRkxPVztcblJlbmRlckZsb3cuRkxBR19MT0NBTF9UUkFOU0ZPUk0gPSBMT0NBTF9UUkFOU0ZPUk07XG5SZW5kZXJGbG93LkZMQUdfV09STERfVFJBTlNGT1JNID0gV09STERfVFJBTlNGT1JNO1xuUmVuZGVyRmxvdy5GTEFHX1RSQU5TRk9STSA9IFRSQU5TRk9STTtcblJlbmRlckZsb3cuRkxBR19PUEFDSVRZID0gT1BBQ0lUWTtcblJlbmRlckZsb3cuRkxBR19DT0xPUiA9IENPTE9SO1xuUmVuZGVyRmxvdy5GTEFHX09QQUNJVFlfQ09MT1IgPSBPUEFDSVRZX0NPTE9SO1xuUmVuZGVyRmxvdy5GTEFHX1VQREFURV9SRU5ERVJfREFUQSA9IFVQREFURV9SRU5ERVJfREFUQTtcblJlbmRlckZsb3cuRkxBR19SRU5ERVIgPSBSRU5ERVI7XG5SZW5kZXJGbG93LkZMQUdfQ0hJTERSRU4gPSBDSElMRFJFTjtcblJlbmRlckZsb3cuRkxBR19QT1NUX1JFTkRFUiA9IFBPU1RfUkVOREVSO1xuUmVuZGVyRmxvdy5GTEFHX0ZJTkFMID0gRklOQUw7XG5cbm1vZHVsZS5leHBvcnRzID0gY2MuUmVuZGVyRmxvdyA9IFJlbmRlckZsb3c7XG4iXSwic291cmNlUm9vdCI6Ii8ifQ==