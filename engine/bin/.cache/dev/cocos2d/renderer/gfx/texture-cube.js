
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'engine-dev/cocos2d/renderer/gfx/texture-cube.js';
                    var __require = nodeEnv ? function (request) {
                        return require(request);
                    } : function (request) {
                        return __quick_compile_engine__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_engine__.registerModule(__filename, module);}"use strict";

exports.__esModule = true;
exports["default"] = void 0;

var _texture = _interopRequireDefault(require("./texture"));

var _enums = require("./enums");

var _misc = require("./misc");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

function _inheritsLoose(subClass, superClass) { subClass.prototype = Object.create(superClass.prototype); subClass.prototype.constructor = subClass; subClass.__proto__ = superClass; }

var TextureCube = /*#__PURE__*/function (_Texture) {
  _inheritsLoose(TextureCube, _Texture);

  /**
   * @constructor
   * @param {Device} device
   * @param {Object} options
   * @param {Array} options.images
   * @param {Boolean} options.mipmap
   * @param {Number} options.width
   * @param {Number} options.height
   * @param {TEXTURE_FMT_*} options.format
   * @param {Number} options.anisotropy
   * @param {FILTER_*} options.minFilter
   * @param {FILTER_*} options.magFilter
   * @param {FILTER_*} options.mipFilter
   * @param {WRAP_*} options.wrapS
   * @param {WRAP_*} options.wrapT
   * @param {WRAP_*} options.wrapR
   * @param {Boolean} options.flipY
   * @param {Boolean} options.premultiplyAlpha
   */
  function TextureCube(device, options) {
    var _this;

    _this = _Texture.call(this, device) || this;
    var gl = _this._device._gl;
    _this._target = gl.TEXTURE_CUBE_MAP;
    _this._glID = gl.createTexture();

    _this.update(options);

    return _this;
  }
  /**
   * @method update
   * @param {Object} options
   * @param {Array} options.images
   * @param {Boolean} options.genMipmaps
   * @param {Number} options.width
   * @param {Number} options.height
   * @param {TEXTURE_FMT_*} options.format
   * @param {Number} options.anisotropy
   * @param {FILTER_*} options.minFilter
   * @param {FILTER_*} options.magFilter
   * @param {FILTER_*} options.mipFilter
   * @param {WRAP_*} options.wrapS
   * @param {WRAP_*} options.wrapT
   * @param {WRAP_*} options.wrapR
   * @param {Boolean} options.flipY
   * @param {Boolean} options.premultiplyAlpha
   */


  var _proto = TextureCube.prototype;

  _proto.update = function update(options) {
    var gl = this._device._gl;
    var genMipmaps = this._genMipmaps;

    if (options) {
      if (options.width !== undefined) {
        this._width = options.width;
      }

      if (options.height !== undefined) {
        this._height = options.height;
      }

      if (options.anisotropy !== undefined) {
        this._anisotropy = options.anisotropy;
      }

      if (options.minFilter !== undefined) {
        this._minFilter = options.minFilter;
      }

      if (options.magFilter !== undefined) {
        this._magFilter = options.magFilter;
      }

      if (options.mipFilter !== undefined) {
        this._mipFilter = options.mipFilter;
      }

      if (options.wrapS !== undefined) {
        this._wrapS = options.wrapS;
      }

      if (options.wrapT !== undefined) {
        this._wrapT = options.wrapT;
      } // wrapR available in webgl2
      // if (options.wrapR !== undefined) {
      //   this._wrapR = options.wrapR;
      // }


      if (options.format !== undefined) {
        this._format = options.format;
        this._compressed = this._format >= _enums.enums.TEXTURE_FMT_RGB_DXT1 && this._format <= _enums.enums.TEXTURE_FMT_RGBA_PVRTC_4BPPV1 || this._format >= _enums.enums.TEXTURE_FMT_RGB_ETC2 && this._format <= _enums.enums.TEXTURE_FMT_RGBA_ETC2;
      } // check if generate mipmap


      if (options.genMipmaps !== undefined) {
        this._genMipmaps = options.genMipmaps;
        genMipmaps = options.genMipmaps;
      }

      if (options.images !== undefined) {
        if (options.images.length > 1) {
          genMipmaps = false;

          if (options.width !== options.height) {
            console.warn('texture-cube width and height should be identical.');
          }

          if (options.width >> options.images.length - 1 !== 1) {
            console.error('texture-cube mipmap is invalid. please set mipmap as 1x1, 2x2, 4x4 ... nxn');
          }
        }
      }
    } // NOTE: get pot after this._width, this._height has been assigned.


    var pot = (0, _misc.isPow2)(this._width) && (0, _misc.isPow2)(this._height);

    if (!pot) {
      genMipmaps = false;
    }

    gl.activeTexture(gl.TEXTURE0);
    gl.bindTexture(gl.TEXTURE_CUBE_MAP, this._glID);

    if (options.images !== undefined && options.images.length > 0) {
      this._setMipmap(options.images, options.flipY, options.premultiplyAlpha);

      if (options.images.length > 1) this._genMipmaps = true;
    }

    if (genMipmaps) {
      gl.hint(gl.GENERATE_MIPMAP_HINT, gl.NICEST);
      gl.generateMipmap(gl.TEXTURE_CUBE_MAP);
      this._genMipmaps = true;
    }

    this._setTexInfo();

    this._device._restoreTexture(0);
  }
  /**
   * @method updateSubImage
   * @param {Object} options
   * @param {Number} options.x
   * @param {Number} options.y
   * @param {Number} options.width
   * @param {Number} options.height
   * @param {Number} options.level
   * @param {Number} options.faceIndex
   * @param {HTMLCanvasElement | HTMLImageElement | HTMLVideoElement | ArrayBufferView} options.image
   * @param {Boolean} options.flipY
   * @param {Boolean} options.premultiplyAlpha
   */
  ;

  _proto.updateSubImage = function updateSubImage(options) {
    var gl = this._device._gl;
    var glFmt = (0, _enums.glTextureFmt)(this._format);
    gl.activeTexture(gl.TEXTURE0);
    gl.bindTexture(gl.TEXTURE_CUBE_MAP, this._glID);

    this._setSubImage(glFmt, options);

    this._device._restoreTexture(0);
  }
  /**
   * @method updateImage
   * @param {Object} options
   * @param {Number} options.width
   * @param {Number} options.height
   * @param {Number} options.level
   * @param {Number} options.faceIndex
   * @param {HTMLCanvasElement | HTMLImageElement | HTMLVideoElement | ArrayBufferView} options.image
   * @param {Boolean} options.flipY
   * @param {Boolean} options.premultiplyAlpha
   */
  ;

  _proto.updateImage = function updateImage(options) {
    var gl = this._device._gl;
    var glFmt = (0, _enums.glTextureFmt)(this._format);
    gl.activeTexture(gl.TEXTURE0);
    gl.bindTexture(gl.TEXTURE_CUBE_MAP, this._glID);

    this._setImage(glFmt, options);

    this._device._restoreTexture(0);
  };

  _proto._setSubImage = function _setSubImage(glFmt, options) {
    var gl = this._device._gl;
    var flipY = options.flipY;
    var premultiplyAlpha = options.premultiplyAlpha;
    var faceIndex = options.faceIndex;
    var img = options.image;

    if (flipY === undefined) {
      gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, false);
    } else {
      gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, flipY);
    }

    if (premultiplyAlpha === undefined) {
      gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, false);
    } else {
      gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, premultiplyAlpha);
    }

    if (img && !ArrayBuffer.isView(img) && !(img instanceof ArrayBuffer)) {
      gl.texSubImage2D(gl.TEXTURE_CUBE_MAP_POSITIVE_X + faceIndex, options.level, options.x, options.y, glFmt.format, glFmt.pixelType, img);
    } else {
      if (this._compressed) {
        gl.compressedTexSubImage2D(gl.TEXTURE_CUBE_MAP_POSITIVE_X + faceIndex, options.level, options.x, options.y, options.width, options.height, glFmt.format, img);
      } else {
        gl.texSubImage2D(gl.TEXTURE_CUBE_MAP_POSITIVE_X + faceIndex, options.level, options.x, options.y, options.width, options.height, glFmt.format, glFmt.pixelType, img);
      }
    }
  };

  _proto._setImage = function _setImage(glFmt, options) {
    var gl = this._device._gl;
    var flipY = options.flipY;
    var premultiplyAlpha = options.premultiplyAlpha;
    var faceIndex = options.faceIndex;
    var img = options.image;

    if (flipY === undefined) {
      gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, false);
    } else {
      gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, flipY);
    }

    if (premultiplyAlpha === undefined) {
      gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, false);
    } else {
      gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, premultiplyAlpha);
    }

    if (img && !ArrayBuffer.isView(img) && !(img instanceof ArrayBuffer)) {
      gl.texImage2D(gl.TEXTURE_CUBE_MAP_POSITIVE_X + faceIndex, options.level, glFmt.internalFormat, glFmt.format, glFmt.pixelType, img);
    } else {
      if (this._compressed) {
        gl.compressedTexImage2D(gl.TEXTURE_CUBE_MAP_POSITIVE_X + faceIndex, options.level, glFmt.internalFormat, options.width, options.height, 0, img);
      } else {
        gl.texImage2D(gl.TEXTURE_CUBE_MAP_POSITIVE_X + faceIndex, options.level, glFmt.internalFormat, options.width, options.height, 0, glFmt.format, glFmt.pixelType, img);
      }
    }
  } // levelImages = [imagePosX, imageNegX, imagePosY, imageNegY, imagePosZ, imageNegz]
  // images = [levelImages0, levelImages1, ...]
  ;

  _proto._setMipmap = function _setMipmap(images, flipY, premultiplyAlpha) {
    var glFmt = (0, _enums.glTextureFmt)(this._format);
    var options = {
      width: this._width,
      height: this._height,
      faceIndex: 0,
      flipY: flipY,
      premultiplyAlpha: premultiplyAlpha,
      level: 0,
      image: null
    };

    for (var i = 0; i < images.length; ++i) {
      var levelImages = images[i];
      options.level = i;
      options.width = this._width >> i;
      options.height = this._height >> i;

      for (var face = 0; face < 6; ++face) {
        options.faceIndex = face;
        options.image = levelImages[face];

        this._setImage(glFmt, options);
      }
    }
  };

  _proto._setTexInfo = function _setTexInfo() {
    var gl = this._device._gl;
    var pot = (0, _misc.isPow2)(this._width) && (0, _misc.isPow2)(this._height); // WebGL1 doesn't support all wrap modes with NPOT textures

    if (!pot && (this._wrapS !== _enums.enums.WRAP_CLAMP || this._wrapT !== _enums.enums.WRAP_CLAMP)) {
      console.warn('WebGL1 doesn\'t support all wrap modes with NPOT textures');
      this._wrapS = _enums.enums.WRAP_CLAMP;
      this._wrapT = _enums.enums.WRAP_CLAMP;
    }

    var mipFilter = this._genMipmaps ? this._mipFilter : -1;

    if (!pot && mipFilter !== -1) {
      console.warn('NPOT textures do not support mipmap filter');
      mipFilter = -1;
    }

    gl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_MIN_FILTER, (0, _enums.glFilter)(gl, this._minFilter, mipFilter));
    gl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_MAG_FILTER, (0, _enums.glFilter)(gl, this._magFilter, -1));
    gl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_WRAP_S, this._wrapS);
    gl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_WRAP_T, this._wrapT); // wrapR available in webgl2
    // gl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_WRAP_R, this._wrapR);

    var ext = this._device.ext('EXT_texture_filter_anisotropic');

    if (ext) {
      gl.texParameteri(gl.TEXTURE_CUBE_MAP, ext.TEXTURE_MAX_ANISOTROPY_EXT, this._anisotropy);
    }
  };

  return TextureCube;
}(_texture["default"]);

exports["default"] = TextureCube;
module.exports = exports["default"];
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_engine__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImVuZ2luZS1kZXYvY29jb3MyZC9yZW5kZXJlci9nZngvdGV4dHVyZS1jdWJlLmpzIl0sIm5hbWVzIjpbIlRleHR1cmVDdWJlIiwiZGV2aWNlIiwib3B0aW9ucyIsImdsIiwiX2RldmljZSIsIl9nbCIsIl90YXJnZXQiLCJURVhUVVJFX0NVQkVfTUFQIiwiX2dsSUQiLCJjcmVhdGVUZXh0dXJlIiwidXBkYXRlIiwiZ2VuTWlwbWFwcyIsIl9nZW5NaXBtYXBzIiwid2lkdGgiLCJ1bmRlZmluZWQiLCJfd2lkdGgiLCJoZWlnaHQiLCJfaGVpZ2h0IiwiYW5pc290cm9weSIsIl9hbmlzb3Ryb3B5IiwibWluRmlsdGVyIiwiX21pbkZpbHRlciIsIm1hZ0ZpbHRlciIsIl9tYWdGaWx0ZXIiLCJtaXBGaWx0ZXIiLCJfbWlwRmlsdGVyIiwid3JhcFMiLCJfd3JhcFMiLCJ3cmFwVCIsIl93cmFwVCIsImZvcm1hdCIsIl9mb3JtYXQiLCJfY29tcHJlc3NlZCIsImVudW1zIiwiVEVYVFVSRV9GTVRfUkdCX0RYVDEiLCJURVhUVVJFX0ZNVF9SR0JBX1BWUlRDXzRCUFBWMSIsIlRFWFRVUkVfRk1UX1JHQl9FVEMyIiwiVEVYVFVSRV9GTVRfUkdCQV9FVEMyIiwiaW1hZ2VzIiwibGVuZ3RoIiwiY29uc29sZSIsIndhcm4iLCJlcnJvciIsInBvdCIsImFjdGl2ZVRleHR1cmUiLCJURVhUVVJFMCIsImJpbmRUZXh0dXJlIiwiX3NldE1pcG1hcCIsImZsaXBZIiwicHJlbXVsdGlwbHlBbHBoYSIsImhpbnQiLCJHRU5FUkFURV9NSVBNQVBfSElOVCIsIk5JQ0VTVCIsImdlbmVyYXRlTWlwbWFwIiwiX3NldFRleEluZm8iLCJfcmVzdG9yZVRleHR1cmUiLCJ1cGRhdGVTdWJJbWFnZSIsImdsRm10IiwiX3NldFN1YkltYWdlIiwidXBkYXRlSW1hZ2UiLCJfc2V0SW1hZ2UiLCJmYWNlSW5kZXgiLCJpbWciLCJpbWFnZSIsInBpeGVsU3RvcmVpIiwiVU5QQUNLX0ZMSVBfWV9XRUJHTCIsIlVOUEFDS19QUkVNVUxUSVBMWV9BTFBIQV9XRUJHTCIsIkFycmF5QnVmZmVyIiwiaXNWaWV3IiwidGV4U3ViSW1hZ2UyRCIsIlRFWFRVUkVfQ1VCRV9NQVBfUE9TSVRJVkVfWCIsImxldmVsIiwieCIsInkiLCJwaXhlbFR5cGUiLCJjb21wcmVzc2VkVGV4U3ViSW1hZ2UyRCIsInRleEltYWdlMkQiLCJpbnRlcm5hbEZvcm1hdCIsImNvbXByZXNzZWRUZXhJbWFnZTJEIiwiaSIsImxldmVsSW1hZ2VzIiwiZmFjZSIsIldSQVBfQ0xBTVAiLCJ0ZXhQYXJhbWV0ZXJpIiwiVEVYVFVSRV9NSU5fRklMVEVSIiwiVEVYVFVSRV9NQUdfRklMVEVSIiwiVEVYVFVSRV9XUkFQX1MiLCJURVhUVVJFX1dSQVBfVCIsImV4dCIsIlRFWFRVUkVfTUFYX0FOSVNPVFJPUFlfRVhUIiwiVGV4dHVyZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUNBOzs7Ozs7SUFFcUJBOzs7QUFDbkI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFtQkEsdUJBQVlDLE1BQVosRUFBb0JDLE9BQXBCLEVBQTZCO0FBQUE7O0FBQzNCLGdDQUFNRCxNQUFOO0FBQ0EsUUFBSUUsRUFBRSxHQUFHLE1BQUtDLE9BQUwsQ0FBYUMsR0FBdEI7QUFDQSxVQUFLQyxPQUFMLEdBQWVILEVBQUUsQ0FBQ0ksZ0JBQWxCO0FBQ0EsVUFBS0MsS0FBTCxHQUFhTCxFQUFFLENBQUNNLGFBQUgsRUFBYjs7QUFDQSxVQUFLQyxNQUFMLENBQVlSLE9BQVo7O0FBTDJCO0FBTTVCO0FBRUQ7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7U0FrQkFRLFNBQUEsZ0JBQU9SLE9BQVAsRUFBZ0I7QUFDZCxRQUFJQyxFQUFFLEdBQUcsS0FBS0MsT0FBTCxDQUFhQyxHQUF0QjtBQUNBLFFBQUlNLFVBQVUsR0FBRyxLQUFLQyxXQUF0Qjs7QUFFQSxRQUFJVixPQUFKLEVBQWE7QUFDWCxVQUFJQSxPQUFPLENBQUNXLEtBQVIsS0FBa0JDLFNBQXRCLEVBQWlDO0FB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aUYsR0FBRyxDQUFDQywwQkFBMUMsRUFBc0UsS0FBS3RFLFdBQTNFO0FBQ0Q7QUFDRjs7O0VBNVVzQ3VFIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFRleHR1cmUgZnJvbSAnLi90ZXh0dXJlJztcbmltcG9ydCB7IGVudW1zLCBnbEZpbHRlciwgZ2xUZXh0dXJlRm10IH0gZnJvbSAnLi9lbnVtcyc7XG5pbXBvcnQgeyBpc1BvdzIgfSBmcm9tICcuL21pc2MnO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBUZXh0dXJlQ3ViZSBleHRlbmRzIFRleHR1cmUge1xuICAvKipcbiAgICogQGNvbnN0cnVjdG9yXG4gICAqIEBwYXJhbSB7RGV2aWNlfSBkZXZpY2VcbiAgICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnNcbiAgICogQHBhcmFtIHtBcnJheX0gb3B0aW9ucy5pbWFnZXNcbiAgICogQHBhcmFtIHtCb29sZWFufSBvcHRpb25zLm1pcG1hcFxuICAgKiBAcGFyYW0ge051bWJlcn0gb3B0aW9ucy53aWR0aFxuICAgKiBAcGFyYW0ge051bWJlcn0gb3B0aW9ucy5oZWlnaHRcbiAgICogQHBhcmFtIHtURVhUVVJFX0ZNVF8qfSBvcHRpb25zLmZvcm1hdFxuICAgKiBAcGFyYW0ge051bWJlcn0gb3B0aW9ucy5hbmlzb3Ryb3B5XG4gICAqIEBwYXJhbSB7RklMVEVSXyp9IG9wdGlvbnMubWluRmlsdGVyXG4gICAqIEBwYXJhbSB7RklMVEVSXyp9IG9wdGlvbnMubWFnRmlsdGVyXG4gICAqIEBwYXJhbSB7RklMVEVSXyp9IG9wdGlvbnMubWlwRmlsdGVyXG4gICAqIEBwYXJhbSB7V1JBUF8qfSBvcHRpb25zLndyYXBTXG4gICAqIEBwYXJhbSB7V1JBUF8qfSBvcHRpb25zLndyYXBUXG4gICAqIEBwYXJhbSB7V1JBUF8qfSBvcHRpb25zLndyYXBSXG4gICAqIEBwYXJhbSB7Qm9vbGVhbn0gb3B0aW9ucy5mbGlwWVxuICAgKiBAcGFyYW0ge0Jvb2xlYW59IG9wdGlvbnMucHJlbXVsdGlwbHlBbHBoYVxuICAgKi9cbiAgY29uc3RydWN0b3IoZGV2aWNlLCBvcHRpb25zKSB7XG4gICAgc3VwZXIoZGV2aWNlKTtcbiAgICBsZXQgZ2wgPSB0aGlzLl9kZXZpY2UuX2dsO1xuICAgIHRoaXMuX3RhcmdldCA9IGdsLlRFWFRVUkVfQ1VCRV9NQVA7XG4gICAgdGhpcy5fZ2xJRCA9IGdsLmNyZWF0ZVRleHR1cmUoKTtcbiAgICB0aGlzLnVwZGF0ZShvcHRpb25zKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBAbWV0aG9kIHVwZGF0ZVxuICAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9uc1xuICAgKiBAcGFyYW0ge0FycmF5fSBvcHRpb25zLmltYWdlc1xuICAgKiBAcGFyYW0ge0Jvb2xlYW59IG9wdGlvbnMuZ2VuTWlwbWFwc1xuICAgKiBAcGFyYW0ge051bWJlcn0gb3B0aW9ucy53aWR0aFxuICAgKiBAcGFyYW0ge051bWJlcn0gb3B0aW9ucy5oZWlnaHRcbiAgICogQHBhcmFtIHtURVhUVVJFX0ZNVF8qfSBvcHRpb25zLmZvcm1hdFxuICAgKiBAcGFyYW0ge051bWJlcn0gb3B0aW9ucy5hbmlzb3Ryb3B5XG4gICAqIEBwYXJhbSB7RklMVEVSXyp9IG9wdGlvbnMubWluRmlsdGVyXG4gICAqIEBwYXJhbSB7RklMVEVSXyp9IG9wdGlvbnMubWFnRmlsdGVyXG4gICAqIEBwYXJhbSB7RklMVEVSXyp9IG9wdGlvbnMubWlwRmlsdGVyXG4gICAqIEBwYXJhbSB7V1JBUF8qfSBvcHRpb25zLndyYXBTXG4gICAqIEBwYXJhbSB7V1JBUF8qfSBvcHRpb25zLndyYXBUXG4gICAqIEBwYXJhbSB7V1JBUF8qfSBvcHRpb25zLndyYXBSXG4gICAqIEBwYXJhbSB7Qm9vbGVhbn0gb3B0aW9ucy5mbGlwWVxuICAgKiBAcGFyYW0ge0Jvb2xlYW59IG9wdGlvbnMucHJlbXVsdGlwbHlBbHBoYVxuICAgKi9cbiAgdXBkYXRlKG9wdGlvbnMpIHtcbiAgICBsZXQgZ2wgPSB0aGlzLl9kZXZpY2UuX2dsO1xuICAgIGxldCBnZW5NaXBtYXBzID0gdGhpcy5fZ2VuTWlwbWFwcztcblxuICAgIGlmIChvcHRpb25zKSB7XG4gICAgICBpZiAob3B0aW9ucy53aWR0aCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHRoaXMuX3dpZHRoID0gb3B0aW9ucy53aWR0aDtcbiAgICAgIH1cbiAgICAgIGlmIChvcHRpb25zLmhlaWdodCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHRoaXMuX2hlaWdodCA9IG9wdGlvbnMuaGVpZ2h0O1xuICAgICAgfVxuICAgICAgaWYgKG9wdGlvbnMuYW5pc290cm9weSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHRoaXMuX2FuaXNvdHJvcHkgPSBvcHRpb25zLmFuaXNvdHJvcHk7XG4gICAgICB9XG4gICAgICBpZiAob3B0aW9ucy5taW5GaWx0ZXIgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICB0aGlzLl9taW5GaWx0ZXIgPSBvcHRpb25zLm1pbkZpbHRlcjtcbiAgICAgIH1cbiAgICAgIGlmIChvcHRpb25zLm1hZ0ZpbHRlciAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHRoaXMuX21hZ0ZpbHRlciA9IG9wdGlvbnMubWFnRmlsdGVyO1xuICAgICAgfVxuICAgICAgaWYgKG9wdGlvbnMubWlwRmlsdGVyICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgdGhpcy5fbWlwRmlsdGVyID0gb3B0aW9ucy5taXBGaWx0ZXI7XG4gICAgICB9XG4gICAgICBpZiAob3B0aW9ucy53cmFwUyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHRoaXMuX3dyYXBTID0gb3B0aW9ucy53cmFwUztcbiAgICAgIH1cbiAgICAgIGlmIChvcHRpb25zLndyYXBUICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgdGhpcy5fd3JhcFQgPSBvcHRpb25zLndyYXBUO1xuICAgICAgfVxuICAgICAgLy8gd3JhcFIgYXZhaWxhYmxlIGluIHdlYmdsMlxuICAgICAgLy8gaWYgKG9wdGlvbnMud3JhcFIgIT09IHVuZGVmaW5lZCkge1xuICAgICAgLy8gICB0aGlzLl93cmFwUiA9IG9wdGlvbnMud3JhcFI7XG4gICAgICAvLyB9XG4gICAgICBpZiAob3B0aW9ucy5mb3JtYXQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICB0aGlzLl9mb3JtYXQgPSBvcHRpb25zLmZvcm1hdDtcbiAgICAgICAgdGhpcy5fY29tcHJlc3NlZCA9IFxuICAgICAgICAgICh0aGlzLl9mb3JtYXQgPj0gZW51bXMuVEVYVFVSRV9GTVRfUkdCX0RYVDEgJiYgdGhpcy5fZm9ybWF0IDw9IGVudW1zLlRFWFRVUkVfRk1UX1JHQkFfUFZSVENfNEJQUFYxKSB8fCBcbiAgICAgICAgICAodGhpcy5fZm9ybWF0ID49IGVudW1zLlRFWFRVUkVfRk1UX1JHQl9FVEMyICYmIHRoaXMuX2Zvcm1hdCA8PSBlbnVtcy5URVhUVVJFX0ZNVF9SR0JBX0VUQzIpXG4gICAgICAgIDtcbiAgICAgIH1cblxuICAgICAgLy8gY2hlY2sgaWYgZ2VuZXJhdGUgbWlwbWFwXG4gICAgICBpZiAob3B0aW9ucy5nZW5NaXBtYXBzICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgdGhpcy5fZ2VuTWlwbWFwcyA9IG9wdGlvbnMuZ2VuTWlwbWFwcztcbiAgICAgICAgZ2VuTWlwbWFwcyA9IG9wdGlvbnMuZ2VuTWlwbWFwcztcbiAgICAgIH1cblxuICAgICAgaWYgKG9wdGlvbnMuaW1hZ2VzICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgaWYgKG9wdGlvbnMuaW1hZ2VzLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICBnZW5NaXBtYXBzID0gZmFsc2U7XG4gICAgICAgICAgaWYgKG9wdGlvbnMud2lkdGggIT09IG9wdGlvbnMuaGVpZ2h0KSB7XG4gICAgICAgICAgICBjb25zb2xlLndhcm4oJ3RleHR1cmUtY3ViZSB3aWR0aCBhbmQgaGVpZ2h0IHNob3VsZCBiZSBpZGVudGljYWwuJyk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChvcHRpb25zLndpZHRoID4+IChvcHRpb25zLmltYWdlcy5sZW5ndGggLSAxKSAhPT0gMSkge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcigndGV4dHVyZS1jdWJlIG1pcG1hcCBpcyBpbnZhbGlkLiBwbGVhc2Ugc2V0IG1pcG1hcCBhcyAxeDEsIDJ4MiwgNHg0IC4uLiBueG4nKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBOT1RFOiBnZXQgcG90IGFmdGVyIHRoaXMuX3dpZHRoLCB0aGlzLl9oZWlnaHQgaGFzIGJlZW4gYXNzaWduZWQuXG4gICAgbGV0IHBvdCA9IGlzUG93Mih0aGlzLl93aWR0aCkgJiYgaXNQb3cyKHRoaXMuX2hlaWdodCk7XG4gICAgaWYgKCFwb3QpIHtcbiAgICAgIGdlbk1pcG1hcHMgPSBmYWxzZTtcbiAgICB9XG5cbiAgICBnbC5hY3RpdmVUZXh0dXJlKGdsLlRFWFRVUkUwKTtcbiAgICBnbC5iaW5kVGV4dHVyZShnbC5URVhUVVJFX0NVQkVfTUFQLCB0aGlzLl9nbElEKTtcbiAgICBpZiAob3B0aW9ucy5pbWFnZXMgIT09IHVuZGVmaW5lZCAmJiBvcHRpb25zLmltYWdlcy5sZW5ndGggPiAwKSB7XG4gICAgICB0aGlzLl9zZXRNaXBtYXAob3B0aW9ucy5pbWFnZXMsIG9wdGlvbnMuZmxpcFksIG9wdGlvbnMucHJlbXVsdGlwbHlBbHBoYSk7XG4gICAgICBpZiAob3B0aW9ucy5pbWFnZXMubGVuZ3RoID4gMSkgdGhpcy5fZ2VuTWlwbWFwcyA9IHRydWU7XG4gICAgfVxuICAgIGlmIChnZW5NaXBtYXBzKSB7XG4gICAgICBnbC5oaW50KGdsLkdFTkVSQVRFX01JUE1BUF9ISU5ULCBnbC5OSUNFU1QpO1xuICAgICAgZ2wuZ2VuZXJhdGVNaXBtYXAoZ2wuVEVYVFVSRV9DVUJFX01BUCk7XG4gICAgICB0aGlzLl9nZW5NaXBtYXBzID0gdHJ1ZTtcbiAgICB9XG5cbiAgICB0aGlzLl9zZXRUZXhJbmZvKCk7XG5cbiAgICB0aGlzLl9kZXZpY2UuX3Jlc3RvcmVUZXh0dXJlKDApO1xuICB9XG5cbiAgLyoqXG4gICAqIEBtZXRob2QgdXBkYXRlU3ViSW1hZ2VcbiAgICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnNcbiAgICogQHBhcmFtIHtOdW1iZXJ9IG9wdGlvbnMueFxuICAgKiBAcGFyYW0ge051bWJlcn0gb3B0aW9ucy55XG4gICAqIEBwYXJhbSB7TnVtYmVyfSBvcHRpb25zLndpZHRoXG4gICAqIEBwYXJhbSB7TnVtYmVyfSBvcHRpb25zLmhlaWdodFxuICAgKiBAcGFyYW0ge051bWJlcn0gb3B0aW9ucy5sZXZlbFxuICAgKiBAcGFyYW0ge051bWJlcn0gb3B0aW9ucy5mYWNlSW5kZXhcbiAgICogQHBhcmFtIHtIVE1MQ2FudmFzRWxlbWVudCB8IEhUTUxJbWFnZUVsZW1lbnQgfCBIVE1MVmlkZW9FbGVtZW50IHwgQXJyYXlCdWZmZXJWaWV3fSBvcHRpb25zLmltYWdlXG4gICAqIEBwYXJhbSB7Qm9vbGVhbn0gb3B0aW9ucy5mbGlwWVxuICAgKiBAcGFyYW0ge0Jvb2xlYW59IG9wdGlvbnMucHJlbXVsdGlwbHlBbHBoYVxuICAgKi9cbiAgdXBkYXRlU3ViSW1hZ2Uob3B0aW9ucykge1xuICAgIGxldCBnbCA9IHRoaXMuX2RldmljZS5fZ2w7XG4gICAgbGV0IGdsRm10ID0gZ2xUZXh0dXJlRm10KHRoaXMuX2Zvcm1hdCk7XG5cbiAgICBnbC5hY3RpdmVUZXh0dXJlKGdsLlRFWFRVUkUwKTtcbiAgICBnbC5iaW5kVGV4dHVyZShnbC5URVhUVVJFX0NVQkVfTUFQLCB0aGlzLl9nbElEKTtcbiAgICB0aGlzLl9zZXRTdWJJbWFnZShnbEZtdCwgb3B0aW9ucyk7XG5cbiAgICB0aGlzLl9kZXZpY2UuX3Jlc3RvcmVUZXh0dXJlKDApO1xuICB9XG5cbiAgLyoqXG4gICAqIEBtZXRob2QgdXBkYXRlSW1hZ2VcbiAgICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnNcbiAgICogQHBhcmFtIHtOdW1iZXJ9IG9wdGlvbnMud2lkdGhcbiAgICogQHBhcmFtIHtOdW1iZXJ9IG9wdGlvbnMuaGVpZ2h0XG4gICAqIEBwYXJhbSB7TnVtYmVyfSBvcHRpb25zLmxldmVsXG4gICAqIEBwYXJhbSB7TnVtYmVyfSBvcHRpb25zLmZhY2VJbmRleFxuICAgKiBAcGFyYW0ge0hUTUxDYW52YXNFbGVtZW50IHwgSFRNTEltYWdlRWxlbWVudCB8IEhUTUxWaWRlb0VsZW1lbnQgfCBBcnJheUJ1ZmZlclZpZXd9IG9wdGlvbnMuaW1hZ2VcbiAgICogQHBhcmFtIHtCb29sZWFufSBvcHRpb25zLmZsaXBZXG4gICAqIEBwYXJhbSB7Qm9vbGVhbn0gb3B0aW9ucy5wcmVtdWx0aXBseUFscGhhXG4gICAqL1xuICB1cGRhdGVJbWFnZShvcHRpb25zKSB7XG4gICAgbGV0IGdsID0gdGhpcy5fZGV2aWNlLl9nbDtcbiAgICBsZXQgZ2xGbXQgPSBnbFRleHR1cmVGbXQodGhpcy5fZm9ybWF0KTtcblxuICAgIGdsLmFjdGl2ZVRleHR1cmUoZ2wuVEVYVFVSRTApO1xuICAgIGdsLmJpbmRUZXh0dXJlKGdsLlRFWFRVUkVfQ1VCRV9NQVAsIHRoaXMuX2dsSUQpO1xuICAgIHRoaXMuX3NldEltYWdlKGdsRm10LCBvcHRpb25zKTtcbiAgICB0aGlzLl9kZXZpY2UuX3Jlc3RvcmVUZXh0dXJlKDApO1xuICB9XG5cbiAgX3NldFN1YkltYWdlKGdsRm10LCBvcHRpb25zKSB7XG4gICAgbGV0IGdsID0gdGhpcy5fZGV2aWNlLl9nbDtcbiAgICBsZXQgZmxpcFkgPSBvcHRpb25zLmZsaXBZO1xuICAgIGxldCBwcmVtdWx0aXBseUFscGhhID0gb3B0aW9ucy5wcmVtdWx0aXBseUFscGhhO1xuICAgIGxldCBmYWNlSW5kZXggPSBvcHRpb25zLmZhY2VJbmRleDtcbiAgICBsZXQgaW1nID0gb3B0aW9ucy5pbWFnZTtcblxuICAgIGlmIChmbGlwWSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICBnbC5waXhlbFN0b3JlaShnbC5VTlBBQ0tfRkxJUF9ZX1dFQkdMLCBmYWxzZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGdsLnBpeGVsU3RvcmVpKGdsLlVOUEFDS19GTElQX1lfV0VCR0wsIGZsaXBZKTtcbiAgICB9XG5cbiAgICBpZiAocHJlbXVsdGlwbHlBbHBoYSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICBnbC5waXhlbFN0b3JlaShnbC5VTlBBQ0tfUFJFTVVMVElQTFlfQUxQSEFfV0VCR0wsIGZhbHNlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgZ2wucGl4ZWxTdG9yZWkoZ2wuVU5QQUNLX1BSRU1VTFRJUExZX0FMUEhBX1dFQkdMLCBwcmVtdWx0aXBseUFscGhhKTtcbiAgICB9XG5cbiAgICBpZiAoaW1nICYmICFBcnJheUJ1ZmZlci5pc1ZpZXcoaW1nKSAmJiAhKGltZyBpbnN0YW5jZW9mIEFycmF5QnVmZmVyKSkge1xuICAgICAgZ2wudGV4U3ViSW1hZ2UyRChnbC5URVhUVVJFX0NVQkVfTUFQX1BPU0lUSVZFX1ggKyBmYWNlSW5kZXgsIG9wdGlvbnMubGV2ZWwsIG9wdGlvbnMueCwgb3B0aW9ucy55LCBnbEZtdC5mb3JtYXQsIGdsRm10LnBpeGVsVHlwZSwgaW1nKTtcbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKHRoaXMuX2NvbXByZXNzZWQpIHtcbiAgICAgICAgZ2wuY29tcHJlc3NlZFRleFN1YkltYWdlMkQoZ2wuVEVYVFVSRV9DVUJFX01BUF9QT1NJVElWRV9YICsgZmFjZUluZGV4LFxuICAgICAgICAgIG9wdGlvbnMubGV2ZWwsXG4gICAgICAgICAgb3B0aW9ucy54LFxuICAgICAgICAgIG9wdGlvbnMueSxcbiAgICAgICAgICBvcHRpb25zLndpZHRoLFxuICAgICAgICAgIG9wdGlvbnMuaGVpZ2h0LFxuICAgICAgICAgIGdsRm10LmZvcm1hdCxcbiAgICAgICAgICBpbWdcbiAgICAgICAgKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGdsLnRleFN1YkltYWdlMkQoXG4gICAgICAgICAgZ2wuVEVYVFVSRV9DVUJFX01BUF9QT1NJVElWRV9YICsgZmFjZUluZGV4LFxuICAgICAgICAgIG9wdGlvbnMubGV2ZWwsXG4gICAgICAgICAgb3B0aW9ucy54LFxuICAgICAgICAgIG9wdGlvbnMueSxcbiAgICAgICAgICBvcHRpb25zLndpZHRoLFxuICAgICAgICAgIG9wdGlvbnMuaGVpZ2h0LFxuICAgICAgICAgIGdsRm10LmZvcm1hdCxcbiAgICAgICAgICBnbEZtdC5waXhlbFR5cGUsXG4gICAgICAgICAgaW1nXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgX3NldEltYWdlKGdsRm10LCBvcHRpb25zKSB7XG4gICAgbGV0IGdsID0gdGhpcy5fZGV2aWNlLl9nbDtcbiAgICBsZXQgZmxpcFkgPSBvcHRpb25zLmZsaXBZO1xuICAgIGxldCBwcmVtdWx0aXBseUFscGhhID0gb3B0aW9ucy5wcmVtdWx0aXBseUFscGhhO1xuICAgIGxldCBmYWNlSW5kZXggPSBvcHRpb25zLmZhY2VJbmRleDtcbiAgICBsZXQgaW1nID0gb3B0aW9ucy5pbWFnZTtcblxuICAgIGlmIChmbGlwWSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICBnbC5waXhlbFN0b3JlaShnbC5VTlBBQ0tfRkxJUF9ZX1dFQkdMLCBmYWxzZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGdsLnBpeGVsU3RvcmVpKGdsLlVOUEFDS19GTElQX1lfV0VCR0wsIGZsaXBZKTtcbiAgICB9XG5cbiAgICBpZiAocHJlbXVsdGlwbHlBbHBoYSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICBnbC5waXhlbFN0b3JlaShnbC5VTlBBQ0tfUFJFTVVMVElQTFlfQUxQSEFfV0VCR0wsIGZhbHNlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgZ2wucGl4ZWxTdG9yZWkoZ2wuVU5QQUNLX1BSRU1VTFRJUExZX0FMUEhBX1dFQkdMLCBwcmVtdWx0aXBseUFscGhhKTtcbiAgICB9XG4gICAgaWYgKGltZyAmJiAhQXJyYXlCdWZmZXIuaXNWaWV3KGltZykgJiYgIShpbWcgaW5zdGFuY2VvZiBBcnJheUJ1ZmZlcikpIHtcbiAgICAgIGdsLnRleEltYWdlMkQoXG4gICAgICAgIGdsLlRFWFRVUkVfQ1VCRV9NQVBfUE9TSVRJVkVfWCArIGZhY2VJbmRleCxcbiAgICAgICAgb3B0aW9ucy5sZXZlbCxcbiAgICAgICAgZ2xGbXQuaW50ZXJuYWxGb3JtYXQsXG4gICAgICAgIGdsRm10LmZvcm1hdCxcbiAgICAgICAgZ2xGbXQucGl4ZWxUeXBlLFxuICAgICAgICBpbWdcbiAgICAgICk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmICh0aGlzLl9jb21wcmVzc2VkKSB7XG4gICAgICAgIGdsLmNvbXByZXNzZWRUZXhJbWFnZTJEKFxuICAgICAgICAgIGdsLlRFWFRVUkVfQ1VCRV9NQVBfUE9TSVRJVkVfWCArIGZhY2VJbmRleCxcbiAgICAgICAgICBvcHRpb25zLmxldmVsLFxuICAgICAgICAgIGdsRm10LmludGVybmFsRm9ybWF0LFxuICAgICAgICAgIG9wdGlvbnMud2lkdGgsXG4gICAgICAgICAgb3B0aW9ucy5oZWlnaHQsXG4gICAgICAgICAgMCxcbiAgICAgICAgICBpbWdcbiAgICAgICAgKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGdsLnRleEltYWdlMkQoXG4gICAgICAgICAgZ2wuVEVYVFVSRV9DVUJFX01BUF9QT1NJVElWRV9YICsgZmFjZUluZGV4LFxuICAgICAgICAgIG9wdGlvbnMubGV2ZWwsXG4gICAgICAgICAgZ2xGbXQuaW50ZXJuYWxGb3JtYXQsXG4gICAgICAgICAgb3B0aW9ucy53aWR0aCxcbiAgICAgICAgICBvcHRpb25zLmhlaWdodCxcbiAgICAgICAgICAwLFxuICAgICAgICAgIGdsRm10LmZvcm1hdCxcbiAgICAgICAgICBnbEZtdC5waXhlbFR5cGUsXG4gICAgICAgICAgaW1nXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLy8gbGV2ZWxJbWFnZXMgPSBbaW1hZ2VQb3NYLCBpbWFnZU5lZ1gsIGltYWdlUG9zWSwgaW1hZ2VOZWdZLCBpbWFnZVBvc1osIGltYWdlTmVnel1cbiAgLy8gaW1hZ2VzID0gW2xldmVsSW1hZ2VzMCwgbGV2ZWxJbWFnZXMxLCAuLi5dXG4gIF9zZXRNaXBtYXAoaW1hZ2VzLCBmbGlwWSwgcHJlbXVsdGlwbHlBbHBoYSkge1xuICAgIGxldCBnbEZtdCA9IGdsVGV4dHVyZUZtdCh0aGlzLl9mb3JtYXQpO1xuICAgIGxldCBvcHRpb25zID0ge1xuICAgICAgd2lkdGg6IHRoaXMuX3dpZHRoLFxuICAgICAgaGVpZ2h0OiB0aGlzLl9oZWlnaHQsXG4gICAgICBmYWNlSW5kZXg6IDAsXG4gICAgICBmbGlwWTogZmxpcFksXG4gICAgICBwcmVtdWx0aXBseUFscGhhOiBwcmVtdWx0aXBseUFscGhhLFxuICAgICAgbGV2ZWw6IDAsXG4gICAgICBpbWFnZTogbnVsbFxuICAgIH07XG5cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGltYWdlcy5sZW5ndGg7ICsraSkge1xuICAgICAgbGV0IGxldmVsSW1hZ2VzID0gaW1hZ2VzW2ldO1xuICAgICAgb3B0aW9ucy5sZXZlbCA9IGk7XG4gICAgICBvcHRpb25zLndpZHRoID0gdGhpcy5fd2lkdGggPj4gaTtcbiAgICAgIG9wdGlvbnMuaGVpZ2h0ID0gdGhpcy5faGVpZ2h0ID4+IGk7XG5cbiAgICAgIGZvciAobGV0IGZhY2UgPSAwOyBmYWNlIDwgNjsgKytmYWNlKSB7XG4gICAgICAgIG9wdGlvbnMuZmFjZUluZGV4ID0gZmFjZTtcbiAgICAgICAgb3B0aW9ucy5pbWFnZSA9IGxldmVsSW1hZ2VzW2ZhY2VdO1xuICAgICAgICB0aGlzLl9zZXRJbWFnZShnbEZtdCwgb3B0aW9ucyk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgX3NldFRleEluZm8oKSB7XG4gICAgbGV0IGdsID0gdGhpcy5fZGV2aWNlLl9nbDtcbiAgICBsZXQgcG90ID0gaXNQb3cyKHRoaXMuX3dpZHRoKSAmJiBpc1BvdzIodGhpcy5faGVpZ2h0KTtcblxuICAgIC8vIFdlYkdMMSBkb2Vzbid0IHN1cHBvcnQgYWxsIHdyYXAgbW9kZXMgd2l0aCBOUE9UIHRleHR1cmVzXG4gICAgaWYgKCFwb3QgJiYgKHRoaXMuX3dyYXBTICE9PSBlbnVtcy5XUkFQX0NMQU1QIHx8IHRoaXMuX3dyYXBUICE9PSBlbnVtcy5XUkFQX0NMQU1QKSkge1xuICAgICAgY29uc29sZS53YXJuKCdXZWJHTDEgZG9lc25cXCd0IHN1cHBvcnQgYWxsIHdyYXAgbW9kZXMgd2l0aCBOUE9UIHRleHR1cmVzJyk7XG4gICAgICB0aGlzLl93cmFwUyA9IGVudW1zLldSQVBfQ0xBTVA7XG4gICAgICB0aGlzLl93cmFwVCA9IGVudW1zLldSQVBfQ0xBTVA7XG4gICAgfVxuXG4gICAgbGV0IG1pcEZpbHRlciA9IHRoaXMuX2dlbk1pcG1hcHMgPyB0aGlzLl9taXBGaWx0ZXIgOiAtMTtcbiAgICBpZiAoIXBvdCAmJiBtaXBGaWx0ZXIgIT09IC0xKSB7XG4gICAgICBjb25zb2xlLndhcm4oJ05QT1QgdGV4dHVyZXMgZG8gbm90IHN1cHBvcnQgbWlwbWFwIGZpbHRlcicpO1xuICAgICAgbWlwRmlsdGVyID0gLTE7XG4gICAgfVxuXG4gICAgZ2wudGV4UGFyYW1ldGVyaShnbC5URVhUVVJFX0NVQkVfTUFQLCBnbC5URVhUVVJFX01JTl9GSUxURVIsIGdsRmlsdGVyKGdsLCB0aGlzLl9taW5GaWx0ZXIsIG1pcEZpbHRlcikpO1xuICAgIGdsLnRleFBhcmFtZXRlcmkoZ2wuVEVYVFVSRV9DVUJFX01BUCwgZ2wuVEVYVFVSRV9NQUdfRklMVEVSLCBnbEZpbHRlcihnbCwgdGhpcy5fbWFnRmlsdGVyLCAtMSkpO1xuICAgIGdsLnRleFBhcmFtZXRlcmkoZ2wuVEVYVFVSRV9DVUJFX01BUCwgZ2wuVEVYVFVSRV9XUkFQX1MsIHRoaXMuX3dyYXBTKTtcbiAgICBnbC50ZXhQYXJhbWV0ZXJpKGdsLlRFWFRVUkVfQ1VCRV9NQVAsIGdsLlRFWFRVUkVfV1JBUF9ULCB0aGlzLl93cmFwVCk7XG4gICAgLy8gd3JhcFIgYXZhaWxhYmxlIGluIHdlYmdsMlxuICAgIC8vIGdsLnRleFBhcmFtZXRlcmkoZ2wuVEVYVFVSRV9DVUJFX01BUCwgZ2wuVEVYVFVSRV9XUkFQX1IsIHRoaXMuX3dyYXBSKTtcblxuICAgIGxldCBleHQgPSB0aGlzLl9kZXZpY2UuZXh0KCdFWFRfdGV4dHVyZV9maWx0ZXJfYW5pc290cm9waWMnKTtcbiAgICBpZiAoZXh0KSB7XG4gICAgICBnbC50ZXhQYXJhbWV0ZXJpKGdsLlRFWFRVUkVfQ1VCRV9NQVAsIGV4dC5URVhUVVJFX01BWF9BTklTT1RST1BZX0VYVCwgdGhpcy5fYW5pc290cm9weSk7XG4gICAgfVxuICB9XG59XG4iXSwic291cmNlUm9vdCI6Ii8ifQ==