"use strict";const e=require("electron").ipcMain,a=require("path"),r=require("fire-fs"),t=Editor.url("unpack://static/package-template");function i(e,a,t){var i=r.readFileSync(e,{encoding:"utf8"});r.writeFileSync(e,i.replace(new RegExp(a,"ig"),t),{encoding:"utf8"})}e.on("editor:create-package",(e,n)=>{var o="";"global"===n?o=a.join(Editor.App.home,"packages"):"project"===n&&(o=a.join(Editor.Project.path,"packages"));var c=Editor.Dialog.saveFile({title:Editor.T("MESSAGE.package.title"),defaultPath:o,buttonLabel:Editor.T("MESSAGE.package.create")});if(c)return r.isDirSync(c)?(Editor.error("Failed to create package at "+c+", Directory already exists!"),void 0):(function(e,n){var o=a.basename(e);r.copy(t,e,function(r){if(r)return n(r);(function(e,r,n){var o=a.basename(t);return i(a.join(r,"package.json"),o,e),i(a.join(r,"main.js"),o,e),i(a.join(r,"panel","index.js"),o,e),n(null)})(o,e,n)})}(c,function(e){e?Editor.error(e):Editor.success("Create package successfully at "+c)}),void 0)});