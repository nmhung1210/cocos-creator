"use strict";const e=require("fire-fs"),t=require("path"),r=require("../utils/data"),i=require("../utils/cloud");exports.template=e.readFileSync(t.join(__dirname,"../template/prefab.html"),"utf-8"),exports.props=["prefab","zoom"],exports.data=function(){return{time:0,rename:!1,img:{width:60*this.zoom,height:60*this.zoom},text:{width:60*this.zoom}}},exports.watch={zoom(){this.text.width=this.img.width=this.img.height=60*this.zoom}},exports.methods={queryIcon:(e,t)=>e.icon?`${e.icon}?_t=${t}`:`${r.queryIcon(e.uuid)}?_t=${t}`,whetherRename(e){this.rename=this.prefab.uuid===e},updatIcon(e){e===this.prefab.uuid&&this.time++},onMouseUp(e){if(e.preventDefault(),2!==e.button)return!1;Editor.Ipc.sendToMain("node-library:popup-prefab-menu",e.x,e.y,{id:this.prefab.uuid})},onDragStart(e){if(e.stopPropagation(),this.prefab.component)return Editor.UI.DragDrop.start(e.dataTransfer,{effect:"copyMove",type:"cloud-function",items:[{path:this.prefab.component}],options:{unlinkPrefab:!0,from:"node-library"}}),void 0;Editor.UI.DragDrop.start(e.dataTransfer,{effect:"copyMove",type:"asset",items:[{id:this.prefab.uuid,name:this.prefab.name,assetType:"prefab"}],options:{unlinkPrefab:!0,from:"node-library"}})},onDragEnd(e){Editor.UI.DragDrop.end(),this.prefab.file&&i.dropCloudFunction(this.prefab.file)},onInputBlur(e){this.rename=!1,r.renameUserPrefab(this.prefab.uuid,e.target.value)},onInputKeyUp(e){switch(e.keyCode){case 13:this.rename=!1,r.renameUserPrefab(this.prefab.uuid,e.target.value);break;case 27:this.rename=!1,e.target.value=this.prefab.name}}},exports.directives={"input-init"(){requestAnimationFrame(()=>{this.el.focus()})}},exports.created=function(){r.event.on("start-rename",this.whetherRename),r.event.on("prefab-icon-changed",this.updatIcon)},exports.destroyed=function(){r.event.removeListener("start-rename",this.whetherRename),r.event.removeListener("prefab-icon-changed",this.updatIcon)};