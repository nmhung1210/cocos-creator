"use strict";const o=require("./fs"),t=require("fs-extra"),e=require("path"),n=Editor.remote?Editor.remote.App.home:Editor.App.home,r=e.join(n,"cloud-component");t.ensureDirSync(r),exports.install=function(n,i){return new Promise((n,s)=>{const c=e.join(r,".temp");t.existsSync(c)&&t.removeSync(c),o.unzip(i,c,function(o){if(o)return s(o);const d=t.readdirSync(c).filter(o=>{const n=e.join(c,o);return!t.existsSync(n),"__MACOSX"!==o&&(!!t.statSync(n).isDirectory()||void 0)});if(1!==d.length)return Editor.warn(Editor.T("store.cloudComponent.do_not_install")+"\n"+i),s(new Error(Editor.T("store.cloudComponent.do_not_install")));const l=e.join(r,d[0]);if(t.existsSync(l)){if(1===Editor.Dialog.messageBox({title:Editor.T("store.cloudComponent.install"),message:Editor.T("store.cloudComponent.exists"),buttons:[Editor.T("store.button.confirm"),Editor.T("store.button.cancel")],defaultId:0,cancelId:0}))return n(),void 0;t.removeSync(l)}return t.copySync(e.join(c,d[0]),e.join(r,d[0])),Editor.Ipc.sendToAll("store:cloud-component-install"),Editor.Dialog.messageBox({title:Editor.T("store.cloudComponent.install"),message:Editor.T("store.cloudComponent.success"),buttons:[Editor.T("store.button.confirm")],defaultId:0,cancelId:0}),Editor.Ipc.sendToAll("store:cloud-component-installation-completed"),n()})})};