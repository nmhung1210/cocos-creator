"use strcit";const{join:e}=require("path"),{readFileSync:t}=require("fs"),{shell:o,ipcRenderer:r}=require("electron"),s=require("vue/dist/vue");let i=!1,a=null;(function(){try{const e=`${Editor.remote.App.home}/profiles/store.json`;i=require("fire-fs").readJSONSync(e).test}catch(e){}})(),exports.template=t(e(__dirname,"./index.html"),"utf8"),exports.$={webview:"webview"},exports.messages={update(){a&&a.upateStoreList()}},r.on("store:update",()=>a&&a.upateStoreList());const n=Editor.require("app://share/@base/electron-base-ipc");exports.ready=async function(){const e=this.$.webview instanceof HTMLElement?this.$.webview:document.querySelector("webview"),t=await n.send("creator-libs-user:call","getUserData").promise(),r=i?"test-":"",c=t.session_id;var d=`https://${r}store.cocos.com/creator/index/#/c?language=${Editor.lang}`,l=`https://${r}creator-api.cocos.com/api/account/client_signin?session_id=${c}&client_type=2&redirect_url=${encodeURIComponent(d)}`;requestAnimationFrame(()=>e.setAttribute("src",l)),e.getWebContents().session.clearStorageData(["appcache","cookies","filesystem","indexdb","localstorage","shadercache","websql","serviceworkers","cachestorage"]),e.addEventListener("did-navigate-in-page",e=>{console.log(`本地导航 - ${e.url}`)}),e.addEventListener("new-window",e=>{if(e.stopPropagation(),e.preventDefault(),console.log(`打开新页面 - ${e.url}`),!/\/pay\//.test(e.url))return/\/creator\/download/.test(e.url)?(Editor.Ipc.sendToPackage("store","download",e.url),a&&(a.show.slider=!0),void 0):(/cocos\.com/.test(e.url)&&o.openExternal(e.url),void 0)}),a=new s({el:document.querySelector(".content"),data:{show:{slider:!1},list:[]},components:{slider:require("./components/slider")},methods:{upateStoreList(){Editor.Ipc.sendToPackage("store","query-download-list",(e,t)=>this.list=t)},goBack(){e.goBack()},goForward(){e.goForward()},goHome(){e.src=l},reload(){e.reload()}},ready(){this.upateStoreList()}})};