const e=require("fire-fs"),i=require("fire-path"),r=require("./lib/jszip.min.js"),t=require("electron"),o="fb-instant-games";function n(n,s){if(n.platform!==o)return s();let d=new r;d.directory(n.dest,i.basenameNoExt(n.dest));let l=i.join(n.dest,n.title+".zip");d.generateNodeStream({type:"nodebuffer",compression:"DEFLATE",compressionOptions:{level:9}}).pipe(e.createWriteStream(l)).on("finish",()=>{t.shell.showItemInFolder(l),s()})}r.prototype.directory=function(r,t){if(!e.statSync(r).isDirectory())return Editor.error(r+" is not a folder!"),void 0;e.readdirSync(r).forEach(function(r){let t=this.zip,o=i.join(this.srcPath,r),n=e.statSync(o);n.isDirectory()?t.directory(o,r):n.isFile()?t.file(r,e.readFileSync(o)):Editor.error(o+" was not added to zip!")}.bind({srcPath:r,zip:this.folder(t)}))},module.exports={load(){Editor.Builder.on("build-finished",n)},unload(){Editor.Builder.removeListener("build-finished",n)},messages:{}};