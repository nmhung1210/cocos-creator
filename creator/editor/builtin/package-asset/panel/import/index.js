var e=require("fire-fs"),t=require("fire-path"),s=Editor.require("packages://package-asset/utils.js"),a=Editor.require("packages://package-asset/parse/import.js");Editor.require("packages://package-asset/lib/jszip-utils.min.js"),Editor.require("packages://package-asset/lib/jszip.min.js");const r=Editor.require("packages://package-asset/panel/common/asset-item.js");Vue.component("package-asset-item",r),Editor.Panel.extend({style:e.readFileSync(Editor.url("packages://package-asset/panel/style.css"))+"",template:e.readFileSync(Editor.url("packages://package-asset/panel/import/panel.html"))+"",ready(){s.init(this.profiles),this._vm=new window.Vue({el:this.shadowRoot,created(){this.outPath=t.join(Editor.Project.path,"assets"),this.folderPath="",this._lastfolderPath=""},data:{outPath:"",folderPath:"",filetree:[],selectAll:!0,progress:0,progressState:s.T("IMPORT_ASSET.progress_state_wait")},watch:{folderPath:{handler(e){if(s.save("import-folder-path",e),!e)return this.filetree=null,this.progressState=s.T("IMPORT_ASSET.progress_state_wait"),void 0;console.time(),a.analyticalZip(e,(e,t)=>{if(console.timeEnd(),e)return this.folderPath=this._lastfolderPath,void 0;this.filetree=t,this.progressState=s.T("IMPORT_ASSET.progress_state_ready")})}}},methods:{T:s.T,_isDisabled(){return""===this.folderPath||""===this.outPath},changeSelectAll(e){this.selectAll=e.children.every(e=>e.selected)},onSelectAll(e){s.changedAssetTreeSelectState(this.filetree,e.detail.value)},onChooseImportFolder(){s.showImportZipDialog((e,t)=>{this._lastfolderPath=this.folderPath,this.folderPath=t})},onChooseOutFolder(){s.showImportOutPathDialog((e,t)=>{this.outPath=t})},onImport(){a.importZip(this.outPath,this.filetree,e=>{this.progress=e.curProgress/e.total*100,this.progressState=e.outStrLog})}}})}});