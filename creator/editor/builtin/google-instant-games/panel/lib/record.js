"use strict";const e=require("fs"),t=require("path"),i=require("../lib/resource"),n=require("../lib/info");t.join(Editor.Project.path,"temp","android-instant-games","profiles");let r=null,u=null,s={},l=null,f=[],o=[],d=function(i){let n=t.join(i,"timeline.json"),r=[];if(e.existsSync(n)){let t=e.readFileSync(n,"utf-8");try{r=JSON.parse(t)}catch(e){console.warn(e)}}return r},c=function(e){let t=d(e),i=t[0];return t[t.length-1].ts-i.ts},a=function(){if(!r)return[];let e=f.filter(e=>{if(-1===r.indexOf(e))return e});return e=e.concat(o.filter(e=>{if(-1===r.indexOf(e))return e})),r.concat(e)};module.exports={queryRecordMs:c,queryRecordScreenshots:function(e){let i=d(e);return i=(i=i.filter(e=>!!e.screenshot)).map(i=>t.join(e,i.screenshot))},queryRecordResources:async function(e,t){let n=l,d=c(e),h=n[0].ts+Math.round(d*t);r=[],u=[];for(let e=0;e<n.length;e++){let t=n[e];if(t.items)for(let e=0;e<t.items.length;e++){let n=t.items[e];if(n.uuid){let e=await i.queryAssetInfo(n.uuid);if(!e)continue;s[e.uuid]=e,-1!==o.indexOf(e)&&(e.selected=!0),-1!==f.indexOf(e)&&(e.selected=!1),t.ts>h?u.push(e):r.push(e)}}}return a()},querySelectedResource:a,queryLastResource:function(){if(!u)return[];let e=f.filter(e=>{if(-1===u.indexOf(e))return e}),t=u.filter(e=>{if(-1===o.indexOf(e))return e});return e.concat(t)},moveToRemoveList:function(e){if(!r)return;let t=r.find(t=>t.uuid===e);t&&-1===f.indexOf(t)&&f.push(t);let i=o.find(t=>t.uuid===e);i&&o.splice(o.indexOf(i),1),i&&-1===f.indexOf(i)&&f.push(i)},moveToAddList:function(e){if(!u)return;let t=f.find(t=>t.uuid===e);t&&(t.selected=!0,f.splice(f.indexOf(t),1),-1===o.indexOf(t)&&o.push(t));let i=u.find(t=>t.uuid===e);i&&(i.selected=!0,-1===o.indexOf(i)&&o.push(i))},addManualItem:function(e){let t="fail";do{if(s[e.uuid]){t="exist";break}s[e.uuid]=e,-1!==f.indexOf(e)&&f.splice(f.indexOf(e),1),-1===o.indexOf(e)&&o.push(e),t="success"}while(0);return t},loadData:async function(e){let t=n.readJson(e);l=d(e),o.length=0,f.length=0;for(let e in s)delete s[e];for(let e=0;e<t.addList.length;e++){let n=t.addList[e],r=await i.queryAssetInfo(n);r.selected=!0,o.push(r)}if(t.removeList)for(let e=0;e<t.removeList.length;e++){let n=t.removeList[e],r=await i.queryAssetInfo(n);r.selected=!1,f.push(r)}},removeList:f,addList:o};