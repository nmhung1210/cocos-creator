"use strict";const e=require("../libs/advice"),{promisify:i}=require("util"),t=require("../libs/dump");let r=null;module.exports={selected(e,i,r){"node"===i&&t.update(()=>{this.vm.updateState()})},unselected(e,i){"node"===i&&t.update()},async activated(a,d,h){if("node"!==d||!h)return;if(clearTimeout(r),this.vm&&this.vm.hierarchy.some(i=>i.id===h&&(e.emit("change-node",i),!0)),!this.vm||this.vm.record)return;let n=await i(Editor.Ipc.sendToPanel)("scene","scene:query-animation-hierarchy",h);n=JSON.parse(n),this.vm.hierarchy&&this.vm.hierarchy[0]&&n[0].id===this.vm.hierarchy[0].id||(e.emit("change-hierarchy",function(e){let i=[];for(;i.length;)i.pop();let t=[],r=function(e,a,d){if(e.hidden)return;d=`${d}/${e.name}`;let h=!1;-1===t.indexOf(d)?t.push(d):h=!0,i.push({id:e.id,path:d,name:e.name,level:a,state:0,disabled:h}),e.children&&e.children.forEach(e=>{r(e,a+1,d)})};return e.forEach(e=>{r(e,0,"")}),i}(n)),t.root=n[0].id,this.vm.updateClips())},deactivated(i,a,d){if("node"===a&&d)return this.vm.record?(r=setTimeout(()=>{e.emit("change-node",{id:"",path:"////"})},100),void 0):(r=setTimeout(()=>{e.emit("change-hierarchy",[]),t.root="",this.vm.updateClips()},100),void 0)}};