"use strict";window.Cache=module.exports;const e=require("./event");let t={},r={id:"root",children:[],show:!0},n=[],o=[];exports.lineHeight=19,exports.queryCache=function(){return t},exports.queryRoot=function(){return r},exports.queryNodes=function(){return n},exports.queryShowNodes=function(){return o},exports.updateShowNodes=function(e){o.length=[],e.forEach(e=>{o.push(e)})},exports.copyUuids=[],exports.queryNode=function(e){let r=t[e];return r||null},exports.genAssetsTree=function(e){e.forEach(e=>{t[e.uuid]=i(e)}),r.children.length=0;for(let e in t){let o=t[e];o.hidden||(o.parent?(o.level=t[o.parent].level+1,t[o.parent].children.push(o),n.push(o)):(r.children.push(o),o.level=0))}return n.sort(Cache.sortChildrenNodes),this.sortAssetsTree(),r};let s="name";const l=Editor.Profile.load("project://project.json");exports.sortAssetsTree=function(e){e=e||r.children,s=l.get("assets-sort-type"),function e(t){t&&(t.sort(exports.sortChildrenNodes),t.forEach(t=>{e(t.children)}))}(e)},exports.sortChildrenNodes=((e,t)=>{let r="folder"===e.assetType,n="folder"===t.assetType;return r||n?r&&n?e.name.localeCompare(t.name,"en",{numeric:!0}):r?-1:1:"ext"===s&&e.extname!==t.extname?e.extname.localeCompare(t.extname):e.name.localeCompare(t.name,"en",{numeric:!0})});let i=function(e){return{id:e.uuid,name:e.name,extname:e.extname,assetType:e.type,isSubAsset:e.isSubAsset,readonly:e.readonly,hidden:e.hidden,parent:e.parentUuid||null,children:[],selected:!1,fold:!0,show:!e.parentUuid,rename:!1,level:0,hint:!1,iconUrl:null,isMount:"mount"===e.type}};exports.add=function(o){o=i(o),t[o.id]=o;let s=t[o.parent];if(s){o.level=s.level+1;let e=function(e,t,r){for(var n=0,o=e.length-1,s=o>>>1;n<=o;s=n+o>>>1){var l=r(e[s],t);if(l>0)o=s-1;else{if(!(l<0))return s;n=s+1}}return~n}(s.children,o,this.sortChildrenNodes);e<0&&(e=~e),s.children.splice(e,0,o)}else r.children.push(o);n.push(o),e.emit("node-added",o)},exports.remove=function(o){let s=this.queryNode(o),l=s.parent?t[s.parent]:r;if(l){let e=l.children.indexOf(s);e>-1&&l.children.splice(e,1)}delete t[o];let i=n.indexOf(s);return i>-1&&n.splice(i,1),e.emit("node-removed",s),!0};