"use strict";const e=require("fire-fs"),o=require("semver"),t=require("electron");var r=0;module.exports={load(){},unload(){},messages:{open(e,o){o&&void 0!==o.tab&&(r=o.tab),Editor.Panel.open("project-settings")},close(e){Editor.Panel.close("project-settings")},"save-simulator-config"(o,t,r){if(!r)return;let s=Editor.url(t)+".json";e.existsSync(s)&&e.writeJsonSync(s,r,"utf8")},"query-tab"(e){e.reply(null,r)},"update-tab"(e,o){r=o}}},t.ipcMain.on("migrate-project",function(t,r){if(r||(r=function(){const t=require("path"),r=require("globby");let s,n=t.join(Editor.Project.path,"assets");try{let o=r.sync(`${n}/**/*.@(png|jpg).meta`,{nodir:!0,caseSensitiveMatch:!1,absolute:!0});if(!(o.length>0))return console.warn("can not guess last project version, no texture meta found"),void 0;s=e.readJsonSync(o[0])}catch(e){return console.error(e),void 0}return s&&s.ver?o.satisfies(s.ver,"< 2.3.0",{includePrerelease:!0})?(console.log("last project version must < 2.1.0 since texture meta version < 2.3.0"),"2.0.10"):(console.log("last project version must >= 2.1.0 since texture meta version >= 2.3.0"),void 0):(console.error("can not guess last project version, texture meta version is invalid"),void 0)}()),r){console.log("migrating module config from "+r);try{let t=Editor.Profile.load("project://project.json"),s=t.get("excluded-modules"),n=e.readJsonSync(Editor.url("unpack://engine/modules.json")),i=!1;n.forEach(e=>{!s.includes(e.name)&&e.since&&o.satisfies(r,"< "+e.since,{includePrerelease:!0})&&(s.push(e.name),console.log(`exclude module ${e.name} because it was added since ${e.since}`),i=!0)}),i&&(t.set("excluded-modules",s),t.save())}catch(e){console.error(e)}}});