"use strict";const e=require("fire-fs");exports.template=e.readFileSync(Editor.url("packages://project-settings/panel/template/module.html"),"utf-8"),exports.props=["excluded"],exports.data=function(){return{module:null,all:!1}},exports.methods={T:Editor.T,_onSelectModule(e,t){t.options.forEach((e,d)=>{let s=`${t.name}/${e}`,n=this.excluded.indexOf(s),l=n>-1;d===parseInt(t.currentIndex)&&l?this.excluded.splice(n,1):l||this.excluded.push(s)})},_updateAllChekced(){this.all=this.module.every(e=>e.checked)},_updateExcluded(){clearTimeout(this._timer),this._timer=setTimeout(()=>{this.excluded.length=0,this.module.forEach(e=>{e.checked?e.options.forEach((t,d)=>{d!==parseInt(e.currentIndex)&&this.excluded.push(`${e.name}/${t}`)}):e.options.length>0?e.options.forEach(t=>{this.excluded.push(`${e.name}/${t}`)}):this.excluded.push(e.name)})},400)},_selectAll(e){this.all=e,this.module.forEach(t=>{t.locked||(t.checked=e)}),this._updateExcluded()},_selectModule(e,t){e.checked=t;let d=e.name;if(t){e.options.length>0&&(d=`${e.name}/${e.options[e.currentIndex]}`);let t=this.excluded.indexOf(d);this.excluded.splice(t,1),e.dependencies&&e.dependencies.forEach(e=>{this.module.some(t=>{if(t.name!==e)return!1;this._selectModule(t,!0)})})}else e.options.length>0?e.options.forEach(t=>{this.excluded.push(`${e.name}/${t}`)}):this.excluded.push(d),this.module.forEach(e=>{e.dependencies&&-1!==e.dependencies.indexOf(d)&&this._selectModule(e,!1)});this._updateAllChekced(),this._updateExcluded()}},exports.created=function(){this.all=!0,this.module=function(){const t=Editor.url("unpack://engine/modules.json");let d=[];return e.readJsonSync(t).forEach(e=>{let t,s=e.name.split("/").filter(Boolean),n=s.length>1;n&&(t=d.find(e=>e.name===s[0])),t||(t={name:s[0],checked:!0,hide:e.hide,locked:e.locked,since:e.since,dependencies:e.dependencies,options:[],currentIndex:0},d.push(t)),n&&t.options.push(s[1])}),d}(),this.excluded&&this.module.forEach(e=>{e.options.length>0?e.checked=e.options.some((t,d)=>!this.excluded.includes(`${e.name}/${t}`)&&(e.currentIndex=d,!0)):e.checked=!this.excluded.includes(e.name),e.checked||(this.all=!1)})};