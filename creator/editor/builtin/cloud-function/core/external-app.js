"use strict";const e=require("electron"),t=e.ipcMain,i=require("child_process").spawn,n=require("path"),o=require("fire-fs"),r=require("plist"),d=JSON.parse(o.readFileSync(Editor.App.home+"/profiles/settings.json"));t.on("cloud-function:open-text-file",function(t,i){if("default"===d["script-editor"])if(Editor.isWin32){1===Editor.Dialog.messageBox({type:"warning",buttons:[Editor.T("MESSAGE.cancel"),Editor.T("MESSAGE.yes")],title:Editor.T("MESSAGE.warning"),message:Editor.T("MESSAGE.warning"),detail:Editor.T("PREFERENCES.vacancy_script_editor_tips")})&&(Editor.Ipc.sendToMain("preferences:update-tab",1),Editor.Ipc.sendToPanel("preferences","update-tab",1),Editor.Panel.open("preferences"))}else e.shell.openItem(i);else i&&Editor.Ipc.sendToMain("cloud-function:open-text-file-by-path",i)}),t.on("cloud-function:open-text-file-by-path",function(e,t){let s=d["script-editor"];if("default"===s)return Editor.warn("Can not open "+t+" because text editor is not configured.");let a=[],p="";if("darwin"===process.platform){if(s.endsWith(".app")){s=n.join(s,"/Contents/MacOS/");let e=r.parse(o.readFileSync(n.join(s,"../Info.plist"),"utf8"));s=n.join(s,e.CFBundleExecutable)}-1!==s.indexOf("Visual Studio Code")?(p=s,a=[Editor.Project.path,t,"-n"]):(p="open",a=["-a",n.basename(s),t])}else-1!==s.indexOf("Code")?(p=s,a=[Editor.Project.path,t,"-r"]):(p=s,a=[t]);i(p,a,{detached:!0,stdio:"ignore"}).unref()});