"use strict";const e=require("electron"),s=require("fire-fs"),n=(require("fire-path"),require("path")),t=require("../selection");let l=function(){const e=`${Editor.Project.path}/settings/serverless.json`;var n=s.existsSync(e)?s.readFileSync(e):"{}",t=null;try{t=JSON.parse(n)}catch(e){}return t&&t.env_id?t.env_id:"undefinedenv"},o=function(e,...s){return Editor.T(`cloud-function.${e}`,...s)},i=function(e){var n=a();if(""===n)return!1;if(n+=Editor.isWin32?"\\":"/",e.split(n).length<=1)return!1;var t=e.split(n)[1],l=e.replace(t,t.split(/[\/|\\]+/)[0]);return s.existsSync(l+"/index.js")||s.existsSync(l+"/index.php")};function a(){const e=/serverless[\/|\\]+cloud-function[\/|\\]+/,s=/[\/|\\]+/;let n=t.contexts("cloud-function")[0];if(n.match(e)){var l=n.split(e);if(l.length>=2)return l[1].split(s)[0]}return""}module.exports={getContextTemplate:function(c,u,r,d){var f=[];if(null!==r)if(r.indexOf("mgobe-server")>-1)f=f.concat([{label:o("create-custom-server"),message:"cloud-function:custom-server-new",visible:!1,params:[{assetType:c,allowAssign:u,assetUuid:r,copyEnable:d}]},{label:o("publish-reboot"),message:"cloud-function:custom-server-release-stop",visible:"mount"!==c,params:[{assetType:c,allowAssign:u,assetUuid:r,copyEnable:d}]},{label:o("publish-noreboot"),message:"cloud-function:custom-server-release-not-stop",visible:"mount"!==c,params:[{assetType:c,allowAssign:u,assetUuid:r,copyEnable:d}]}]);else if(r.indexOf("cloud-function")>-1&&"cloud-function"!==n.basename(r)){let e=a(),s=function(e){let s=t.contexts("cloud-function")[0];return n.basename(s)===e}(e);f=f.concat([{label:o("create-cloud-func"),message:"cloud-function:cloud-function-new",visible:s,params:[{assetType:c,allowAssign:u,assetUuid:r,env_id:e,copyEnable:d}]},{label:o("sync-cloud-func"),message:"cloud-function:cloud-function-list",visible:s,params:[{assetType:c,allowAssign:u,assetUuid:r,env_id:e,copyEnable:d}]},{label:o("upload-cloud-func"),message:"cloud-function:cloud-function-upload",visible:"mount"!==c&&!s,enabled:i(r),params:[{assetType:c,allowAssign:u,assetUuid:r,env_id:e,copyEnable:d}]},{label:o("download-cloud-func"),message:"cloud-function:cloud-function-download",visible:"mount"!==c&&!s,params:[{assetType:c,allowAssign:u,assetUuid:r,env_id:e,copyEnable:d}]},{label:o("delete-cloud-func"),message:"cloud-function:cloud-function-delete",visible:"mount"!==c&&!s,params:[{assetType:c,allowAssign:u,assetUuid:r,env_id:e,copyEnable:d}]}])}return f=f.concat([{type:"separator"},{label:Editor.isDarwin?Editor.T("ASSETS.reveal_mac"):Editor.T("ASSETS.reveal_win"),click(){r&&s.existsSync(r)||(r=`${Editor.Project.path}/serverless/cloud-function/${l()}`),r&&s.existsSync(r)?e.shell.showItemInFolder(r):Editor.failed("Can not found the asset %s",r)}}])},getCreateTemplate:function(e,s,n){return[{label:o("create-cloud-func"),message:"cloud-function:cloud-function-new",params:[{assetType:s,env_id:l(),visible:"undefinedenv"!==l,assetUuid:n}]},{label:o("create-custom-server"),message:"cloud-function:custom-server-new",visible:!1,params:[{assetType:s,assetUuid:n}]}]}};