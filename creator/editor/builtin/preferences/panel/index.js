"use strict";const e=require("fire-fs"),t=(require("fire-path"),Editor.require("packages://preferences/panel/utils")),r=require("electron").remote.dialog;Editor.Panel.extend({style:e.readFileSync(Editor.url("packages://preferences/panel/style/home.css")),template:e.readFileSync(Editor.url("packages://preferences/panel/template/home.html")),ready(){t.init(),Editor.Ipc.sendToMain("preferences:query-tab",(e,i)=>{i=e?0:i;let n=function(e,i){return new Vue({el:e,data:{loaded:!0,changed:!1,tab:i||0,loading:!1,general:t.queryGeneral(),editor:t.queryEditor(),native:t.queryNative(),preview:t.queryPreview()},watch:{tab(e){Editor.Ipc.sendToMain("preferences:update-tab",e)},general:{deep:!0,handler(){this.changed=!0}},editor:{deep:!0,handler(){this.changed=!0}},native:{deep:!0,handler(){this.changed=!0}},preview:{deep:!0,handler(){this.changed=!0}},"native.useDefaultCppEngine"(e){let r=e?null:this.native.cppEnginePath;t.resetSimulatorConfig(r),this.preview=t.queryPreview()},"native.cppEnginePath"(e){e=this.native.useDefaultCppEngine?null:e,t.resetSimulatorConfig(e),this.preview=t.queryPreview()}},methods:{T:Editor.T,_selectTab(e){this.tab=e,Editor.Ipc.sendToMain("preferences:update-tab",e)},_save(){return this.native.useDefaultCppEngine||this.native.cppEnginePath?this.native.useDefaultJsEngine||this.native.jsEnginePath?(this.loading=!0,this.changed=!1,t.setGeneral(this.general),t.setEditor(this.editor),t.setNative(this.native),t.setPreview(this.preview),t.save(),setTimeout(()=>{this.loading=!1},300),void 0):(r.showErrorBox(Editor.T("PROJECT_SETTINGS.error.setting_error"),Editor.T("PROJECT_SETTINGS.error.custom_engine_empty_tips",{name:"JavaScript"})),void 0):(r.showErrorBox(Editor.T("PROJECT_SETTINGS.error.setting_error"),Editor.T("PROJECT_SETTINGS.error.custom_engine_empty_tips",{name:"Cocos2d-x"})),void 0)}},components:{general:Editor.require("packages://preferences/panel/components/general"),editor:Editor.require("packages://preferences/panel/components/editor"),native:Editor.require("packages://preferences/panel/components/native"),preview:Editor.require("packages://preferences/panel/components/preview")}})}(this.shadowRoot.getElementById("settings"),i);window.addEventListener("beforeunload",e=>{n.changed&&(e.returnValue=!0,process.nextTick(()=>{switch(Editor.Dialog.messageBox({type:"info",buttons:[Editor.T("MESSAGE.save"),Editor.T("MESSAGE.dont_save"),Editor.T("MESSAGE.cancel")],title:Editor.T("MESSAGE.warning"),message:Editor.T("MESSAGE.warning"),detail:Editor.T("MESSAGE.preferences.modified"),defaultId:0,cancelId:0,noLink:!0})){case 0:n._save();case 1:n.changed=!1,Editor.Ipc.sendToMain("preferences:close",i)}}))})})}});