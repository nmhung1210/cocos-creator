var r,e,o,i=require("path"),t=require("child_process").execSync,n=require("child_process").spawn,s=require("fire-fs"),d=require("fix-path");let u={npmRunServer:function(u,c){var p=function(){var r={};let e=(o=Editor.remote.Profile.load("profile://project/vivo-runtime.json").data).npmPath;return e?(Editor.log(Editor.T("vivo-runtime.custom_npm_path_config"),e),"win32"===process.platform?(r.Path=o.npmPath,r.Path+=";C:\\Windows\\System32"):(r.PATH=o.npmPath,r.PATH+=":/usr/bin:/bin:/usr/sbin:/sbin")):(Editor.log(Editor.T("vivo-runtime.custom_npm_path_not_config")),"win32"===!process.platform&&-1===process.env.PATH.indexOf(NPM_PATH)&&(process.env.PATH+=`:${NPM_PATH}`),d(),r=process.env),r}();if(!function(r){try{t("node -v",{env:r})}catch(r){return!1}return!0}(p))return function(){if(o&&o.npmPath)return Editor.error(Editor.T("vivo-runtime.custom_npm_path_config_error")),void 0;"win32"===process.platform?Editor.error(Editor.T("vivo-runtime.not_install_nodejs_windows_error_before_preview")):Editor.error(Editor.T("vivo-runtime.not_install_nodejs_mac_error_before_preview"))}(),void 0;var v=r.dest,a=i.join(v,"node_modules"),f=i.join(v,"dist");if(!s.existsSync(a)||!s.existsSync(f))return Editor.error(Editor.T("vivo-runtime.buidBeforePreview")),void 0;var m,_="win32"===process.platform?"npm.cmd":"npm";free=n(`${_}`,["run","server"],{env:p,cwd:v}),free.stdout.on("data",function(r){if(e=free.pid,r&&-1!==r.indexOf("地址 http:")){var o=r.toString().replace(/[\n\r]/g,"");return m=o.match(/http:\/\/[^\s]*:\d*/)[0],u(m),void 0}}),free.stderr.on("data",function(r){Editor.error(r)}),free.on("exit",function(r,e){}),free.on("close",function(r,e){})},setOptions:function(e){r=e},closePort:function(){var r=require(Editor.url("packages://vivo-runtime/lib/killPort"));e&&r(e,void 0),e=void 0},options:r};module.exports=u;