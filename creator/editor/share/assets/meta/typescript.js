"use strict";var e=require("fire-fs"),t=require("convert-source-map"),r=require("typescript"),o=require("path");module.exports=class extends(require("./javascript")){static defaultType(){return"typescript"}static validate(e){return!e.endsWith(".d.ts")}compile(i,s){var c,a="";try{a=e.readFileSync(i,{encoding:"utf8"});let t,n=o.join(Editor.Project.path,"tsconfig.json"),p={target:"ES5",sourceMap:!0,allowJS:!0,experimentalDecorators:!0,allowSyntheticDefaultImports:!0,pretty:!0,noEmitHelpers:!0,noImplicitUseStrict:!0,module:r.ModuleKind.CommonJS};try{let o=e.readFileSync(n,"utf8"),i=r.parseConfigFileTextToJson(n,o);i.error?(Editor.error("Error in tsconfig.json: "+i.error.messageText),t=p):(t=i.config.compilerOptions).sourceMap=!0}catch(e){t=p}c=r.transpileModule(a,{compilerOptions:t})}catch(e){return s(e)}let n=JSON.parse(c.sourceMapText);n.sourcesContent=[a],n.file="",c.sourceMapObject=n,c.outputText=t.removeMapFileComments(c.outputText),s(null,c)}};