"use strict";const e=require("fire-url"),r=require("fire-fs"),{protocol:o}=require("electron"),t=require("./utils");o.registerFileProtocol("unpack",(r,o)=>{let i=decodeURIComponent(r.url),s=e.parse(i),n=t.unpackUrl2path(s);o(n?{path:n}:-6)},e=>{if(e)return Editor.failed("Failed to register protocol unpack, %s",e.message),void 0;Editor.success("protocol unpack registerred")}),o.registerStringProtocol("disable-commonjs",(o,t)=>{let i,s=e.parse(o.url);if(!s.slashes)return Editor.error('Please use "disable-commonjs://" + fspath.'),t(-6);let n=decodeURIComponent(s.hostname),l=decodeURIComponent(s.pathname);console.log(`Parsing disable-commonjs protocol, url: "${o.url}", hostname: "${n}", pathname: "${l}"`),(i=Editor.isWin32?n+":"+l:l)?r.readFile(i,"utf8",(e,r)=>{if(e)return Editor.error(`Failed to read ${i}, ${e}`),t(-6);t({data:function(e){const r="(function(){var require = undefined;var module = undefined; ";let o=e.lastIndexOf("\n");if(-1!==o){let t=e.slice(o).trimLeft();if(t||(o=e.lastIndexOf("\n",o-1),t=e.slice(o).trimLeft()),t.startsWith("//"))return r+e.slice(0,o)+"\n})();\n"+t}return r+e+"\n})();\n"}(r),charset:"utf-8"})}):t(-6)},e=>{if(e)return Editor.failed("Failed to register protocol disable-commonjs, %s",e.message),void 0;Editor.success("protocol disable-commonjs registerred")}),Editor.Protocol.register("unpack",t.unpackUrl2path);