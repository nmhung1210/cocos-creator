var t=Editor.require("unpack://engine-dev/cocos2d/core/platform/utils").isPlainEmptyObj_DEV,e=["currentImport","webkitIndexedDB","webkitStorageInfo"],o=["object","function","boolean"],i=window;function n(t){this.info="",this.onIntroduced=this.onModified=this.onDeleted=null,this.dontRestoreIntroduce=this.dontRestoreModify=this.dontRestoreDelete=!1;var o=e;if(t){t.ignoreNames&&(o=o.concat(t.ignoreNames));var i=t.callbacks;i&&("function"==typeof i?this.onIntroduced=this.onModified=this.onDeleted=i:(this.onIntroduced=i.introduced,this.onModified=i.modified,this.onDeleted=i.deleted));var n=t.dontRestore;n&&("object"!=typeof n?this.dontRestoreIntroduce=this.dontRestoreModify=this.dontRestoreDelete=n:(this.dontRestoreIntroduce=n.introduced,this.dontRestoreModify=n.modified,this.dontRestoreDelete=n.deleted)),this.info=t.info}this.ignoreNames=o.reduce(function(t,e){return t[e]=!0,t},{}),this._snapshot={}}n.prototype={record:function(){for(var t in this._snapshot={},i)i.hasOwnProperty(t)&&!this.ignoreNames[t]&&(this._snapshot[t]=i[t]);return this},isRecorded:function(){return!t(this._snapshot)},restore:function(){var t;for(t in console.assert(this.isRecorded(),"Should recorded"),i)if(i.hasOwnProperty(t)&&!this.ignoreNames[t]){var e=i[t];if(t in this._snapshot){var n=this._snapshot[t];if(e===n)continue;if(void 0!==n){if(o.includes(typeof n)){if(this.onModified){var s=Editor.Utils.toString(n)||'""',d=Editor.Utils.toString(i[t])||'""';this.onModified(`Modified global variable while ${this.info}: ${t}\nBefore: ${s}\nAfter: ${d}`)}this.dontRestoreModify||(i[t]=n)}continue}}if(this.onIntroduced&&this.onIntroduced(`Introduced global variable while ${this.info}: ${t}`),!this.dontRestoreIntroduce){var r=!1;try{r=delete i[t]}catch(t){}r||(this._snapshot[t]=i[t]=void 0)}}for(t in this._snapshot)t in i||this.ignoreNames[t]||(this.onDeleted&&this.onDeleted(`Deleted global variable while ${this.info}: ${t}`),this.dontRestoreDelete||(i[t]=this._snapshot[t]))}},module.exports=n;