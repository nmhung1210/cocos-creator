"use strict";const e=Editor.Profile&&Editor.Profile.load("global://settings.json"),t=cc.Quat;let n={},o=cc.mat4(),c=cc.v3();function r(e){var t,n=e._components.length;for(t=0;t<n;++t){var o=e._components[t];o._enabled&&cc.director._compScheduler.disableComp(o)}for(t=0,n=e._children.length;t<n;++t){var c=e._children[t];c._active&&r(c)}}n.getObbFromRect=function(e,t,n,o,c,r){let i=t.x,s=t.y,a=t.width,l=t.height,u=e.m[0]*i+e.m[4]*s+e.m[12],d=e.m[1]*i+e.m[5]*s+e.m[13],f=e.m[0]*a,g=e.m[1]*a,m=e.m[4]*l,h=e.m[5]*l;return n=n||cc.v3(),o=o||cc.v3(),c=c||cc.v3(),r=r||cc.v3(),o.x=u,o.y=d,c.x=f+u,c.y=g+d,n.x=m+u,n.y=h+d,r.x=f+m+u,r.y=g+h+d,[n,o,c,r]},n.getWorldBounds=function(e,t,n){t=t||e.getContentSize();let c=e.getAnchorPoint(),r=t.width,i=t.height,s=new cc.Rect(-c.x*r,-c.y*i,r,i);return e.getWorldMatrix(o),s.transformMat4(s,o),n?(n.x=s.x,n.y=s.y,n.width=s.width,n.height=s.height,n):s},n.getWorldOrientedBounds=function(e,t,c,r,i,s){let a=e.getComponent(cc.MeshRenderer);if(e.getWorldMatrix(o),a)return n.getObbFromMeshRenderer(a,o);{t=t||e.getContentSize();let a=e.getAnchorPoint(),l=t.width,u=t.height,d=new cc.Rect(-a.x*l,-a.y*u,l,u),f=n.getObbFromRect(o,d,c,r,i,s),g=n.getWorldPosition3D(e);return f.forEach(e=>{e.z=g.z}),f}},n.getObbFromMeshRenderer=function(e,t){const n=Editor.require("unpack://engine-dev/cocos2d/core/geom-utils/aabb");let o=n.create(0,0,0,0,0,0);if(e&&e._boundingBox){n.clone(e._boundingBox).transform(t,null,null,null,o)}let c=cc.v3(),r=cc.v3();o.getBoundary(c,r);let i=[];return i.push(c),i.push(cc.v3(r.x,c.y,c.z)),i.push(cc.v3(r.x,r.y,c.z)),i.push(cc.v3(c.x,r.y,c.z)),i.push(r),i.push(cc.v3(c.x,r.y,r.z)),i.push(cc.v3(c.x,c.y,r.z)),i.push(cc.v3(r.x,c.y,r.z)),i},n.getScenePosition=function(e){let t=cc.director.getScene();return t?t.convertToNodeSpaceAR(n.getWorldPosition(e)):(cc.error("Can not access scenePosition if no running scene"),cc.Vec2.ZERO)},n.setScenePosition=function(e,t){let o=cc.director.getScene();if(!o)return cc.error("Can not access scenePosition if no running scene"),void 0;n.setWorldPosition(e,cc.v2(o.convertToWorldSpaceAR(t)))},n.getSceneRotation=function(e){let t=cc.director.getScene();return t?n.getWorldRotation(e)-t.angle:(cc.error("Can not access sceneRotation if no running scene"),0)},n.setSceneRotation=function(e,t){let o=cc.director.getScene();if(!o)return cc.error("Can not access sceneRotation if no running scene"),void 0;n.setWorldRotation(o.angle+t)},n.getWorldPosition=function(e){let t=e.convertToWorldSpaceAR(cc.v2(0,0));return cc.v2(t.x,t.y)},n.setWorldPosition=function(e,t){if(t instanceof cc.Vec2)if(e.parent){let n=e.parent.convertToNodeSpaceAR(t);e.x=n.x,e.y=n.y}else e.x=t.x,e.y=t.y;else cc.error("The new worldPosition must be cc.Vec2")},n.getWorldRotation=function(e){let t=e.parent;return t?t instanceof cc.Scene?e.angle+t.angle:e.angle+n.getWorldRotation(t):e.angle},n.setWorldRotation=function(e,t){if(isNaN(t))cc.error("The new worldRotation must not be NaN");else{let o=e.parent;o?o instanceof cc.Scene?e.angle=t-o.angle:e.angle=t-n.getWorldRotation(o):e.angle=t}},n.getWorldScale=function(e){e.getWorldMatrix(o);let t=o.m[0],n=o.m[1],c=o.m[4],r=o.m[5],i=new cc.Vec2;return i.x=Math.sqrt(t*t+n*n),i.y=Math.sqrt(c*c+r*r),0!==t&&t===-r&&0===n&&0===c&&(t<0?i.x=-i.x:i.y=-i.y),i},n._hasFlagInComponents=function(e,t){let n=e._components;for(let e=0,o=n.length;e<o;++e){if(n[e]._objFlags&t)return!0}return!1},n._destroyForUndo=function(e,t){cc.Node.isNode(e)&&(e._activeInHierarchy&&r(e),function(e){let t=e._components.length;for(let n=0;n<t;++n){let t=e._components[n];cc.director._nodeActivator.destroyComp(t)}for(let t=0,n=e.childrenCount;t<n;++t){let n=e._children[t];n._active&&r(n)}}(e)),t(),e.destroy()},n.getNodePath=function(e){let t="";for(;e&&!(e instanceof cc.Scene);)t=t?e.name+"/"+t:e.name,e=e._parent;return t};var i=new Array(32);function s(e){const t=e.getComponent("cc.MeshRenderer");return t?{minPosition:t._mesh._minPos,maxPosition:t._mesh._maxPos}:{minPosition:new cc.Vec3,maxPosition:new cc.Vec3}}function a(e){const t=new cc.Vec3;return cc.Vec3.subtract(t,e.maxPosition,e.minPosition),t}function l(e){const t=a(e),n=new cc.Vec3;return cc.Vec3.scaleAndAdd(n,e.minPosition,t,.5),n}function u(e,t){const n=s(t),o=a(n);e.radius=function(e){return Math.max(e.x,Math.max(e.y,e.z))}(o)/2,e.center=l(n)}function d(e,t){const n=s(t),o=a(n),c=0===o.x?1:0,r=0===o.y?1:0;if(1===c+r+(0===o.z?1:0)){const e=.001;c?o.x=e:r?o.y=e:o.z=e}e.size=o,e.center=l(n)}n.getChildUuids=function(e,t){var n=[];t&&n.push(e.uuid);var o=0;for(i[0]=e;o>=0;){var c=i[o];if(i[o]=null,--o,c){var r=c._children;if(r)for(var s=0,a=r.length;s<a;++s){var l=r[s];i[++o]=l,n.push(l.uuid)}}}return n},n.createNodeFromAsset=function(t,n){const o=require("../lib/sandbox");cc.assetManager.editorExtend.queryAssetInfo(t,(c,r,i)=>{if(c)return n(c);if(cc.js.isChildClassOf(i,cc._Script)){let e,c=Editor.Utils.UuidUtils.compressUuid(t),i=cc.js._getClassById(c);if(cc.js.isChildClassOf(i,cc.Component))(e=new cc.Node(cc.js.getClassName(i))).addComponent(i),n(null,e);else{let e=(!CC_TEST&&require("fire-url")).basename(r);"compiling"===Editor.remote.Compiler.state||o.reloading?n(new Error(`Can not load "${e}", please wait for the scene to reload.`)):n(new Error(`Can not find a component in the script "${e}".`))}}else cc.assetManager.loadAny(t,(t,o)=>{if(t)return n(t);if(o.createNode){if(o instanceof cc.Prefab){if(e&&e.get("auto-sync-prefab")){require("./prefab")._setPrefabSync(o.data,!0)}}o.createNode(n)}else n(new Error("Can not create node from "+cc.js.getClassName(i)))})})},n.createNodeFromClass=function(e,t){let n=new cc.Node,o=null;if(e){let t=cc.js._getClassById(e);if(t){var c=n.addComponent(t);c&&cc.director._nodeActivator.resetComp(c,!0)}else o=new Error(`Unknown node to create: ${e}`)}t&&t(o,n)},n.makeVec3InPrecision=function(e,t){return e.x=Editor.Math.toPrecision(e.x,t),e.y=Editor.Math.toPrecision(e.y,t),e.z=Editor.Math.toPrecision(e.z,t),e},n.getWorldPosition3D=function(e){let t=cc.mat4(),n=cc.v3(0,0,0);return e.getWorldMatrix(t),cc.Vec3.transformMat4(n,n,t),n},n.setWorldPosition3D=function(e,t,o=3){if(null==e)return;let c=cc.v3();if(t instanceof cc.Vec3){if(e.parent){let n=cc.mat4(),o=cc.mat4();e.parent.getWorldMatrix(n),cc.Mat4.invert(o,n),cc.Vec3.transformMat4(c,t,o)}else c=t;c=n.makeVec3InPrecision(c,o),e.setPosition(c.x,c.y,c.z)}else cc.error("The new worldPosition must be cc.Vec3")},n.getWorldRotation3D=function(e){let o=e.parent,c=cc.quat(0,0,0,1),r=cc.quat(0,0,0,1);return e.getRotation(r),o?(t.mul(c,n.getWorldRotation3D(o),r),c):r},n.setWorldRotation3D=function(e,o,c=3){if(o instanceof cc.Quat){let r=e.parent,i=cc.quat(0,0,0,1),s=cc.quat(0,0,0,1);r?(r.getRotation(i),t.conjugate(i,i),t.mul(s,i,o)):s=o;let a=cc.v3();t.toEuler(a,s),a=n.makeVec3InPrecision(a,c),n.setEulerAngles(e,a)}else cc.error("The new worldRotation must be Quat")},n.getEulerAngles=function(e){return e.eulerAngles},n.setEulerAngles=function(e,t){e.eulerAngles=t},n.getWorldScale3D=function(e){return e.getWorldScale(c)};let f={PhysicsSphereColliderComponent:u,PhysicsBoxColliderComponent:d,SphereColliderComponent:u,BoxColliderComponent:d};n.addComponentHandle=function(e,t){t.constructor&&f[t.constructor.name]&&f[t.constructor.name](t,e)},module.exports=n;