"use strict";let t=require("./controller-base"),e=require("../utils/controller-utils");const{create3DNode:i,setMeshColor:o}=require("../../../utils/engine"),r=require("../../../utils/external").EditorCamera;let l=cc.v3();module.exports=class extends t{constructor(t){super(t),this._editable=!1,this._edit=!1,this._editControllerShape=null,this._defaultEditCtrlSize=5,this._hoverColor=cc.Color.GREEN,this._editCtrlScales={},r._camera.node.on("transform-changed",this.onEditorCameraMoved,this)}get editable(){return this._editable}set editable(t){this._editable=t}get edit(){return this._edit}set edit(t){this._editable&&(this._edit=t,!0===this._edit?(this.initEditController(),this._editControllerShape.active=!0):this.hideEditController())}get hoverColor(){return this._hoverColor}set hoverColor(t){this._hoverColor=t}createEditControllerShape(){this._editControllerShape=i("EditControllerShape"),this._editControllerShape.parent=this.shape}setEditCtrlColor(t){this.editable&&this.edit&&Object.keys(this._axisDir).forEach(e=>{let i=this._axisDataMap[e];if(i){let e=i.topNode;o(e,t)}})}hideEditController(){this._editControllerShape&&(this._editControllerShape.active=!1)}createEditController(t,i){let o=this._defaultEditCtrlSize,r=e.quad(o,o,i,{unlit:!0});r.name=t,r.parent=this._editControllerShape,this._editCtrlScales[t]=cc.v3(1,1,1),this.initAxis(r,t),this._updateEditController(t)}initEditController(){this._editControllerShape||(this.createEditControllerShape(),Object.keys(this._axisDir).forEach(t=>{this.createEditController(t,this._color)}))}_updateEditController(t){}updateEditControllers(){Object.keys(this._axisDir).forEach(t=>{this._updateEditController(t)})}checkEdit(){this.editable?this.edit=!0:this.hideEditController()}onHoverIn(t){this.setAxisColor(t.axisName,this.hoverColor)}onHoverOut(){this.resetAxisColor()}onEditorCameraMoved(){this.adjustEditControllerSize()}adjustEditControllerSize(){this.edit&&Object.keys(this._axisDir).forEach(t=>{let e=this._axisDataMap[t];if(e){let t=e.topNode;t.getWorldPosition(l);let i=1;i=this.is2D?1/this.scale2D:this.getCameraDistScalar(l),this._editCtrlScales[this._axisDir]=i,t.setWorldScale(cc.v3(i,i,i));let o=cc.quat();r._camera.node.getWorldRotation(o),t.setWorldRotation(o)}})}setPosition(t){super.setPosition(t),this._editControllerShape&&this._editControllerShape.setPosition(t)}setRotation(t){super.setRotation(t),this._editControllerShape&&this._editControllerShape.setRotation(t)}onShow(){this._editControllerShape&&(this._editControllerShape.active=!0)}onHide(){this._editControllerShape&&(this._editControllerShape.active=!1)}};