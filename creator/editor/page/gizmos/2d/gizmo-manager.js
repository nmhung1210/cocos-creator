"use strict";const{create3DNode:e,getRaycastResults:o}=require("../utils/engine");let t=cc.v3();module.exports={init(){this.gizmoRootNode=e("gizmoRoot"),this.gizmoRootNode.parent=_Scene.view.foregroundNode,this.recordLastX=0,this.recordLastY=0,this.hoverinNode=null,this.curSelectNode=null},onMouseDown(e){if(!e.button&&1===e.which){let i=e.offsetX,n=cc.game.canvas.height-e.offsetY;this.recordLastX=i,this.recordLastY=n;let s=o(this.gizmoRootNode,i,n),c=s.ray;if(s.length>0){let e=s[0],o=new cc.Event("mouseDown",!0);return cc.Vec3.scale(t,c.d,e.distance),cc.Vec3.add(t,c.o,t),o.hitPoint=t,o.x=i,o.y=n,this.curSelectNode=e.node,this.curSelectNode.emit(o.type,o),!0}}},onMouseWheel(){},onMouseMove(e){let t=e.offsetX,i=cc.game.canvas.height-e.offsetY,n=o(this.gizmoRootNode,t,i),s=new cc.Event("mouseMove",!0);if(s.x=t,s.y=i,s.moveDeltaX=e.movementX,s.moveDeltaY=-e.movementY,null!=this.curSelectNode)this.curSelectNode.emit(s.type,s);else if(n.length>0){let e=n[0].node;e!=this.hoverinNode&&(null!=this.hoverinNode&&(s=new cc.Event("hoverOut",!0),this.hoverinNode.emit(s.type,s)),this.hoverinNode=e,s=new cc.Event("hoverIn",!0),this.hoverinNode.emit(s.type,s))}else null!=this.hoverinNode&&(s=new cc.Event("hoverOut",!0),this.hoverinNode.emit(s.type,s)),this.hoverinNode=null},onMouseUp(e){let t=e.offsetX,i=cc.game.canvas.height-e.offsetY,n=new cc.Event("mouseUp",!0);if(null!=this.curSelectNode)return this.curSelectNode.emit(n.type,n),this.curSelectNode=null,!0;{let e=o(this.gizmoRootNode,t,i);for(let o=0;o<e.length;o++)e[o].node.emit(n.type,n)}},onMouseLeave(){let e=new cc.Event("mouseLeave",!0);null!=this.curSelectNode&&(this.curSelectNode.emit(e.type,e),this.curSelectNode=null)},onKeyDown(e){_Scene.gizmosView&&_Scene.gizmosView.svg.transform&&_Scene.gizmosView.svg.transform.onGizmoKeyDown&&_Scene.gizmosView.svg.transform.onGizmoKeyDown(e)},onKeyUp(e){_Scene.gizmosView&&_Scene.gizmosView.svg.transform&&_Scene.gizmosView.svg.transform.onGizmoKeyUp&&_Scene.gizmosView.svg.transform.onGizmoKeyUp(e)}};