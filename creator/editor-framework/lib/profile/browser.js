"use strict";const{EventEmitter:e}=require("events"),r=require("@base/electron-profile"),t=require("@base/electron-profile/lib/browser/data");let o={getData(e,o){const a=s.join(r._type2path[e],o);return t.get()[a]}};global.__Profile__=o;const a=require("../app"),s=require("path"),i=require("fs-extra"),{checkMigrate:l,adaptProfile:n,setDefaultData:u,url2profile:c}=require("./utils");module.exports=new class extends e{query(e){return r.query(e)}register(e,t){r.register(e,t)}clear(){r.clear()}inherit(e,t){r.inherit(e,t)}reset(){console.warn("'Editor.Profile.reset' has been deprecated, please use 'Editor.Profile.clear'."),r.clear()}getPath(e){return console.warn("'Editor.Profile.getPath' has been deprecated, please use 'Editor.Profile.query'."),r.query(e)}setDefault(e,r){console.warn("'Editor.Profile.setDefault' has been deprecated. please use profile.set(key, value)."),u(e,r)}load(e,t){try{let s=c[e];return s||(l(e,a.home),(s=r.load(e))&&(s=n(s),t&&u(e,t),Object.defineProperty(s,"data",{get(){return console.warn(`'${this._type}/${this._file} data' has been deprecated, please use 'profile.get'`),o.getData(this._type,this._file)}})),c[e]=s,s)}catch(e){return console.error(e),null}}mount(e,r){u(e,r)}};if(r.on("change",e=>{let r=c[e];r&&r.emit("changed")}),s.isAbsolute(a.home)){const e=s.join(a.home,"default-profiles");i.ensureDirSync(e),r.register("default",e);const t=s.join(a.home,"profiles");i.ensureDirSync(t),r.register("global",t)}r.inherit("global","default"),function(){try{const e=s.join(a.home,"profiles");let r=s.join(e,"layout.windows.json"),t=s.join(e,"layout.dashboard.json");!i.existsSync(t)&&i.existsSync(r)&&i.renameSync(r,t)}catch(e){console.error(e)}}();