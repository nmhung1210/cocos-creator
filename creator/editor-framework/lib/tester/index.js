"use strict";const e=require("fire-path"),r=require("fire-fs"),n=require("chalk");process.on("message",e=>{switch(e.channel){case"tester:reload":if(!Editor.Window.main)return;Editor.Window.main.nativeWin.reload();break;case"tester:active-window":if(!Editor.Window.main)return;Editor.Window.main.nativeWin.focus();break;case"tester:exit":process.exit(0)}});let i={runPackage(r,n,o){require("find-up")("package.json",{cwd:r}).then(s=>{if(!s)return t(`Cannot find package.json in ${s}`),void 0;let a=e.dirname(s);e.isAbsolute(a)||(a=e.join(Editor.App.path,a)),Editor.Package.load(a,()=>{let t=!0;if(-1!==r.indexOf("test")&&(t=!1),t){const r=require("async");let t=0,s=e.join(a,"test");return r.series([r=>{i.runRenderer(e.join(s,"renderer"),n,e=>{t+=e,r()})},r=>{i.runMain(e.join(s,"main"),n,e=>{t+=e,r()})}],()=>{o&&o(t)}),void 0}if(n.renderer||-1!==r.indexOf("renderer"))return i.runRenderer(r,n,o),void 0;i.runMain(r,n,o)})})},runRenderer(e,r,n){try{require("./renderer/runner-main")(e,r,n)}catch(e){t(e),process.exit(1)}},runMain(e,r,n){try{require("./main/runner")(e,r,n)}catch(e){t(e),process.exit(1)}},run(n,o){if(n=n||e.join(Editor.App.path,"test"),!r.existsSync(n))return t(`The path ${n} you provide does not exist.`),process.exit(1),void 0;function s(e){process.send&&process.send({channel:"process:end",failures:e,path:n}),process.exit(e)}return Editor.Menu.register("main-menu",require("./main-menu"),!0),Editor.MainMenu.init(),o.package?(i.runPackage(n,o,s),void 0):o.renderer||-1!==n.indexOf("renderer")?(i.runRenderer(n,o,s),void 0):(i.runMain(n,o,s),void 0)}};function t(e){console.log(n.red(e))}module.exports=i;