"use strict";const t=require("../utils/dom-utils"),e=require("../utils/drag-drop");let r={get droppable(){return this.getAttribute("droppable")},set droppable(t){this.setAttribute("droppable",t)},get multi(){return null!==this.getAttribute("multi")},set multi(t){t?this.setAttribute("multi",""):this.removeAttribute("multi")},get canDrop(){return this._canDrop},_initDroppable(r){let a=r.shadowRoot||r;this._dragenterCnt=0,this._canDrop=!1,a.addEventListener("dragenter",r=>{if(++this._dragenterCnt,1===this._dragenterCnt){this._canDrop=!1;let a=[];null!==this.droppable&&(a=this.droppable.split(","));let i=e.type(r.dataTransfer),s=!1;for(let t=0;t<a.length;++t)if(i===a[t]){s=!0;break}if(!s)return this._canDrop=!1,void 0;let n=e.getLength();if("file"===i&&0===n&&(n=r.dataTransfer.items.length),!this.multi&&n>1)return this._canDrop=!1,void 0;r.stopPropagation(),this._canDrop=!0,this.setAttribute("drag-hovering",""),t.fire(this,"drop-area-enter",{bubbles:!0,detail:{target:r.target,dataTransfer:r.dataTransfer,clientX:r.clientX,clientY:r.clientY,offsetX:r.offsetX,offsetY:r.offsetY,dragType:i,dragItems:e.items(r.dataTransfer),dragOptions:e.options()}})}}),a.addEventListener("dragleave",e=>{if(--this._dragenterCnt,0===this._dragenterCnt){if(!this._canDrop)return;e.stopPropagation(),this.removeAttribute("drag-hovering"),t.fire(this,"drop-area-leave",{bubbles:!0,detail:{target:e.target,dataTransfer:e.dataTransfer}})}}),a.addEventListener("drop",r=>{this._dragenterCnt=0,this._canDrop&&(r.preventDefault(),r.stopPropagation(),this.removeAttribute("drag-hovering"),t.fire(this,"drop-area-accept",{bubbles:!0,detail:{target:r.target,dataTransfer:r.dataTransfer,clientX:r.clientX,clientY:r.clientY,offsetX:r.offsetX,offsetY:r.offsetY,dragType:e.type(r.dataTransfer),dragItems:e.items(r.dataTransfer),dragOptions:e.options()}}))}),a.addEventListener("dragover",r=>{this._canDrop&&(r.preventDefault(),r.stopPropagation(),t.fire(this,"drop-area-move",{bubbles:!0,detail:{target:r.target,clientX:r.clientX,clientY:r.clientY,offsetX:r.offsetX,offsetY:r.offsetY,dataTransfer:r.dataTransfer,dragType:e.type(r.dataTransfer),dragItems:e.items(r.dataTransfer),dragOptions:e.options()}}))})}};module.exports=r;