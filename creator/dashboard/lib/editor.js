"use strict";const{app:e,dialog:o,BrowserWindow:t}=require("electron"),{spawn:r}=require("child_process"),{join:s}=require("path");let n=[],i=e.getPath("exe");exports.startup=function(t,d,a){let l=s(t,"local/logs/project.log"),c=[Editor.App.path,"--path",t,"--logfile",l];d||c.push("--nologin"),a&&(c.push("--dev"),c.push("--inspect=1988")),Editor.showInternalMount&&c.push("--internal");let h=r(i,c,{stdio:[0,1,2,"ipc"],env:process.env});process.env.checkedVersion=!1;let p=[],u=!1,f=function(){if(u)return;u=!0;let e=p.shift();if(1!==o.showMessageBox({type:"error",buttons:["OK","Abort"],title:"Error",message:e.message,detail:e.stack,defaultId:0,cancelId:0}))return p.length>0&&f(),u=!1,void 0;setTimeout(()=>{p.length=0,h.kill(),u=!1},200)};return h.on("message",e=>{"show-dashboard"===e.channel?(Editor.Ipc.sendToMainWin("dashboard:refresh-recent-project"),Editor.Ipc.sendToMainWin("dashboard:refresh-last-create"),Editor.Window.main.show()):"editor-error"===e.channel&&(p.push(e),f())}),h.on("close",()=>{let o=n.indexOf(h);-1!==o&&n.splice(o,1),0===n.length&&(Editor.Ipc.sendToMainWin("dashboard:refresh-recent-project"),Editor.Ipc.sendToMainWin("dashboard:refresh-last-create"),Editor.Window.main.show(),e.dock&&e.dock.show())}),n.push(h),e.dock&&e.dock.hide(),h},exports.closeAll=function(){for(;n.length>0;)n.pop().kill()},exports.isEmpty=function(){return n.length<=0};