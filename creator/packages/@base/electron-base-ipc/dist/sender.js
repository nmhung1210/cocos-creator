"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const electron_1=require("electron"),pkg=require("../package.json"),ipcFlag=`${pkg.name}@${pkg.version}`,_id2sender=Object.create(null);let _senderID=0;class Sender{static query(e){return _id2sender[e]}static remove(e){delete _id2sender[e]}constructor(e){this.id=_senderID++,e.cid=this.id,this.options=e}promise(){return new Promise((e,s)=>{this.options.needCallback=!0,_id2sender[this.id]=this,this._callback=function(i,t){return i?s(i):e(t)}})}callback(e){return"function"!=typeof e?this:(this.options.needCallback=!0,_id2sender[this.id]=this,this._callback=e,this)}timeout(e){return clearTimeout(this._timer),"number"!=typeof e||e<0?this:(this._timer=setTimeout(()=>{this._callback&&this._callback(new Error("Message timeout")),delete _id2sender[this.id]},e),this)}option(e){return this.options.original=e.original,this}immediately(){}}class MainSender extends Sender{constructor(e){super(e),this._send=!1,process.nextTick(()=>{this.immediately()})}immediately(){this._send||(this._send=!0,electron_1.ipcRenderer.send(`${ipcFlag}:send`,this.options))}}exports.MainSender=MainSender;class EventSender extends Sender{constructor(e,s){super(s),this._send=!1,this._events=e,process.nextTick(()=>{this.immediately()})}immediately(){if(this._send)return;this._send=!0;let e=this._callback,s={senderType:process.type,needCallback:this.options.needCallback,reply(...s){e&&e(...s),e=void 0}};this._events.forEach(e=>{e(s,...this.options.arguments)})}}exports.EventSender=EventSender;class WindowSender extends Sender{constructor(e,s){super(s),this._send=!1,this._win=e,process.nextTick(()=>{this.immediately()})}immediately(){this._send||(this._send=!0,this._win.send(`${ipcFlag}:send`,this.options))}}exports.WindowSender=WindowSender;class WindowIDSender extends Sender{constructor(e,s){super(s),this._send=!1,this._id=e,process.nextTick(()=>{this.immediately()})}immediately(){this._send||(this._send=!0,-1===this._id?electron_1.ipcRenderer.send(`${ipcFlag}:send`,this.options):electron_1.ipcRenderer.sendTo(this._id,`${ipcFlag}:send`,this.options))}}exports.WindowIDSender=WindowIDSender;