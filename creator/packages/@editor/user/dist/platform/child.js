"use strict";var __awaiter=this&&this.__awaiter||function(e,n,s,o){return new(s||(s=Promise))(function(r,t){function c(e){try{a(o.next(e))}catch(e){t(e)}}function i(e){try{a(o.throw(e))}catch(e){t(e)}}function a(e){e.done?r(e.value):new s(function(n){n(e.value)}).then(c,i)}a((o=o.apply(e,n||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0});const{EventEmitter:EventEmitter}=require("events"),EventManager=new EventEmitter;let sendID=1;const sendMap={};function getData(){return __awaiter(this,void 0,void 0,function*(){return new Promise((e,n)=>{sendMap[sendID]={resolve:e,reject:n},process.send&&process.send({channel:"cocos-user",id:sendID++,func:"getData",params:[]})})})}function isLoggedIn(){return __awaiter(this,void 0,void 0,function*(){return new Promise((e,n)=>{sendMap[sendID]={resolve:e,reject:n},process.send&&process.send({channel:"cocos-user",id:sendID++,func:"isLoggedIn",params:[]})})})}function login(e,n){return new Promise((s,o)=>{sendMap[sendID]={resolve:s,reject:o},process.send&&process.send({channel:"cocos-user",id:sendID++,func:"login",params:[e,n]})})}function logout(){return new Promise((e,n)=>{sendMap[sendID]={resolve:e,reject:n},process.send&&process.send({channel:"cocos-user",id:sendID++,func:"logout",params:[]})})}function getUserToken(){return new Promise((e,n)=>{sendMap[sendID]={resolve:e,reject:n},process.send&&process.send({channel:"cocos-user",id:sendID++,func:"getUserToken",params:[]})})}function getSessionCode(e){return new Promise((n,s)=>{sendMap[sendID]={resolve:n,reject:s},process.send&&process.send({channel:"cocos-user",id:sendID++,func:"getSessionCode",params:[e]})})}function emit(...e){EventManager.emit(...e)}function on(...e){EventManager.on(...e)}function once(...e){EventManager.once(...e)}function removeListener(...e){EventManager.removeListener(...e)}process.on("message",e=>{if(!e||!e.channel||"cocos-user"!==e.channel)return;if(e.emit)return void emit(e.emit,...e.result||[]);const n=sendMap[e.id];return n?(delete sendMap[e.id],e.error?n.reject(new Error(e.error)):n.resolve(e.result)):void 0}),exports.getData=getData,exports.isLoggedIn=isLoggedIn,exports.login=login,exports.logout=logout,exports.getUserToken=getUserToken,exports.getSessionCode=getSessionCode,exports.emit=emit,exports.on=on,exports.once=once,exports.removeListener=removeListener;